<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:site_name" content="MeuPix/Loja">
	<meta property="article:author" content="@DaviMaTaeus">
    <meta property="og:description" content="Compre produtos exclusivos na nossa loja online! Carrinho fácil, checkout rápido e histórico de pedidos. Pague com Pix!">
    <meta property="og:image" content="pagamentos.files/imagens/metaTag.png">
    <meta property="og:locale" content="pt_BR">
    <meta property="og:type" content="website">
    <meta name="theme-color" content="#ffa200e0">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Loja Virtual">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" id="dynamic-manifest">

    <link rel="icon" href="pagamentos.files/imagens/favicon.png" type="image/png">
    <link href="pagamentos.files/imagens/favicon.png" rel="shortcut icon" type="image/png">
    <title>Meu Pix - Loja online</title>
    <!-- Fontes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
    /* Cores Globais */
    :root {
    --primary-color: #ff6b6b;
    --secondary-color: #4ecdc4;
    --text-color: #ffffff;
    --background-color: #f9f9f9;
    --light-gray: #ddd;
    --success-color: #2ecc71;
    --error-color: #e74c3c;
    --floating-cart-bg: linear-gradient(120deg, #ffa200a6, #ff5e00a2);
}

    /* Estilos Globais */
    body {
    background-image: url(pagamentos.files/imagens/capa-pix.png);
    font-family: 'Poppins', sans-serif;
    background-color: var(--background-color);
    color: var(--text-color);
    line-height: 1.6;
    margin: 0;
    padding: 0;
}


    /* Header Styles */
header {
    text-align: center;
    padding: 20px;
    border-radius: 10px;
    backdrop-filter: blur(8px);
    box-shadow: 0px 0px 23px 0 #05a58285;
    background: linear-gradient(120deg, #2069587d, #05a58266);
}

    header img {
    max-width: 200px;
    height: auto;
    border-radius: 10px;
}

    header h1 {
    font-family: 'Poppins', sans-serif;
    color: white;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

    header p {
    font-size: 18px;
    color: #fff;
    font-weight: bold;
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
}

    /* Container Principal */
.container {
    margin-right: 30px;
    margin-left: 30px;
    margin-top: 20px;
    margin-bottom: 20px;
    padding: 20px;
    box-shadow: 0px 0px 23px 0 #05a58285;
    background: linear-gradient(120deg, #2069587d, #05a58266);
    border-radius: 15px;
    display: flex;
    backdrop-filter: blur(8px);
}
    /* Seção de Produtos */
.products {
    flex: 2;
    padding-right: 20px;
    border-right: 1px solid var(--light-gray);
    width: 800px;
    text-align: center;
}

.products h2 {
    font-size: 1.4em;
    margin-bottom: 15px;
}

    /* Lista de Produtos */
#productList {
    display: flex;
    flex-wrap: wrap;
    justify-content: flex-start;
}

    /* Item de Produto */
.product {
    width: calc(50% - 20px);
    padding: 15px;
    margin-bottom: 20px;
    margin-right: 20px;
    text-align: center;
    position: relative;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    box-sizing: border-box;
    border-radius: 15px;
    box-shadow: 0 0 10px rgb(0 0 0 / 53%);
    background: linear-gradient(24deg, #ff00007c, #0004ff86);
}

.product:nth-child(2n) {
    margin-right: 0;
}

.product:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

.product img {
    max-width: 100%;
    height: auto;
    margin-bottom: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    transition: opacity 0.3s ease;
}

.product img:hover {
    opacity: 0.9;
}

.product h3 {
    font-size: 1.5em;
    margin-bottom: 8px;
    color: #ffffff;
    transition: color 0.3s ease;
}

.product:hover h3 {
    color: darken(#3498db, 10%);
}


.product p {
    font-size: 1.2em;
    margin-bottom: 12px;
    color: #ffffff;
}

    /* Badge de Desconto */
.discount-badge {
    position: absolute;
    top: 10px;
    left: 10px;
    background: linear-gradient(118deg, #ff0000ad, #cc0000c4);
    color: white;
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 0.9em;
    z-index: 1;
    backdrop-filter: blur(8px);
}

.discount-carrossel {
    position: absolute;
    top: 19px;
    margin-left: 20px;
    background: linear-gradient(118deg, #ff0000b3, #cc0000b0);
    color: white;
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 0.9em;
    z-index: 1;
    box-shadow: 0 0 15px #0000009a;
    backdrop-filter: blur(8px);
}

    /* Barra Lateral */
aside {
    flex: 1;
    padding-left: 20px;
}

 
.tab-button {
    flex: 1; /* Distribui o espaço igualmente entre os botões */
    background: linear-gradient(120deg, #206958b8, #05a582a1);
    border: none;
    padding: 10px 0; /* Reduz o preenchimento vertical */
    cursor: pointer;
    border-radius: 10px 10px 0 0;
    font-size: 0.9em; /* Reduz o tamanho da fonte */
    font-weight: 500;
    color: #fff;
    transition: all 0.3s ease;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    position: relative;
    overflow: hidden;
    z-index: 2;
    text-align: center; /* Centraliza o texto */
    white-space: nowrap; /* Evita que o texto quebre a linha */
    overflow: hidden; /* Esconde o texto que ultrapassa as bordas */
    text-overflow: ellipsis; /* Adiciona "..." ao texto que ultrapassa */
    margin: 0 2px; /* Adiciona margem lateral para separação */
}

/* =========================================== */
/* === NOVOS ESTILOS PARA O CARD DE PRODUTO === */
/* =========================================== */

.product-card {
    background: linear-gradient(145deg, rgba(44, 62, 80, 0.5), rgba(52, 73, 94, 0.7));
    border-radius: 16px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: #ecf0f1;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.product-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.6);
}

.product-info {
    padding: 20px;
    display: flex;
    flex-direction: column;
    flex-grow: 1;
}

.product-info h3 {
    font-size: 1.4em;
    font-weight: 600;
    margin: 0 0 10px 0;
    line-height: 1.3;
}

.product-price {
    font-size: 1.1em;
    margin-bottom: 15px;
}

.product-price .original-price {
    text-decoration: line-through;
    color: #e74c3c;
    margin-right: 8px;
    opacity: 0.8;
}

.product-price .current-price {
    font-size: 1.3em;
    font-weight: 700;
    color: #2ecc71;
}

.product-options { 
   display: flex
;
    align-items: center;
    justify-content: space-between;
    background-color: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    margin-bottom: 10px;
    padding: 5px;
    margin-top: 10px;
}
.product-actions { margin-bottom: auto; } /* Empurra os botões para baixo */


.tab-button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 50%;
    height: 100%;
    background: linear-gradient(to right, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.3));
    transform: skewX(-45deg);
    transition: left 0.4s ease;
    z-index: 1;
}

.tab-button:hover::before {
    left: 150%;
}

.tab-button:hover {
    background: linear-gradient(120deg, #05a582a1, #206958b8);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

.tab-button.active {
    box-shadow: 0 0 15px #ff6700;
    background: linear-gradient(231deg, #ffa200e0, #ff5d00e0);
    color: #fff;
    z-index: 3;
}

/* Estilo base para os botões */
button {
    padding: 12px 18px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    outline: none;
}

.button-group {
    margin-bottom: 20px;
    display: flex;
    justify-content: space-between;
    gap: 12px;
    margin-top: 16px;
    flex-wrap: wrap;
}


/* Estilo base para os botões */
button {
  border: none;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s ease; /* Transição para todos os atributos */
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); /* Sombra mais pronunciada */
  outline: none;
  font-weight: 500; /* Peso da fonte um pouco mais forte */
    position: relative; /* Necessário para efeitos de brilho */
    overflow: hidden; /* Esconde o brilho que ultrapassa as bordas */
}

/* =========================================== */
/* === NOVOS ESTILOS PARA CONTROLE DE QTD   === */
/* =========================================== */
.quantity-selector {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background-color: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    margin-bottom: 10px;
    padding: 5px;
    margin-top: 10px;
}

.quantity-selector label {
    margin: 0;
    padding-left: 10px;
    font-weight: 500;
}

.quantity-controls {
    display: flex;
    align-items: center;
    padding-left: 10px;
}

.quantity-controls button {
    background: linear-gradient(120deg, #34495e, #2c3e50);
    color: white;
    border: none;
    width: 36px;
    height: 36px;
    border-radius: 6px;
    font-size: 1.4em;
    cursor: pointer;
    transition: background 0.2s;
    box-shadow: none;
        display: flex;
    align-items: center;
    justify-content: center;
}

.quantity-controls button:hover { background: #3498db; }
.quantity-controls span {
    font-size: 1.2em;
    font-weight: bold;
    padding: 0 15px;
  position: relative; /* Necessário para efeitos de brilho */
  overflow: hidden; /* Esconde o brilho que ultrapassa as bordas */
}

/* Efeito de brilho (Opcional, mas adiciona um toque premium) */
button::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 50%;
  height: 100%;
  margin-bottom: 10px;
  background: linear-gradient(to right, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.4));
  transform: skewX(-45deg);
  transition: left 0.4s ease;
  z-index: 1;
}

button:hover::before {
  left: 150%;
}

/* Estilos para os botões primários */
.ButtonCompraComDinheiro {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: space-around;
    padding: 15px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    flex-direction: column;
    box-shadow: 0 0 15px #000000c7;
    background: linear-gradient(167deg, #3498db, #2980b9);
    color: #fff;
}

.ButtonCompraComDinheiro:hover {
  background: linear-gradient(120deg, #d35400, #f39c12); /* Inverte o gradiente no hover */
  transform: translateY(-3px); /* Elevação um pouco maior */
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3); /* Sombra mais intensa */
}

/* Estilos para os botões secundários */
.ButtonCompraComPix {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: space-around;
    padding: 15px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    flex-direction: column;
    box-shadow: 0 0 15px #000000c7;
        background: linear-gradient(120deg, #206958, #05a582);
    color: #fff;
}

.ButtonCompraComPix:hover {
  background: linear-gradient(120deg, #d35400, #f39c12); /* Inverte o gradiente no hover */
  transform: translateY(-3px); /* Elevação um pouco maior */
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3); /* Sombra mais intensa */
}

.add-to-cart-button {
    background: linear-gradient(120deg, #3498db, #2980b9);
    box-shadow: 0 0 15px #000000a3;
    margin-bottom: 10px;
    color: #fff;
    width: 100%;
}

.add-to-cart-button:hover {
    background: linear-gradient(120deg, #d35400, #f39c12);
    transform: translateY(-3px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
}

/* Estilos para os botões desabilitados */
button:disabled {
  background: #ddd; /* Cinza claro */
  color: #999;
  cursor: not-allowed; /* Altera o cursor para indicar que não é clicável */
  box-shadow: none; /* Remove a sombra */
  transform: none; /* Remove a elevação */
  opacity: 0.7; /* Diminui a opacidade para indicar que está desabilitado */
}


/* Estilo adicional para os botões para dar um efeito 3D suave */
button {
  border: 1px solid rgba(0, 0, 0, 0.1);
  background-clip: padding-box; /* Evita que o gradiente se estenda sob a borda */
}

/* Sutil efeito de relevo no hover */
button:hover {
  border-color: rgba(0, 0, 0, 0.2);
}

.button-container {
  display: flex;
  flex-direction: column;
}

#orderHistoryList button {
  margin-top: 12px; 
  padding: 12px 20px; 
  border-radius: 10px; 
  font-size: 1em;
  font-weight: 500; 
  border: none; 
  background: linear-gradient(120deg, #7986cb, #3f51b5); 
  color: #fff; 
  cursor: pointer; 
  transition: all 0.3s ease; 
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2); 
  position: relative; 
  overflow: hidden; 
}

#orderHistoryList button::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 50%;
  height: 100%;
  background: linear-gradient(to right, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.3));
  transform: skewX(-45deg);
  transition: left 0.4s ease;
  z-index: 1;
}

#orderHistoryList button:hover::before {
  left: 150%;
}

#orderHistoryList button:hover {
  transform: translateY(-2px); 
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); 
  background: linear-gradient(120deg, #3f51b5, #7986cb); 
}


#orderHistoryList button {
    margin-top: 10px;
    padding: 10px 15px;
    border-radius: 8px;
    font-size: 1em;
}

.pagination-buttons {
    display: flex;
    margin-top: 20px;
    justify-content: space-evenly;
}

.tabs {
    display: flex;
    margin-bottom: 20px;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

/* --- Novo Design do Carrinho --- */

#cartList {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 15px; /* Espaço entre os itens */
}

/* O Cartão do Produto */
.cart-item {
    display: grid;
    grid-template-columns: auto 1fr auto;
    align-items: center;
    gap: 1rem;
    padding: 1.25rem 0.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    transition: background-color 0.3s ease;
}

.cart-item:hover {
    transform: translateX(5px);
    background: rgba(255, 255, 255, 0.15);
    border-color: rgba(255, 255, 255, 0.3);
}

/* Imagem */
.cart-item-img-wrapper {
    flex-shrink: 0;
    width: 80px;
    height: 80px;
    border-radius: 10px;
    overflow: hidden;
    margin-right: 15px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.2);
}

.cart-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}

/* Informações (Meio) */
.cart-item-info {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    min-width: 0; /* Evita que texto longo quebre o layout */
}

.cart-item-info .item-name {
    font-size: 1rem;
    font-weight: 600;
    color: #fff;
    margin-bottom: 4px;
    overflow: hidden;
    text-overflow: ellipsis;
}

.cart-item-info .item-badges {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    margin-bottom: 6px;
}

.item-badge {
    font-size: 0.75rem;
    padding: 2px 8px;
    border-radius: 12px;
    background: rgba(0, 0, 0, 0.3);
    color: #ddd;
    border: 1px solid rgba(255,255,255,0.1);
}

.cart-item-info .item-price {
    color: #2ecc71; /* Verde Sucesso */
    font-weight: 700;
    font-size: 1.1rem;
}

/* Ações (Direita - Qtd e Lixeira) */
.cart-actions {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    margin-left: 10px;
}

/* Novo Stepper de Quantidade Compacto */
.cart-stepper {
    display: flex;
    align-items: center;
    background: rgba(0,0,0,0.25);
    border-radius: 20px;
    padding: 2px;
}

.cart-stepper button {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    border: none;
    background: transparent;
    color: #fff;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: none; /* Remove sombras globais dos botões */
}

.cart-stepper button:hover {
    background: rgba(255,255,255,0.2);
}

.cart-stepper span {
    font-size: 0.9rem;
    font-weight: 600;
    padding: 0 8px;
    min-width: 20px;
    text-align: center;
}

/* Botão de Excluir */
.btn-remove-item {
    color: #ff6b6b;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 1rem;
    opacity: 0.7;
    transition: all 0.2s;
    box-shadow: none;
    padding: 5px;
}

.btn-remove-item:hover {
    opacity: 1;
    transform: scale(1.1);
    color: #ff4757;
}

/* --- Estado Vazio (Empty State) --- */
.empty-cart-container {
    text-align: center;
    padding: 40px 20px;
    background: rgba(0,0,0,0.2);
    border-radius: 15px;
    border: 2px dashed rgba(255,255,255,0.1);
}

.empty-cart-icon {
    font-size: 4rem;
    color: rgba(255,255,255,0.2);
    margin-bottom: 15px;
}

.empty-cart-text {
    font-size: 1.2rem;
    color: #ccc;
    margin-bottom: 20px;
}

.btn-go-shopping {
    background: linear-gradient(45deg, #2ecc71, #27ae60);
    color: white;
    padding: 10px 20px;
    border-radius: 25px;
    text-decoration: none;
    font-weight: bold;
    display: inline-block;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(46, 204, 113, 0.4);
}

/* Animação de entrada */
@keyframes slideInLeft {
    from { opacity: 0; transform: translateX(-20px); }
    to { opacity: 1; transform: translateX(0); }
}

/* Responsividade Mobile */
@media (max-width: 480px) {
    .cart-item {
        padding: 10px;
    }
    .cart-item-img-wrapper {
        width: 60px;
        height: 60px;
    }
    .cart-item-info .item-name {
        font-size: 0.95rem;
    }
    .item-badge {
        font-size: 0.7rem;
    }
}

#cartTotal {
    font-weight: bold;
    color: #2ecc71;
}


.form-group {
    margin-bottom: 15px;
}

.form-group label {
    margin-bottom: 5px;
    font-weight: 500;
}

.form-group input[type="text"],
.form-group input[type="Email"],
.form-group input[type="number"],
.form-group input[type="Nome"],
.form-group textarea,
.form-group select {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 1em;
    box-sizing: border-box;
    box-shadow: 0 0 15px #0000009a;
}

.form-group textarea {
    resize: vertical;
    min-height: 100px;
}

#orderHistoryList button {
    margin-top: 10px;
    padding: 10px 15px;
    border-radius: 8px;
    font-size: 1em;
}

.custom-select {
    /*margin-bottom: 12px;*/
    width: 55%;
    padding: 12px;
    font-size: 1em;
    border: 2px solid #ddd;
    border-radius: 8px;
    background-color: #fff;
    color: #333;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20fill%3D%22%23343a40%22%20d%3D%22M7%2C10l5%2C5l5%2C-5H7z%22%2F%3E%3C%2Fsvg%3E');
    background-repeat: no-repeat;
    background-position: right 12px top 50%;
    background-size: 18px;
    padding-right: 35px;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
  /* Melhorias de Estilo e Consistência */
  /* width: 100%;  Ocupa toda a largura disponível */
  padding: 12px;
  font-size: 1em;
  border: 1px solid var(--border-color, #555); /* Usa variável de cor */
  border-radius: 8px;
  background-color: rgba(0, 0, 0, 0.2); /* Fundo translúcido */
  color: var(--text-color, #fff); /* Usa variável de cor */
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  /* Ícone de seta em SVG, que herda a cor do texto */
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='2' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19.5 8.25l-7.5 7.5-7.5-7.5' /%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  background-size: 18px;
  padding-right: 40px; /* Espaço para a seta */
  transition: border-color 0.3s ease, box-shadow 0.3s ease;
  cursor: pointer;
}

.custom-select:focus {
    border-color: #3498db;
    outline: none;
    box-shadow: 0 0 8px rgba(52, 152, 219, 0.5);
  /* Estado de foco alinhado com o tema */
  border-color: var(--primary-color, #ff6b6b);
  outline: none;
  box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.2);
}

.custom-select option {
    font-size: 1em;
    color: #333;
    background-color: #fff;
  /* Estilo para as opções, ideal para temas escuros */
  background-color: #2c3e50;
  color: #ecf0f1;
}

#orderHistoryList {
    list-style: none;
    padding: 0;
}

.order-details p {
    margin-bottom: 8px;
}
.order-details h4 {
    margin-top: 15px;
    margin-bottom: 10px;
    color: #055d00;
}
.order-details ul {
    list-style: none;
    padding: 0;
}
.order-details li {
    padding: 8px 0;
    border-bottom: 1px dashed #ddd;
}
.order-details li:last-child {
    border-bottom: none;
}
.order-details img {
    vertical-align: middle;
    border-radius: 50%;
    object-fit: contain;
}

/* =========================================== */
/* === NOVOS ESTILOS PARA HISTÓRICO OCULTO === */
/* =========================================== */
.order-item {
    background-color: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    margin-bottom: 15px;
    overflow: hidden; /* Importante para a animação */
}
.order-header {
    background: linear-gradient(120deg, #206958b8, #05a582a1);
    padding: 15px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: background-color 0.3s ease;
}
.order-header:hover {
    background-color: rgba(0, 0, 0, 0.3);
}
.order-header h3, .order-header .status-display {
    margin: 0;
    color: #fff;
}
.order-header h3 {
    font-size: 1.1em;
}
.order-header .status-display {
    font-weight: bold;
}
.order-header .toggle-icon {
    font-size: 1.2em;
    transition: transform 0.3s ease-in-out;
}
.order-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.5s ease-out, padding 0.5s ease-out;
    padding: 0 20px; /* Sem padding vertical quando fechado */
    color: #000;
    background: linear-gradient(163deg, #ffa200b3, #ff5d00a1);
    border-top: 1px solid rgba(0,0,0,0.1);
}
/* Estilos para quando o item está aberto */
.order-item.open .order-header {
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
}
.order-item.open .order-content {
    max-height: 2000px; /* Valor alto para acomodar qualquer conteúdo */
    padding-bottom: 20px;
}
.order-item.open .toggle-icon {
    transform: rotate(180deg);
}
.order-content p { color: #000000; }
.order-content h4 { color: #003808; }
.order-content ul li { color: #111; }
/* =========================================== */

.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    z-index: 1000; 
}

.modal-content {
    position: absolute; 
    top: 50%; 
    left: 50%; 
    padding: 20px;
    width: 80%;
    max-width: 600px;
    box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
    border-radius: 10px; 
}

@keyframes animatetop {
    from {
    top: -300px;
    opacity: 0
}

to {
    top: 50%;
    opacity: 1
}
}

#qrCode {
    text-align: center;
}

.modal.fullscreen .modal-content {
    width: 100%;
    max-width: none;
    height: 100%;
    border: none;
    border-radius: 0;
    box-shadow: none;
    top: 0;
    left: 0;
    transform: none;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 0;
}
.modal.fullscreen .close-button {
    position: absolute;
    top: 20px;
    right: 20px;
    z-index: 1002;
}

.modal.fullscreen #qrCode {
    width: 100%; 
    height: 100%; 
    max-width: none; 
    max-height: none; 
}

.modal.fullscreen iframe {
    width: 100%; 
    height: 100%; 
    border: none;
}

    /* Notificações */
#notification-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    width: 300px;
}

.notification {
    background-color: #2ecc71;
    color: white;
    padding: 15px;
    margin-bottom: 10px;
    border-radius: 5px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    opacity: 0;
    transition: opacity 0.5s ease-in-out, transform 0.3s ease;
    transform: translateX(100%);
}
.notification.aguardando {
    background-color: #9e8600;
}
.notification.atualizado {
    background-color: #006eff;
}

.notification.success {
    background-color: #2ecc71;
}

.notification.error {
    background-color: #e74c3c;
}

.notification.show {
    opacity: 1;
    transform: translateX(0);
}

    /* Carrinho Flutuante */
#floating-cart {
    backdrop-filter: blur(8px);
    position: fixed;
    bottom: 20px;
    left: 20px;
    color: #fff;
    display: flex;
    align-items: center;
    padding: 17px;
    font-size: 1.5em;
    background: var(--floating-cart-bg);
    border: none;
    border-radius: 31px;
    cursor: pointer;
    box-shadow: 0 0 15px #000000ba;
    z-index: 100;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

#floating-cart:hover {
    background-color: darken(#3498db, 10%);
    transform: translateY(-2px);
    background: linear-gradient(47deg, #206958ab, #05a5829c, #206958ad);
}

#floating-cart .cart-icon {
    margin-right: 10px;
    font-size: 1.5em;
}

#floating-cart .cart-count {
    background-color: #e74c3c;
    color: white;
    border-radius: 50%;
    padding: 5px 15px;
    font-size: 0.8em;
    margin-left: 5px;
}

.mini-cart-button {
    display: none;
}

.rodape {
    color: #fff;
    padding: 40px 20px 20px 20px;
    margin-top: 30px;
    border-radius: 15px;
    font-size: 0.9em;
    backdrop-filter: blur(8px);
    box-shadow: 0px 0px 23px 0 #05a58285;
    background: linear-gradient(120deg, #2069587d, #05a58266);
}

/* Container que segura as colunas */
.footer-content {
    display: flex;
    flex-wrap: wrap; /* Permite que as colunas quebrem a linha em telas menores */
    justify-content: space-between;
    gap: 30px; /* Espaço entre as colunas */
    margin-bottom: 30px;
}

/* Estilo de cada coluna */
.footer-column {
    flex: 1; /* Faz as colunas dividirem o espaço */
    min-width: 250px; /* Largura mínima antes de quebrar a linha */
}

.footer-column h4 {
    font-size: 1.2em;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid #4ecdc4; /* Linha de destaque no título */
    color: #ffffff;
}

.footer-column p {
    margin-bottom: 10px;
    line-height: 1.6;
}

/* Lista de links úteis */
.footer-links {
    list-style: none;
    padding: 0;
}
.footer-links li {
    margin-bottom: 10px;
}
.footer-links a {
    color: #fff;
    text-decoration: none;
    transition: color 0.3s ease;
        cursor: pointer;
}
.footer-links a:hover {
    color: #4ecdc4;
    text-decoration: underline;
}

/* Ícones de redes sociais */
.social-icons a {
    color: #fff;
    font-size: 1.8em; /* Ícones maiores */
    margin-right: 20px;
    transition: transform 0.3s ease, color 0.3s ease;
    display: inline-block; /* Necessário para o transform */
}
.social-icons a:hover {
    color: #4ecdc4;
    transform: translateY(-3px); /* Efeito de elevação */
}

/* Ícone de pagamento */
.payment-icons .pix-icon {
    display: inline-block;
    background-color: #fff;
    border-radius: 4px;
    padding: 5px;
    margin-top: 10px;
}
.payment-icons .pix-icon img {
    width: 60px;
    height: auto;
    display: block;
}

/* Botão de horários e aviso */
.footer-column #openModalhorarios {
    margin-top: 15px;
    width: 100%; /* Ocupa a largura da coluna */
}
.footer-notice {
    font-size: 0.85em;
    font-style: italic;
    margin-top: 15px;
    opacity: 0.8;
}

/* Seção inferior do rodapé (copyright) */
.footer-bottom {
    text-align: center;
    padding-top: 20px;
    margin-top: 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.2); /* Linha divisória sutil */
}

/* Media Query para responsividade em celulares */
@media (max-width: 768px) {
    .footer-content {
        flex-direction: column; /* Empilha as colunas */
        text-align: center; /* Centraliza o texto */
    }
    .footer-column h4 {
        border-bottom: none; /* Remove a linha para um visual mais limpo no mobile */
    }
    .social-icons {
        margin-bottom: 20px;
    }
    .close-button {
        font-size: 24px;
        padding: 6px 10px;
    }
}

@media (max-width: 1280px) {
.container {
    margin-right: 10px !important;
    margin-left: 10px !important;
    margin-top: 20px !important;
    margin-bottom: 20px !important;
    flex-direction: column-reverse;
    padding: 10px;
    display: flex;
}

.products {
    border-right: none;
    padding-right: 0;
    margin-bottom: 20px;
    width: 100%;
    text-align: center;
}

    aside {
    padding-left: 0;
}

    header h1 {
    font-size: 2em;
}

    header p {
    font-size: 1em;
}

.products h2 {
    font-size: 1.8em;
}

#productList {
    flex-direction: column;
}

.product {
    width: 100%;
    margin-right: 0;
}
}

.loja-fechada-mensagem {
    text-align: center;
    margin-bottom: 20px;
}

.not-alert {
    padding: 15px;
    border: 1px solid transparent;
    border-radius: 4px;
}

.not-alert-danger {
    color: #000000;
}

.not-alert p {
    margin: 0;
    font-size: 1em;
}

.not-alert {
    width: 100%;
    margin-top: 10px;
    border-collapse: collapse;
}

.not-alert {
    background-color: #ffffff;
    color: #000000;
    padding: 8px;
    border: 1px solid #ebccd1;
}

.not-alert {
    padding: 8px;
    border: 1px solid #ebccd1;
    text-align: left;
}

.not-alert{
    background-color: #f9f9f9;
}

.required:after {
    content: " *";
    color: red;
}


.loja-aberta {
    color: #09ff00;
    font-size: 24px;
    font-weight: bold;
}

.loja-fechada {
    color: red;
    font-size: 24px;
    font-weight: bold;
}

.pago-success {
    color: #09ff00;
    font-size: 18px;
    font-weight: bold;
}
.aguardando-paga {
    color: #ffee00;
    font-size: 18px;
    font-weight: bold;
}

.cancelado-falha {
    color: red;
    font-size: 18px;
    font-weight: bold;
}

.whatswidget-widget-wrapper {
    font-family: "Helvetica Neue","Apple Color Emoji",Helvetica,Arial,sans-serif !important;
    font-size: 16px !important;
    position: fixed !important;
    bottom: 20px !important;
    right: 30px !important;
    z-index: 100;
}

.whatswidget-conversation {
    background-color: #e4dcd4 !important;
    background-image: url('data:image/png !important;base64,iVBORw0KGgoAAAANSUhEUgAAAGUAAABlCAYAAABUfC3PAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAhHpUWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYAAAiZdY5dDoQwCITfOcUeYQqUluOYrCbewOM7tW6MD/slwPAbZD32TT6DAojX1iMjQDw9daHomBhQFGVE+skdrVApxXfmYjpFZG/wZ9DxpiJ6bM1pXDHV1YJmV5M3BOOFfA5E/X3zp34jJ5txK0wLhZMZAAABd2lUWHRYTUw6Y29tLmFkb2JlLnhtcAABAFVURi04AFhNTDpjb20uYWRvYmUueG1wAEiJ7ZaxTsMwFEX3foVl5thJKEOsuB1aUBkKCJBaxjR5Taw2TpQYYvprDHwSv4DdVi2qyojEYE+27/U99vPy4qGuk3QFCi0gF5Ljr49PjETG8exq6k/rERRismngaXP3nG5WaZTh4aAXa6bLugSVIF2uZcs0x0lWLYCZud2mGG0tasXxfPqARlUDqE/6xPeutXgL8aCH4iZbssfxzT7CrDgulKoZpV3Xke6SVE1OgyiKqB/SMPSMw2vfpUq0J9sLG7HLGEObNqJWopLIrpNF9ao4xkZH+3DQ4pguW7K9LEmrklqFBsSnP+1KLH+xW+Vot4fZg9Cwno9FCbI1V+A48IMT9eWMapPYbZnkMBOZKs4JExB5oU6U+0aAqYHahWFqK0n3pTQ/Qw9fM9g+6K+HgziIgziIgziIg/wrSC8+NHcgTUfXmdbtG8Nkm7OA2X6LAAATK0lEQVR4nO1d25bjOI4MgKSy5/+/bR/3cf+hLJLAPoCgaFu2JaeU6dptnFNTPVlpWSJIXAIBiP7nv/9L8a98lPBv38C/ci/xt2/g/5qICGoVqAoUAAEAEQIzmBlE9PIaEQBUFaUUiAhU7VIhMEIIYP73MG0VEUHOpa+lCxEhhICUIkIILxUTRQSlVtRSoAoQAQqFFoGoIsX4r2I2iIjgcrlARMGB8fU1gYigqqhVUGpBzhmqipTS02vFWivmeQYTI8YA5gBVQc4ZJWcQgJgSeMOx+/8qtvAVtQpCDJhSujJVzAIiIJeCXApCiGB+vJ6xioCIME0JIYT2Y7tg6RcJQP+33xMzrcvfIAIBm+z0mSIi8HWMMQ7raMLMSCmZ4sT8DfB4PSNUV51QjBEiipzLsgi/JKoKVYWIQETb/SiICMy8yU6fen/tf0IIDy2K36vq8jyP7rlFXw8e6Beec1l8U4CIQFTa7RCIlpNRRaClYEoJMcbfU8xycF8IbVrTqABqLUh6HR3XWiG12oOe/LBdCarQHgGi7yo3UUQMZuqLTyIopaDUCmJGbGajnyy7QA9N3RocrTxfIhnu/VbsngR4ckJcYuCAWgrmeUZskZaIopQMEUVK8VQnX6ugVgsjq0hfPOaAEPlpfC/NjpdSUUtFYIYCkGa7pdoiKRTUwnx/xiMVw+0ecylgEYSmGP8Oj8BEbHvQi++PIYTuP0qpIJa+y7g9xFlmQUQwzxdUEcQQkG6iltu/b2Wx0xk5C6pUO2kAePA3AEFUuuJTjC/D0j3ieUhgRikFKnK1brVaNEtESCm+tGAxBAbxF2opzWQJiAkpphYin5OjdN+hauF4SggPdpD/rjaPquq70xY+xtSTNWrOlm9OmCqDMEaUz8PSvWILnlriqMil9MVXBYgJMUSE8HqTR8B2Fd2EcmfY3luRZl8Dh+4PgMUnjH+ulaJgDogxIISAaUrdnrsy/DrtYcBAM812osz0HWfGPBwmIpS2ud2bERNS2JbNAwP29RNKuBVueYZicY6OHdXaTm5THFOzxe0TpRYA2h803ChVVFFLBYAOGdnvcVNyvQoajpIOTd1ax/asW+RHAclx15sjrhBRxGYhO3ZUS0MYYo+4/KEMp1OgnQyHhkYppZpth0VzVQImLAtGbN/vDvlo+a6iY875UKfncm9+WkjY/81sre/irqxqpiWmiBBGn2C7X8TOFXNb4JXnr9UUm2JEBZliqnTTxi1i0w/FyONZCjEsqF4ngApwsDDXAowl5HVFgVo+wWSfVYuoPCiw0HbxJ6vfD/TfQwMFPcPzfEc0fwupGD/73ZNxex+H7xUvAzg845A1tR0KXPuv8e8QGCIW75dc7BT00DZ2HzD+WZMYAkQEfy4XQLXjUQtA6KdPnsIdj8RyjtpN5xJ6718rQ5dnix7btU5RSs4ZCsPPQlxC1Fdi4W28UpT/2ZPwhWA+pFbp/3/8fg8cXmFQa8/mfk9UwEQtpLdTHeM+DM6ulaGwnJDazw5VyujEU0qYprR7F4Zwb5ZG3zTKo9PivuORZTYlB6jaImzNxXzD1ZbLETOoVguBRa984BaptSKXgilNSMlUcbnMxyulVjGfcQCUMTr/6rhS04v5ptB9095v4sCQDn1sv59S6lXNRGPCPF8scHjDR1G7Fy+IHW6+HGf6LrbkgUJukIUleeiL76cml4yczWfEHRVSajXzWmpHoHfcXQ8W7G/0YGKvTohtQ+WcIc3UllJOyFP6jb2nlK6QXCBiKLVHbI5Ya0OT/QRZToLNpeuOmWFBpbdsom72xMq7QbmfZmLaDaYHZqQYkRvEZQo+I3kkQGUJQffKGLmlVidZXegGpFYR5HlGyQUqimlKmxUDGNSzRykxRtvZ8wwJEbUaavAOl8ErkhaiG0KejjZfFtUwsr5nX23Xm0n5mr5eRjNuhmiamgMuqHVbzcTvte/0jZ9JyaJDD4ktMHm/+mmKDlBloBXxDlUKM4ODQmfd5UCBJb/x3OZWIZ6IjmVg910hhJ7t51L6jt5yv9LAya15hi+iCENVdofrj655VYp/+0oPxBLEJYTdngMAtS2oHekBXhFBdi5Vy9hiiIgR3WQEZmgMmOcMCductyEJ0hHmrfdqG4FwFsH0lKsSM1wxW0W1wSjEVzB+bZl5rVZZjNGSj5wz5pakAkNWTeYnZMN3O9A5Euc+QQ5Xitt5AJsftp+qVnsYfy61QsXCXnP8liMQkeUZ9ZqJ2EvXm5RipYCeA32InIKTMjOqLPD4FrOgaLZ1/Jln8WR4lpsqZm6FpNrwq8Em9xrNaxlt+TtK6cU3YCB3fL9Gc55SquwyC21pVv/ltjykjvuvie4LxokAJu6BwtYSsWf3peSOXluIe0/G2yurShm5V3bjtDnku0rM6r7d5zmDi9fhnUbrztihF6xEPk8V9ux+RaD8nLk4SikFl3nupWyFJb3IltnH+L5iHiol59wKSkZs2BP2mRkiCLZFNeORv03mmBlhYGsaRmTQy+1GWcwdbaZFEZkfu90Qz8RNM4Be1xGxzSCiqFIRNyp3TVYdvcPTzhapYgWrrTdtu4/6rt7yOc873Cz4Z5gZU0pWW4c2rMqSuBGF9u4BwMzR3g2EHdiVVAvNY0O0uRXtrOwA6DejuYc+ZYHL33OCxAxuJnDrKUsxImdrGXAY3E2nK6xd3QDKm+SyNDI6h31BpZ0+YKs3IrLfVNGrT4hqD1i+I6tKuc2IA+/nfzERZMdJscWPPVGc53zlNB9FNYYWL70fcYo9JN8qZi6xmZ7bGZE1I88zKoeOSDDTOY6e2ZpeHGy7JbZtEV/EWuvmaIiZzH9ooxCZVRmoQHZCXMkejHSFhIi4E4NyHlgYytWv79MSXGkkD4eUFIoQToq+Op7DDCjuTMXWGydiiJRd0VBsDMe5Ib+llMYsdJIdNWhEG2ulgsn8zgjPbBH3Q1KlF622SggBX19fKNWIHSDCV5gO4Sk/9Ck9kXvz+u7szTnv80nMjGmawMESRFGBFK88GhRjXQXUggDrQNtTa3f6qqoipvdI38yMRNRP7jsV0DU5lfnkkY02mtGenegPLC0R9VYCL5laKLtQlNZkjf7q/DEvbgUO3+rrPCKDv5XT6WgeNYnqbqDNI68tNnoMJrRFQeqNRypX/+2csKkFEp/WaHv6SeHG3VWRU/omR/ShE/+GiI/YilnEjBQWpr7f39G7/Ag5XSnWs/FeJXKUkfp6a4K64zMkHiF4FY+aUq75Y58sqvpT5qtsBiddeW6C4H6gK8R5xctpMH7wcgrOaqM7W6SVw8939L0O7rXwdVL2NRncsCUdzJJTOv1PbAnt7c7/2xTh4vDSPB9MxlsTIiDEgFoq/lwuHS8CMDSfujNui0+t9aEt/lKnuK9Z/KYSPLQ+YnxKzhm5FMQYfkIphBStz8+agYwA4Zn5YqZwZfe50UK38pDfkR4MvKHYI8enjF0KMfyAUoCFYF0777a1RQz9Itwy+Z/a+R6ledi9R3wRjxyf4ozLWg8meD//Ulo91r9hhqwreUYp1YbbTNMuxYxjP44Yn7Jcx9pAfrSX6RMiIkehnbL0DrzicM+R41PGiPFDG8xeyzudVEtDU4aKVVQXoHPHdy/fvP4L38ALY4x/r1IsxG7U0fjaH6kqSq1Gi+0Th7ZBOLfCRCg4b3zKX6wUZ+YLKBucY+H2/dACV8g8zyAYu7LWuhlXuxVm6405a3zKX6sUz1s81wmykLVvM3rvyweWfkfR9znAHrScNT7ldKUc2UU7ipervXvMWzDmmjsHixt91nofFdPXV+stqYjhe2MYzxyfcqWU62hhfxPMrYwJlvdiHJkIevVvzhm1VCi0U1rHzir3HSEEXEqjwX59f3DbWeNTrpRy1E52slwptU8WoqaMaZoO+x43IxOADPSxITEEBDJGPYArM2U/012Vylf3sOc6W4iOq+ZrzHb34Exj24JjQgabhEbwK6szFr8rfj0FUEsFEyFMAYGuH895v2/HrAfIFqLjnVL8Q5d57vWQEKwf/lnHr8Jmosx5Rh3IDD5fJefcbua9hO2VhBDwRYQLZsu2c8Y0TVe/00eAQFo/5c/PnnSiY0oRCuqY17j575TipkdbxiqqkDyjlIUFeHvcnObjxayUkrFSBjzL297OFCJCDAE5l17Xv/1Op5jO84xpmjZ1fB0tr4iOd45+UYhNqvPopndTqSKp9pCvwxatgSfFtMo8N9R3/5SHvcJsTJeRu9g5xrBBOzGaKc3FwuSfnNa6heh4t00sfCTEFDqPammjzp0nBaAjv/NlBgiYUnriyKmPy3iHRLFVrPkIg2PX3tpNWJDpmGKHW76+vt+3uFW2EB3vzZdazB/4OsxzhJfbMBv3Od4xM02T1U0ePJihDk0VJzZNuX32KXhzzpDWNkFE0Fyag/X5LNa+103uyTX8LUTHVUc/subHi40Fq8s8tz5Ea3fbVNTZ2mL1pkiDU6wVG9aUqrL0Q4IgLH34Zy9TazUWZ0o/MkL+FdHx3ssN5JA18UlDc26Zc+BDc493xfojWw8km0+ppSJN6Y6SuuRRBUpGGPTZxp8wQv6t0MPqCYbOprh3UtH70yieiS+0BR8VBMY0pVUUwW14jHGYi2wn7BNkt1KW5ktFCnFfG5kuielaE1K3t+/WzIfClc8efmRSe04QQ29f+BRe2L1Smt1/FLr6NFSLGvaFkgrt8+mNQnSjlMZm3DtWY6El1X4C9uBsa1Sl35Q7pRAaU/7BaAznb1kSuf1BeudTq/6N0A3B/KxW7TnSP/987VMM0IZOR6tlfNAi75V7pTAB8qQjuo3NmDgtIe4G6bUOYpthf1WMsuOpqhYxiTz8/jUhspaIOMyZ/GR5RW26U0pgRtXaEdbbi0nPjNeZjg9vpBHWUkp9J6/dVBWB5v3BgJmgXR/5FdlCbbp6DGr8KzwYjeEDa/bOiF9uBC9fFtaBuQ/f7e+IU5v+/Ln0PG9N7vZWaCdgrYG0sxl3LlhpmFncEj57gLHrGz5fRmpTldoZoWtypxRrHzAIoLMZm+yd5qCKzoqk1vv+ygGb4hVHvhzgSBmJ6Hs+s4fatKqUwDZBuw7vK/Rb2GPpVWVAYl8PVO5vdmgwzyeKESVspOKW6UfvUJsetmwvdYnacSP0dzJsuPlG7a+lIA1zd5/efBvQeXRl8kj5CWrTQ6WEEHvNgdoojj6O/EUDkKrasM1+A69N0agU/oXC01b5CWrTwz56Nze1VpSceynYmoDW2+X85mzkko10jfF1Zt1HlUubH/nLrwh8Jj9BbXr4r0RtsihTf6eUAn1y3W10NhbC5mxFr9QG3bykkzYn6Pb2t7LxrU7cqU0xxY6ATG2M/IhyxNh+r5WgdeM8/KfDDRYGeUbOdgx9IEwptdcpxqqkansTRCOlvVLIPM+dof5bNXPAp7kakjAClGtyNrXp6Qr4aQEBZVh08/QVpdjggVKWofw2ASI+PSF+qkqtKE3ZaXqtxLXrOGj6rrmz10QZdO+lwFIVUaQ/xyM5i9r0clv6vC0CIZfcXwDGiA1+lx4aRjT4hKl39o7ii+hvnfYy7SuY/VZUtTeqemvbO0N9AHsnpJvm0HZxlTZFHEAI09PPn0Ft2mQrun8hYFbY1J/A/dj6q/RqrfhzMXT5tqFmrKP41B9/u8JemN59kDTmpYi9J3La2ZEFtCl3VfCf//wzNMgG/PlzsRetPddJX58jqU2bDbjTiYxUwcu4vhA7QlvqQnZ2XGfJbKgPuYkprCpui3jsT0RI0zQMT5A2b2v79TpCQUvPIYA+37iz6Ddc70hq02aluMmw92qFvgALedocZG0EPq+duBChdfsuRax3RUXAYRl0owBKXt4FuVXHnZYLtAKZ3agDr0TbpxIdSW3aFeqISI/FFzhk8QPvNuHsFaM26QIBtfI00/5OAaf7lBYBElF7PyTtenPQkdSmzUrxNmvwEkMQ/XwZ1UP1ec4o5dLeGFTBIfSR63skhICvaTL0tr2s03hsafMGO5ratEkpyxACvRrcfEQvxl7xHCElbaaBwJE3wzmPrgcspQkDZcMmUPQMatPuTI2w2OHfEm9Aiuovd/7e5rjl9+6RM6hN+5XSaZa/i039xildkzOoTXHvGEEMi3E2g/7T5SxqE/t7C18K3fsSHSKgv0k6oXAPZebRtWDUppEQ8l2Jc0Nnn8EJRHQ3PMAnqeZcProodSs+FKG2iO3RYFBto5WeWYGzqE1sOcfrF9B0Gz4UdLR1cP0tYq2Dc39z0Xy52NuKVjC6xXc+F0+gj+xv4e0FXvTsuSsF6+1hnyoLKmGTtlXtZQK3daHf9pGsGxUCoM+Qr7V1DrfXNf0tp8UQuPY209bu5xiXy28rBADYW+Ve3UwP2xptaKRe/i0+xTqdDSK6/LlAxd5zzB90/6qK6DyvLTvEWuwKSmkz4tvrvz9hd20VbyF3vxFC+Cjin5UBWn/8M3GsRtHajBuUICrg8LvMk2WCg/Zi17PE8tPaHkZx6xOf9Sr25KhaxayPsQVdzQX+LXF4fJ5zhzpSirvfDvEJcplnKyeHgP8FbJ3FbCth4+oAAAAASUVORK5CYII=') !important;
    background-repeat: repeat !important;
    box-shadow: rgba(0, 0, 0, 0.16) 0px 5px 40px !important;
    width: 250px !important;
    height: 300px !important;
    border-radius: 10px !important;
    transition-duration: 0.5s !important;
    margin-bottom: 80px !important
}

.whatswidget-conversation-header {
    background-color: #31d831c2 !important;
    padding: 10px !important;
    padding-left: 25px !important;
    box-shadow: 0px 1px #00000029 !important;
    font-weight: 600 !important;
    border-top-left-radius: 10px !important;
    border-top-right-radius: 10px !important
}

.whatswidget-conversation-message {
    line-height: 1.2em !important;
    background-color: rgba(0, 0, 0, 0.274) !important;
    padding: 10px !important;
    margin: 10px !important;
    margin-left: 15px !important;
    border-radius: 5px !important
}

.whatswidget-conversation-message-outer {
    background-color: #31d831c2  !important;
    padding: 10px !important;
    margin: 10px !important;
    margin-left: 0px !important;
    border-radius: 5px !important;
    box-shadow: rgba(0, 0, 0, 0.342) 0px 2.5px 10px !important;
    cursor: pointer !important;
    animation: nudge 2s linear infinite !important;
    margin-bottom: 70px !important
}

.whatswidget-text-header-outer {
    font-weight: bold !important;
    font-size: 90% !important
}

.whatswidget-text-message-outer {
    font-size: 90% !important
}

.whatswidget-conversation-cta {
    border-radius: 25px !important;
    width: 175px !important;
    font-size: 110% !important;
    padding: 10px !important;
    margin: 0 auto !important;
    text-align: center !important;
    background-color: #23b123 !important;
    color: white !important;
    font-weight: bold !important;
    box-shadow: rgba(0, 0, 0, 0.16) 0px 2.5px 10px !important;
    transition: 1s !important;
    position: absolute !important;
    top: 62% !important;
    left: 10% !important
}

.whatswidget-conversation-cta:hover {
    transform: scale(1.1) !important;
    filter: brightness(1.3) !important
}

.whatswidget-cta {
    text-decoration: none !important;
    color: white !important
}

.whatswidget-cta-desktop {
    display: none !important
}

.whatswidget-cta-mobile {
    display: inherit !important
}

    @media (min-width: 48em) {
.whatswidget-cta-desktop {
    display:inherit !important
}

.whatswidget-cta-mobile {
    display: none !important
}
}

.whatswidget-button-wrapper {
    position: fixed !important;
    bottom: 32px !important;
    right: 22px !important
}

.whatswidget-button {
    position: relative !important;
    right: 0px !important;
    background-color: #31d831 !important;
    border-radius: 100% !important;
    width: 60px !important;
    height: 60px !important;
    box-shadow: 2px 1px #0d630d63 !important;
    transition: 1s !important
}

.whatswidget-icon {
    width: 42px !important;
    height: 42px !important;
    position: absolute !important;
    bottom: 10px !important;
    left: 10px !important;
}

.whatswidget-button:hover {
    filter: brightness(115%) !important;
    transform: rotate(15deg) scale(1.15) !important;
    cursor: pointer !important
}

    @keyframes nudge {
    20%,100% {
    transform: translate(0,0)
}

    0% {
    transform: translate(0,5px);
    transform: rotate(2deg)
}

    10% {
    transform: translate(0,-5px);
    transform: rotate(-2deg)
}
}	

.backgroundred {
    background: linear-gradient(118deg, #ff0000, #cc0000fb);
    color: white;
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 0.9em;
}
.backgroundverde {
    background: linear-gradient(120deg, #206958, #05a582);
    color: white;
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 0.9em;
}


/* Botão "Finalizar Compra" */
.ButtonFinalizarcheckout {
  flex: 1;
  background: linear-gradient(120deg, #206958, #05a582);
  color: #fff;
  border: none;
  border-radius: 12px;
  padding: 12px 18px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.37);
}

.ButtonFinalizarcheckout:hover {
  background: linear-gradient(47deg, #e05300, #e69200);
  transform: translateY(-2px);
  box-shadow: 0 5px 10px rgba(0, 0, 0, 0.39);
}

/* Botão "Esvaziar Carrinho" */
.ButtonEsvaziarCarrinho {
  flex: 1;
  background: linear-gradient(167deg, #5b0000, #ff0000);
  color: #fff;
  border: none;
  border-radius: 12px;
  padding: 12px 18px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.329);
}

.ButtonEsvaziarCarrinho:hover {
  background: linear-gradient(332deg, #5b0000, #ff0000);
  transform: translateY(-2px);
  box-shadow: 0 5px 10px rgba(0, 0, 0, 0.336);
}

/* Efeito visual ao clicar */
.ButtonFinalizarcheckout:active,
.ButtonEsvaziarCarrinho:active {
  transform: scale(0.97);
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}
 
   /* Estilos para o modal */
.horariosModal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

.modal-contenthorarios {
            display: flex;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    justify-content: center;
    align-items: center;
}


/* Adicione este CSS perto dos outros estilos de .tab-button */

.tab-button.tab-disabled {
    background: #555; /* Cor cinza escura */
    color: #999;
    cursor: not-allowed; /* Ícone de "proibido" */
    box-shadow: none;
    transform: none;
}

.tab-button.tab-disabled::before {
    display: none; /* Remove o efeito de brilho */
}

.tab-button.tab-disabled:hover {
    background: #555; /* Impede mudança de cor no hover */
    transform: none;
    box-shadow: none;
}

.close {
    position: absolute;
    top: -22px;
    right: 24px;
    cursor: pointer;
    display: block;
    font-size: 5em;
}

.status {
    font-family: helvetica;
    text-align: center;
    color: #ffffff;
    display: block;
    font-size: 1.57em;
    font-weight: bold;
}
        /* Estilos para o botão de compartilhar */
#shareButton {
    background: linear-gradient(231deg, #ffa200e0, #ff5d00e0);
    color: white;
    padding: 10px 15px;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease;
}

#openModalhorarios {
        background: linear-gradient(231deg, #ffa200e0, #ff5d00e0);
    color: white;
    padding: 10px 15px;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease;
}

#shareButton:hover {
    background-color: #2980b9; /* Azul mais escuro no hover */
    transform: translateY(-2px); /* Levemente elevado no hover */
    box-shadow: 0 4px 8px rgba(0,0,0,0.3); /* Sombra mais intensa no hover */
}
.botao-Lojista {
        background: linear-gradient(231deg, #ffa200e0, #ff5d00e0);
    color: white;
    padding: 10px 15px;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease;
}
#sairdaloja {
        background: linear-gradient(231deg, #ffa200e0, #ff5d00e0);
    color: white;
    padding: 10px 15px;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease;
}

#sairdaloja:hover {
    background-color: #2980b9; /* Azul mais escuro no hover */
    transform: translateY(-2px); /* Levemente elevado no hover */
    box-shadow: 0 4px 8px rgba(0,0,0,0.3); /* Sombra mais intensa no hover */
}

.image-slider-container { position: relative; overflow: hidden; width: 100%; }

.image-slider { display: flex; transition: transform 0.35s ease; width: 100%; }

.image-slider .slider-image { flex: 0 0 100%; width: 100%; height: auto; display: block; object-fit: cover; }

.slider-button { 
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 2;
    background: linear-gradient(141deg, #ff0000b8, #4800ffba);
    color: #fff;
    border: none;
    padding: 8px 12px;
    cursor: pointer;
    border-radius: 5px;
    transition: background-color 0.3s ease;
    box-shadow: 2px 1px 2px #000000e8;
        backdrop-filter: blur(8px);
}

.slider-button.prev { left: 8px; }

.slider-button.next { right: 8px; }

.fullscreen-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0,0,0,0.9);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
}

.fullscreen-image {
    max-width: 90%;
    max-height: 90%;
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0,0,0,0.7);
    cursor: zoom-out;
}

.close-btn {
    position: absolute;
    top: 20px;
    right: 30px;
    font-size: 40px;
    color: white;
    cursor: pointer;
    user-select: none;
}
.aviso-taxa {
    background-color: #fffbe6; /* Amarelo claro */
    border-left: 5px solid #f59e0b; /* Borda amarela/laranja */
    padding: 12px;
    margin-top: 15px;
    border-radius: 4px;
    font-size: 0.9em;
    color: #854d0e; /* Cor do texto mais escura */
    font-weight: 500;
}
/* Estilos para Filtros de Categoria */
#categoryFilters {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 25px;
    flex-direction: row;
    justify-content: center;
}

.category-button {
    background: linear-gradient(120deg, #206958b8, #05a582a1);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.3s ease;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

.category-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
}

.category-button.active {
    background: linear-gradient(231deg, #ffa200e0, #ff5d00e0);
    box-shadow: 0 0 15px #ff6700;
    font-weight: bold;
}
/* Adicione no seu CSS */
.skeleton {
    background-color: #3a3a3a;
    border-radius: 15px;
    margin-bottom: 20px;
    position: relative;
    overflow: hidden;
    width: 100%;
    height: 400px; /* Altura similar a um card de produto */
}

.skeleton::before {
    content: '';
    position: absolute;
    top: 0;
    left: -150%;
    height: 100%;
    width: 150%;
    background: linear-gradient(to right, transparent 0%, #555 50%, transparent 100%);
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0% {
        left: -150%;
    }
    100% {
        left: 150%;
    }
}
/* Adicione no final do seu CSS */
.search-container {
    position: relative; /* Essencial para posicionar o botão dentro dele */
}

/* Adiciona um espaço à direita no campo de texto para o botão não ficar em cima */
#searchInput {
    padding-right: 35px !important; 
}

.clear-search-btn {
    position: absolute;
    top: 50%;
    right: 10px; /* Distância da borda direita */
    transform: translateY(-50%); /* Alinha verticalmente no centro */
    
    background: none;
    border: none;
    cursor: pointer;
    
    font-size: 1.5em; /* Tamanho do "X" */
    color: #ff6600;
    
    display: none; /* Escondido por padrão */
}

/* Classe que vamos adicionar com JS para mostrar o botão */
.clear-search-btn.show {
    display: block;
}

/* =================================== */
/*    ESTILOS DO BOTÃO VOLTAR AO TOPO    */
/* =================================== */

#backToTopBtn {
    position: fixed;
    bottom: 102px;
    right: 25px;
    z-index: 99;
    background: var(--floating-cart-bg);
    color: white;
    border: none;
    outline: none;
    cursor: pointer;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    font-size: 20px;
    transition: background-color 0.3s, transform 0.2s;
    box-shadow: 0 0 15px #000000ba;
    backdrop-filter: blur(8px);
}

#backToTopBtn:hover {
    background: linear-gradient(47deg, #206958ab, #05a5829c, #206958ad);
    transform: translateY(-3px); /* Efeito de elevação */
}
.modal-product-description {
    margin-top: 15px;
    margin-bottom: 20px;
    line-height: 1.7;
    white-space: pre-wrap; /* Respeita as quebras de linha e espaços */
}

.description-modal {
    display: none; /* Inicia escondido */
    position: fixed;
    z-index: 1002;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(10, 25, 47, 0.85);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    opacity: 0;
    transition: opacity 0.3s ease;
    visibility: hidden;
}

.description-modal.is-visible {
    display: flex; /* Usamos Flex para centralizar o conteúdo */
    align-items: center;
    justify-content: center;
    opacity: 1;
    visibility: visible;
}

.description-modal-content {
    background: linear-gradient(120deg, #206958b8, #05a582a1);
    color: #e5e7eb;
    padding: 2.5rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
    width: 90%;
    max-width: 750px;
    border-radius: 16px;
    position: relative;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    
    /* Animação de entrada */
    transform: scale(0.95);
    transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
}

.description-modal.is-visible .description-modal-content {
    transform: scale(1);
}

.description-modal-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.1);
    color: #ff9900;
    border: none;
    border-radius: 50%;
    font-size: 1.5rem;
    line-height: 40px;
    text-align: center;
    cursor: pointer;
    transition: background-color 0.2s ease, transform 0.2s ease;
}

.description-modal-close:hover {
    background-color: rgba(255, 255, 255, 0.2);
    transform: rotate(90deg);
}

#descriptionModalTitle {
    font-size: 20px;
    font-weight: 600;
    color: #ffffff;
    margin: 0 0 1.5rem 0;
    padding-bottom: 1rem;
    border-bottom: 1px solid #4ecdc4;
}

#descriptionModalText {
    font-size: 1.1rem;
    line-height: 1.8;
    white-space: pre-wrap;
    color: #ffffff;
    max-height: 60vh; /* Altura máxima no desktop para evitar modais gigantes */
    overflow-y: auto; /* Adiciona scroll se o texto for muito longo */
}


/* --- Estilos de TELA CHEIA (Celular) --- */

@media (max-width: 768px) {
    .description-modal {
        backdrop-filter: none;
        -webkit-backdrop-filter: none;
    }

    .description-modal-content {
        /* Regras FORÇADAS para garantir a tela cheia */
        width: 100vw !important;
        height: 100vh !important;
        max-width: none !important;
        max-height: none !important;
        margin: 0 !important;
        border-radius: 0 !important;
        box-shadow: none !important;
        
        /* Layout flex para organizar título e texto */
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        padding: 0; /* Remove padding geral */
        transform: none !important; /* Desativa animação de escala */
    }

    #descriptionModalTitle {
        font-size: 1.5rem;
        padding: 4rem 1.5rem 1rem 1.5rem; /* Padding com espaço para o botão de fechar */
        margin: 0;
        flex-shrink: 0; /* Impede que o título encolha */
    }

    #descriptionModalText {
        padding: 0 1.5rem 1.5rem 1.5rem;
        overflow-y: auto;
        flex-grow: 1; /* Faz o texto ocupar todo o espaço restante */
        max-height: none; /* Remove a restrição de altura do desktop */
    }
    
    .description-modal-close {
        /* Posição fixa para ficar visível mesmo com scroll */
        position: fixed;
        top: 1rem;
        right: 1rem;
        z-index: 1003; /* Acima de todo o resto */
    }
}
.btn-details2 {
background: linear-gradient(120deg, #9b59b6, #8e44ad);
    padding: 10px 20px;
    border-radius: 25px;
    font-weight: bold;
    cursor: pointer;
    border: none;
    color: white;
    flex: 1;
    white-space: nowrap;
}
.btn-details {
    background: linear-gradient(120deg, #9b59b6, #8e44ad);
    box-shadow: 0 0 15px #00000070;
    margin-bottom: 20px;
    color: #fff;
    width: 100%;
}
.btn-details:hover {
    background: linear-gradient(120deg, #d35400, #f39c12);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
}
.featured-title {
    text-align: center;
    font-size: 2.2em;
    margin-bottom: 20px;
    color: #fff;
    text-shadow: 2px 2px 5px rgba(0,0,0,0.3);
}
/* Adicione este CSS na sua tag <style> */
.payment-options-container {
    display: flex;
    gap: 15px;
    margin-top: 10px;
}
.payment-option {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 15px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    flex-direction: row;
    box-shadow: 0 0 15px #000000a3;
    background: linear-gradient(120deg, #206958a1, #05a582ab);
}
.payment-option.active {
    background: linear-gradient(231deg, #ffa200e0, #ff5d00e0);
    box-shadow: 0 0 15px #ff6700;
    font-weight: bold;
}
.payment-option:hover {
    transform: translateY(-2px);
}
.payment-option input[type="radio"] {
    display: none; /* Esconde o radio button padrão */
}
.payment-option input[type="radio"]:checked + i + span,
.payment-option input[type="radio"]:checked ~ i {
    color: var(--secondary-color); /* Apenas para visualização */
}
.payment-option input[type="radio"]:checked ~ label,
.payment-option input[type="radio"]:checked + label {
     border-color: var(--success-color);
     box-shadow: 0 0 10px var(--success-color);
}

/* Estilo para quando a opção está selecionada */
input[type="radio"]:checked + .payment-option {
    border-color: var(--success-color);
    box-shadow: 0 0 10px var(--success-color);
    background-color: rgba(46, 204, 113, 0.1);
}
.payment-option i {
    margin-right: 8px;
    font-size: 1.2em;
}

/* NOVO: Estilos para o estado de carregamento do carrossel */
#featuredProductsCarousel.loading {
    /* Mantém o fundo, mas podemos adicionar a animação */
    position: relative;
}

#featuredProductsCarousel.loading::before {
    content: '';
    position: absolute;
    top: 0;
    left: -150%;
    height: 100%;
    width: 150%;
    z-index: 1; /* Fica acima do fundo, mas abaixo do conteúdo */
    
    /* Mesmo efeito de brilho dos outros skeletons */
    background: linear-gradient(to right, transparent 0%, rgba(255, 255, 255, 0.2) 50%, transparent 100%);
    animation: pulse 1.8s infinite;
}

/* Esconde os botões de navegação enquanto carrega */
#featuredProductsCarousel.loading .carousel-nav {
    display: none;
}
#statusLoja {
  text-align: center;
  font-size: 1.4em;
  font-weight: bold;
  margin: 15px 0;
  transition: all 0.6s ease;
}

.loja-aberta {
  color: #00ff99;
  background: linear-gradient(120deg, #206958, #05a582);
  padding: 10px 20px;
  border-radius: 12px;
  display: inline-block;
  animation: fadeSlideIn 0.8s ease;
}

.loja-fechada {
  color: #ffb347;
  background: linear-gradient(47deg, #e69200, #e05300);
  padding: 10px 20px;
  border-radius: 12px;
  display: inline-block;
  animation: fadeSlideIn 0.8s ease;
}

@keyframes fadeSlideIn {
  0% { opacity: 0; transform: translateY(-10px); }
  100% { opacity: 1; transform: translateY(0); }
}

.fade-out {
  opacity: 0;
  transform: translateY(10px);
  transition: opacity 0.5s ease, transform 0.5s ease;
}

.current-day {
  background: rgb(255, 0, 0);
  font-weight: bold;
}
.aplicarCupomBtn {
  background: linear-gradient(47deg, #e69200, #e05300);
  color: #fff;
  font-weight: 600;
  border: none;
  border-radius: 10px;
  padding: 10px 18px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 3px 6px rgba(0,0,0,0.1);
}

/* --- Modal base --- */
#modalErro {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.55);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 999;
    animation: fadeIn 0.3s ease;
    overflow-y: auto;
}

/* --- Animação de entrada --- */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* --- Caixa do conteúdo --- */
#modalErro .conteudo {
    border-radius: 16px;
    padding: 25px;
    width: 80%;
    max-width: 400px;
    text-align: center;
    animation: scaleUp 0.3s ease;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(8px);
    box-shadow: 0 8px 30px #000000b0;
    display: flex;
    flex-direction: column;
    align-items: center;
}

@keyframes scaleUp {
    from { transform: scale(0.9); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

/* --- Título e texto --- */
#modalErro h3 {
    font-size: 1.5rem;
    margin-bottom: 10px;
}

#modalErro p {
    font-size: 1rem;
    margin: 10px 0 20px;
}

/* --- Formulário --- */
#modalErro .form-group {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 10px;
}

#modalErro input {
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 1rem;
    outline: none;
    transition: border-color 0.2s;
}

#modalErro input:focus {
    border-color: #05a582;
}

/* --- Botões gerais --- */
#modalErro button {
    cursor: pointer;
    border: none;
    border-radius: 8px;
    padding: 10px 14px;
    font-size: 1rem;
    font-weight: 600;
    transition: 0.25s ease;
}

/* Botão de ajuda */
.botaoAjuda {
    background: linear-gradient(47deg, #e69200, #e05300);
    color: #fff;
    margin-top: 8px;
}

/* Botão de fechar */
.botaoFechar {
    background: #ddd;
    color: #333;
    margin-top: 10px;
}

.botaoFechar:hover {
    background: #ccc;
}

/* --- Temas por tipo --- */
#modalErro.error .conteudo { border-top: 6px solid #ff0000; }
#modalErro.success .conteudo { border-top: 6px solid #05a582; }
#modalErro.aviso .conteudo { border-top: 6px solid #e69200; }
#modalErro.trocaid .conteudo { border-top: 6px solid #206958; }
#modalErro.info .conteudo { border-top: 6px solid #2196F3; }
        /* =========================================== */
/*    NOVO CSS PARA TABELA DE HORÁRIOS         */
/* =========================================== */

.schedule-table-container {
    width: 100%;
    max-width: 500px; /* Um pouco mais estreito para melhor leitura */
    margin: 25px auto;
    overflow-x: auto;
}

.schedule-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 1em;
    border-radius: 12px; /* Bordas mais arredondadas */
    overflow: hidden; /* Garante que o border-radius funcione */
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    color: var(--text-color);
}

.schedule-table thead tr {
    background: linear-gradient(135deg, #ffa20075, #ff5d0094);
    color: #ffffff;
    text-align: left;
    font-weight: bold;
    backdrop-filter: blur(8px);
    box-shadow: 0 8px 30px #000000b0;
}

     .schedule-table th,
        .schedule-table td {
            padding: 6px 0px;
            text-align: center;
            border-bottom: 1px solid #ddd;
        }

.schedule-table tbody tr {
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    background-color: rgba(0, 0, 0, 0.15);
}

.schedule-table tbody tr:nth-of-type(even) {
    background-color: rgba(0, 0, 0, 0.25); /* Efeito de zebra sutil */
}

.schedule-table tbody tr:last-of-type {
    border-bottom: 2px solid #ff5d00; /* Linha final mais forte */
}

/* Estilo para o texto "Fechado" */
.schedule-table td span {
    background: linear-gradient(120deg, #e74c3c, #c0392b);
    color: white;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 0.9em;
    font-weight: 500;
}

/* Ajustes para telas menores */
@media (max-width: 600px) {
    .schedule-table {
        font-size: 0.9em;
    }
    .schedule-table th,
    .schedule-table td {
        padding: 10px 12px;
    }
}
 
   /* Estilos para o modal */
.horariosModal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

.modal-contenthorarios {
            display: flex;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    justify-content: center;
    align-items: center;
        }

tbody {
    display: table-row-group;
    vertical-align: middle;
    unicode-bidi: isolate;
    background: linear-gradient(153deg, #20695882, #05a58266);
    backdrop-filter: blur(8px);
}
#tela-horarios {
    display: none;
    margin: 20px auto;
    padding: 20px;
    border-radius: 15px;
    color: #fff;
    text-align: center;
    flex: 2;
    padding-right: 20px;
}
/* =================================== */
/*    ESTILOS DO ALERTA DE PRIVACIDADE   */
/* =================================== */
.local-storage-alert {
    background: var(--floating-cart-bg);
    color: #ecf0f1;
    padding: 15px;
    margin-bottom: 20px;
    border-radius: 10px;
    border-left: 5px solid #ff0000;
    display: flex;
    align-items: center;
    position: relative;
    font-size: 0.9em;
    backdrop-filter: blur(5px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
}

.local-storage-alert i {
    font-size: 1.5em;
    margin-right: 12px;
    color: #df0505;
}

.local-storage-alert span {
    flex-grow: 1; /* Faz o texto ocupar o espaço disponível */
    padding-right: 25px; /* Espaço para o botão de fechar */
}

.close-alert-btn {
    position: absolute;
    top: 5px;
    right: 10px;
    background: none;
    border: none;
    font-size: 1.8em;
    color: white;
    cursor: pointer;
    opacity: 0.7;
    transition: opacity 0.2s ease;
}

.close-alert-btn:hover {
    opacity: 1;
}
/* =================================== */
/*    ESTILOS DO TRACKER FRETE GRÁTIS    */
/* =================================== */
.frete-gratis-tracker {
    border-radius: 8px;
    padding: 12px 15px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
    margin-top: 10px;
}

.frete-gratis-tracker p {
    margin: 0 0 10px 0;
    font-weight: 500;
    font-size: 0.95em;
}

.progress-bar-container {
    width: 100%;
    background-color: rgba(0, 0, 0, 0.3);
    border-radius: 20px;
    height: 12px;
    overflow: hidden;
}

.progress-bar {
    height: 100%;
    width: 0%; /* Inicia em 0, será controlado pelo JS */
    background: linear-gradient(90deg, #3498db, #2980b9);
    border-radius: 20px;
    transition: width 0.5s ease-in-out;
}

/* Estilo de sucesso quando atinge o objetivo */
.frete-gratis-tracker.success {
    background-color: rgba(39, 174, 96, 0.2);
    border-left: 5px solid #2ecc71;
}

.frete-gratis-tracker.success .progress-bar {
    background: linear-gradient(90deg, #2ecc71, #27ae60);
}
/* =================================== */
/*    ESTILOS REFINADOS PARA CUPOM     */
/* =================================== */
.cupom-input-wrapper {
    display: flex;
    gap: 10px;
    align-items: center;
}

#cupomInput:read-only {
    background-color: #e9ecef;
    cursor: not-allowed;
    font-weight: bold;
}

.cupom-status {
    margin-top: 8px;
    font-weight: 500;
    font-size: 0.9em;
    min-height: 1.2em; /* Evita que o layout "pule" quando o texto aparece */
}

.cupom-status.success {
    color: var(--success-color);
}

.cupom-status.error {
    color: var(--error-color);
}

.removerCupomBtn {
    background: linear-gradient(120deg, #e74c3c, #c0392b);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 0px 12px; /* Menor para se alinhar melhor */
    height: 38px; /* Altura similar ao input */
    cursor: pointer;
    font-weight: 600;
    font-size: 0.9em;
    transition: all 0.3s ease;
    flex-shrink: 0; /* Impede que o botão encolha */
}

.removerCupomBtn:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}
/* --- 1. Estilos dos Favoritos (Coração) --- */
.heart-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    background: rgba(255, 255, 255, 0.9);
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    cursor: pointer;
    z-index: 10;
    font-size: 1.2rem;
    color: #ccc; /* Cor desativado */
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    display: flex;
    align-items: center;
    justify-content: center;
}

.heart-btn:hover {
    transform: scale(1.1);
}

.heart-btn.active {
    color: #ff4757; /* Vermelho ativado */
    box-shadow: 0 0 10px rgba(255, 71, 87, 0.5);
}

/* Botão para filtrar só favoritos */
.filter-fav-btn {
    background: linear-gradient(120deg, #ff4757, #ff6b81);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 500;
    margin-left: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}
.filter-fav-btn.active {
    box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
    background: #e04050;
}

/* --- 2. Estilos de Estoque Baixo --- */
.low-stock-badge {
    background: #fff3cd;
    color: #856404;
    border: 1px solid #ffeeba;
    font-size: 0.85em;
    font-weight: 700;
    padding: 4px 8px;
    border-radius: 4px;
    margin-top: 8px;
    display: inline-block;
    animation: pulseStock 2s infinite;
}

@keyframes pulseStock {
    0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.7); }
    70% { transform: scale(1.05); box-shadow: 0 0 0 6px rgba(255, 193, 7, 0); }
    100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 193, 7, 0); }
}
/* --- CSS CORRIGIDO DO CARROSSEL --- */
#featuredProductsCarousel {
    position: relative;
    overflow: hidden;
    margin-bottom: 30px;
    border-radius: 20px;
    background: linear-gradient(231deg, #ffa200b3, #ff5d00a1);
    box-shadow: 0 0 15px #ffa200b3;
    user-select: none;
    touch-action: pan-y;
    min-height: 400px; /* GARANTE QUE NÃO FIQUE INVISÍVEL */
}

.carousel-slide {
    display: flex;
    width: 100%;
    height: 100%;
    transition: transform 0.5s cubic-bezier(0.25, 1, 0.5, 1);
    align-items: center; /* Centraliza verticalmente */
}

.carousel-item {
    min-width: 100%;
    box-sizing: border-box;
    padding: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 30px;
    /* Adicionei flex-direction row para PC */
    flex-direction: row; 
}

/* Imagem */
.carousel-img-wrapper {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    max-width: 45%;
}

.carousel-item img {
    max-width: 100%;
    max-height: 350px;
    height: auto;
    object-fit: contain;
    border-radius: 15px;
    cursor: pointer;
    /* Removendo sombras pesadas que podem bugar renderização em alguns browsers */
    filter: drop-shadow(0 10px 15px rgba(0,0,0,0.3));
}

/* Conteúdo */
.carousel-content {
    flex: 1;
    text-align: left;
    color: #fff;
    z-index: 2;
    padding-right: 20px;
    text-align: center;
}

.carousel-content h3 {
    font-size: 1.2em;
    margin: 0 0 10px 0;
    line-height: 1.2;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
}

/* Preços */
.carousel-price-tag {
    font-size: 1em;
    margin-bottom: 15px;
    font-weight: bold;
}
.carousel-old-price { text-decoration: line-through; color: #ffcccc; font-size: 0.7em; margin-right: 10px; }
.carousel-new-price { color: #2ecc71; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); }

/* Badge */
.carousel-discount {
    position: absolute;
    top: 0; left: 0;
    background: #ff4757;
    color: white;
    padding: 5px 10px;
    border-radius: 8px;
    font-weight: bold;
    font-size: 0.8em;
    z-index: 5;
}

/* Ações e Selects */
.carousel-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 15px;
    justify-content: center;
}

.carousel-actions select {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
    justify-content: center;
}
.carousel-actions option { background: #333; color: #fff; }

.carousel-btn-buy, .carousel-btn-add, .carousel-btn-details {
    padding: 10px 20px;
    border-radius: 25px;
    font-weight: bold;
    cursor: pointer;
    border: none;
    color: white;
    flex: 1;
    white-space: nowrap;
}
.carousel-btn-details { background: linear-gradient(120deg, #9b59b6, #8e44ad); }
.carousel-btn-buy { background: linear-gradient(45deg, #2ecc71, #27ae60); }
.carousel-btn-add { background: linear-gradient(45deg, #3498db, #2980b9); }

/* Botões de Navegação (Setas) */
.carousel-nav button {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 2;
    background: linear-gradient(141deg, #ff0000b8, #4800ffba);
    color: #fff;
    border: none;
    padding: 8px 12px;
    cursor: pointer;
    border-radius: 5px;
    transition: background-color 0.3s ease;
    box-shadow: 2px 1px 2px #000000e8;
    backdrop-filter: blur(8px);

    font-size: 1.2em;
}
#prevBtn { left: 10px; }
#nextBtn { right: 10px; }

/* Dots */
.carousel-dots {
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 8px;
    z-index: 20;
}
.dot {
    width: 10px; height: 10px;
    background: rgba(255,255,255,0.5);
    border-radius: 50%;
    cursor: pointer;
}
.dot.active { background: #fff; transform: scale(1.3); }

/* Mobile */
@media (max-width: 768px) {
    #featuredProductsCarousel { min-height: 550px; }
    .carousel-item { flex-direction: column; text-align: center; padding-top: 10px; }
    .carousel-img-wrapper { max-width: 80%; }
    .carousel-content { padding-right: 0; }
    .carousel-actions { justify-content: center; }
    .carousel-nav button { display: none; } /* Oculta setas no mobile */
}
/* --- Modal de Promoção (Frete Grátis) --- */
.promo-modal {
    display: none; /* Oculto por padrão */
    position: fixed;
    z-index: 2000; /* Acima de tudo */
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.85); /* Fundo bem escuro para foco */
    backdrop-filter: blur(5px);
    align-items: center;
    justify-content: center;
}

.promo-content {
    background: linear-gradient(135deg, #2ecc71, #27ae60); /* Verde chamativo */
    color: white;
    width: 90%;
    max-width: 400px;
    padding: 30px 20px;
    border-radius: 20px;
    text-align: center;
    position: relative;
    box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    border: 1px solid rgba(255,255,255,0.2);
    animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

/* Ícone animado */
.promo-icon-container {
    background: rgba(255, 255, 255, 0.2);
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: -50px auto 15px auto; /* Sobe o ícone pra fora do card */
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    backdrop-filter: blur(5px);
}

.promo-icon {
    font-size: 2.5em;
    color: #fff;
    animation: truckDrive 2s infinite ease-in-out;
}

/* Textos */
.promo-content h2 {
    font-size: 2em;
    margin: 10px 0 5px;
    text-transform: uppercase;
    text-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.promo-content p {
    font-size: 1.1em;
    margin-bottom: 20px;
    opacity: 0.9;
}

.promo-value-box {
    background: rgba(0, 0, 0, 0.2);
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 20px;
    border: 1px dashed rgba(255,255,255,0.4);
}

.promo-value-box small {
    display: block;
    font-size: 0.9em;
    margin-bottom: 5px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.promo-value-box span {
    font-size: 2.2em;
    font-weight: 800;
    color: #fff;
    text-shadow: 2px 2px 0px rgba(0,0,0,0.3);
}

/* Botão de Fechar e Ação */
.close-promo {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 28px;
    cursor: pointer;
    opacity: 0.7;
    transition: opacity 0.2s;
}
.close-promo:hover { opacity: 1; }

.btn-promo-action {
    background: #fff;
    color: #27ae60;
    font-size: 1.1em;
    font-weight: bold;
    padding: 12px 30px;
    border-radius: 30px;
    border: none;
    cursor: pointer;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    transition: transform 0.2s;
    width: 100%;
}

.btn-promo-action:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
}

/* Animações */
@keyframes popIn {
    from { opacity: 0; transform: scale(0.5); }
    to { opacity: 1; transform: scale(1); }
}

@keyframes truckDrive {
    0% { transform: translateX(-5px); }
    50% { transform: translateX(5px); }
    100% { transform: translateX(-5px); }
}
/* --- Estilo do Switch de Salvar Dados --- */
.save-data-container {
    margin: 20px 0;
    padding: 10px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.switch-label {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-size: 0.95em;
    color: #fff;
    font-weight: 500;
}

.switch-label input {
    display: none; /* Esconde o checkbox padrão */
}

.slider-round {
    position: relative;
    width: 40px;
    height: 22px;
    background-color: #ccc;
    border-radius: 34px;
    transition: .4s;
    margin-right: 12px;
    flex-shrink: 0;
}

.slider-round:before {
    position: absolute;
    content: "";
    height: 16px;
    width: 16px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    border-radius: 50%;
    transition: .4s;
}

/* Quando marcado */
input:checked + .slider-round {
    background: linear-gradient(120deg, #2ecc71, #27ae60);
}

input:checked + .slider-round:before {
    transform: translateX(18px);
}

.switch-text {
    flex-grow: 1;
}
/* --- Atualização do Container de Dados --- */
.save-data-container {
    margin: 20px 0;
    padding: 10px 15px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    justify-content: space-between; /* Separa o switch do botão */
    align-items: center;
}

/* Botão de Apagar Dados */
.btn-delete-data {
    background: transparent;
    color: #ff6b6b;
    border: 1px solid rgba(255, 107, 107, 0.5);
    padding: 5px 12px;
    font-size: 0.85em;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: none; /* Remove a sombra padrão dos botões */
    height: auto;
}

.btn-delete-data:hover {
    background: #ff6b6b;
    color: white;
    transform: scale(1.05);
    box-shadow: 0 2px 8px rgba(255, 107, 107, 0.4);
}

.btn-delete-data i {
    margin-right: 5px;
}

.diff-alert {
    font-weight: bold;
    color: #dc3545;
    animation: pulse 1s infinite;
}
/* ================================================================== */
/* ===      ÁREA ADMINISTRATIVA (LOGIN & VERIFICADOR) V-FINAL     === */
/* ================================================================== */

/* 1. O Fundo Escuro (Backdrop) */
#adminLoginModal,
#adminVerifyModal {
    display: none; /* Controlado pelo JS */
    position: fixed;
    z-index: 999; /* Acima de absolutamente tudo */
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
}

/* 2. O Cartão Central (Box Branca) */
#adminLoginModal .modal-content,
#adminVerifyModal .modal-content {
    transform: translate(-50%, -50%) !important;
    border: 1px solid rgba(255, 255, 255, 0.1);
    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    border-radius: 16px;
    padding: 25px;
    animation: scaleUp 0.3s ease;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(8px);
    box-shadow: 0 8px 30px #000000b0;
    display: flex;
    overflow-y: auto;
    flex-direction: column;
    align-items: center;
    border-top: 6px solid #ffa200;
        max-height: 90vh;
}

/* 3. Cabeçalhos e Textos */
#adminLoginModal h2, 
#adminVerifyModal h2 {
    font-size: 1.5rem;
    color: #ffffff;
    margin-bottom: 5px;
    font-weight: 800;
    text-align: center;
}

#adminLoginModal p, 
#adminVerifyModal p {
    font-size: 0.95rem;
    color: #64748b;
    line-height: 1.5;
    margin-bottom: 15px;
    text-align: center;
}

/* 4. Botão de Fechar (X) e Logout */
#adminLoginModal .close-button,
#adminVerifyModal .close-button {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    color: #f5f5f5;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 4.2rem;
    cursor: pointer;
    transition: all 0.2s;
    border: none;
}


/* Botão LOGOUT (Sair) - Canto Superior Esquerdo */
.btn-logout {
    position: absolute;
    top: 20px;
    left: 20px;
    background: transparent;
    color: #ef4444;
    border: 1px solid #ef4444;
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 5px;
    transition: all 0.2s;
}

.btn-logout:hover {
    background: #ef4444;
    color: white;
}

/* 5. Inputs (Campos de Texto) */
#adminPassInput, #newPassInput, #pedidoColado {
    width: 100%;
    box-sizing: border-box;
    padding: 15px;
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    font-size: 1rem;
    color: #334155;
    transition: border-color 0.3s;
    font-family: monospace; /* Melhor para alinhar texto */
}

#adminPassInput:focus, #newPassInput:focus, #pedidoColado:focus {
    outline: none;
    background: #fff;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

#pedidoColado {
    min-height: 120px;
    resize: vertical;
}
.buy-now-button {
    padding: 15px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 0 15px #000000a3;
    background: linear-gradient(120deg, #206958, #029b7a);
    color: #fff;
    width: 100%;
}
.buy-now-button:hover {
  background: linear-gradient(120deg, #d35400, #f39c12); /* Inverte o gradiente no hover */
  transform: translateY(-3px); /* Elevação um pouco maior */
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3); /* Sombra mais intensa */
}
/* 6. Botões Principais */
.performAdminLogin,
.analisarPedidoColado {
    background: #004cff; /* Azul Escuro */
    color: #fff;
    border: none;
    padding: 15px;
    overflow-y: auto;
    border-radius: 10px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
    transition: transform 0.2s;
    width: 100%;
    margin-bottom: 20px;
}

#adminLoginModal button:hover,
#adminVerifyModal button:hover {
    transform: translateY(-2px);
    background: #1e293b;
    box-shadow: 0 10px 15px -3px rgba(0,0,0,0.2);
}

/* 7. Resultados da Verificação (Cards Coloridos) */
.verify-card {
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 20px;
    text-align: center;
    animation: fadeIn 0.3s ease;
}

.verify-success {
    background-color: #ecfdf5;
    border: 1px solid #10b981;
    color: #065f46;
}
.verify-success h2 { color: #047857 !important; }

.verify-error {
    background-color: #fef2f2;
    border: 1px solid #ef4444;
    color: #991b1b;
}
.verify-error h2 { color: #b91c1c !important; }

/* Detalhes (Tabela Cinza) */
.verify-details {
    background: #f1f5f9;
    border-radius: 12px;
    padding: 15px;
    border: 1px solid #e2e8f0;
    font-size: 0.9rem;
}

.verify-details h4 {
    margin: 0 0 10px 0;
    text-transform: uppercase;
    font-size: 0.8rem;
    color: #64748b;
    border-bottom: 1px solid #cbd5e1;
    padding-bottom: 5px;
}

.verify-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 15px;
}

.verify-table th {
    text-align: left;
    color: #64748b;
    font-weight: 600;
    padding: 6px;
    font-size: 0.85rem;
}

.verify-table td {
    padding: 6px;
    border-bottom: 1px solid rgba(0,0,0,0.05);
}

/* 8. Botões de Status e Ações Rápidas */
.verify-actions {
    display: flex;
    gap: 10px;
    margin-top: 15px;
}

.btn-print, .btn-reply {
    flex: 1;
    padding: 12px;
    border-radius: 8px;
    border: none;
    font-weight: bold;
    cursor: pointer;
    color: white;
    transition: opacity 0.2s;
}
.btn-print { background: #334155; }
.btn-reply { background: #25D366; }
.btn-print:hover, .btn-reply:hover { opacity: 0.9; }

/* Grid de Respostas do WhatsApp */
.quick-actions-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr); /* 3 por linha */
    gap: 8px;
    margin-top: 15px;
}

.btn-status {
    border: none;
    border-radius: 8px;
    padding: 10px 5px;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    color: white;
    display: flex;
    flex-direction: column; /* Ícone em cima do texto */
    align-items: center;
    justify-content: center;
    gap: 5px;
    transition: transform 0.1s;
}

.btn-status:hover { transform: scale(1.05); }
.btn-status i { font-size: 1.1rem; }

/* Cores dos botões de status */
.st-pago { background-color: #10b981; }
.st-enviado { background-color: #3b82f6; }
.st-entregue { background-color: #8b5cf6; }
.st-cancelado { background-color: #ef4444; }
.st-reembolso { background-color: #f59e0b; }
.st-print { 
    background-color: #1e293b; 
    grid-column: span 3; /* Ocupa largura total */
    flex-direction: row; /* Ícone ao lado */
    padding: 12px;
    font-size: 1rem;
    width: 100%;
    margin-bottom: 10px;
}

/* Link "Gerar nova senha" */
#adminLoginModal p[onclick] {
    margin-top: 20px;
    color: #3b82f6;
    cursor: pointer;
    font-size: 0.85rem;
    text-decoration: none;
}
#adminLoginModal p[onclick]:hover { text-decoration: underline; }

/* Animação Zoom */
@keyframes adminZoomIn {
    from { opacity: 0; transform: translate(-50%, -45%) scale(0.9); }
    to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
}

/* Scrollbar Bonita dentro do modal */
#adminVerifyModal .modal-content::-webkit-scrollbar {
    width: 8px;
}
#adminVerifyModal .modal-content::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 4px;
}
#adminVerifyModal .modal-content::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 4px;
}
#adminVerifyModal .modal-content::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
}

/* Status do Cupom no Verificador */
.badge-cupom-valid {
    background-color: #dcfce7;
    color: #166534;
    padding: 3px 10px;
    border-radius: 15px;
    font-size: 0.8em;
    border: 1px solid #166534;
    font-weight: bold;
    display: inline-block;
    margin-left: 10px;
}
.badge-cupom-invalid {
    background-color: #fee2e2;
    color: #991b1b;
    padding: 3px 10px;
    border-radius: 15px;
    font-size: 0.8em;
    border: 1px solid #991b1b;
    font-weight: bold;
    display: inline-block;
    margin-left: 10px;
    text-decoration: line-through;
}
/* --- Tabela de Auditoria --- */
.audit-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    font-size: 0.95em;
}
.audit-table th {
    background: #f1f5f9;
    padding: 10px;
    text-align: left;
    color: #64748b;
    font-size: 0.85em;
    text-transform: uppercase;
}
.audit-table td {
    padding: 12px 10px;
    border-bottom: 1px solid #e2e8f0;
}
/* Linhas de Status */
.row-error {
    background-color: #fef2f2;
    color: #991b1b;
    font-weight: bold;
}
.row-error td:last-child::after {
    content: " ⚠️";
}
.row-success {
    color: #166534;
}
</style>
</head>

<body>
    <header style="position: relative;">
    <div id="minhalogo"></div>
    <h1 id="NomeDaLoja">Carregando...</h1>
    <p id="descricao">Carregando...</p>
    <div id="statusLoja"></div>

    <div style="display: flex;flex-direction: row-reverse;justify-content: space-between;">
        <button id="sairdaloja"><span>Troca id da loja</span></button>
        <button class="botao-Lojista" onclick="checkAdminAccess()"><i class="fas fa-user-shield"></i></button>
        <button id="shareButton"><span>🔗Compartilhar</span></button>
                    
    </div>

    </header>

    <div class="container">
    <div id="tela-horarios"></div>
    <div class="products" id="products">
    <h2 class="featured-title">✨ Produtos em destaque  ✨</h2>

    <div id="featuredProductsCarousel">
    <div class="carousel-slide"></div>
    <div class="carousel-nav">
        <button id="prevBtn" type="button"><i class="fas fa-chevron-left"></i></button>
        <button id="nextBtn" type="button"><i class="fas fa-chevron-right"></i></button>
    </div>
    <div class="carousel-dots" id="carouselDots"></div>
    </div>

    <div class="form-group search-container">
    <input type="text" id="searchInput" placeholder="🔎 Pesquisar por nome do produto...">
    <div id="clearSearchBtn" class="clear-search-btn">&times;</div>
    </div>

    <div id="categoryFilters"></div>
    
    <h2 class="featured-title">Nossos Produtos</h2>
    <div id="productList"></div>

    <p id="errorMessage" class="hidden" style="color: rgb(255, 255, 255);"></p>
    <div class="pagination-buttons">
        <button id="btnAnterior" onclick="previousPage()" disabled><i class="fas fa-chevron-left"></i></button>
        <button id="btnInicio" onclick="goToPage(1)" disabled>Início</button>
        <button id="btnProximo" onclick="nextPage()" disabled><i class="fas fa-chevron-right"></i></button>
    </div>
    </div>

    <aside id="cartSection">

        <div id="localStorageAlert" class="local-storage-alert">
            <i class="fas fa-info-circle"></i>
            <span>Seus dados (carrinho, histórico) são salvos <strong>localmente no seu navegador</strong>. Eles não estarão disponíveis em outros dispositivos ou navegadores.</span>
            <div class="close-alert-btn" onclick="dismissAlert()">&times;</div>
        </div>

    <div class="tabs">
        <button class="tab-button active" data-tab="cart">Meu Carrinho</button>
        <button class="tab-button" data-tab="checkout">Checkout</button>
        <button class="tab-button" data-tab="orderHistory">Históricos</button>
    </div>

    <div id="cart" class="tab-content active">
        <h2>Seu Carrinho</h2>
        <ul id="cartList"></ul>
        <p>Total: <span id="cartTotal">R$ 0,00</span></p>
        <div class="button-group">
        <button class="ButtonFinalizarcheckout" onclick="showTab('checkout')" id="proceedToCheckoutButton" disabled>Finalizar Compra</button>
        <button class="ButtonEsvaziarCarrinho" id="clearCartButton" onclick="clearCart()" disabled>Esvaziar Carrinho</button>
        </div>
    </div>

    <div id="checkout" class="tab-content">
        <h2>Detalhes da Entrega</h2>
        <form id="checkoutForm">
        <div class="form-group">
        <label for="Nome" class="required">Nome Completo</label>
        <input type="Nome" id="Nome" name="Nome" placeholder="Nome Completo" required>
        </div>

        <div class="form-group">
        <label for="Email" class="required">Email</label>
        <input type="email" id="Email" name="Email" placeholder="seu@email.com" required>
        </div>

        <div class="form-group">
        <label for="WhatsApp" class="required">WhatsApp</label>
        <input type="text" id="WhatsApp" name="WhatsApp" placeholder="(00) 90000-0000" required maxlength="15">
        </div>

        <div class="form-group" id="OpcaodeEntrega">
        <label for="deliveryOption" class="required">Opção de Entrega</label>
        <select id="deliveryOption" name="deliveryOption" class="custom-select"
        onchange="toggleAddressFields()">
        <option value="">Retirar no Local</option>
        <option value="delivery">Entrega em Domicílio</option>
        </select>
        </div>

        <div id="addressFields" style="display:none;">
        <div class="form-group">
        <label for="CEP" class="required">CEP</label>
        <input type="text" id="CEP" name="CEP" placeholder="00000-000" maxlength="9">
        <small id="deliveryAreaInfo" class="delivery-area-info"></small>
        </div>

        <div class="form-group">
        <label for="Endereço" class="required">Endereço</label>
        <input type="text" id="Endereço" name="Endereço" placeholder="Endereço Completo">
        </div>

        <div class="form-group">
        <label for="Cidade" class="required">Cidade</label>
        <input type="text" id="Cidade" name="Cidade" placeholder="Cidade" disabled>
        </div>

        <div class="form-group">
        <label for="Bairro" class="required">Bairro</label>
        <input type="text" id="Bairro" name="Bairro" placeholder="Bairro" disabled>
        </div>
        </div>

        <div class="form-group">
        <label for="additionalInfo">Informações Adicionais (opcional)</label>
        <textarea id="additionalInfo" name="additionalInfo"
        placeholder="Informações Adicionais (opcional)"></textarea>
        </div>
        <div id="carrinhocheckout">
        <h3>Resumo do Pedido</h3>
        <div id="cartListCheckout"></div>
                <div id="freteGratisTracker" class="frete-gratis-tracker" style="display: none;">
            <p id="freteGratisText"></p>
            <div class="progress-bar-container">
                <div id="freteGratisProgressBar" class="progress-bar"></div>
            </div>
        </div>
        <div id="avisoTaxaEntrega" class="aviso-taxa" style="display: none;"></div>
        <p class="resumo-linha">Subtotal: <span id="TotalcartCheckout">R$ 0,00</span></p>
        <p id="linhaDesconto" class="resumo-linha" style="display: none;">Desconto: <span id="valorDescontoCheckout"> - R$ 0,00</span></p>
        <p id="linhaTaxaEnvio" class="resumo-linha" style="display: none;"><span id="taxaEnvioCheckout"> R$ 0,00</span></p>
        <h3 class="resumo-linha total-final">Total Final: <span id="totalFinalCheckout">R$ 0,00</span></h3>
        </div>

        <div id="cupomContainer" class="form-group">
        <label for="cupomInput">Cupom de Desconto</label>
        <div id="cupomInputWrapper" class="cupom-input-wrapper">
        <input type="text" id="cupomInput" placeholder="Digite seu cupom">
        <button type="button" class="aplicarCupomBtn" id="aplicarCupomBtn">Aplicar</button>
        <!-- O botão de remover será adicionado aqui pelo JS -->
        </div>
        <p id="cupomStatus" class="cupom-status"></p>
        </div>

<div class="form-group">
  <label class="required">Forma de Pagamento</label>
  <div class="payment-options-container">
    <label class="payment-option" data-tab="pix">
      <input type="radio" name="paymentMethod" value="pix" onchange="updatePaymentMethodUI()" checked>
      <i class="fas fa-qrcode"></i> Pix
    </label>
    <label class="payment-option" data-tab="dinheiro">
      <input type="radio" name="paymentMethod" value="dinheiro" onchange="updatePaymentMethodUI()" >
      <i class="fas fa-money-bill-wave"></i> Dinheiro
    </label>
  </div>
</div>

<!-- Checkbox Salvar Dados -->
<div class="form-group save-data-container">
    <label class="switch-label">
        <input type="checkbox" id="salvarDadosCheck">
        <span class="slider-round"></span>
        <span class="switch-text">Salvar meus dados para a próxima compra</span>
    </label>
        <!-- Botão de Apagar (Inicia oculto) -->
    <button type="button" id="btnApagarDados" class="btn-delete-data" onclick="apagarDadosCliente()" style="display: none;">
        <i class="fas fa-trash-alt"></i> Esquecer
    </button>
</div>

<div class="button-group">
  <button type="button" class="ButtonCompraComPix" id="finalizarPedidoBtn" onclick="finalizarPedido()" disabled>
    <i class="fas fa-qrcode"></i> Gerar QR Code Pix
  </button>
</div>
        </form>
    </div>

    <div id="orderHistory" class="tab-content">
        <h2>Histórico de Pedidos</h2>
        <ul id="orderHistoryList"></ul>
        <!-- NOVO: Container para a paginação do histórico -->
        <div id="orderHistoryPagination" class="pagination-buttons"></div>
        <div class="button-group">
           <button class="ButtonEsvaziarCarrinho" id="clearHistoryButton" onclick="clearOrderHistory()">
    <i class="fas fa-trash-alt"></i> Apagar Histórico
  </button>
        </div>
    </div>
    </aside>
    </div>

    <div id="myModal" class="modal">
    <div class="modal-content">
    <button class="close-button" onclick="closeModal()">Fechar</button>
    <div id="qrCode"></div>
    </div>
    </div>

    <div id="horariosModal" class="horariosModal">
        <div class="modal-contenthorarios">
            <span class="close" onclick="closeModalhorarios()">×</span>
            <div id="horariosContent"></div>
        </div>
    </div>

<footer class="rodape">
    <div class="footer-content">
        <!-- Coluna 1: Contato e Endereço -->
        <div class="footer-column">
            <h4>Localização</h4>
            <div id="endereco-info">
                <p><strong>📍 Endereço:</strong></p>
                <p id="Endereço1"></p>
                <p id="Endereço2"></p>
                <p id="meucep"></p>
            </div>
        </div>

        <!-- Coluna 2: Links Úteis -->
        <div class="footer-column">
            <h4>Links Úteis</h4>
            <ul id="termospolitica" class="footer-links" style="display: none;">
                <li><a id="politicaPrivacidadeLink">Política de Privacidade</a></li>
                <li><a id="termosUsoLink">Termos de Uso</a></li>
            </ul>
            <h4 style="margin-top: 20px;">Siga-nos</h4>
            <div id="redesSociaisDiv" class="social-icons">
                <!-- O JS vai esconder os que não tiverem link -->
                <a id="instagramLink" href="#" target="_blank" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                <a id="facebookLink" href="#" target="_blank" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                <a id="twitterLink" href="#" target="_blank" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                <a id="emailLink" href="#" target="_blank" aria-label="envelope"><i class="fa-solid fa-envelope"></i></a>
            </div>
        </div>

        <!-- Coluna 3: Informações -->
        <div class="footer-column">
            <h4>Pagamento e Horários</h4>
            <div>
                <strong>Formas de Pagamento:</strong>
                <div class="payment-icons">
                    <div class="pix-icon"><img src="pagamentos.files/imagens/pix-icon.png" alt="Pix"></div>
                </div>
            </div>
            <button id="openModalhorarios" onclick="openModalhorarios()"><span>Horário de funcionamento</span></button>
            <p id="avisonorodape" class="footer-notice">⚠️ Todas as vendas são feitas sob encomenda e conforme disponibilidade ⚠️</p>
        </div>
    </div>

    <!-- Seção Inferior do Rodapé -->
    <div class="footer-bottom">
        <p id="rodapedaloja">Todos os direitos reservados.</p>
    </div>
</footer>

    <div id="floating-cart" onclick="showTab('cart')">
    <i class="fas fa-shopping-cart cart-icon"></i>
    <span class="cart-count" id="floatingCartCount">0</span>
    </div>

    <div id="whatswidget-pre-wrapper" style="display: none;">
        <div id="whatswidget-widget-wrapper" class="whatswidget-widget-wrapper">
        <div id="whatswidget-conversation" class="whatswidget-conversation" style="display: none; opacity: 0;">
        <div class="whatswidget-conversation-header" style="all:revert;">
            <div id="whatswidget-conversation-title" class="whatswidget-conversation-title" style="all:revert;"><span id="nome1"></span></div>
        </div>
        <div id="whatswidget-conversation-message" class="whatswidget-conversation-message " style="all:revert;">Qualquer dúvida estou a disposição.</div>
        <div class="whatswidget-conversation-cta" style="all:revert; cursor: pointer;">
            <a style="all:revert;" id="whatswidget-phone-desktop" onclick="AbrirWhatsapp();" class="whatswidget-cta whatswidget-cta-desktop">Enviar mensagem</a>
            <a id="whatswidget-phone-mobile" onclick="AbrirWhatsapp();" class="whatswidget-cta whatswidget-cta-mobile" style="all:revert;">Enviar mensagem</a>
        </div>
        </div>
        
        <div class="whatswidget-button-wrapper" style="all:revert;">
        <div class="whatswidget-button" id="whatswidget-button" style="all:revert;">
            <div style="margin:0 auto;width:38.5px;all:revert;">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="rgba(255,255,255,1)"><path d="M7.25361 18.4944L7.97834 18.917C9.18909 19.623 10.5651 20 12.001 20C16.4193 20 20.001 16.4183 20.001 12C20.001 7.58172 16.4193 4 12.001 4C7.5827 4 4.00098 7.58172 4.00098 12C4.00098 13.4363 4.37821 14.8128 5.08466 16.0238L5.50704 16.7478L4.85355 19.1494L7.25361 18.4944ZM2.00516 22L3.35712 17.0315C2.49494 15.5536 2.00098 13.8345 2.00098 12C2.00098 6.47715 6.47813 2 12.001 2C17.5238 2 22.001 6.47715 22.001 12C22.001 17.5228 17.5238 22 12.001 22C10.1671 22 8.44851 21.5064 6.97086 20.6447L2.00516 22ZM8.39232 7.30833C8.5262 7.29892 8.66053 7.29748 8.79459 7.30402C8.84875 7.30758 8.90265 7.31384 8.95659 7.32007C9.11585 7.33846 9.29098 7.43545 9.34986 7.56894C9.64818 8.24536 9.93764 8.92565 10.2182 9.60963C10.2801 9.76062 10.2428 9.95633 10.125 10.1457C10.0652 10.2428 9.97128 10.379 9.86248 10.5183C9.74939 10.663 9.50599 10.9291 9.50599 10.9291C9.50599 10.9291 9.40738 11.0473 9.44455 11.1944C9.45903 11.25 9.50521 11.331 9.54708 11.3991C9.57027 11.4368 9.5918 11.4705 9.60577 11.4938C9.86169 11.9211 10.2057 12.3543 10.6259 12.7616C10.7463 12.8783 10.8631 12.9974 10.9887 13.108C11.457 13.5209 11.9868 13.8583 12.559 14.1082L12.5641 14.1105C12.6486 14.1469 12.692 14.1668 12.8157 14.2193C12.8781 14.2457 12.9419 14.2685 13.0074 14.2858C13.0311 14.292 13.0554 14.2955 13.0798 14.2972C13.2415 14.3069 13.335 14.2032 13.3749 14.1555C14.0984 13.279 14.1646 13.2218 14.1696 13.2222V13.2238C14.2647 13.1236 14.4142 13.0888 14.5476 13.097C14.6085 13.1007 14.6691 13.1124 14.7245 13.1377C15.2563 13.3803 16.1258 13.7587 16.1258 13.7587L16.7073 14.0201C16.8047 14.0671 16.8936 14.1778 16.8979 14.2854C16.9005 14.3523 16.9077 14.4603 16.8838 14.6579C16.8525 14.9166 16.7738 15.2281 16.6956 15.3913C16.6406 15.5058 16.5694 15.6074 16.4866 15.6934C16.3743 15.81 16.2909 15.8808 16.1559 15.9814C16.0737 16.0426 16.0311 16.0714 16.0311 16.0714C15.8922 16.159 15.8139 16.2028 15.6484 16.2909C15.391 16.428 15.1066 16.5068 14.8153 16.5218C14.6296 16.5313 14.4444 16.5447 14.2589 16.5347C14.2507 16.5342 13.6907 16.4482 13.6907 16.4482C12.2688 16.0742 10.9538 15.3736 9.85034 14.402C9.62473 14.2034 9.4155 13.9885 9.20194 13.7759C8.31288 12.8908 7.63982 11.9364 7.23169 11.0336C7.03043 10.5884 6.90299 10.1116 6.90098 9.62098C6.89729 9.01405 7.09599 8.4232 7.46569 7.94186C7.53857 7.84697 7.60774 7.74855 7.72709 7.63586C7.85348 7.51651 7.93392 7.45244 8.02057 7.40811C8.13607 7.34902 8.26293 7.31742 8.39232 7.30833Z"></path></svg> 
            </div>
        </div>
        </div>
        </div>
    </div>

        <!-- NOVO: Modal apenas para a Descrição do Produto -->
    <div id="descriptionModal" class="description-modal">
        <div class="description-modal-content">
        <dav class="description-modal-close" onclick="closeDescriptionModal()">&times;</dav>
        <h3 id="descriptionModalTitle"></h3>
        <div id="descriptionModalText" class="modal-product-description"></div>
        </div>
    </div>

    <button id="backToTopBtn" title="Voltar ao topo"><i class="fas fa-arrow-up"></i></button>
    
    <div id="notification-container"></div>

    <!-- Modal de Anúncio de Frete Grátis -->
<div id="promoModal" class="promo-modal">
    <div class="promo-content">
        <span class="close-promo" onclick="closePromoModal()">&times;</span>
        <div class="promo-icon-container">
            <i class="fas fa-shipping-fast promo-icon"></i>
        </div>
        <h2>FRETE GRÁTIS!</h2>
        <p>Aproveite nossa promoção especial.</p>
        <div class="promo-value-box">
            <small>Nas compras acima de</small>
            <span id="promoValueDisplay">R$ 0,00</span>
        </div>
        <button class="btn-promo-action" onclick="closePromoModal()">
            Quero aproveitar!
        </button>
    </div>
</div>

<!-- Modal de Login do Administrador -->
<div id="adminLoginModal" class="modal">
    <div class="modal-content" style="max-width: 400px; text-align: center;">
        <span class="close-button" onclick="closeLoginModal()">×</span>
        
        <!-- Tela de Login -->
        <div id="loginView">
            <h2 style="color: #fff;"><i class="fas fa-lock"></i> Acesso Restrito</h2>
            <p style="color: #fff;">Digite a senha de administrador para acessar o verificador.</p>
            
            <input type="password" id="adminPassInput" placeholder="Senha" style="width: 100%; padding: 12px; margin: 15px 0; border-radius: 8px; border: 1px solid #ddd;">
            
            <button onclick="performAdminLogin()" class="performAdminLogin" style="width: 100%;">Entrar</button>
            
            <p style="margin-top: 20px; font-size: 0.8em; color: #999; cursor: pointer; text-decoration: underline;" onclick="toggleGeneratorView()">
                Não tem um hash? Gerar nova senha
            </p>
        </div>

        <!-- Tela de Gerador de Hash (Oculta) -->
        <div id="generatorView" style="display: none;">
            <h3 style="color: #fff;">Gerador de Senha Segura</h3>
            <p style="font-size: 0.9em; color: #fff;">Digite a senha que deseja usar. Copie o código gerado e coloque nas configurações do seu Blogger como <code>admin = CÓDIGO</code></p>
            
            <input type="text" id="newPassInput" placeholder="Sua nova senha aqui" style="width: 100%; padding: 10px; margin-top: 10px;">
            
            <button onclick="generateAdminHash()" class="category-button" style="width: 100%; margin: 10px 0;">Gerar Código SHA-256</button>
            
            <div id="hashResultArea" style="display: none; background: #f0f0f0; padding: 10px; border-radius: 5px; word-break: break-all; font-family: monospace; font-size: 0.85em; border: 1px dashed #999;">
                <span id="generatedHash"></span>
            </div>

            <p style="margin-top: 20px; font-size: 0.8em; color: #3498db; cursor: pointer;" onclick="toggleGeneratorView()">
                <i class="fas fa-arrow-left"></i> Voltar para Login
            </p>
        </div>
    </div>
</div>

<!-- Modal Verificador de Pedidos (Lojista) -->
<div id="adminVerifyModal">
    <div class="modal-content">
        
        <!-- Cabeçalho do Painel -->
        <div class="admin-header">
            <button class="btn-logout" onclick="adminLogout()" title="Sair da conta">
                <i class="fas fa-sign-out-alt"></i> Sair
            </button>
            
            <h2><i class="fas fa-clipboard-check"></i> Conferência</h2>
            
            <span class="close-button" onclick="closeAdminModal()">×</span>
        </div>

        <!-- Corpo do Painel (Com Scroll) -->
        <div class="admin-body">
            <p style="text-align: center; color: #64748b; margin-bottom: 15px;">
                Cole a mensagem completa do WhatsApp abaixo:
            </p>
            
            <textarea id="pedidoColado" rows="6" 
                placeholder="Ex: * Novo Pedido Realizado! * ..."></textarea>
            
            <button onclick="analisarPedidoColado()" class="analisarPedidoColado" style="margin-top: 15px; width: 100%;">
                🔍 Verificar Agora
            </button>

            <!-- Área onde o resultado aparece -->
            <div id="resultadoVerificacao" style="margin-top: 20px; display: none;"></div>
        </div>
    </div>
</div>

<div id="cats"></div>
<script>
const Params = new URLSearchParams(window.location.search);
    let blog; // Declarar 'blog' aqui, sem inicializar

    // Função para obter e validar o ID da loja
    function obterIdLoja() {
        let blog = Params.get('id'); // Tenta obter o ID da URL
        
        const newUrl = window.location.pathname;
        window.history.replaceState({}, document.title, newUrl);

        if (blog) {
            const lojaLogada = localStorage.getItem('lojalogada');

            if (lojaLogada && lojaLogada !== blog) {
                localStorage.setItem('lojalogada', blog);
            } else if (!lojaLogada) {
                localStorage.setItem('lojalogada', blog);
            }
        } else {
            blog = localStorage.getItem('lojalogada'); // Tenta obter o ID do localStorage
        }
        return blog;
    }

    // Obtém e valida o ID da loja
    blog = obterIdLoja();

    let cart = JSON.parse(localStorage.getItem(blog + 'cart')) || [];
    let orderHistory = JSON.parse(localStorage.getItem(blog)) || [];
    let products = [];
    let carouselProducts = [];
    let MeuPix = '';
    let whatsapp = '';
    let horariosFuncionamento = '';
    let Endereço1 = '';
    let Endereço2 = '';
    let unidadefederativa = '';
    let cidade = '';
    let bairro = '';
    let emailEndereco = '';
    let instagramUsuario = '';
    let facebookPagina = '';
    let twitterUsuario = '';
    let termosepoliticaURL = '';
    let isOpen = false;
    let currentPage = 1;
    const productsPerPage = 10;
    let currentCategory = 'all';
    let nomedaloja = '';
    let descricao = '';
    let logotipo = '';
    let taxadeenvio = 0;
    let freteGratisValor = 0;
    let contatoHTML = '';
    var hashCupomParaVerificar = '';
    let cupomAplicado = null;
    let orderHistoryCurrentPage = 1;
    const ordersPerPage = 10;
    let showingFavoritesOnly = false;
    let carouselInterval;
    let currentSlideIndex = 0;
    let touchStartX = 0;
    let touchEndX = 0;
    let EnderecoCompleto = '';
    let parametrosUrl = '';
    let ativaentrega = true;

function updatePaymentMethodUI() {
    const metodoSelecionado = document.querySelector('input[name="paymentMethod"]:checked').value;
    const tabPix = document.querySelector('.payment-option[data-tab="pix"]');
    const tabDinheiro = document.querySelector('.payment-option[data-tab="dinheiro"]');
    const btnFinalizar = document.getElementById('finalizarPedidoBtn');

    if (metodoSelecionado === 'pix') {
        tabDinheiro.classList.remove('active');
        tabPix.classList.add('active');

        btnFinalizar.innerHTML = '<i class="fas fa-qrcode"></i> Gerar QR Code Pix';
        btnFinalizar.classList.remove('ButtonCompraComDinheiro');
        btnFinalizar.classList.add('ButtonCompraComPix');
    } else {
        tabPix.classList.remove('active');
        tabDinheiro.classList.add('active');

        btnFinalizar.innerHTML = '<i class="fas fa-hand-holding-usd"></i> Pagar em Dinheiro';
        btnFinalizar.classList.remove('ButtonCompraComPix');
        btnFinalizar.classList.add('ButtonCompraComDinheiro');
    }
}

function fetchOrderStatusFromAPI(paymentHash) {
    return new Promise((resolve, reject) => {
        const callbackName = `jsonp_${paymentHash}_${Date.now()}`;
        const script = document.createElement('script');
        script.src = `https://www.blogger.com/feeds/${blog}/pages/default?alt=json-in-script&callback=${callbackName}`;

        script.onerror = () => reject(new Error('Network error'));

        window[callbackName] = (data) => {
            try {
                let foundStatus = null;
                if (data && data.feed && data.feed.entry) {
                    for (const entry of data.feed.entry) {
                        if (entry.content && entry.content.$t) {
                            const lines = entry.content.$t.split('\n');
                            for (const line of lines) {
                                const cleanLine = line.replace(/<[^>]*>/g, '').trim();
                                const match = cleanLine.match(new RegExp(`^${paymentHash}\\s+(\\w+)`));
                                if (match) {
                                    foundStatus = match[1].trim();
                                    break;
                                }
                            }
                        }
                        if (foundStatus) break;
                    }
                }
                resolve(foundStatus); // Resolve com o status ou com null
            } catch (error) {
                reject(error);
            } finally {
                delete window[callbackName];
                if (document.body.contains(script)) {
                    document.body.removeChild(script);
                }
            }
        };
        document.body.appendChild(script);
    });
}

function updateOrderStatus(index, newStatus) {
    const history = JSON.parse(localStorage.getItem(blog)) || [];
    if (!history[index]) return;

    let order = history[index];
    
    // Mapeia o status da API para as propriedades do objeto do pedido
    switch (newStatus) {
        case 'Pago':
            order.Entregue = 'Pago';
            order.Enviado = 'Pago';
            order.Pagamento = 'Pago';
            order.StatusPedido = 'Pago';
            order.StatusButton = true;
            order.isPago = true;
            break;
        case 'Enviado':
            order.Entregue = 'Enviado';
            order.Enviado = 'Enviado';
            order.Pagamento = 'Pago';
            order.StatusPedido = 'Enviado';
            order.StatusButton = true;
            order.isPago = true;
            break;    
        case 'Entregue':
            order.Enviado = 'Entregue';
            order.Entregue = 'Entregue';
            order.Pagamento = 'Pago';
            order.StatusPedido = 'Entregue';
            order.StatusButton = true;
            order.isPago = true;
            break;
        case 'Cancelado':
            order.StatusButton = false;
            order.StatusPedido = 'Cancelado';
            break;
        case 'Reembolsado':
            order.StatusButton = false;
            order.StatusPedido = 'Devolvido';
            break;
    }

    localStorage.setItem(blog, JSON.stringify(history));
    updateOrderHistoryDisplay();
}

function notifyUserOfStatusChange(order, newStatus) {
    const notifiedStatuses = JSON.parse(localStorage.getItem(blog + '_notifiedStatuses')) || {};
    const lastNotifiedStatus = notifiedStatuses[order.id];

    if (newStatus !== lastNotifiedStatus) {
        let mensagem = '', tipo = 'success';
        switch (newStatus) {
            case 'Pago': mensagem = `Pagamento do Pedido #${order.id} confirmado!`; tipo = 'success'; break;
            case 'Enviado': mensagem = `Seu Pedido #${order.id} foi enviado!`; tipo = 'atualizado'; break;
            case 'Entregue': mensagem = `Seu Pedido #${order.id} foi entregue!`; tipo = 'atualizado'; break;
            case 'Cancelado': mensagem = `O Pedido #${order.id} foi cancelado.`; tipo = 'error'; break;
            case 'Devolvido': mensagem = `O pagamento do Pedido #${order.id} foi devolvido.`; tipo = 'error'; break;
        }

        if (mensagem) showNotification(mensagem, tipo);
        
        notifiedStatuses[order.id] = newStatus;
        localStorage.setItem(blog + '_notifiedStatuses', JSON.stringify(notifiedStatuses));

    } else if (newStatus === 'Aguardando Pagamento') {
        showNotification(`Continuamos aguardando a confirmação do Pedido #${order.id}.`, 'aguardando');
    }
}

async function monitorDePedidos(options = {}) {
    const history = JSON.parse(localStorage.getItem(blog)) || [];
    const verificationTimestamps = JSON.parse(sessionStorage.getItem('verificationTimestamps')) || {};
    const cooldownTime = 25000; // 25 segundos

    // Determina quais pedidos verificar
    let indicesParaVerificar;
    if (typeof options.forceCheckIndex === 'number') {
        indicesParaVerificar = [options.forceCheckIndex]; // Apenas o pedido do clique manual
    } else {
        const estadosFinais = ['Devolvido'];
        indicesParaVerificar = history
            .map((order, index) => (estadosFinais.includes(order.StatusPedido) ? -1 : index))
            .filter(index => index !== -1); // Todos os pedidos ativos
    }

    if (indicesParaVerificar.length === 0) return;

    for (const index of indicesParaVerificar) {
        const order = history[index];
        const now = new Date().getTime();
        const lastVerificationTime = verificationTimestamps[order.id];

        // Gerencia o cooldown
        if (lastVerificationTime && (now - lastVerificationTime < cooldownTime)) {
            if (options.forceCheckIndex) { // Informa o usuário apenas no clique manual
                const timeLeft = Math.ceil((cooldownTime - (now - lastVerificationTime)) / 1000);
                showNotification(`Por favor, aguarde ${timeLeft}s antes de verificar novamente.`, 'error');
            }
            continue; // Pula para o próximo pedido
        }

        try {
            // Orquestração: 1. Busca -> 2. Atualiza -> 3. Notifica
            const newStatus = await fetchOrderStatusFromAPI(order.paymentHash);
            
            verificationTimestamps[order.id] = new Date().getTime();
            sessionStorage.setItem('verificationTimestamps', JSON.stringify(verificationTimestamps));

            if (newStatus && newStatus !== order.StatusPedido) {
                updateOrderStatus(index, newStatus);
            }
            
            // Passa o objeto do pedido (possivelmente já atualizado) para o notificador
            const currentOrderState = (JSON.parse(localStorage.getItem(blog)) || [])[index];
            if (currentOrderState) {
                notifyUserOfStatusChange(currentOrderState, currentOrderState.StatusPedido);
            }
        } catch (error) {
            console.error(`Falha ao verificar pedido #${order.id}:`, error);
        }
    }
}

let monitorIntervalIDy = null;

function iniciarMonitoramentoDePedidos() {
    if (monitorIntervalIDy) clearInterval(monitorIntervalIDy);
    monitorDePedidos(); // Roda uma vez imediatamente
    monitorIntervalIDy = setInterval(monitorIntervalIDy, 30000); // E depois a cada 30 segundos
}

function escapeHTML(str) {
    if (!str) return "";
    return str.replace(/[&<>'"]/g, 
        tag => ({
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            "'": '&#39;',
            '"': '&quot;'
        }[tag]));
}

function inicio() {

    if (localStorage.getItem('storageAlertDismissed') === 'true') {
      const alertBox = document.getElementById('localStorageAlert');
        if (alertBox) {
            alertBox.style.display = 'none';
        }
    }
    
    const carouselContainer = document.getElementById('featuredProductsCarousel');
    if (carouselContainer) {
        carouselContainer.classList.add('loading');
    }
        const productListElement = document.getElementById('productList');
    // Limpa a lista e mostra os skeletons
    productListElement.innerHTML = `
        <div class="product skeleton"></div>
        <div class="product skeleton"></div>
        <div class="product skeleton"></div>
        <div class="product skeleton"></div>
    `;

    if (!blog) {
    exibirModalErro("Digitar o id da loja", true, false, 'trocaid');
    const minecart = document.getElementById('floating-cart');
    minecart.style.display = 'none';
    const abasParaBloquear = ['cart', 'checkout', 'orderHistory'];
    abasParaBloquear.forEach(tabId => {
    const tabButton = document.querySelector(`.tab-button[data-tab="${tabId}"]`);
    if (tabButton) {
    tabButton.classList.add('tab-disabled');
    tabButton.disabled = true;
    }
    });
         return;
    }

    iniciarMonitoramentoDePedidos();

    // Adiciona comportamento ao clique nas abas
    const tabButtons = document.querySelectorAll('.tab-button');
    tabButtons.forEach(button => {
        button.addEventListener('click', function () {
            const tabId = this.dataset.tab;
            showTab(tabId);
        });
    });

    verificarStatusDaLoja();
    updateCartDisplay();
    updateOrderHistoryDisplay();
    updateMiniCartCount();
    updateFloatingCartCount();
    updateFloatingCartAccessibilityLabel();
    updatePaymentMethodUI();

    const trocaid = document.getElementById('sairdaloja');
        trocaid.addEventListener('click', function() {
        exibirModalErro("Digitar o id da loja", true, true, 'trocaid');
    });

};



function exibirModalErro(mensagem, comb = false, mostrarFechar = true, tipo = 'error', extraData = null) {
    const existente = document.getElementById('modalErro');
    if (existente) existente.remove();

    const modal = document.createElement('div');
    modal.id = 'modalErro';
    modal.className = `modal show ${tipo}`;

    const icones = {
        error: '✖️',
        success: '✔️',
        trocaid: '🏪',
        aviso: '⚠️',
        info: 'ℹ️',
        confirmarLimpeza: '🗑️',
        confirmarExclusao: '🗑️',
    };

    const conteudo = document.createElement('div');
    conteudo.className = 'conteudo';

    conteudo.innerHTML = `
        <p>${icones[tipo] || ''} ${mensagem || ''}</p>
    `;

    // Campo ID da loja (se for necessário)
    if (comb) {
        const formGroup = document.createElement('div');
        formGroup.className = 'form-group';
        formGroup.innerHTML = `
            <input type="text" id="addid" placeholder="ID da Loja">
            <button class="category-button" onclick="irParaLoja()">Ir para Loja</button>
        `;
        conteudo.appendChild(formGroup);

        const ajuda = document.createElement('a');
        ajuda.href = 'https://meupix.vercel.app/lojavirtual/criarconfig';
        ajuda.innerHTML = `<button class="botaoAjuda">Como criar um ID?</button>`;
        conteudo.appendChild(ajuda);
    }

    // Grupo de botões para confirmar ações
    if (tipo === 'confirmarLimpeza' || tipo === 'confirmarExclusao') {
        const botoes = document.createElement('div');
        botoes.className = 'button-group';

        const btnConfirmar = document.createElement('button');
        btnConfirmar.className = 'ButtonFinalizarCompra';
        btnConfirmar.innerHTML = '<i class="fas fa-check"></i> Confirmar';

        // Define a ação correta de acordo com o tipo
        if (tipo === 'confirmarLimpeza') {
             btnConfirmar.onclick = () => {
                orderHistory = [];
                localStorage.removeItem(blog);
                updateOrderHistoryDisplay();
                showNotification("Histórico de pedidos apagado!", 'success');
                modal.remove();
            };
        } else if (tipo === 'confirmarExclusao' && extraData !== null) {
            
            // --- NOVA LÓGICA AQUI ---
            if (extraData === 'DADOS_CLIENTE') {
                btnConfirmar.onclick = () => {
                    // Remove do Storage
                    localStorage.removeItem(blog + '_dadosCliente');
                    
                    // Limpa Campos
                    const campos = ['Nome', 'Email', 'WhatsApp', 'additionalInfo', 'CEP', 'Endereço', 'Cidade', 'Bairro'];
                    campos.forEach(id => {
                        const el = document.getElementById(id);
                        if(el) el.value = '';
                    });

                    // Reseta Switch e UI
                    const switchSalvar = document.getElementById('salvarDadosCheck');
                    if(switchSalvar) switchSalvar.checked = false;
                    
                    const btnApagar = document.getElementById('btnApagarDados');
                    if(btnApagar) btnApagar.style.display = 'none';

                    // Reseta Entrega
                    const deliverySelect = document.getElementById('deliveryOption');
                    if(deliverySelect) {
                        deliverySelect.value = '';
                        toggleAddressFields();
                    }

                    showNotification("Dados pessoais removidos!", 'success');
                    modal.remove();
                };
            } else {
                // Lógica existente para excluir pedido do histórico
                btnConfirmar.onclick = () => {
                    executeDeleteOrder(extraData);
                    modal.remove();
                };
            }
        }

        const btnCancelar = document.createElement('button');
        btnCancelar.className = 'ButtonEsvaziarCarrinho';
        btnCancelar.innerHTML = '<i class="fas fa-times"></i> Cancelar';
        btnCancelar.onclick = () => modal.remove();

        botoes.appendChild(btnConfirmar);
        botoes.appendChild(btnCancelar);
        conteudo.appendChild(botoes);
    }

    // Botão de fechar padrão (para outros tipos)
    if (mostrarFechar && tipo !== 'confirmarLimpeza' && tipo !== 'confirmarExclusao') {
        const botaoFechar = document.createElement('button');
        botaoFechar.className = 'botaoFechar';
        botaoFechar.innerText = 'Fechar';
        botaoFechar.onclick = () => modal.remove();
        conteudo.appendChild(botaoFechar);
    }

    modal.appendChild(conteudo);
    document.body.appendChild(modal);

    // Fecha com tecla ESC
    document.addEventListener('keydown', function escHandler(e) {
        if (e.key === 'Escape') {
            modal.remove();
            document.removeEventListener('keydown', escHandler);
        }
    });
}
function irParaLoja() {
        const idLoja = document.getElementById('addid').value;
        if (idLoja) {
            // Remove o 'id=' existente da URL
            let url = window.location.href.replace(/[?&]id=[^&#]+/i, '');
            // Adiciona o novo ID como parâmetro
            if (url.indexOf('?') > -1) {
                url += '&id=' + idLoja;
            } else {
                url += '?id=' + idLoja;
            }
            window.location.href = url;
        } else {
            showNotification("Por favor, insira o ID de loja.", 'error');
        }
    }

function verificarStatusDaLoja() {
    // 🔹 Remove qualquer script anterior antes de criar um novo
    const oldScript = document.getElementById('statusLojaScript');
    if (oldScript) oldScript.remove();

    // 🔹 Cria o novo script de forma controlada
    const script = document.createElement('script');
    script.id = 'statusLojaScript';
    script.src = `https://www.blogger.com/feeds/${blog}/pages/default?start-index=1&max-results=500&alt=json-in-script&callback=processarStatusDaLoja`;

    script.onerror = function () {
              const minecart = document.getElementById('floating-cart');
    minecart.style.display = 'none';
            const abasParaBloquear = ['cart', 'checkout', 'orderHistory'];
    abasParaBloquear.forEach(tabId => {
    const tabButton = document.querySelector(`.tab-button[data-tab="${tabId}"]`);
    if (tabButton) {
    tabButton.classList.add('tab-disabled');
    tabButton.disabled = true;
    }
    });
        exibirModalErro("ID do blog inválido.", true, false, 'error');
        script.remove(); // 🔹 remove em caso de erro

    };

    document.body.appendChild(script);
}

function processarStatusDaLoja(data) {
    try {
        let fechada = false;
        let manutencao = false;
        let ativahorario = false;
        let ativacupom = false;

        if (data && data.feed && data.feed.entry && data.feed.entry.length > 0) {
            nomedaloja = data.feed.title.$t;
            descricao = data.feed.subtitle.$t;

            document.querySelector('title').textContent = "Meu Pix - " + nomedaloja;
            document.getElementById('descricao').textContent = descricao;
            document.getElementById('NomeDaLoja').textContent = nomedaloja;
            document.getElementById('rodapedaloja').textContent = '© ' + new Date().getFullYear() + ' ' + nomedaloja + ' - Todos os direitos reservados.';

            // Configura o botão de compartilhar
            const shareButton = document.getElementById('shareButton');
            if (shareButton) {
                shareButton.addEventListener('click', function () {
                    const baseUrl = window.location.origin + window.location.pathname;
                    const shareUrl = `${baseUrl}?id=${blog}`;
                    if (navigator.share) {
                        navigator.share({ title: nomedaloja, text: descricao, url: shareUrl })
                        .catch(() => showNotification("Erro ao compartilhar.", 'error'));
                    } else {
                        // Fallback para copiar
                        navigator.clipboard.writeText(shareUrl).then(() => showNotification("Link copiado!", 'success'));
                    }
                });
            }

            // Loop único para ler todas as configurações
            data.feed.entry.forEach(entry => {
                if (entry.content && entry.content.$t) {
                    const lines = entry.content.$t.split('\n');
                    lines.forEach(line => {
                        // Limpa tags HTML se houver
                        line = line.replace(/<[^>]*>/g, '').trim();
                        
                        if (line.startsWith('fechada')) fechada = line.includes('ativado');
                        else if (line.startsWith('manutenção')) manutencao = line.includes('ativado');
                        else if (line.startsWith('ativacupom')) ativacupom = line.includes('ativado');
                        else if (line.startsWith('ativahorário')) ativahorario = line.includes('ativado');
                        else if (line.startsWith('pix')) {
                            let rawPix = line.split('pix =')[1].trim();
                            MeuPix = rawPix.replace(/&amp;/g, "&");
                            const ParamsPix = new URLSearchParams(MeuPix);
                            meuCnpj = ParamsPix.get('cpf') || '';
                        } 
                        else if (line.startsWith('whatsapp')) {
                            whatsapp = line.split('=')[1].trim();
                            const whatswidget = document.getElementById("whatswidget-pre-wrapper");
                            if(whatswidget) whatswidget.style.display = whatsapp ? 'block' : 'none';
                        }
                        else if (line.startsWith('nome')) document.getElementById('nome1').textContent = line.split('=')[1].trim();
                        else if (line.startsWith('horários')) horariosFuncionamento = line.split('horários =')[1].trim();
                        else if (line.startsWith('logo')) {
                            logotipo = line.split('logo =')[1].trim();
                            const imgContainer = document.getElementById('minhalogo');
                            if(imgContainer) imgContainer.innerHTML = `<img src="${logotipo}" width="200" height="200">`;
                        }
                        else if (line.startsWith('Endereço1')) {
                            Endereço1 = line.split('Endereço1 =')[1].trim();
                            document.getElementById("Endereço1").innerHTML = Endereço1 ? `<p>🏠 ${Endereço1}</p>` : `🏠 Carregando...`;
                        }
                        else if (line.startsWith('Endereço2')) {
                            Endereço2 = line.split('Endereço2 =')[1].trim();
                            document.getElementById("Endereço2").innerHTML = Endereço2 ? `<p>🏙️ ${Endereço2}</p>` : `🏙️ Carregando...`;
                        }
                        else if (line.startsWith('meucep')) {
                            meucep = line.split('meucep =')[1].trim();
                            document.getElementById("meucep").innerHTML = meucep ? `<p>📮 CEP: ${meucep}</p>` : `📮 CEP: Carregando...`;
                        }
                        else if (line.startsWith('unidadefederativa')) unidadefederativa = line.split('=')[1].trim();
                        else if (line.startsWith('cidade')) cidade = line.split('=')[1].trim();
                        else if (line.startsWith('bairro')) bairro = line.split('=')[1].trim();
                        else if (line.startsWith('emailEndereco')) emailEndereco = line.split('=')[1].trim();
                        else if (line.startsWith('instagramUsuario')) instagramUsuario = line.split('=')[1].trim();
                        else if (line.startsWith('facebookPagina')) facebookPagina = line.split('=')[1].trim();
                        else if (line.startsWith('twitterUsuario')) twitterUsuario = line.split('=')[1].trim();
                        else if (line.startsWith('termosepoliticaURL')) termosepoliticaURL = line.split('=')[1].trim();
                        else if (line.startsWith('taxadeenvio')) {
                            const valorTaxa = line.split('=')[1].trim();
                            taxadeenvio = parseFloat(valorTaxa.replace('R$', '').replace(',', '.').trim());
                        }
                        else if (line.startsWith('avisonorodape')) {
                            const aviso = line.split('=')[1].trim();
                            document.getElementById('avisonorodape').textContent = aviso;
                        }
                        // ✅ LEITURA DA SENHA DO ADMIN
                        else if (line.startsWith('admin')) {
                            const partes = line.split('=');
                            if (partes.length > 1) {
                                adminHash = partes[1].trim();
                            }
                        }
                        else if (line.startsWith('fretegratis_acima_de')) {
                             valorFrete = line.split('=')[1].trim();
                        }
                        else if (line.startsWith('ativaentrega')) ativaentrega = line.includes('ativado');
                    });
                    
                }
            });

            atualizarInterface(fechada, manutencao, ativahorario);
            
            // Lógica de Redes Sociais e Links (Mantida Simplificada)
            const instaLink = document.getElementById("instagramLink");
            const fbLink = document.getElementById("facebookLink");
            const twLink = document.getElementById("twitterLink");
            const mailLink = document.getElementById("emailLink");

            if (instagramUsuario) instaLink.href = `https://instagram.com/${instagramUsuario}`; else instaLink.style.display = 'none';
            if (facebookPagina) fbLink.href = `https://facebook.com/${facebookPagina}`; else fbLink.style.display = 'none';
            if (twitterUsuario) twLink.href = `https://x.com/${twitterUsuario}`; else twLink.style.display = 'none';
            if (emailEndereco) mailLink.href = `mailto:${emailEndereco}`; else mailLink.style.display = 'none';

            EnderecoCompleto = `${Endereço1 ? `🏠 ${Endereço1}` : ``}, - ${Endereço2 ? `🏙️ ${Endereço2}` : ``}, ${meucep ? `📮 CEP: ${meucep}` : ``}`;
            parametrosUrl = 
            `?nome=${encodeURIComponent(nomedaloja)}` +
            `&cnpj=${encodeURIComponent(meuCnpj)}` +
            `&email=${encodeURIComponent(emailEndereco)}` +
            `&telefone=${encodeURIComponent(whatsapp)}` +
            `&endereco=${encodeURIComponent(EnderecoCompleto)}`;

            const cupomForm = document.getElementById('cupomContainer');
            if(cupomForm) cupomForm.style.display = ativacupom ? 'block' : 'none';

            if (ativaentrega) {
            freteGratisValor = parseFloat(valorFrete); 
            if (freteGratisValor > 0) {
                const jaViuPromo = sessionStorage.getItem('promoFreteVisto');
                if (!jaViuPromo) {
                    setTimeout(() => showPromoModal(), 2000);
                }
            }
            }
            const opcaodeentrega = document.getElementById('OpcaodeEntrega');
            if (opcaodeentrega) opcaodeentrega.style.display = ativaentrega ? 'block' : 'none';

        } else {
            exibirModalErro("A loja não possui uma configuração válida.", true, false, 'error');
        }
        atualizarManifestoPWA(); 
        fetchProducts();

    } finally {
        const script = document.getElementById('statusLojaScript');
        if (script) script.remove();
    }
}

function atualizarInterface(fechada, manutencao, ativahorario) {
    const telaAtivada = document.querySelector('.products');
    const cartTabButton = document.querySelector('.tab-button[data-tab="cart"]');
    const checkoutTabButton = document.querySelector('.tab-button[data-tab="checkout"]');
    const minecart = document.getElementById('floating-cart');
    const telahorarios = document.getElementById('tela-horarios');
    const LojaAberta = document.getElementById('statusLoja');
    const abasParaBloquear = ['cart', 'checkout'];
    minecart.style.display = 'none';

    if (fechada) {
        isOpen = false;
    abasParaBloquear.forEach(tabId => {
    const tabButton = document.querySelector(`.tab-button[data-tab="${tabId}"]`);
    if (tabButton) {
    tabButton.classList.add('tab-disabled');
    tabButton.disabled = true;
    }
    });
    LojaAberta.innerHTML = '<h1 class="loja-fechada">Loja fechada!</h1>';
    telaAtivada.innerHTML = `
    <div class="desativado" style="text-align: center;">
    <h1>⚠️</h1>
    <p>A loja está temporariamente fechada. Por favor, volte mais tarde!</p>
    </div>
    `;
     minecart.style.display = 'none';
    clearCart();
    } else if (manutencao) {
        isOpen = false;
    abasParaBloquear.forEach(tabId => {
    const tabButton = document.querySelector(`.tab-button[data-tab="${tabId}"]`);
    if (tabButton) {
    tabButton.classList.add('tab-disabled');
    tabButton.disabled = true;
    }
    });
    LojaAberta.innerHTML = '<h1 class="loja-fechada">Loja em Manutenção!</h1>';
    telaAtivada.innerHTML = `
    <div class="desativado" style="text-align: center;">
    <h1>⚠️</h1>
    <p>Estamos trabalhando para melhorar sua experiência de compra. Por favor, volte mais tarde!</p>
    </div>
    `;
     minecart.style.display = 'none';
    clearCart();
    } else if (ativahorario) {
    if (horariosFuncionamento) {
       iniciarMonitoramento();
       isOpen = true;
    }
    } else {
    isOpen = true;
    const LojaAberta = document.getElementById('statusLoja');
    LojaAberta.innerHTML = '<p class="loja-aberta">Loja aberta, Boas compras!</p>';
  ativarAbasCarrinho();
    // Loja aberta
    if (document.querySelector('.desativado')) {
        telaAtivada.innerHTML = ''; // Limpa a mensagem "Loja fechada"
    }
  
    if (minecart) minecart.style.display = 'flex'; 
    //Reativa o carrinho caso a loja volte a estar disponível
    if (cartTabButton) {
        cartTabButton.classList.remove('disabled-tab');
        cartTabButton.disabled = false;
        cartTabButton.style.display = 'block';
        document.getElementById('cart').style.display = 'block';
    }
    if (checkoutTabButton) {
        checkoutTabButton.classList.remove('disabled-tab');
        checkoutTabButton.disabled = false;
        checkoutTabButton.style.display = 'block';
    }
    const featuredProductsCarousel = document.getElementById('featuredProductsCarousel');
    if (featuredProductsCarousel) featuredProductsCarousel.style.display = 'block';
    }
}

function fetchProducts() {
    if (!isOpen) return;
    const errorMessage = document.getElementById('errorMessage');
    errorMessage.classList.add('hidden');

    // Remove qualquer script anterior (se existir)
    const oldScript = document.getElementById('scriptProdutos');
    if (oldScript) oldScript.remove();

    // Cria o script novo
    const script = document.createElement('script');
    script.id = 'scriptProdutos';
    script.src = 'https://www.blogger.com/feeds/' + blog + '/posts/default?start-index=1&max-results=500&alt=json-in-script&callback=processarProdutos';

    script.onerror = function () {
        errorMessage.textContent = 'A loja foi desativada ou o ID é inválido. Verifique novamente mais tarde.';
        errorMessage.classList.remove('hidden');

        // Esconde abas relacionadas
        const cartTabButton = document.querySelector('.tab-button[data-tab="cart"]');
        const checkoutTabButton = document.querySelector('.tab-button[data-tab="checkout"]');
        if (cartTabButton) cartTabButton.style.display = 'none';
        if (checkoutTabButton) checkoutTabButton.style.display = 'none';

        // Remove o script com erro
        script.remove();
    };

    document.body.appendChild(script);
}

// Callback
function processarProdutos(data) {

    try {
        products = [];
        carouselProducts = [];

        data.feed.entry.forEach(entry => {
            const product = parseProductFromEntry(entry);
            products.push(product);
            if (product.isCarousel) carouselProducts.push(product);
        });

        if (carouselProducts.length > 0) {
            initializeCarousel();
        } else {
        const featuredtitle = document.querySelector('.featured-title');
        featuredtitle.style.display = 'none';
            const carouselContainer = document.getElementById('featuredProductsCarousel');
            if (carouselContainer) {
                carouselContainer.style.display = 'none';
                carouselContainer.classList.remove('loading');
            }
        }

        displayCategoryFilters();
        document.getElementById('productList').style.display = 'grid';
        displayProducts();
    } catch (error) {
        console.error("Erro ao processar produtos:", error);
    } finally {
        // Remove o script após processar (limpeza final)
        const script = document.getElementById('scriptProdutos');
        if (script) script.remove();
    }
}


function verificarDisponibilidadeProdutos() {
    // Retorna uma Promise para que possamos usar async/await
    return new Promise((resolve, reject) => {
        // Define uma função de callback global temporária
        window.verificarProdutosCallback = (data) => {
            const latestProducts = data.feed.entry.map(parseProductFromEntry);

            // --- INÍCIO DA MODIFICAÇÃO ---
            // 1. Atualiza as listas de produtos globais com os dados mais recentes.
            products = latestProducts;
            carouselProducts = latestProducts.filter(p => p.isCarousel);

            // 2. Redesenha a vitrine de produtos e o carrossel na tela.
            displayProducts();
            if (carouselProducts.length > 0) {
                initializeCarousel();
            }
            // --- FIM DA MODIFICAÇÃO ---


            let cartWasModified = false;
            const errorMessages = [];
            const updatedCart = [];

            cart.forEach(itemInCart => {
                const latestProduct = latestProducts.find(p => p.name === itemInCart.name);

                // Verificação 1: O produto ainda existe?
                if (!latestProduct || !latestProduct.available) {
                    cartWasModified = true;
                    errorMessages.push(`- O produto "${itemInCart.name}" não está mais disponível e foi removido.`);
                    return; // Pula para o próximo item do carrinho
                }

                // Verificação 2: A quantidade é válida?
                if (itemInCart.quantity > latestProduct.quantity) {
                    cartWasModified = true;
                    errorMessages.push(`- O estoque de "${itemInCart.name}" foi atualizado. Quantidade ajustada para ${latestProduct.quantity}.`);
                    itemInCart.quantity = latestProduct.quantity;
                }

                // Verificação 3: O preço mudou?
                if (itemInCart.price.toFixed(2) !== latestProduct.price.toFixed(2)) {
                    cartWasModified = true;
                    errorMessages.push(`- O preço de "${itemInCart.name}" mudou para ${realBR(latestProduct.price)}.`);
                    itemInCart.price = latestProduct.price;
                }

                updatedCart.push(itemInCart); // Adiciona o item (possivelmente modificado) ao novo carrinho
            });

            // Se o carrinho foi modificado, atualiza tudo e informa o usuário
            if (cartWasModified) {
                cart = updatedCart; // Substitui o carrinho antigo pelo atualizado
                localStorage.setItem(blog + 'cart', JSON.stringify(cart));
                updateCartDisplay();
                updateFloatingCartCount();
                
                const finalMessage = "Seu carrinho foi atualizado devido a mudanças no estoque ou preços:\n\n" + errorMessages.join('\n') + "\n\nPor favor, verifique antes de continuar.";
                exibirModalErro(finalMessage.replace(/\n/g, '<br>'), false, true, 'aviso');

                resolve(false); // Indica que a verificação falhou
            } else {
                resolve(true); // Indica que está tudo OK
            }

            // Limpeza: remove a função de callback e o script
            document.body.removeChild(document.getElementById('productVerificationScript'));
            delete window.verificarProdutosCallback;
        };

        // Cria e adiciona o script para a chamada JSONP
        const script = document.createElement('script');
        script.id = 'productVerificationScript';
        script.src = 'https://www.blogger.com/feeds/' + blog + '/posts/default?start-index=1&max-results=500&alt=json-in-script&callback=verificarProdutosCallback';
        script.onerror = () => {
            showNotification("Não foi possível verificar os produtos. Tente novamente.", 'error');
            reject(new Error("Falha ao carregar script de verificação."));
            document.body.removeChild(script);
            delete window.verificarProdutosCallback;
        };
        document.body.appendChild(script);
    });
}

function parseProductFromEntry(entry) {
    const entryTitle = entry.title.$t;
    const content = entry.content.$t;

    // Limpa a descrição removendo tags de imagem e outras HTML, mas mantendo quebras de linha
    const description = content
        .replace(/<img[^>]*>/g, "")           // Remove todas as tags <img>
        .replace(/<br\s*\/?>/ig, "\n")        // Converte <br> para quebras de linha
        .replace(/<[^>]*>?/gm, '')            // Remove o restante das tags HTML
        .replace(/&nbsp;/g, '')              // <-- CORREÇÃO ADICIONADA AQUI
        .trim();                              // Remove espaços em branco no início e no fim

    let imageUrls = [];
    const imgRegex = /<img.*?src="(.*?)"/g;
    let imgMatch;

    while ((imgMatch = imgRegex.exec(content)) !== null) {
        imageUrls.push(imgMatch[1]);
    }

    if (!imageUrls || imageUrls.length === 0) {
        imageUrls = [
            'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgRlizRb5kyLXSQ8P8w6hhv7DsQjm82JUQia943JRHcdu_p-BOghPdbS3Gvomxr5Sx8ivfRwuJd4OB1cjQtXLclAIPv1tMjOCKk_p6wzL6GPp2WZ6IWDCumKCmdNHjpW4-5qqZNp_HpFQhxXHlTO7pH86wbTCLxj0L5Ae7aypZyGngU0fj6eNqjWsyigvhO/s320/Captura%20de%20tela%202025-11-13%20220454.png'
        ];
    }

    let price = 0;
    let originalPrice = 0;
    let discount = 0;
    let sizes = [];
    let sabor = [];
    let quantity = 0;
    let isCarousel = false;
    let categories = [];

    if (entry.category && Array.isArray(entry.category)) {
        isCarousel = entry.category.some(cat => cat.term.toLowerCase() === 'carousel');
        entry.category.forEach(cat => {
            const term = cat.term;
            if (term.startsWith('R$')) {
                price = parseFloat(term.replace('R$ ', '').replace(',', '.'));
            } else if (term.toLowerCase().startsWith('tamanho/')) {
                sizes = term.substring('tamanho/'.length).split('/');
            } else if (term.toLowerCase().startsWith('sabor/')) {
                sabor = term.substring('sabor/'.length).split('/');
            } else if (term.toLowerCase().startsWith('quantidade/')) {
                quantity = parseInt(term.substring('quantidade/'.length));
            } else if (term.toLowerCase().startsWith('desconto/')) {
                discount = parseInt(term.substring('desconto/'.length));
            } else if (term.toLowerCase().startsWith('categorias/')) {
                categories = term.substring('categorias/'.length).split('/').filter(c => c.trim() !== '');
            }
        });
    }

    const discountedPrice = price * (1 - (discount / 100));

    return {
        name: escapeHTML(entryTitle),
        description: description,
        price: discountedPrice,
        originalPrice: price,
        imageUrls: imageUrls,
        sizes: sizes,
        sabor: sabor,
        quantity: quantity,
        discount: discount,
        available: quantity > 0,
        categories: categories,
        isCarousel: isCarousel
    };
}

// Função para criar e exibir os botões de filtro de categoria
function displayCategoryFilters() {
    const filtersContainer = document.getElementById('categoryFilters');
    if (!filtersContainer) return;

    // Extrai todas as categorias únicas de todos os produtos
    const allCategories = new Set();
    products.forEach(p => {
        if (p.categories && p.categories.length > 0) {
            p.categories.forEach(cat => allCategories.add(cat));
        }
    });
    todascategoriasdaloja = Array.from(allCategories).join(', ');
    const termospolitica =  document.getElementById('termospolitica');
    const politicaPrivacidadeLink = document.getElementById('politicaPrivacidadeLink');
    const termosUsoLink = document.getElementById('termosUsoLink');
    linkpoliticaURL = `${termosepoliticaURL}${parametrosUrl}&categorias=${todascategoriasdaloja}#politica-de-privacidade`;
    linktermosURL = `${termosepoliticaURL}${parametrosUrl}&categorias=${todascategoriasdaloja}#termos-de-uso`;

    if (termosepoliticaURL) {
        politicaPrivacidadeLink.addEventListener('click', () => {
           location.href = linkpoliticaURL;
        });

        termosUsoLink.addEventListener('click', () => {
            location.href = linktermosURL;
        });
          termospolitica.style.display = 'block';
    }


    // Limpa filtros antigos e cria o botão "Todos"
    filtersContainer.innerHTML = '';
    const allButton = document.createElement('button');
    allButton.textContent = 'Todos';
    allButton.classList.add('category-button', 'active'); // 'Todos' é ativo por padrão
    allButton.onclick = () => filterByCategory('all');
    filtersContainer.appendChild(allButton);

    // --- NOVO: Botão de Filtro de Favoritos ---
    const favButton = document.createElement('button');
    favButton.id = 'btnFilterFav';
    favButton.innerHTML = '<i class="far fa-heart"></i> Meus Favoritos';
    favButton.classList.add('filter-fav-btn');
    favButton.onclick = toggleShowFavorites;
    filtersContainer.appendChild(favButton);

    // Cria um botão para cada categoria encontrada
    allCategories.forEach(category => {
        const button = document.createElement('button');
        button.textContent = category;
        button.classList.add('category-button');
        button.onclick = () => filterByCategory(category);
        filtersContainer.appendChild(button);
    });
}

// Função para lidar com o clique em um botão de categoria
function filterByCategory(category) {
    document.getElementById('productList').style.display = 'grid';
    currentCategory = category; // Atualiza a categoria global
    currentPage = 1; // Volta para a primeira página ao filtrar

    // Atualiza qual botão está com a classe 'active'
    document.querySelectorAll('#categoryFilters .category-button').forEach(button => {
        if (button.textContent === category || (category === 'all' && button.textContent === 'Todos')) {
            button.classList.add('active');
        } else {
            button.classList.remove('active');
        }
    });

    displayProducts(); // Re-renderiza a lista de produtos com o filtro aplicado
}

function displayProducts() {
    const productListElement = document.getElementById('productList');
    const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
    productListElement.innerHTML = '';
    productListElement.style.display = 'grid';

    // Carrega a lista de favoritos salva
    const wishlist = JSON.parse(localStorage.getItem(blog + 'wishlist')) || [];

    const filteredProducts = products.filter(product => {
        if (!product.available) return false;
        
        // Filtro de Categoria
        const matchesCategory = currentCategory === 'all' || (product.categories && product.categories.includes(currentCategory));

        // Filtro de Busca
        const matchesSearch = product.name.toLowerCase().includes(searchTerm);
        
        // NOVO: Filtro de Favoritos
        const matchesFav = showingFavoritesOnly ? wishlist.includes(product.name) : true;

        return matchesCategory && matchesSearch && matchesFav;
    });

    if (filteredProducts.length === 0) {
        let msg = 'Nenhum produto encontrado com esses filtros.';
        if(showingFavoritesOnly) msg = 'Você ainda não tem nenhum favorito!';
        productListElement.innerHTML = `<p style="text-align: center; width: 100%; grid-column: 1/-1;">${msg}</p>`;
        updatePaginationButtons(0);
        return;
    }

    const startIndex = (currentPage - 1) * productsPerPage;
    const endIndex = startIndex + productsPerPage;
    const currentProducts = filteredProducts.slice(startIndex, endIndex);

    currentProducts.forEach(product => {
        const productCard = document.createElement('article');
        productCard.className = 'product-card';
        // Necessário para o posicionamento absoluto do botão de coração
        productCard.style.position = 'relative'; 
        // --- 1. Lógica do Coração (Favoritos) ---
        const isFav = wishlist.includes(product.name);
        const heartClass = isFav ? 'active' : '';
        const heartIcon = isFav ? 'fas fa-heart' : 'far fa-heart';
        const discountBadgeHTML = product.discount > 0 ? `<div class="discount-badge">-${product.discount}%</div>` : '';
        // Botão de coração HTML
        const heartBtnHTML = `
            <button class="heart-btn ${heartClass}" onclick="toggleWishlist('${product.name}', this)" aria-label="Adicionar aos favoritos">
                <i class="${heartIcon}"></i>
            </button>
        `;

        // --- 2. Lógica de Estoque Baixo (Escassez) ---
        let stockHtml = '';
        if (product.quantity > 0 && product.quantity <= 5) {
            stockHtml = `<div class="low-stock-badge"><i class="fas fa-fire"></i> Restam apenas ${product.quantity}!</div>`;
        }

        // --- Image Slider (Código existente mantido) ---
        const imageSliderContainer = document.createElement('div');
        imageSliderContainer.classList.add('image-slider-container');
        const imageSlider = document.createElement('div');
        imageSlider.classList.add('image-slider');
        imageSlider.dataset.currentSlide = 0;

        product.imageUrls.forEach(imageUrl => {
            const img = document.createElement('img');
            img.src = imageUrl;
            img.alt = product.name;
            img.loading = 'lazy';
            img.classList.add('slider-image');
            img.addEventListener('click', () => openFullscreenImage(imageUrl));
            imageSlider.appendChild(img);
        });

        if (product.imageUrls.length > 1) {
            const prevButton = document.createElement('button');
            prevButton.classList.add('slider-button', 'prev');
            prevButton.innerHTML = '<i class="fas fa-chevron-left"></i>';
            prevButton.addEventListener('click', () => prevSlide(imageSlider));
            const nextButton = document.createElement('button');
            nextButton.classList.add('slider-button', 'next');
            nextButton.innerHTML = '<i class="fas fa-chevron-right"></i>';
            nextButton.addEventListener('click', () => nextSlide(imageSlider));
            imageSliderContainer.appendChild(prevButton);
            imageSliderContainer.appendChild(nextButton);
        }
        imageSliderContainer.appendChild(imageSlider);
        
        // Inserir o botão de coração no card (antes do slider ou dentro do slider container, aqui colocamos no card)
        productCard.innerHTML = heartBtnHTML; 
        productCard.appendChild(imageSliderContainer);

        const productInfo = document.createElement('div');
        productInfo.className = 'product-info';

        // Título, Preço e Estoque Baixo
        productInfo.innerHTML = `
        ${discountBadgeHTML}
            <h3>${product.name}</h3>
            <p class="">${
                product.discount > 0
                    ? `De <strike class="backgroundred">${realBR(product.originalPrice.toFixed(2))}</strike> Por <span class="backgroundverde">${realBR(product.price.toFixed(2))}</span>`
                    : `<span class="backgroundverde">${realBR(product.price.toFixed(2))}</span>`
            }</p>
            ${stockHtml} 
        `;

        // Opções (Tamanho, Sabor)
        const productOptions = document.createElement('div');
        
        if (product.sizes?.length > 0) {
            productOptions.className = 'product-options';
            productOptions.innerHTML += `
                <label for="sizeSelect_${sanitizeId(product.name)}">Tamanho:</label>
                <select id="sizeSelect_${sanitizeId(product.name)}" class="custom-select">
                    ${product.sizes.map(size => `<option value="${size}">${size}</option>`).join('')}
                </select>`;
        }
        if (product.sabor?.length > 0) {
            productOptions.className = 'product-options';
            productOptions.innerHTML += `
                <label for="saborSelect_${sanitizeId(product.name)}">Sabor:</label>
                <select id="saborSelect_${sanitizeId(product.name)}" class="custom-select">
                    ${product.sabor.map(s => `<option value="${s}">${s}</option>`).join('')}
                </select>`;
        }
        productInfo.appendChild(productOptions);

        // Seletor de Quantidade
        productInfo.appendChild(createQuantityStepper(product));

        // Botões de Ação
        const productActions = document.createElement('div');
        productActions.className = 'product-actions';
        
        if (product.description && product.description.trim().length > 0) {
            const detailsButton = document.createElement('button');
            detailsButton.className = 'btn-details';
            detailsButton.textContent = 'Veja todos os detalhes';
            detailsButton.onclick = () => showDescriptionModal(product.name);
            productActions.appendChild(detailsButton);
        }
        productActions.appendChild(CriaBotaoAdicionarAoCarrinho(product));
        productActions.appendChild(CriaBotaoComprarAgora(product));
        productInfo.appendChild(productActions);

        productCard.appendChild(productInfo);
        productListElement.appendChild(productCard);
    });

    updatePaginationButtons(filteredProducts.length);
}

function showDescriptionModal(productName) {
    const product = products.find(p => p.name === productName);
    if (!product) return;

    const modal = document.getElementById('descriptionModal');
    const modalTitle = document.getElementById('descriptionModalTitle');
    const modalText = document.getElementById('descriptionModalText');

    modalTitle.textContent = product.name;
    modalText.innerHTML = product.description.replace(/\n/g, '<br>'); 

    modal.classList.add('is-visible');
}

function closeDescriptionModal() {
    const modal = document.getElementById('descriptionModal');

    modal.classList.remove('is-visible');
}

// Atualize sua função window.onclick para fechar este novo modal também
window.onclick = function(event) {
    const productModal = document.getElementById('productDetailModal'); // Se você ainda tiver o modal antigo
    const horariosModal = document.getElementById("horariosModal");
    const descriptionModal = document.getElementById("descriptionModal"); // Novo modal
    
    if (event.target == productModal) {
        closeProductDetails();
    }
    if (event.target == horariosModal) {
        closeModalhorarios();
    }
    // Adiciona a verificação para o novo modal
    if (event.target == descriptionModal) {
        closeDescriptionModal();
    }
}

// --- Slider Functions (com checagem e dataset por slider) ---
function nextSlide(slider) {
    const images = slider.querySelectorAll('.slider-image');
    if (images.length === 0) return;
    let currentSlide = parseInt(slider.dataset.currentSlide, 10) || 0;
    currentSlide = (currentSlide + 1) % images.length;
    slider.dataset.currentSlide = currentSlide;
    slider.style.transform = `translateX(-${currentSlide * 100}%)`;
}

function prevSlide(slider) {
    const images = slider.querySelectorAll('.slider-image');
    if (images.length === 0) return;
    let currentSlide = parseInt(slider.dataset.currentSlide, 10) || 0;
    currentSlide = (currentSlide - 1 + images.length) % images.length;
    slider.dataset.currentSlide = currentSlide;
    slider.style.transform = `translateX(-${currentSlide * 100}%)`;
}

// --- utilitário para ids seguros (substitui espaços e chars inválidos) ---
function sanitizeId(name) {
    return String(name).replace(/\s+/g, '_').replace(/[^A-Za-z0-9_\-]/g, '');
}
    // Função para criar o botão "Adicionar ao Carrinho"
    function createQuantityStepper(product) {
    const quantityId = `quantity_${sanitizeId(product.name)}`;
    const stepper = document.createElement('div');
    stepper.className = 'quantity-selector';
    stepper.innerHTML = `
        <label for="${quantityId}">Quantidade:</label>
        <div class="quantity-controls">
            <button onclick="changeQuantity('${product.name}', -1)">-</button>
            <span id="${quantityId}">1</span>
            <button onclick="changeQuantity('${product.name}', 1, ${product.quantity})">+</button>
        </div>
    `;
    return stepper;
}

    // Função para criar o botão "Adicionar ao Carrinho"
    function CriaBotaoAdicionarAoCarrinho(product) {
    const button = document.createElement('button');
    button.classList.add('add-to-cart-button');
    button.textContent = 'Adicionar ao Carrinho';
    button.onclick = () => AdicionaraoCarrinho(product); // Chama a função Adicionar ao Carrinho
    return button;
}
function changeQuantity(productName, delta, maxStock) {
    const quantitySpan = document.getElementById(`quantity_${sanitizeId(productName)}`);
    if (!quantitySpan) return;

    let currentQuantity = parseInt(quantitySpan.textContent, 10);
    let newQuantity = currentQuantity + delta;

    // Garante que a quantidade não seja menor que 1 nem maior que o estoque
    if (newQuantity < 1) newQuantity = 1;
    if (newQuantity > maxStock) {
        newQuantity = maxStock;
        showNotification(`Estoque máximo de ${maxStock} unidades atingido.`, 'aviso');
    }
    quantitySpan.textContent = newQuantity;
}

function openFullscreenImage(imageUrl) {
    // Cria o overlay
    const overlay = document.createElement('div');
    overlay.classList.add('fullscreen-overlay');

    // Cria a imagem em fullscreen
    const fullscreenImg = document.createElement('img');
    fullscreenImg.src = imageUrl;
    fullscreenImg.classList.add('fullscreen-image');

    // Botão fechar
    const closeBtn = document.createElement('span');
    closeBtn.classList.add('close-btn');
    closeBtn.innerHTML = '&times;';
    closeBtn.addEventListener('click', () => overlay.remove());

    // Fecha clicando fora da imagem também
    overlay.addEventListener('click', e => {
        if (e.target === overlay) overlay.remove();
    });

    overlay.appendChild(fullscreenImg);
    overlay.appendChild(closeBtn);
    document.body.appendChild(overlay);
}

function AdicionaraoCarrinho(product) {
    // Obtém as opções selecionadas dos selects
    const selectedQuantity = document.getElementById(`quantity_${sanitizeId(product.name)}`).textContent;
    const selectedSize = document.getElementById(`sizeSelect_${sanitizeId(product.name)}`) ? document.getElementById(`sizeSelect_${sanitizeId(product.name)}`).value : '';
    const selectedSabor = document.getElementById(`saborSelect_${sanitizeId(product.name)}`) ? document.getElementById(`saborSelect_${sanitizeId(product.name)}`).value : '';
    
    ComprarProdutos(product, selectedQuantity, selectedSize, selectedSabor, false);
}
    // Função para criar o botão "Comprar Agora"
function CriaBotaoComprarAgora(product) {
    const button = document.createElement('button');
    button.classList.add('buy-now-button');
    button.textContent = 'Comprar Agora';
    button.onclick = () => ComprarAgora(product); // Chama a função buyNow
    return button;
}

function ComprarAgora(product) {
    // Obtém as opções selecionadas dos selects
    const selectedQuantity = document.getElementById(`quantity_${sanitizeId(product.name)}`).textContent;
    const selectedSize = document.getElementById(`sizeSelect_${sanitizeId(product.name)}`) ? document.getElementById(`sizeSelect_${sanitizeId(product.name)}`).value : '';
    const selectedSabor = document.getElementById(`saborSelect_${sanitizeId(product.name)}`) ? document.getElementById(`saborSelect_${sanitizeId(product.name)}`).value : '';

    // Chama a função auxiliar, indicando para redirecionar para o checkout
    ComprarProdutos(product, selectedQuantity, selectedSize, selectedSabor, true);
}

// Função auxiliar para padronizar a adição/atualização do carrinho
function ComprarProdutos(product, selectedQuantity, selectedSize, selectedSabor, redirectToCheckout = false) {
    if (!product) {
        showNotification("Produto não encontrado.", 'error');
        return;
    }

    // Validações
    if (product.sizes && product.sizes.length > 0 && selectedSize === "") {
        showNotification("Por favor, selecione um tamanho.", 'error');
        return;
    }

    if (product.sabor && product.sabor.length > 0 && selectedSabor === "") {
        showNotification("Por favor, selecione um Sabor.", 'error');
        return;
    }

    if (!selectedQuantity || parseInt(selectedQuantity) <= 0) {
        showNotification("Por favor, selecione uma quantidade válida.", 'error');
        return;
    }

    selectedQuantity = parseInt(selectedQuantity);

    // Encontra o índice de um item *com as mesmas características*
    const existingItemIndex = cart.findIndex(item =>
        item.name === product.name &&
        item.selectedSize === selectedSize &&
        item.selectedsabor === selectedSabor
    );

    if (existingItemIndex > -1) {
        // O produto já existe no carrinho com as mesmas opções de tamanho e sabor
        const existingItem = cart[existingItemIndex];

        if (existingItem.quantity === selectedQuantity) {
            showNotification("Produto já adicionado no carrinho com a mesma quantidade!", 'error');
        } else {
            existingItem.quantity = selectedQuantity;
            showNotification("Quantidade do produto atualizada no carrinho!", 'atualizado');
        }

    } else {
        // O produto não existe no carrinho com essas opções, então adicione-o
        cart.push({
            name: product.name,
            price: product.price,
            quantity: selectedQuantity,
            imageUrl: product.imageUrls[0],
            selectedSize: selectedSize,
            selectedsabor: selectedSabor
        });
        showNotification("Item adicionado ao carrinho!", 'success');
    }

    localStorage.setItem(blog + 'cart', JSON.stringify(cart));
    updateCartDisplay();
    updateMiniCartCount();
    updateFloatingCartCount();
    updateFloatingCartAccessibilityLabel();

    if (redirectToCheckout) {
        showTab('checkout');
    }
}

    function removeFromCart(index) {
    cart.splice(index, 1);
    localStorage.setItem(blog + 'cart', JSON.stringify(cart));
    updateCartDisplay();
    updateMiniCartCount();
    updateFloatingCartCount();
    updateFloatingCartAccessibilityLabel();
    showNotification("Item removido do carrinho!", 'success');
}

function updateCartDisplay() {
    const cartList = document.getElementById('cartList');
    const cartTotalElement = document.getElementById('cartTotal');
    
    // Elementos do Checkout
    const cartListCheckout = document.getElementById('cartListCheckout');
    const subtotalCheckoutEl = document.getElementById('TotalcartCheckout');
    const linhaDescontoEl = document.getElementById('linhaDesconto');
    const valorDescontoEl = document.getElementById('valorDescontoCheckout');
    const linhaTaxaEnvioEl = document.getElementById('linhaTaxaEnvio');
    const taxaEnvioEl = document.getElementById('taxaEnvioCheckout');
    const totalFinalEl = document.getElementById('totalFinalCheckout');
    const carrinhoCheckoutDiv = document.getElementById('carrinhocheckout');
    const proceedToCheckoutButton = document.getElementById('proceedToCheckoutButton');
    const clearCartButton = document.getElementById('clearCartButton');
    const finalizarPedidoBtn = document.getElementById('finalizarPedidoBtn');

    // 1. Calcula o subtotal
    let subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

    // 2. Lógica do Carrinho Vazio
    if (cart.length === 0) {
        cartList.innerHTML = `
            <div class="empty-cart-container">
                <div class="empty-cart-icon"><i class="fas fa-shopping-basket"></i></div>
                <p class="empty-cart-text">Seu carrinho está vazio!</p>
                <button class="btn-go-shopping" onclick="showTab('products')">
                    Explorar Produtos
                </button>
            </div>
        `;
    } else {
        // Se houver itens, remove o aviso de vazio se ele estiver lá
        const emptyState = cartList.querySelector('.empty-cart-container');
        if (emptyState) cartList.innerHTML = '';

        // --- RENDERIZAÇÃO INTELIGENTE (SEM PISCAR) ---
        // A. Remove itens que não existem mais
        const currentDomItems = cartList.querySelectorAll('.cart-item');
        if (currentDomItems.length > cart.length) {
            cartList.innerHTML = ''; // Reseta se a contagem não bater (segurança)
        }

        // B. Atualiza ou Cria
        cart.forEach((item, index) => {
            const itemTotal = item.price * item.quantity;
            const itemId = `cart-item-${index}`; // ID único
            
            let existingItem = document.getElementById(itemId);
            // Verifica se é o mesmo produto
            const isSameProduct = existingItem && existingItem.getAttribute('data-name') === item.name;

            // Badges HTML
            let badgesHTML = '';
            if (item.selectedSize) badgesHTML += `<span class="item-badge">${item.selectedSize}</span>`;
            if (item.selectedsabor) badgesHTML += `<span class="item-badge">${item.selectedsabor}</span>`;

            if (existingItem && isSameProduct) {
                // SÓ ATUALIZA OS NÚMEROS (Não pisca)
                const qtySpan = existingItem.querySelector('.cart-stepper span');
                const priceDiv = existingItem.querySelector('.item-price');
                if(qtySpan) qtySpan.textContent = item.quantity;
                if(priceDiv) priceDiv.textContent = realBR(itemTotal);
            } else {
                // CRIA NOVO ITEM
                const li = document.createElement('li');
                li.id = itemId;
                li.classList.add('cart-item');
                li.setAttribute('data-name', item.name);
                
                li.innerHTML = `
                    <div class="cart-item-img-wrapper">
                        <img src="${item.imageUrl}" alt="${item.name}" loading="lazy">
                    </div>
                    <div class="cart-item-info">
                        <div class="item-name">${item.name}</div>
                        <div class="item-badges">${badgesHTML}</div>
                        <div class="item-price">${realBR(itemTotal)}</div>
                    </div>
                    <div class="cart-actions">
                        <div class="cart-stepper">
                            <button onclick="decreaseCartItemQuantity(${index})"><i class="fas fa-minus" style="font-size: 0.7em;"></i></button>
                            <span>${item.quantity}</span>
                            <button onclick="increaseCartItemQuantity(${index})"><i class="fas fa-plus" style="font-size: 0.7em;"></i></button>
                        </div>
                        <button class="btn-remove-item" onclick="removeFromCart(${index})" title="Remover">
                            <i class="fas fa-trash-alt"></i> Remover
                        </button>
                    </div>
                `;
                cartList.appendChild(li);
            }
        });
        
        // Remove sobras
        while (cartList.children.length > cart.length) {
            cartList.removeChild(cartList.lastChild);
        }
    }

    // --- ATUALIZA LISTA DO CHECKOUT (Recria sempre, pois fica em outra aba) ---
    if (cartListCheckout) {
        cartListCheckout.innerHTML = '';
        cart.forEach(item => {
            const itemTotal = item.price * item.quantity;
            const optionsString = [item.selectedSize, item.selectedsabor].filter(Boolean).join(' / ');
            const li = document.createElement('li');
            li.className = 'cart-item'; // Reutiliza estilo ou cria específico
            li.style.borderBottom = "1px solid #eee"; // Ajuste fino para checkout
            li.innerHTML = `
                <div style="display:flex; align-items:center; width:100%;">
                    <img src="${item.imageUrl}" style="width:50px; height:50px; border-radius:8px; margin-right:10px; object-fit:cover;">
                    <div style="flex:1;">
                        <div style="font-weight:bold; font-size:0.9em;">${item.name}</div>
                        <div style="font-size:0.8em; opacity:0.8;">${optionsString} (x${item.quantity})</div>
                    </div>
                    <strong style="color:#2ecc71;">${realBR(itemTotal)}</strong>
                </div>
            `;
            cartListCheckout.appendChild(li);
        });
    }

    // --- CÁLCULOS FINAIS ---
    let desconto = 0;
    if (cupomAplicado && subtotal > 0) {
        if (cupomAplicado.tipo === 'percentual') {
            desconto = subtotal * (cupomAplicado.valor / 100);
        } else if (cupomAplicado.tipo === 'fixo') {
            desconto = cupomAplicado.valor;
            if (desconto > subtotal) desconto = subtotal;
        }
        if (linhaDescontoEl) {
            if (desconto > 0) {
                linhaDescontoEl.style.display = 'block';
                valorDescontoEl.textContent = `- ${realBR(desconto)}`;
            } else {
                linhaDescontoEl.style.display = 'none';
            }
        }
    } else {
        if(linhaDescontoEl) linhaDescontoEl.style.display = 'none';
    }

    // Frete
    const deliveryOption = document.getElementById('deliveryOption') ? document.getElementById('deliveryOption').value : '';
    let taxaDeEntregaAplicada = 0;
    let freteGratisAlcancado = false;

    if (deliveryOption === 'delivery' && taxadeenvio > 0) {
        if (cupomAplicado && cupomAplicado.tipo === 'frete') {
            taxaEnvioEl.innerHTML = `Taxa de Entrega: <span style="text-decoration: line-through; color: #e74c3c;"> ${realBR(taxadeenvio)}</span> <span style="color: var(--success-color);">Grátis (Cupom)!</span>`;
            freteGratisAlcancado = true;
        } 
        else if (freteGratisValor > 0 && subtotal >= freteGratisValor) {
            taxaEnvioEl.innerHTML = `Taxa de Entrega: <strike>${realBR(taxadeenvio)}</strike> <span class="pago-success">Frete Grátis!</span>`;
            freteGratisAlcancado = true;
        } 
        else {
            taxaDeEntregaAplicada = taxadeenvio;
            taxaEnvioEl.textContent = 'Taxa de Entrega: ' + realBR(taxadeenvio);
        }
        if(linhaTaxaEnvioEl) linhaTaxaEnvioEl.style.display = 'flex';
    } else {
        if(linhaTaxaEnvioEl) linhaTaxaEnvioEl.style.display = 'none';
    }

    let totalFinal = subtotal - desconto + taxaDeEntregaAplicada;
    if (totalFinal < 0) totalFinal = 0;

    // Atualiza Textos
    if(cartTotalElement) cartTotalElement.textContent = realBR(subtotal);
    if(subtotalCheckoutEl) subtotalCheckoutEl.textContent = realBR(subtotal);
    if(totalFinalEl) totalFinalEl.textContent = realBR(totalFinal);

    // Atualiza Botões e Layout
    const cartHasItems = cart.length > 0;
    if(proceedToCheckoutButton) proceedToCheckoutButton.disabled = !cartHasItems;
    if(clearCartButton) clearCartButton.disabled = !cartHasItems;
    if(finalizarPedidoBtn) finalizarPedidoBtn.disabled = !cartHasItems;
    if(carrinhoCheckoutDiv) carrinhoCheckoutDiv.style.display = cartHasItems ? 'block' : 'none';

    // Atualiza Extras
    updateFreteGratisTracker(subtotal, freteGratisAlcancado);
    updateMiniCartCount();
    updateFloatingCartCount();
    updateFloatingCartAccessibilityLabel();
}

function updateFreteGratisTracker(subtotal, freteGratisAlcancado) {
    const tracker = document.getElementById('freteGratisTracker');
    const textEl = document.getElementById('freteGratisText');
    const progressBar = document.getElementById('freteGratisProgressBar');
    const avisoTaxaEl = document.getElementById('avisoTaxaEntrega');
    const deliveryOption = document.getElementById('deliveryOption').value;

    // Só mostra o tracker se a promoção estiver configurada
    if (freteGratisValor <= 0 || cart.length === 0) {
        tracker.style.display = 'none';
        return;
    }

    tracker.style.display = 'block';

    if (freteGratisAlcancado || subtotal >= freteGratisValor) {
        tracker.classList.add('success');
        textEl.innerHTML = '🎉 <strong>Parabéns! Você conseguiu frete grátis!</strong>';
        progressBar.style.width = '100%';
        avisoTaxaEl.style.display = 'none';
    } else {
        tracker.classList.remove('success');
        const restante = freteGratisValor - subtotal;
        textEl.innerHTML = `Faltam <strong>${realBR(restante)}</strong> para você ganhar <strong>FRETE GRÁTIS!</strong>`;
        const progresso = (subtotal / freteGratisValor) * 100;
        progressBar.style.width = `${progresso}%`;

    if (deliveryOption === 'delivery') {  
        avisoTaxaEl.style.display = 'block';
    } else {
        avisoTaxaEl.style.display = 'none';
    }
}
}

function updateMiniCartCount() {
    const miniCartCount = document.getElementById('miniCartCount');
    if (miniCartCount) { // Check if the element exists
    let totalItems = 0;
    cart.forEach(item => {
        totalItems += item.quantity;
});
    miniCartCount.textContent = totalItems;
} else {}
}

function updateFloatingCartCount() {
    const floatingCartCount = document.getElementById('floatingCartCount');
    if (floatingCartCount) { // Check if the element exists
    let totalItems = 0;
    cart.forEach(item => {
        totalItems += item.quantity;
});
    floatingCartCount.textContent = totalItems;
} else {}

}

function updateFloatingCartAccessibilityLabel() {
    const floatingCart = document.getElementById('floating-cart');
    const cartCount = cart.reduce((sum, item) => sum + item.quantity,
    0); //Soma a quantidade total de itens
    floatingCart.setAttribute('aria-label',
    `Carrinho de Compras (itens: ${cartCount}). Clique para ver o carrinho.`);
}

async function generateHash(value) {
    const encoder = new TextEncoder();
    const data = encoder.encode(value);
    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map(byte => byte.toString(16).padStart(2, '0')).join('');
}

const inputCep = document.getElementById('CEP');
const inputWhatsApp = document.getElementById('WhatsApp');

    if (inputCep) {
        inputCep.addEventListener('input', () => {
            let cep = inputCep.value.replace(/\D/g, '');
            cep = cep.substring(0, 8);
            cep = cep.replace(/(\d{5})(\d)/, '$1-$2');
            inputCep.value = cep;
        });
    }

    if (inputWhatsApp) {
        inputWhatsApp.addEventListener('input', () => {
            let whatsapp = inputWhatsApp.value.replace(/\D/g, '');
            whatsapp = whatsapp.substring(0, 11);
            if (whatsapp.length > 10) {
                whatsapp = whatsapp.replace(/^(\d{2})(\d{5})(\d{4})$/, '($1) $2-$3');
            } else if (whatsapp.length > 11) {
                whatsapp = whatsapp.replace(/^(\d{2})(\d{4})(\d{0,4})$/, '($1) $2-$3');
            } else if (whatsapp.length > 2) {
                whatsapp = whatsapp.replace(/^(\d{2})(\d*)$/, '($1) $2');
            } else if (whatsapp.length > 0) {
                whatsapp = whatsapp.replace(/^(\d*)$/, '($1');
            }
            inputWhatsApp.value = whatsapp;
        });
    }

function isValidEmail(email) {
    if (!email) return false;
    const emailRegex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
    return emailRegex.test(email);
}
async function finalizarPedido() {
    // --- Validação dos campos do formulário (seu código existente) ---
    const deliveryOption = document.getElementById('deliveryOption').value;
    const nomeInput = document.getElementById('Nome');
    const emailInput = document.getElementById('Email');
    const whatsappInput = document.getElementById('WhatsApp');
    
    let requiredFields = [
        { el: nomeInput, name: "Nome" },
        { el: emailInput, name: "Email" },
        { el: whatsappInput, name: "WhatsApp" }
    ];

    if (deliveryOption === 'delivery') {
        requiredFields.push({ el: document.getElementById('CEP'), name: "CEP" });
        requiredFields.push({ el: document.getElementById('Endereço'), name: "Endereço" });
        requiredFields.push({ el: document.getElementById('Cidade'), name: "Cidade" });
        requiredFields.push({ el: document.getElementById('Bairro'), name: "Bairro" });
    }

    // 2. Verifica campos vazios
    const missingFields = requiredFields.filter(field => !field.el.value.trim());
    if (missingFields.length > 0) {
        const fieldNames = missingFields.map(field => field.name).join(', ');
        showNotification(`Por favor, preencha os campos obrigatórios: ${fieldNames}.`, 'error');
        
        missingFields[0].el.focus();
        missingFields[0].el.style.borderColor = 'var(--error-color)'; // Destaque visual
        return; // Para a execução
    }

    // 3. Validação específica para o formato do E-mail
    if (!isValidEmail(emailInput.value)) {
        showNotification('O endereço de e-mail inserido não parece ser válido. Por favor, verifique.', 'error');
        emailInput.focus();
        emailInput.style.borderColor = 'var(--error-color)'; // Destaque visual
        return; // Para a execução
    }

    if (cart.length === 0) {
        showNotification("Carrinho de compras vazio!", 'error');
        return;
    }
    
    // Verificação de estoque antes de prosseguir
    try {
        const isCartValid = await verificarDisponibilidadeProdutos();
        if (!isCartValid) {
            return; 
        }
    } catch (error) {
        showNotification("Erro ao verificar o estoque. Tente novamente.", 'error');
        return;
    }

    // --- LÓGICA DE SALVAR DADOS ---
    const salvarDadosCheck = document.getElementById('salvarDadosCheck');
    if (salvarDadosCheck && salvarDadosCheck.checked) {
        const dadosParaSalvar = {
            nome: document.getElementById('Nome').value,
            email: document.getElementById('Email').value,
            whatsapp: document.getElementById('WhatsApp').value,
            deliveryOption: deliveryOption,
            cep: document.getElementById('CEP').value,
            endereco: document.getElementById('Endereço').value,
            cidade: document.getElementById('Cidade').value,
            bairro: document.getElementById('Bairro').value
        };
        localStorage.setItem(blog + '_dadosCliente', JSON.stringify(dadosParaSalvar));
    } else {
        // Se o usuário desmarcar, removemos os dados salvos? 
        // Geralmente é melhor manter ou perguntar, mas aqui vamos manter a opção do usuário.
        // Se quiser que apague quando desmarcado, descomente a linha abaixo:
        // localStorage.removeItem(blog + '_dadosCliente');
    }
    
    try {
        const idPagamentos = generatePaymentId();
        const paymentHash = idPagamentos;
        
        // --- 1. Recalcula o subtotal (base para todos os outros cálculos) ---
        const metodoPagamento = document.querySelector('input[name="paymentMethod"]:checked').value;
        const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        let valorDesconto = 0;
        let cupomInfo = null;

        if (cupomAplicado && subtotal > 0 && cupomAplicado.tipo !== 'frete') {
            if (cupomAplicado.tipo === 'percentual') {
                valorDesconto = subtotal * (cupomAplicado.valor / 100);
            } else if (cupomAplicado.tipo === 'fixo') {
                valorDesconto = cupomAplicado.valor;
                if (valorDesconto > subtotal) valorDesconto = subtotal;
            }

            cupomInfo = {
                codigoHash: cupomAplicado.hash,
                valor: cupomAplicado.valor,
                tipo: cupomAplicado.tipo,
                codigoOriginal: cupomAplicado.codigoOriginal
            };
        }


        let taxaAplicada = 0;
        let freteGratisAlcancado = false;

        if (deliveryOption === 'delivery' && taxadeenvio > 0) {

            if (cupomAplicado && cupomAplicado.tipo === 'frete') {
                freteGratisAlcancado = true;
                cupomInfo = {
                    codigoHash: cupomAplicado.hash,
                    valor: cupomAplicado.valor,
                    tipo: 'frete',
                    codigoOriginal: cupomAplicado.codigoOriginal
                 };
            } 

            else if (freteGratisValor > 0 && subtotal >= freteGratisValor) {
                freteGratisAlcancado = true;
            }

            if (!freteGratisAlcancado) {
                taxaAplicada = taxadeenvio;
            }
        }
        
        let valorFinal = subtotal - valorDesconto + taxaAplicada;
        if (valorFinal < 0) valorFinal = 0;

        const valor = valorFinal.toFixed(2);
        const dataCompra = new Date().toLocaleDateString();

        const produtosnopix = JSON.stringify(cart.map(item => ({
            name: item.name,
            price: item.price,
            quantity: item.quantity,
            imageUrl: item.imageUrl,
            selectedSize: item.selectedSize || '',
            selectedsabor: item.selectedsabor || '',
        })));

        const nomeCliente = document.getElementById('Nome').value;
        const emailCliente = document.getElementById('Email').value;
        const telefoneCliente = document.getElementById('WhatsApp').value;
        const infoAdicional = document.getElementById('additionalInfo').value;

        // --- 2. Monta a string dos itens do pedido ---
        const itensPedidoString = cart.map(item => {
            const optionsString = [item.selectedSize, item.selectedsabor].filter(Boolean).join(' / ');
            const itemTotal = item.price * item.quantity;
            return `${item.name} ${optionsString ? `(${optionsString})` : ''} (x${item.quantity}) - ${realBR(itemTotal)}`;
        }).join('\n');

        // --- 3. Monta a string do endereço de entrega ou retirada ---
        const entregaString = deliveryOption === 'delivery'
            ? `*Endereço de Entrega:*\n${document.getElementById('Endereço').value}, ${document.getElementById('Bairro').value}, ${document.getElementById('Cidade').value} - CEP: ${document.getElementById('CEP').value}`
            : `*Opção de Entrega:*\nRetirada no Local`;

        // --- 4. Constrói a mensagem final usando um array e join() para mais legibilidade ---
        const messageParts = [
            `*Novo Pedido Realizado!*`,
            `*Pedido:* #${idPagamentos}`,
            `-----------------------------------`,
            `*Dados do Cliente:*`,
            `*Nome:* ${nomeCliente}`,
            `*Email:* ${emailCliente}`,
            `*Telefone:* ${telefoneCliente}`,
            infoAdicional ? `*Info Adicional:* ${infoAdicional}` : null,
            `-----------------------------------`,
            entregaString,
            `-----------------------------------`,
            `*Itens do Pedido:*`,
            itensPedidoString,
            `-----------------------------------`,
            `*Resumo Financeiro:*`,
            `*Forma de Pagamento:* ${metodoPagamento === 'pix' ? 'Pix' : 'Dinheiro'}`,
            `*Subtotal:* ${realBR(subtotal)}`
        ];

        // Adiciona a linha de desconto SOMENTE se ele for maior que zero
        if (valorDesconto > 0) {
            // AQUI ESTÁ A MUDANÇA
            const codigoCupom = cupomAplicado && cupomAplicado.codigoOriginal ? `(Cupom: ${cupomAplicado.codigoOriginal})` : '';
            messageParts.push(`*Desconto:* - ${realBR(valorDesconto)} ${codigoCupom}`);
        }
        
        // Adiciona a linha da taxa de entrega
        if (deliveryOption === 'delivery') {
            if (cupomAplicado && cupomAplicado.tipo === 'frete') {
                // E AQUI TAMBÉM
                const codigoCupom = cupomAplicado.codigoOriginal || '';
                messageParts.push(`*Taxa de Entrega:* Frete Grátis (Cupom: ${codigoCupom})`);
            } else if (taxaAplicada > 0) {
                messageParts.push(`*Taxa de Entrega:* ${realBR(taxaAplicada)}`);
            }
        }
        
        messageParts.push(`*TOTAL:* *${realBR(valor)}*`);
        messageParts.push(`*Data:* ${dataCompra}`);

        const whatsappMessage = messageParts.filter(part => part !== null).join('\n');

        const pedidowhatsapp = `https://wa.me/${whatsapp}?text=${encodeURIComponent(whatsappMessage)}`;

        const order = {
            id: idPagamentos,
            paymentHash: paymentHash,
            isPago: false,
            Pagamento: '',
            Enviado: '',
            StatusButton: true,
            StatusPedido: 'Aguardando Pagamento',
            Entregue: '',
            produtos: produtosnopix,
            pedidowhatsapp: pedidowhatsapp,
            items: cart.map(item => ({
                name: item.name,
                price: item.price,
                quantity: item.quantity,
                imageUrl: item.imageUrl,
                selectedSize: item.selectedSize || '',
                selectedsabor: item.selectedsabor || '',
            })),
            subtotal: subtotal.toFixed(2),
            desconto: valorDesconto.toFixed(2), 
            cupomUtilizado: cupomInfo,        
            deliveryFee: taxaAplicada.toFixed(2),
            total: valor, 
            metodoPagamento: metodoPagamento,
            pixUrl: '',
            timestamp: Date.now(),
            deliveryOption: deliveryOption,
            address: {
                name: document.getElementById('Nome').value,
                address: document.getElementById('Endereço').value,
                city: document.getElementById('Cidade').value,
                bairro: document.getElementById('Bairro').value,
                postcode: document.getElementById('CEP').value,
                email: document.getElementById('Email').value,
                phone: document.getElementById('WhatsApp').value,
                additionalInfo: document.getElementById('additionalInfo').value
            }
        };

        if (metodoPagamento === 'pix') {

            const paramschaves = `${MeuPix}&valor=${valor}&txid=${idPagamentos}&logo=${logotipo}&idadaloja=${blog}&iddopagamento=${idPagamentos}`;
            const dadospix = btoa(paramschaves);
            order.pixUrl = `index.html?codepix=${dadospix}`; 

            // Mostra o modal do QR Code
            document.getElementById('myModal').classList.add('fullscreen');
            document.getElementById('qrCode').innerHTML = `<iframe src='${order.pixUrl}' style="width:100%; height:100%; border:none;"></iframe>`;
            openModal();
            showNotification("QR Code Pix gerado!", 'success');

        } else { // (metodoPagamento === 'dinheiro')

             window.open(pedidowhatsapp, '_blank');
            // Mostra uma mensagem de confirmação para o cliente
            const mensagemConfirmacao = `Pedido #${order.id} registrado com sucesso! \n\nPor favor, tenha o valor de ${realBR(order.total)} pronto para o pagamento na entrega/retirada. \n\nNão esqueça de enviar o pedido no nosso WhatsApp.`;
            exibirModalErro(mensagemConfirmacao.replace(/\n/g, '<br>'), false, true, 'success');
        }
        
    let currentHistory = JSON.parse(localStorage.getItem(blog)) || [];

        // 2. Adiciona o novo pedido a essa lista atualizada.
        currentHistory.push(order);

        // 3. Salva a lista correta e atualizada de volta no localStorage.
        localStorage.setItem(blog, JSON.stringify(currentHistory));
        
        // O resto do seu código pode continuar normalmente
        cupomAplicado = null;
        document.getElementById('cupomInput').value = '';
        document.getElementById('cupomStatus').textContent = '';
        
        clearCart();
        updateOrderHistoryDisplay();
        showTab('orderHistory');
        
    } catch (error) {
        console.error("Erro ao finalizar pedido:", error);
        showNotification("Erro ao finalizar o pedido. Tente novamente.", 'error');
    }
}


function openModal() {
    document.getElementById('myModal').style.display = 'block';
}

function closeModal() {
    document.getElementById('myModal').style.display = 'none';
    document.getElementById('myModal').classList.remove('fullscreen'); // Remove a classe fullscreen ao fechar
    document.getElementById('qrCode').innerHTML = '';
}

function clearCart() {
    cart = [];
    localStorage.removeItem(blog + 'cart');
    cupomAplicado = null;
    document.getElementById('cupomInput').value = '';
    document.getElementById('cupomStatus').textContent = '';
    updateCartDisplay();
    updateMiniCartCount();
    updateFloatingCartCount();
    updateFloatingCartAccessibilityLabel();
    showNotification("Carrinho esvaziado!", 'success');
}

// ===========================================
// === NOVA FUNÇÃO PARA ABRIR/FECHAR PEDIDO ==
// ===========================================
function toggleOrderDetails(headerElement) {
    const orderItem = headerElement.closest('.order-item');
    if (orderItem) {
        orderItem.classList.toggle('open');
    }
}

// ===========================================
// === FUNÇÃO DO HISTÓRICO ATUALIZADA ========
// ===========================================
function updateOrderHistoryDisplay() {
    const orderHistoryList = document.getElementById('orderHistoryList');
    const clearHistoryButton = document.getElementById('clearHistoryButton');
    orderHistoryList.innerHTML = '';

    const history = JSON.parse(localStorage.getItem(blog)) || [];

    if (history.length === 0) {
        orderHistoryList.textContent = "Nenhum pedido no histórico.";
        clearHistoryButton.style.display = 'none';
        renderOrderHistoryPagination(0); // Limpa a paginação
        return;
    }
    
    clearHistoryButton.style.display = 'block';

    const reversedHistory = [...history].reverse();

    // Lógica de Paginação
    const startIndex = (orderHistoryCurrentPage - 1) * ordersPerPage;
    const endIndex = startIndex + ordersPerPage;
    const paginatedOrders = reversedHistory.slice(startIndex, endIndex);

    paginatedOrders.forEach((order) => {
        const li = document.createElement('li');
        li.classList.add('order-item');

        const metodoPagamentoTexto = (order.metodoPagamento === 'pix' ? 'Pix' : (order.metodoPagamento === 'dinheiro' ? 'Dinheiro' : 'N/A'));
        const addressData = order.address || {};
        const nomeCliente = addressData.name || "Cliente não informado";
        const emailCliente = addressData.email || "E-mail não informado";
        const telefoneCliente = addressData.phone || "Telefone não informado";
        const infoAdicional = addressData.additionalInfo || "Nenhuma";
        const enderecoCompleto = addressData.address ? `${addressData.address}, ${addressData.city || ''} - ${addressData.bairro || ''}, ${addressData.postcode || ''}` : 'Endereço não disponível';

        const itemsList = (order.items && order.items.length > 0) ? order.items.map(item => {
            const itemTotal = (item.price || 0) * (item.quantity || 1);
            return `<li><img src="${item.imageUrl}" alt="${item.name}" width="40" height="40" style="vertical-align: middle; border-radius: 5px; margin-right: 10px;"> ${item.name} (Qtd: ${item.quantity}) ${item.selectedSize ? `(Tamanho: ${item.selectedSize})` : ``} ${item.selectedsabor ? `(sabor: ${item.selectedsabor})` : ``} - <strong>${realBR(itemTotal)}</strong></li>`;
        }).join('') : "<li>Nenhum item encontrado.</li>";

        let resumoFinanceiroHTML = `<p><strong>Subtotal:</strong> ${realBR(order.subtotal)}</p>`;
        if (order.desconto && parseFloat(order.desconto) > 0) {
            resumoFinanceiroHTML += `<p style="color: green;"><strong>Desconto Aplicado:</strong> - ${realBR(order.desconto)}</p>`;
        }
        if (order.cupomUtilizado && order.cupomUtilizado.tipo === 'frete') {
            resumoFinanceiroHTML += `<p style="color: green;"><strong>Cupom de Frete Grátis Utilizado</strong></p>`;
        }
        if (order.deliveryFee && parseFloat(order.deliveryFee) > 0) {
            resumoFinanceiroHTML += `<p><strong>Taxa de Entrega:</strong> ${realBR(order.deliveryFee)}</p>`;
        }
        resumoFinanceiroHTML += `<h4 style="margin-top: 10px;">Total Final: ${realBR(order.total)}</h4>`;

        let enderecoHTML = '';
        let buttonRetirada = '';

        if (order.deliveryOption === 'delivery') {
            enderecoHTML = `<p><strong>Endereço de Entrega:</strong> ${enderecoCompleto}</p>`;
        } else {
                enderecoHTML = `<p><strong>Opção de Entrega:</strong> Retirada no Local</p>`;
                buttonRetirada = `<button onclick="goToAddress()"><i class="fa-solid fa-map-location-dot"></i> Ver Endereço de Retirada</button>`;
        }

        const originalIndex = history.findIndex(h => h.id === order.id);
        li.innerHTML = `
            <div class="order-header" onclick="toggleOrderDetails(this)">
                <div>
                    <h3>#${order.id}</h3>
                    <small>${new Date(order.timestamp).toLocaleString()}</small>
                </div>
                <div class="status-display">
                   ${order.StatusButton === false ? `<span class='cancelado-falha'>${order.StatusPedido}</span>` : `${order.Entregue ? `<span class='pago-success'>${order.Entregue}</span>` : `${order.Enviado ? `<span class='pago-success'>${order.Enviado}</span>` : `${order.Pagamento ? `<span class='pago-success'>${order.Pagamento}</span>` : `<span class='aguardando-paga'>Aguardando Pagamentos</span>`}`}`}`}
                <i class="fas fa-chevron-down toggle-icon"></i>
                   </div>
            </div>
            <div class="order-content">
                <p><strong>Nome:</strong> ${nomeCliente}</p>
                <p><strong>Email:</strong> ${emailCliente}</p>
                <p><strong>Telefone:</strong> ${telefoneCliente}</p>
                ${enderecoHTML}
                <p><strong>Informações Adicionais:</strong> ${infoAdicional}</p>
                <hr>
                <h4>Itens Comprados:</h4>
                <ul style="list-style: none; padding-left: 0;">${itemsList}</ul>
                <hr>
                <h4>Resumo Financeiro:</h4>
                <p><strong>Forma de Pagamento:</strong> ${metodoPagamentoTexto}</p>
                ${resumoFinanceiroHTML}
                <div class="button-container">
                    ${ order.StatusButton === false ? 
                        `<button onclick="AbrirWhatsapp();"><i class="fa-brands fa-whatsapp"></i> Entrar em contato</button>
                         <button onclick="deleteOrderFromHistory('${order.id}')">🗑️ Excluir do Histórico</button>` 
                        :
                        `${order.isPago ? `${buttonRetirada}` : `${buttonRetirada}`}
                         ${metodoPagamentoTexto === 'Pix' && !order.isPago ? `<button onclick="showPixQrCode(${originalIndex})"><i class="fas fa-qrcode"></i> Ver QR Code Pix</button>` : ''}
                         ${!order.isPago ? `<button id="checkBtn_${order.id}" onclick="handleCheckClick(${originalIndex})"><i class="fas fa-sync-alt"></i> Verificar Atualização</button>` : ''}
                         ${!order.isPago ? `<button onclick="resendWhatsappMessage(${originalIndex})"><i class="fa-brands fa-whatsapp"></i> Reenviar Pedido no WhatsApp</button>` : ''}
                         ${order.isPago ? `<button onclick="printOrder(${originalIndex})">🖨️ Imprimir Pedido</button>` : ``}
                         <button onclick="deleteOrderFromHistory('${order.id}')">🗑️ Excluir do Histórico</button>`
                    }
                </div>
            </div>
        `;
        orderHistoryList.appendChild(li);
    });

    renderOrderHistoryPagination(reversedHistory.length);
    
    // Limpa o formulário de checkout após o pedido ser adicionado ao histórico
    if (document.getElementById('Nome')) {
        document.getElementById('Nome').value = '';
        document.getElementById('Endereço').value = '';
        document.getElementById('Cidade').value = '';
        document.getElementById('Email').value = '';
        document.getElementById('WhatsApp').value = '';
        document.getElementById('CEP').value = '';
        document.getElementById('Bairro').value = '';
        document.getElementById('additionalInfo').value = '';
        document.getElementById('deliveryOption').value = '';
        toggleAddressFields();
    }
}

function renderOrderHistoryPagination(totalOrders) {
    const paginationContainer = document.getElementById('orderHistoryPagination');
    paginationContainer.innerHTML = '';

    const totalPages = Math.ceil(totalOrders / ordersPerPage);

    if (totalPages <= 1) {
        return; // Não mostra a paginação se houver apenas uma página
    }

    // Botão Anterior
    const prevButton = document.createElement('button');
    prevButton.innerHTML = '<i class="fas fa-chevron-left"></i> Anterior';
    prevButton.disabled = orderHistoryCurrentPage === 1;
    prevButton.onclick = () => changeOrderHistoryPage(-1);
    paginationContainer.appendChild(prevButton);

    // Indicador de página
    const pageIndicator = document.createElement('span');
    pageIndicator.textContent = `Página ${orderHistoryCurrentPage} de ${totalPages}`;
    pageIndicator.style.margin = '0 15px';
    pageIndicator.style.fontWeight = 'bold';
    paginationContainer.appendChild(pageIndicator);
    
    // Botão Próximo
    const nextButton = document.createElement('button');
    nextButton.innerHTML = 'Próximo <i class="fas fa-chevron-right"></i>';
    nextButton.disabled = orderHistoryCurrentPage >= totalPages;
    nextButton.onclick = () => changeOrderHistoryPage(1);
    paginationContainer.appendChild(nextButton);
}

function changeOrderHistoryPage(direction) {
    orderHistoryCurrentPage += direction;
    updateOrderHistoryDisplay(); // Re-renderiza a lista e a paginação
    document.getElementById('orderHistory').scrollIntoView({ behavior: 'smooth' });
}

function deleteOrderFromHistory(index) {
    exibirModalErro(
        `Deseja realmente excluir o pedido #${index}? Essa ação não pode ser desfeita.`, false, false, 'confirmarExclusao', index);
}

function executeDeleteOrder(orderId) {
    let history = JSON.parse(localStorage.getItem(blog)) || [];

    // A MÁGICA ESTÁ AQUI: Convertemos ambos os IDs para String antes de comparar.
    // Isso garante que a comparação '===' funcione, não importando se o ID original
    // era um número ou uma string.
    const index = history.findIndex(order => String(order.id) === String(orderId));

    if (index !== -1) {
        const removedOrder = history[index];
        history.splice(index, 1);
        localStorage.setItem(blog, JSON.stringify(history));

        // ATUALIZA A TELA IMEDIATAMENTE
        updateOrderHistoryDisplay();
        
        showNotification(`Pedido #${removedOrder.id} foi excluído com sucesso!`, 'success');
    } else {
        showNotification(`Pedido com ID #${orderId} não encontrado.`, 'error');
        // Adiciona um log para sabermos que falhou, caso o problema persista.
        console.error(`Falha ao encontrar o pedido com ID ${orderId} para exclusão.`);
    }
}

// Função para imprimir um pedido
function printOrder(index) {
    const history = JSON.parse(localStorage.getItem(blog)) || [];
    const order = history[index];

    if (!order) {
        showNotification("Erro: Pedido não encontrado para impressão.", "error");
        return;
    }

    // --- 1. Extrai e formata os dados do pedido de forma segura ---

    const addressData = order.address || {};
    const enderecoCompleto = addressData.address ? `${addressData.address}, ${addressData.bairro || ''}, ${addressData.city || ''} - CEP: ${addressData.postcode || ''}` : 'Não aplicável';
    const metodoPagamento = order.metodoPagamento === 'pix' ? 'Pix' : (order.metodoPagamento === 'dinheiro' ? 'Dinheiro na Entrega/Retirada' : 'Não informado');

    // Monta a lista de itens
    const itemsListHTML = (order.items && order.items.length > 0) ? order.items.map(item => {
        const itemTotal = (item.price || 0) * (item.quantity || 1);
        const optionsString = [item.selectedSize, item.selectedsabor].filter(Boolean).join(' / ');
        return `
            <tr class="item-row">
                <td><img src="${item.imageUrl}" alt="${item.name}" class="item-image"></td>
                <td>
                    ${item.name}
                    ${optionsString ? `<br><small>(${optionsString})</small>` : ''}
                </td>
                <td class="text-center">${item.quantity || 1}</td>
                <td class="text-right">${realBR(item.price || 0)}</td>
                <td class="text-right">${realBR(itemTotal)}</td>
            </tr>`;
    }).join('') : '<tr><td colspan="5">Nenhum item no pedido.</td></tr>';

    // Monta o resumo financeiro, incluindo descontos
    let resumoFinanceiroHTML = `
        <tr>
            <td colspan="4" class="text-right"><strong>Subtotal</strong></td>
            <td class="text-right">${realBR(order.subtotal || 0)}</td>
        </tr>
    `;

    if (order.desconto && parseFloat(order.desconto) > 0) {
        const codigoCupom = (order.cupomUtilizado && order.cupomUtilizado.codigoOriginal) ? ` (${order.cupomUtilizado.codigoOriginal})` : '';
        resumoFinanceiroHTML += `
            <tr class="desconto-row">
                <td colspan="4" class="text-right"><strong>Desconto${codigoCupom}</strong></td>
                <td class="text-right">- ${realBR(order.desconto)}</td>
            </tr>`;
    }

    if (order.deliveryFee && parseFloat(order.deliveryFee) > 0) {
        resumoFinanceiroHTML += `
            <tr>
                <td colspan="4" class="text-right"><strong>Taxa de Entrega</strong></td>
                <td class="text-right">${realBR(order.deliveryFee)}</td>
            </tr>`;
    } else if (order.cupomUtilizado && order.cupomUtilizado.tipo === 'frete') {
         const codigoCupom = (order.cupomUtilizado && order.cupomUtilizado.codigoOriginal) ? ` (${order.cupomUtilizado.codigoOriginal})` : '';
        resumoFinanceiroHTML += `
            <tr class="desconto-row">
                <td colspan="4" class="text-right"><strong>Taxa de Entrega${codigoCupom}</strong></td>
                <td class="text-right">Grátis</td>
            </tr>`;
    }
    
    resumoFinanceiroHTML += `
        <tr class="total-row">
            <td colspan="4" class="text-right"><strong>Total a Pagar</strong></td>
            <td class="text-right"><strong>${realBR(order.total || 0)}</strong></td>
        </tr>
    `;

    // --- 2. Abre uma nova janela e escreve o HTML otimizado para impressão ---

    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
        <html>
        <head>
            <title>Pedido #${order.id} - ${nomedaloja}</title>
            <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
            <style>
                body { font-family: 'Poppins', sans-serif; color: #333; margin: 20px; }
                .invoice-box { max-width: 800px; margin: auto; padding: 30px; border: 1px solid #eee; box-shadow: 0 0 10px rgba(0, 0, 0, .15); font-size: 16px; }
                .header { text-align: center; margin-bottom: 20px; }
                .header img { max-width: 150px; max-height: 150px; }
                .header h1 { margin: 10px 0 0; color: #333; }
                .section { margin-bottom: 20px; }
                .section h2 { font-size: 1.2em; border-bottom: 2px solid #eee; padding-bottom: 5px; margin-bottom: 10px; }
                .details-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
                .details-grid p { margin: 0; }
                table { width: 100%; line-height: inherit; text-align: left; border-collapse: collapse; }
                table th { background: #eee; font-weight: 700; padding: 8px; }
                table td { padding: 8px; border-bottom: 1px solid #eee; }
                .item-image { width: 34px; height: 34px; object-fit: cover; border-radius: 5px; vertical-align: middle; }
                .text-center { text-align: center; }
                .text-right { text-align: right; }
                .summary-table td { border: none; }
                .desconto-row { color: #27ae60; }
                .total-row { border-top: 2px solid #333; font-size: 1.2em; }
                .footer { text-align: center; margin-top: 30px; font-size: 0.9em; color: #777; }
                .descricao { font-family: helvetica; color: #333; display: block; margin-block-start: 1em; }
                @media print {
                    body { -webkit-print-color-adjust: exact; margin: 0; }
                    .invoice-box { box-shadow: none; border: none; padding: 0; }
                }
            </style>
        </head>
        <body>
            <div class="invoice-box">
                <div class="header">
                    ${logotipo ? `<img src="${logotipo}" alt="${nomedaloja}">` : ''}
                    <h1>${nomedaloja}</h1>
                <div class="descricao">
                ${descricao ? `<strong>${descricao}</strong>` : ``}
                </div>
                    <p>Pedido #${order.id}</p>
                </div>

                <div class="section">
                    <h2>Detalhes do Pedido</h2>
                    <div class="details-grid">
                        <p><strong>Data do Pedido:</strong> ${new Date(order.timestamp).toLocaleString('pt-BR')}</p>
                        <p><strong>Forma de Pagamento:</strong> ${metodoPagamento}</p>
                    </div>
                </div>

                <div class="section">
                    <h2>Informações do Cliente</h2>
                    <p><strong>Nome:</strong> ${addressData.name || 'N/A'}</p>
                    <p><strong>Email:</strong> ${addressData.email || 'N/A'}</p>
                    <p><strong>Telefone:</strong> ${addressData.phone || 'N/A'}</p>
                    <p><strong>${order.deliveryOption === 'delivery' ? 'Endereço de Entrega:' : 'Opção de Entrega:'}</strong> ${order.deliveryOption === 'delivery' ? enderecoCompleto : 'Retirada no Local'}</p>
                    ${addressData.additionalInfo ? `<p><strong>Observações:</strong> ${addressData.additionalInfo}</p>` : ''}
                </div>

                <div class="section">
                    <h2>Itens do Pedido</h2>
                    <table>
                        <thead>
                            <tr>
                                <th colspan="2">Produto</th>
                                <th class="text-center">Qtd.</th>
                                <th class="text-right">Preço Unit.</th>
                                <th class="text-right">Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsListHTML}
                        </tbody>
                    </table>
                </div>

                <div class="section">
                    <h2>Resumo Financeiro</h2>
                    <table class="summary-table">
                        <tbody>
                            ${resumoFinanceiroHTML}
                        </tbody>
                    </table>
                </div>

                <div class="footer">
                    Obrigado pela sua preferência!
                </div>
            </div>
        </body>
        </html>
    `);

    printWindow.document.close();
    // Um pequeno timeout garante que a página carregue antes de chamar a impressão
    setTimeout(() => {
        printWindow.print();
    }, 500);
}

async function handleCheckClick(index) {
    const order = (JSON.parse(localStorage.getItem(blog)) || [])[index];
    if (!order) return;
    
    const button = document.getElementById(`checkBtn_${order.id}`);
    if (!button) return;

    const originalButtonHTML = button.innerHTML;
    button.disabled = true;
    button.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Verificando...`;
    
    try {
        // Chama o Gerente para verificar apenas este pedido específico
        await monitorDePedidos({ forceCheckIndex: index });
    } finally {
        // Garante que o botão sempre seja restaurado
        button.disabled = false;
        button.innerHTML = originalButtonHTML;
    }
}


function goToAddress() {
    const addressElement = document.querySelector('.rodape');

    if (addressElement) {
    addressElement.scrollIntoView({
        behavior: 'smooth'
    });
    } else {
    alert("Endereço para retirada não encontrado!");
    }
}

function showPixQrCode(index) {
    // Carrega o histórico atualizado diretamente do localStorage
    const history = JSON.parse(localStorage.getItem(blog)) || [];
    const order = history[index];

    if (!order) {
        showNotification("Pedido não encontrado no histórico.", 'error');
        return;
    }

    document.getElementById('myModal').classList.add('fullscreen');
    document.getElementById('qrCode').innerHTML = `<iframe src='${order.pixUrl}' style="width:100%; height:100%; border:none;"></iframe>`;
    openModal();
}

function generatePaymentId() {
    const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let paymentId = 'Pagamento';
    for (let i = 0; i < 6; i++) {
    paymentId += characters.charAt(Math.floor(Math.random() * characters.length));
    }
    return paymentId;
}

function clearOrderHistory() {
    exibirModalErro(
        "Tem certeza que deseja apagar todo o histórico de pedidos? Essa ação não pode ser desfeita.",
        false,
        false,
        'confirmarLimpeza'
    );
}

function showTab(tabId) {
    const tabContents = document.querySelectorAll('.tab-content');
    const tabButtons = document.querySelectorAll('.tab-button');

    tabContents.forEach(content => {
    content.classList.remove('active');
    content.style.display = 'none';
    });

    tabButtons.forEach(button => {
    button.classList.remove('active');

    });

    const tabContent = document.getElementById(tabId);
    if (tabContent) {
    tabContent.classList.add('active');
    tabContent.style.display = 'block';
    } else {}

    const tabButton = document.querySelector(`.tab-button[data-tab="${tabId}"]`);

    if (tabButton) {
    tabButton.classList.add('active');
    } else {}

    const proceedToCheckoutButton = document.getElementById('proceedToCheckoutButton');

    if (proceedToCheckoutButton) {
    if (tabId === 'checkout') {
        proceedToCheckoutButton.style.display = 'none';
            carregarDadosCliente(); 
    } else {
        proceedToCheckoutButton.style.display = 'inline-block';
    }
    }
    document.getElementById(tabId).scrollIntoView({
    behavior: 'smooth'
    });
}

function resendWhatsappMessage(index) {
    const history = JSON.parse(localStorage.getItem(blog)) || [];
    const order = history[index];
    
    if (!order) {
        showNotification("Pedido não encontrado no histórico.", 'error');
        return;
    }

    const codigoOriginal = (order.cupomUtilizado && order.cupomUtilizado.codigoOriginal) ? order.cupomUtilizado.codigoOriginal : '';

    const addressData = order.address || {};
    const nomeCliente = addressData.name || "N/A";
    const emailCliente = addressData.email || "N/A";
    const telefoneCliente = addressData.phone || "N/A";
    const infoAdicional = addressData.additionalInfo || "";
    const dataCompra = new Date(order.timestamp).toLocaleDateString('pt-BR');

    const itensPedidoString = (order.items && order.items.length > 0) ? order.items.map(item => {
        const optionsString = [item.selectedSize, item.selectedsabor].filter(Boolean).join(' / ');
        const itemTotal = (item.price || 0) * (item.quantity || 1);
        return `${item.name} ${optionsString ? `(${optionsString})` : ''} (x${item.quantity}) - ${realBR(itemTotal)}`;
    }).join('\n') : "Nenhum item no pedido.";

    // String da entrega.
    const entregaString = order.deliveryOption === 'delivery'
        ? `*Endereço de Entrega:*\n${addressData.address || ''}, ${addressData.bairro || ''}, ${addressData.city || ''} - CEP: ${addressData.postcode || ''}`
        : `*Opção de Entrega:*\nRetirada no Local`;

    // --- 3. Monta a mensagem final, parte por parte ---
    const messageParts = [
        `*REENVIO DE PEDIDO*`,
        `*Pedido:* #${order.id}`,
        `-----------------------------------`,
        `*Dados do Cliente:*`,
        `*Nome:* ${nomeCliente}`,
        `*Email:* ${emailCliente}`,
        `*Telefone:* ${telefoneCliente}`,
        infoAdicional ? `*Info Adicional:* ${infoAdicional}` : null,
        `-----------------------------------`,
        entregaString,
        `-----------------------------------`,
        `*Itens do Pedido:*`,
        itensPedidoString,
        `-----------------------------------`,
        `*Resumo Financeiro:*`,
        `*Subtotal:* ${realBR(order.subtotal || 0)}`
    ];
    
    if (order.desconto && parseFloat(order.desconto) > 0) {
        const cupomInfoString = codigoOriginal ? ` (Cupom: ${codigoOriginal})` : '';
        messageParts.push(`*Desconto:* - ${realBR(order.desconto)}${cupomInfoString}`);
    }
  
    if (order.deliveryOption === 'delivery') {
        if (order.cupomUtilizado && order.cupomUtilizado.tipo === 'frete') {
            const cupomInfoString = codigoOriginal ? ` (Cupom: ${codigoOriginal})` : '';
            messageParts.push(`*Taxa de Entrega:* Frete Grátis${cupomInfoString}`);
        } else if (order.deliveryFee && parseFloat(order.deliveryFee) > 0) {
            messageParts.push(`*Taxa de Entrega:* ${realBR(order.deliveryFee)}`);
        }
    }

    messageParts.push(`*TOTAL:* *${realBR(order.total || 0)}*`);
    messageParts.push(`*Data do Pedido Original:* ${dataCompra}`);
    
    const whatsappMessage = messageParts.filter(part => part !== null).join('\n');
    const encodedMessage = encodeURIComponent(whatsappMessage);
    const whatsappLink = `https://wa.me/${whatsapp}?text=${encodedMessage}`;

    window.open(whatsappLink, '_blank');
    showNotification(`Mensagem do pedido #${order.id} reenviada para o WhatsApp!`, 'success');
}

function previousPage() {
    if (currentPage > 1) {
    currentPage--;
    displayProducts();
    document.getElementById('productList').scrollIntoView({
        behavior: 'smooth'
    });
    }
}

function nextPage() {
    const totalPages = Math.ceil(products.length / productsPerPage);
    if (currentPage < totalPages) {
    currentPage++;
    document.getElementById('productList').scrollIntoView({
        behavior: 'smooth'
    });
    displayProducts();
    }
}

function goToPage(page) {
    currentPage = page;
    displayProducts();
    document.getElementById('productList').scrollIntoView({
    behavior: 'smooth'
    });
}

function updatePaginationButtons(totalFilteredProducts) { // Modifique aqui
    const btnInicio = document.getElementById('btnInicio');
    const btnAnterior = document.getElementById('btnAnterior');
    const btnProximo = document.getElementById('btnProximo');

    // Modifique aqui para usar o total de produtos filtrados
    const totalPages = Math.ceil(totalFilteredProducts / productsPerPage);

    btnInicio.disabled = currentPage === 1;
    btnAnterior.disabled = currentPage === 1;
    btnProximo.disabled = currentPage >= totalPages || totalPages === 0; // Use >= para segurança

    btnInicio.onclick = () => goToPage(1);
    btnAnterior.onclick = previousPage;
    btnProximo.onclick = nextPage;
}

function showNotification(message, type = 'success') {
    const notificationContainer = document.getElementById('notification-container');

    if (!notificationContainer) {
        console.error("Elemento 'notification-container' não encontrado!");
        return;
    }

    const notification = document.createElement('div');
    notification.classList.add('notification', type);
    notification.textContent = message;

    // Adiciona notificação ao container
    notificationContainer.appendChild(notification);

    // Exibe a notificação
    setTimeout(() => notification.classList.add('show'), 30);

    // Remove a notificação após o tempo determinado
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
            if (notificationContainer.contains(notification)) {
                notificationContainer.removeChild(notification);
            }
        }, 500);
    }, 4000);

    // Remove notificação ao clicar nela
    notification.onclick = () => {
        notification.classList.remove('show');
        setTimeout(() => {
            if (notificationContainer.contains(notification)) {
                notificationContainer.removeChild(notification);
            }
        }, 500);
    };
}

    // --- Carrossel ---

/* ========================================= */
/* === LÓGICA REVISADA DO CARROSSEL  === */
/* ========================================= */
function initializeCarousel() {
    const carouselSlide = document.querySelector('.carousel-slide');
    const dotsContainer = document.getElementById('carouselDots');
    const container = document.getElementById('featuredProductsCarousel');

    if (!carouselSlide || !container) return;

    carouselSlide.innerHTML = '';
    if (dotsContainer) dotsContainer.innerHTML = '';

    if (carouselProducts.length === 0) {
        container.style.display = 'none';
        return;
    } else {
        container.style.display = 'block';
        container.classList.remove('loading');
    }

    carouselProducts.forEach((product, index) => {
        const item = document.createElement('div');
        item.classList.add('carousel-item');

        // IDs únicos baseados no index do carrossel
        const sizeId = `c_size_${index}`;
        const saborId = `c_sabor_${index}`;
        const qtyId = `c_qty_display_${index}`; // ID do SPAN, não do select

        // --- 1. Gera Select de Tamanho (Igual Product List) ---
        let sizesHTML = '';
        if (product.sizes && product.sizes.length > 0) {
            sizesHTML = `
            <div class="quantity-selector">
                <label for="${sizeId}">Tamanho:</label>
                <select id="${sizeId}" class="custom-select">
                    <option value="" disabled selected>Selecione</option>
                    ${product.sizes.map(s => `<option value="${s}">${s}</option>`).join('')}
                </select>
            </div>`;
        }

        // --- 2. Gera Select de Sabor (Igual Product List) ---
        let saborHTML = '';
        if (product.sabor && product.sabor.length > 0) {
            saborHTML = `
            <div class="quantity-selector">
                <label for="${saborId}">Sabor:</label>
                <select id="${saborId}" class="custom-select">
                    <option value="" disabled selected>Selecione</option>
                    ${product.sabor.map(s => `<option value="${s}">${s}</option>`).join('')}
                </select>
            </div>`;
        }

        // --- 3. Gera Stepper de Quantidade (Igual Product List) ---
        // Aqui usamos a estrutura de botões - e +
        const quantityHTML = `
            <div class="quantity-selector">
                <label>Qtd: </label>
                <div class="quantity-controls">
                    <button onclick="updateCarouselQty(${index}, -1)">-</button>
                    <span id="${qtyId}">1</span>
                    <button onclick="updateCarouselQty(${index}, 1, ${product.quantity})">+</button>
                </div>
            </div>
        `;

        // Preço e Desconto
        let priceHTML = `<span class="backgroundverde">${realBR(product.price)}</span>`;
        let discountBadge = '';
        if (product.discount > 0) {
            priceHTML = `
            <p> De <strike class="backgroundred">${realBR(product.originalPrice)}</strike>
                Por <span class="backgroundverde">${realBR(product.price)}</span>
            </p>
            `;
            discountBadge = `<div class="carousel-discount">-${product.discount}%</div>`;
        }

                 let detailsButtonHTML = '';
        if (product.description && product.description.trim().length > 0) {
            // Usamos aspas simples dentro do onclick para passar o nome do produto como string
            detailsButtonHTML = `<button class="carousel-btn-details" onclick="showDescriptionModal('${product.name}')"><i class="fa fa-info-circle" aria-hidden="true"></i> detalhes</button>`;
        }

        // Montagem do HTML
        item.innerHTML = `
            <div class="carousel-img-wrapper">
                ${discountBadge}
                <img src="${product.imageUrls[0]}" alt="${product.name}" onclick="openFullscreenImage('${product.imageUrls[0]}')">
            </div>
            
            <div class="carousel-content">
                <h3>${product.name}</h3>
                <div class="carousel-price-tag">${priceHTML}</div>

                <div class="carousel-actions">
                    ${sizesHTML}
                    ${saborHTML}
                    ${quantityHTML}
                </div>

                <div class="carousel-buttons-row">
                    <button class="carousel-btn-add" onclick="carouselAction(${index}, 'cart')">
                        <i class="fas fa-cart-plus"></i> Add
                    </button>
                    <button class="carousel-btn-buy" onclick="carouselAction(${index}, 'buy')">
                        <i class="fas fa-bolt"></i> Comprar
                    </button>
                    ${detailsButtonHTML}
                </div>
            </div>
        `;
        carouselSlide.appendChild(item);

        // Dots
        if (dotsContainer) {
            const dot = document.createElement('div');
            dot.classList.add('dot');
            dot.onclick = () => { stopCarousel(); showSlide(index); startCarousel(); };
            dotsContainer.appendChild(dot);
        }
    });

    initializeCarouselEvents();
}

function initializeCarouselEvents() {
    const container = document.getElementById('featuredProductsCarousel');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');

    // 1. Botões
    if(prevBtn) {
        prevBtn.onclick = (e) => { 
            e.preventDefault(); stopCarousel(); changeSlide(-1); startCarousel(); 
        };
    }
    if(nextBtn) {
        nextBtn.onclick = (e) => { 
            e.preventDefault(); stopCarousel(); changeSlide(1); startCarousel(); 
        };
    }

    // 2. Touch (Celular)
    if(container) {
        container.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
            stopCarousel();
        }, {passive: true});

        container.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
            startCarousel();
        }, {passive: true});

        // 3. Mouse (Desktop)
        container.addEventListener('mouseenter', stopCarousel);
        container.addEventListener('mouseleave', startCarousel);
    }

    // Inicia
    showSlide(0);
    startCarousel();
}

function handleSwipe() {
    const threshold = 50; 
    if (touchEndX < touchStartX - threshold) changeSlide(1); // Próximo
    if (touchEndX > touchStartX + threshold) changeSlide(-1); // Anterior
}

function startCarousel() {
    if (carouselInterval) clearInterval(carouselInterval);
    carouselInterval = setInterval(() => changeSlide(1), 5000); // 5 segundos
}

function stopCarousel() {
    if (carouselInterval) clearInterval(carouselInterval);
}

function changeSlide(direction) {
    let newIndex = currentSlideIndex + direction;
    const total = carouselProducts.length;

    if (newIndex >= total) newIndex = 0;
    if (newIndex < 0) newIndex = total - 1;

    showSlide(newIndex);
}

function showSlide(index) {
    const carouselSlide = document.querySelector('.carousel-slide');
    const dots = document.querySelectorAll('.dot');
    
    currentSlideIndex = index;
    
    if(carouselSlide) {
        carouselSlide.style.transform = `translateX(-${index * 100}%)`;
    }

    dots.forEach(dot => dot.classList.remove('active'));
    if(dots[index]) dots[index].classList.add('active');
}

function updateCarouselQty(index, delta, maxStock = 999) {
    // Para o carrossel não rodar enquanto o usuário clica
    stopCarousel(); 
    
    const qtySpan = document.getElementById(`c_qty_display_${index}`);
    if (!qtySpan) return;

    let currentQty = parseInt(qtySpan.innerText);
    let newQty = currentQty + delta;

    if (newQty < 1) newQty = 1;
    if (newQty > maxStock) {
        newQty = maxStock;
        showNotification(`Estoque máximo de ${maxStock} unidades atingido.`, 'aviso');
    }

    qtySpan.innerText = newQty;
    
    // Reinicia o carrossel após um tempo
    setTimeout(startCarousel, 5000); 
}

// Função de Ação (Comprar/Adicionar)
function carouselAction(index, action) {
    const product = carouselProducts[index];
    if (!product) return;

    const sizeEl = document.getElementById(`c_size_${index}`);
    const saborEl = document.getElementById(`c_sabor_${index}`);
    const qtySpan = document.getElementById(`c_qty_display_${index}`);

    const selectedSize = sizeEl ? sizeEl.value : "";
    const selectedSabor = saborEl ? saborEl.value : "";
    // Pega o valor do texto do span, pois agora é um stepper
    const selectedQty = qtySpan ? parseInt(qtySpan.innerText) : 1;

    // Validações
    if (product.sizes && product.sizes.length > 0 && selectedSize === "") {
        showNotification("Por favor, selecione um tamanho.", "error");
        if(sizeEl) sizeEl.focus();
        return;
    }
    if (product.sabor && product.sabor.length > 0 && selectedSabor === "") {
        showNotification("Por favor, selecione um sabor.", "error");
        if(saborEl) saborEl.focus();
        return;
    }

    ComprarProdutos(product, selectedQty, selectedSize, selectedSabor, action === 'buy');
}

function carouseladdToCart(button, productName) {
    const product = carouselProducts.find(p => p.name === productName);

    if (!product) {
        showNotification("Produto não encontrado.", 'error');
        return;
    }

    const sizeSelectId = `carouselSizeSelect_${product.name}`;
    const sizeSelectElement = document.getElementById(sizeSelectId);
    const selectedSize = sizeSelectElement ? sizeSelectElement.value : "";

    const saborSelectId = `carouselsaborSelect_${product.name}`;
    const saborSelectElement = document.getElementById(saborSelectId);
    const selectedSabor = saborSelectElement ? saborSelectElement.value : "";

    const quantitySelectId = `carouselQuantitySelect_${product.name}`;
    const quantitySelectElement = document.getElementById(quantitySelectId);
    const selectedQuantity = quantitySelectElement ? quantitySelectElement.value : 1;
    ComprarProdutos(product, selectedQuantity, selectedSize, selectedSabor, false);
}

function buyNowCarousel(button, productName) {
    const product = carouselProducts.find(p => p.name === productName);

    if (!product) {
        showNotification("Produto não encontrado.", 'error');
        return;
    }

    const sizeSelectId = `carouselSizeSelect_${product.name}`;
    const sizeSelectElement = document.getElementById(sizeSelectId);
    const selectedSize = sizeSelectElement ? sizeSelectElement.value : "";

    const saborSelectId = `carouselsaborSelect_${product.name}`;
    const saborSelectElement = document.getElementById(saborSelectId);
    const selectedSabor = saborSelectElement ? saborSelectElement.value : "";

    const quantitySelectId = `carouselQuantitySelect_${product.name}`;
    const quantitySelectElement = document.getElementById(quantitySelectId);
    const selectedQuantity = quantitySelectElement ? quantitySelectElement.value : 1;

    // Chama a função auxiliar, indicando para redirecionar para o checkout
    ComprarProdutos(product, selectedQuantity, selectedSize, selectedSabor, true);
}

async function verifyCouponCode(code) {
    // 1. Gera o hash para verificação, como antes.
    const hashToVerify = await generateHash(code);

    // 2. A "Mágica" da Promise:
    return new Promise((resolve, reject) => {
        // Gera um nome de callback único para evitar conflitos
        const callbackName = 'processarCupom_' + Date.now();

        // 3. Define a função de callback que o Blogger vai chamar
        window[callbackName] = (data) => {
            let foundCoupon = null;
            const couponRegex = /^[a-f0-9]{64}:(\d+(\.\d+)?):(percentual|fixo|frete)$/;

            if (data && data.feed && data.feed.entry) {
                // Loop para encontrar o cupom correspondente
                for (const entry of data.feed.entry) {
                    if (foundCoupon) break; // Otimização: para o loop se já encontrou
                    if (entry.content && entry.content.$t) {
                        const lines = entry.content.$t.split('\n').map(line => line.replace(/<[^>]*>/g, '').trim());
                        for (const line of lines) {
                            if (line.startsWith(hashToVerify)) {
                                const match = line.match(couponRegex);
                                if (match) {
                                    foundCoupon = {
                                        hash: match[0].split(':')[0],
                                        valor: parseFloat(match[1]),
                                        tipo: match[3],
                                        codigoOriginal: code // Guarda o código original para exibição
                                    };
                                    break;
                                }
                            }
                        }
                    }
                }
            }

            // 4. Limpa o callback e o script da página
            delete window[callbackName];
            document.body.removeChild(script);

            // 5. Resolve ou Rejeita a Promise com o resultado
            if (foundCoupon) {
                resolve(foundCoupon); // SUCESSO!
            } else {
                reject(new Error('Cupom inválido ou expirado.')); // FALHA!
            }
        };

        // 6. Cria e injeta o script para fazer a chamada JSONP
        const script = document.createElement('script');
        script.src = `https://www.blogger.com/feeds/${blog}/pages/default?alt=json-in-script&callback=${callbackName}`;
        script.onerror = () => {
            // Limpeza em caso de erro de rede
            delete window[callbackName];
            if (document.body.contains(script)) {
                document.body.removeChild(script);
            }
            reject(new Error('Erro de rede ao verificar o cupom.'));
        };
        document.body.appendChild(script);
    });
}

/**
 * O GERENTE: Orquestra a aplicação do cupom e atualiza a UI.
 */
async function applyCoupon() {
    const code = document.getElementById('cupomInput').value.toUpperCase().trim();
    if (!code) return;

    const statusEl = document.getElementById('cupomStatus');
    const applyBtn = document.getElementById('aplicarCupomBtn');

    // Desabilita o botão e mostra feedback de carregamento
    applyBtn.disabled = true;
    applyBtn.textContent = 'Verificando...';
    statusEl.textContent = '';
    statusEl.className = 'cupom-status';

    try {
        // Chama o nosso "fiscal" e espera pela resposta (sucesso ou falha)
        const validCoupon = await verifyCouponCode(code);
        
        // Se chegou aqui, o cupom é VÁLIDO!
        cupomAplicado = validCoupon;
        showNotification("Cupom aplicado com sucesso!", 'success');

    } catch (error) {
        // Se chegou aqui, o cupom é INVÁLIDO ou houve um erro de rede
        cupomAplicado = null;
        showNotification(error.message, 'error');
        
    } finally {
        // Este bloco SEMPRE executa, seja com sucesso ou falha
        updateCouponUI();
        updateCartDisplay();
    }
}

/**
 * AÇÃO DE REMOVER: Limpa o estado do cupom e atualiza a UI.
 */
function removeCoupon() {
    cupomAplicado = null;
    showNotification("Cupom removido.", 'atualizado');
    updateCouponUI();
    updateCartDisplay();
}

/**
 * ATUALIZADOR DE UI: Mantém a aparência da seção de cupom em sincronia com o estado.
 */
function updateCouponUI() {
    const wrapper = document.getElementById('cupomInputWrapper');
    const input = document.getElementById('cupomInput');
    const applyBtn = document.getElementById('aplicarCupomBtn');
    const statusEl = document.getElementById('cupomStatus');

    // Remove o botão de remover antigo, se existir
    const existingRemoveBtn = document.getElementById('removerCupomBtn');
    if (existingRemoveBtn) {
        existingRemoveBtn.remove();
    }

    if (cupomAplicado) {
        // ESTADO "APLICADO"
        input.value = cupomAplicado.codigoOriginal;
        input.readOnly = true; // Trava o input

        applyBtn.style.display = 'none'; // Esconde o botão de aplicar

        // Cria e adiciona o botão de remover
        const removeBtn = document.createElement('button');
        removeBtn.type = 'button';
        removeBtn.id = 'removerCupomBtn';
        removeBtn.className = 'removerCupomBtn';
        removeBtn.innerHTML = '&times; Remover';
        removeBtn.onclick = removeCoupon;
        wrapper.appendChild(removeBtn);

        // Define a mensagem de sucesso
        let successMessage = '';
        switch(cupomAplicado.tipo) {
            case 'percentual': successMessage = `Desconto de ${cupomAplicado.valor}% aplicado!`; break;
            case 'fixo': successMessage = `Desconto de ${realBR(cupomAplicado.valor)} aplicado!`; break;
            case 'frete': successMessage = 'Frete Grátis ativado!'; break;
        }
        statusEl.textContent = successMessage;
        statusEl.className = 'cupom-status success';

    } else {
        // ESTADO "PADRÃO"
        input.value = '';
        input.readOnly = false; // Destrava o input
        applyBtn.style.display = 'block'; // Mostra o botão de aplicar
        applyBtn.disabled = false;
        applyBtn.textContent = 'Aplicar';
        statusEl.textContent = ''; // Limpa a mensagem
        statusEl.className = 'cupom-status';
    }
}

// Conecta o "gerente" ao botão "Aplicar"
document.getElementById('aplicarCupomBtn').addEventListener('click', applyCoupon);

// --- FIM DA NOVA ESTRUTURA DE CUPOM ---

// Função para validar CEP
async function isCepValido(cep) {
    let cepLimpo = cep.replace(/\D/g, '');
    if (cepLimpo.length !== 8) return false;

    try {
        let response = await fetch(`https://viacep.com.br/ws/${cepLimpo}/json/`);
        let data = await response.json();
        if (data.erro) return false;

        let isValid = true;

        // Converte as strings em listas
        let ufList = unidadefederativa ? unidadefederativa.split(/\s+/).map(u => u.toUpperCase()) : [];
        let cidadesList = cidade ? cidade.split(/\s+/).map(c => c.toLowerCase()) : [];
        let bairrosList = bairro ? bairro.split(/\s+/).map(b => b.toLowerCase()) : [];

        // Verificação UF
        if (ufList.length > 0 && !ufList.includes(data.uf.toUpperCase())) {
            isValid = false;
        }

        // Verificação Cidade
        if (cidadesList.length > 0 && !cidadesList.includes(data.localidade.toLowerCase())) {
            isValid = false;
        }

        // Verificação Bairro
        if (bairrosList.length > 0 && data.bairro && !bairrosList.includes(data.bairro.toLowerCase())) {
            isValid = false;
        }

        return isValid;

    } catch (error) {
        console.error("Erro ao buscar o CEP:", error);
        return false;
    }
}

function increaseCartItemQuantity(index) {
    const item = cart[index];
    if (!item) return;

    // Encontra o produto original para verificar o estoque máximo
    const productData = products.find(p => p.name === item.name);
    const maxQuantity = productData ? productData.quantity : item.quantity;

    if (item.quantity < maxQuantity) {
        item.quantity++;
        localStorage.setItem(blog + 'cart', JSON.stringify(cart));
        updateCartDisplay();
        updateFloatingCartCount();
    } else {
        showNotification(`Estoque máximo para "${item.name}" atingido.`, 'error');
    }
}

function decreaseCartItemQuantity(index) {
    const item = cart[index];
    if (!item) return;

    item.quantity--;

    if (item.quantity <= 0) {
        removeFromCart(index); // Remove se a quantidade for zero
    } else {
        localStorage.setItem(blog + 'cart', JSON.stringify(cart));
        updateCartDisplay();
        updateFloatingCartCount();
    }
}

const searchInput = document.getElementById('searchInput');
const clearSearchBtn = document.getElementById('clearSearchBtn');

    document.getElementById('productList').style.display = 'grid';
    const productList = document.getElementById('productList');
    productList.style.gridTemplateColumns = 'repeat(auto-fill, minmax(300px, 1fr))';
    productList.style.gap = '20px';


searchInput.addEventListener('input', () => {
    currentPage = 1; 
    displayProducts();

    // Mostra ou esconde o botão "X"
    if (searchInput.value.length > 0) {
        clearSearchBtn.classList.add('show');
    } else {
        clearSearchBtn.classList.remove('show');
    }
});

clearSearchBtn.addEventListener('click', () => {
    searchInput.value = ''; 
    clearSearchBtn.classList.remove('show');
    
    currentPage = 1;
    displayProducts(); 
    searchInput.focus();
});

// Evento ao perder foco do campo CEP
document.getElementById("CEP").addEventListener("blur", async function () {
    let cep = this.value.replace(/\D/g, ''); // Remove caracteres não numéricos

    if (cep.length === 8) {
        try {
            let response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
            let data = await response.json();
            if (!data.erro) {
                let valid = true;
                let errorMessage = "Apenas CEPs ";
                let restrictions = [];

                // Listas
                let ufList = unidadefederativa ? unidadefederativa.split(/\s+/).map(u => u.toUpperCase()) : [];
                let cidadesList = cidade ? cidade.split(/\s+/).map(c => c.toLowerCase()) : [];
                let bairrosList = bairro ? bairro.split(/\s+/).map(b => b.toLowerCase()) : [];

                // UF
                if (ufList.length > 0 && !ufList.includes(data.uf.toUpperCase())) {
                    valid = false;
                    restrictions.push("da UF " + unidadefederativa);
                }

                // Cidade
                if (cidadesList.length > 0 && !cidadesList.includes(data.localidade.toLowerCase())) {
                    valid = false;
                    restrictions.push("da cidade " + cidade);
                }

                // Bairro
                if (bairrosList.length > 0 && data.bairro && !bairrosList.includes(data.bairro.toLowerCase())) {
                    valid = false;
                    restrictions.push("do bairro " + bairro);
                }

                if (valid) {
                    document.getElementById("Endereço").value = data.logradouro + ', casa:';
                    document.getElementById("Bairro").value = data.bairro;
                    document.getElementById("Cidade").value = data.localidade;
                } else {
                    errorMessage += restrictions.join(", ");
                    errorMessage += " são aceitos!";
                    showNotification(errorMessage, 'error');
                    this.value = "";
                    document.getElementById("Endereço").value = "";
                    document.getElementById("Bairro").value = "";
                    document.getElementById("Cidade").value = "";
                }

            } else {
                showNotification("CEP não encontrado!", 'error');
            }
        } catch (error) {
            console.error("Erro ao buscar o CEP:", error);
        }
    } else {
        showNotification("CEP inválido!", 'error');
    }
});

function toggleAddressFields() {
    const deliveryOption = document.getElementById('deliveryOption').value;
    const addressFields = document.getElementById('addressFields');
    const avisoTaxaEl = document.getElementById('avisoTaxaEntrega');

    if (deliveryOption === 'delivery') {
        addressFields.style.display = 'block';
        document.getElementById('CEP').setAttribute('required', '');
        document.getElementById('Endereço').setAttribute('required', '');
        document.getElementById('Cidade').setAttribute('required', '');
        document.getElementById('Bairro').setAttribute('required', '');

        // --- INÍCIO DA NOVA LÓGICA PARA GERAR O TEXTO ---
        let infoMessage = "No momento, realizamos entregas apenas para ";
        const restrictions = [];

        // Verifica e adiciona as restrições à lista
        if (cidade) {
            restrictions.push(`a(s) cidade(s) de <strong>${cidade}</strong>`);
        }
        if (bairro) {
            restrictions.push(`o(s) bairro(s) de <strong>${bairro}</strong>`);
        }
        if (unidadefederativa) {
            restrictions.push(`o estado de <strong>${unidadefederativa}</strong>`);
        }

        // Constrói a mensagem final
        if (restrictions.length > 0) {
            infoMessage += restrictions.join(', ');
            infoMessage += ". Por favor, verifique se o seu CEP pertence a uma dessas localidades.";
        } else {
            // Mensagem padrão se nenhuma restrição estiver configurada
            infoMessage = "Realizamos entregas em toda a região. Insira seu CEP para validar.";
        }

        if (taxadeenvio > 0) {
            avisoTaxaEl.textContent = `Atenção: Será aplicada uma taxa de entrega no valor de ${realBR(taxadeenvio)}.`;
            avisoTaxaEl.style.display = 'block';
            exibirModalErro('<br>Atenção: Será aplicada uma taxa de entrega no valor de ' + realBR(taxadeenvio) + "." + '<br><br>' + infoMessage, false, true, 'aviso');
        } else {
            avisoTaxaEl.textContent = 'A entrega em domicílio é gratuita!';
            avisoTaxaEl.style.display = 'block';
            showNotification('A entrega é gratuita!', 'success');
        }

    } else {
        addressFields.style.display = 'none';
        avisoTaxaEl.style.display = 'none';

        document.getElementById('CEP').removeAttribute('required');
        document.getElementById('Endereço').removeAttribute('required');
        document.getElementById('Cidade').removeAttribute('required');
        document.getElementById('Bairro').removeAttribute('required');

        document.getElementById('CEP').value = '';
        document.getElementById('Endereço').value = '';
        document.getElementById('Cidade').value = '';
        document.getElementById('Bairro').value = '';
    }
    
    updateCartDisplay();
}


 let monitorIntervalID = null;

function iniciarMonitoramento() {
            if (monitorIntervalID) clearInterval(monitorIntervalID);
            getStoreStatus();
            monitorIntervalID = setInterval(getStoreStatus, 60000);
}

function getStoreStatus() {
            const now = new Date();
            const dayOfWeek = now.getDay();
            const currentTimeInMinutes = now.getHours() * 60 + now.getMinutes();
            
            const diasSemana = ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'];
            AtualDia = diasSemana[dayOfWeek];
            
            let status = {
                aberta: false,
                emPausa: false,
                mensagem: `Hoje estamos fechados.`
            };

            const parseTime = (timeStr) => {
                if (!timeStr) return 0;
                const [hour, minute] = timeStr.replace('h', ':').split(':');
                return parseInt(hour) * 60 + parseInt(minute || 0);
            };

            const horariosDoDiaStr = horariosFuncionamento.split(';')
                .find(h => h.trim().startsWith(AtualDia));
            
            if (horariosDoDiaStr) {
                const tempoStr = horariosDoDiaStr.split(':')[1].trim();

                if (!tempoStr.toUpperCase().includes('FECHADO')) {
                    const periodos = tempoStr.split(',')
                        .map(periodo => {
                            const [inicioStr, fimStr] = periodo.trim().split('-');
                            return { start: parseTime(inicioStr), end: parseTime(fimStr) };
                        })
                        .sort((a, b) => a.start - b.start);

                    let isOpenNow = false;
                    for (const periodo of periodos) {
                        if (currentTimeInMinutes >= periodo.start && currentTimeInMinutes < periodo.end) {
                            isOpenNow = true;
                            break;
                        }
                    }

                    if (isOpenNow) {
                        status.aberta = true;
                    } else {
                        const firstOpening = periodos[0].start;
                        const lastClosing = periodos[periodos.length - 1].end;

                        if (currentTimeInMinutes < firstOpening) {
                            desativarAbasCarrinho();
                            status.emPausa = false; // FECHADA (antes de abrir)
                            const proximaHora = Math.floor(firstOpening / 60).toString().padStart(2, '0');
                            const proximoMinuto = (firstOpening % 60).toString().padStart(2, '0');
                            status.mensagem = `Nossa loja abrirá hoje às ${proximaHora}h${proximoMinuto}.`;
                        } else if (currentTimeInMinutes >= lastClosing) {
                            desativarAbasCarrinho();
                            status.emPausa = false; // FECHADA (depois de encerrar)
                            status.mensagem = `Nosso horário de funcionamento hoje já encerrou.`;
                        } else {
                            desativarAbasCarrinho();
                            const proximaAbertura = periodos.find(p => p.start > currentTimeInMinutes);
                            if (proximaAbertura) {
                                status.emPausa = true; // EM PAUSA (entre turnos)
                                const proximaHora = Math.floor(proximaAbertura.start / 60).toString().padStart(2, '0');
                                const proximoMinuto = (proximaAbertura.start % 60).toString().padStart(2, '0');
                                status.mensagem = `Reabriremos às ${proximaHora}h${proximoMinuto}.`;
                            }
                        }
                    }
                }
            }

            updateInterface(status);
        }

        // --- ATUALIZAÇÃO DA INTERFACE DO USUÁRIO ---
        function updateInterface(status) {
            const lojaStatusEl = document.getElementById('statusLoja');
            const telahorariosDiv = document.getElementById('tela-horarios');
            if (status.aberta) {
                lojaStatusEl.innerHTML = '<p class="loja-aberta">Loja Aberta! Boas compras!</p>';
                ativarAbasCarrinho();
            } else {
                let statusMessage = status.emPausa ? '⏸️ Loja em Pausa!' : '🌙 Loja Fechada!';
                lojaStatusEl.innerHTML = `<p class="loja-fechada">${statusMessage}</p>`;
                telahorariosDiv.innerHTML = `
                    <div class="desativado">
                        <h1>${status.emPausa ? '⏸️' : '🌙'}</h1>
                        <p style="font-size: 1.2em;">${status.mensagem}</p>
                        <br>
                        <h3>Nosso Horário de Funcionamento:</h3>
                        ${generateScheduleTable(horariosFuncionamento)}
                    </div>
                `;
               desativarAbasCarrinho();
            }
        }

function generateScheduleTable(horarios) {
    if (!horarios) return '';
    const now = new Date();
    const dayOfWeek = now.getDay();
    const diasSemana = ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'];
    const AtualDia = diasSemana[dayOfWeek];

    const horariosArray = horarios.split(';');
    let tableHTML = `
        <div class="schedule-table-container">
            <table class="schedule-table">
                <thead>
                    <tr>
                        <th>Dia da Semana</th>
                        <th>Horário de Funcionamento</th>
                    </tr>
                </thead>
                <tbody>`;

horariosArray.forEach(horario => {
    if (!horario.includes(':')) return;

    const [dia, tempoRaw] = horario.split(':');
    const diaTrimmed = dia.trim();
    const tempoTrimmed = tempoRaw.trim();

    // Divide períodos, remove espaços e partes vazias
    const partes = tempoTrimmed.split(',').map(p => p.trim()).filter(Boolean);

    // Filtra períodos válidos (remove "FECHADO-FECHADO")
    const partesValidas = partes.filter(p => !/FECHADO-FECHADO/i.test(p));

    const isFechado = partesValidas.length === 0;
    const isCurrentDay = diaTrimmed === AtualDia;

    let tempoFormatado;

    if (isFechado) {
        tempoFormatado = `<span class="fechado">Fechado</span>`;
    } else {
        tempoFormatado = partesValidas
            .map(parte => {
                const [inicio, fim] = parte.split('-').map(t => t.trim());
                let label = 'Horário';

                // Converte hora para número (ex: "14h30" -> 14.5)
                const toHora = str => {
                    const match = str.match(/(\d{1,2})h(\d{0,2})?/i);
                    if (!match) return null;
                    const hora = parseInt(match[1], 10);
                    const min = parseInt(match[2] || '0', 10);
                    return hora + min / 60;
                };

                const horaInicio = toHora(inicio);
                const horaFim = toHora(fim);

                if (horaInicio !== null && horaFim !== null) {
                    if (horaFim <= 12) label = 'Manhã';
                    else if (horaFim <= 18) label = 'Tarde';
                    else label = 'Noite';
                }

                return `<strong>${label}</strong>: ${parte}`;
            })
            .join('<br>');
    }

    tableHTML += `
        <tr class="${isCurrentDay ? 'current-day' : ''}">
            <td>${diaTrimmed}</td>
            <td>${tempoFormatado}</td>
        </tr>
    `;
});
    tableHTML += `</tbody></table></div>`;
    return tableHTML;
}

    // --- FUNÇÕES AUXILIARES DE UI ---
function desativarAbasCarrinho() {
    const telahorariosDiv = document.getElementById('tela-horarios');
    const minecart = document.getElementById('floating-cart');
    const productsDiv = document.getElementById('products');
    const abasParaBloquear = ['cart', 'checkout'];
    abasParaBloquear.forEach(tabId => {
    const tabButton = document.querySelector(`.tab-button[data-tab="${tabId}"]`);
    if (tabButton) {
    tabButton.classList.add('tab-disabled');
    tabButton.disabled = true;
    }
    });

    const activeTab = document.querySelector('.tab-content.active');
    if (activeTab && abasParaBloquear.includes(activeTab.id)) {
    showTab('products');
    }
    minecart.style.display = 'none';
    productsDiv.style.display = 'none';
    telahorariosDiv.style.display = 'block';
}

function ativarAbasCarrinho() {
    const telahorariosDiv = document.getElementById('tela-horarios');
    const minecart = document.getElementById('floating-cart');
    const productsDiv = document.getElementById('products');

    const abasParaReativar = ['cart', 'checkout'];
     abasParaReativar.forEach(tabId => {
      const tabButton = document.querySelector(`.tab-button[data-tab="${tabId}"]`);
       if (tabButton) {
        tabButton.classList.remove('tab-disabled');
        tabButton.disabled = false;
        }
    });
    telahorariosDiv.style.display = 'none';
    minecart.style.display = 'revert-layer';
    productsDiv.style.display = 'block';
}

function openModalhorarios() {
    const modal = document.getElementById("horariosModal");
    const content = document.getElementById("horariosContent");
    content.innerHTML = `${generateScheduleTable(horariosFuncionamento)}`;
    modal.style.display = "block";
}

function closeModalhorarios() {
    const modal = document.getElementById("horariosModal");
    modal.style.display = "none";
}

window.onclick = function (event) {
    const modal = document.getElementById("horariosModal");
    if (event.target == modal) {
    modal.style.display = "none";
    }
}

function realBR(valorNumerico) {
    const valor = parseFloat(valorNumerico);
    if (isNaN(valor)) {
        return "R$ 0,00";
    }
    return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
}

function realBR2(input) { //R$ 325.325.232,53
    valor = input.replace(/\D/g, '');
    valor = (parseFloat(valor) / 100).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    valor = valor.toLocaleString('pt-BR');
	return input.value = valor; 
}

function AbrirWhatsapp() {
    window.open("https://api.whatsapp.com/send?phone=" + encodeURIComponent(whatsapp), '_blank');
}

function dismissAlert() {
    // Esconde o elemento da tela
    document.getElementById('localStorageAlert').style.display = 'none';
    // Salva uma marcação no localStorage para não mostrar novamente
    localStorage.setItem('storageAlertDismissed', 'true');
}

const button = document.getElementById("whatswidget-button");
    const conversation = document.getElementById("whatswidget-conversation");
    let chatOpen = false;

function openChat() {
    if (!chatOpen) {
    conversation.style.display = "block";
    conversation.style.opacity = "1";
    } else {
    conversation.style.opacity = "0";
    conversation.style.display = "none";
    }
    chatOpen = !chatOpen;
}
button.addEventListener("click", openChat);


const backToTopButton = document.getElementById("backToTopBtn");

function toggleBackToTopButton() {
    const backToTopButton = document.getElementById("backToTopBtn");
    if (!backToTopButton) return;

    // Mostra o botão após rolar 300px para baixo
    if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
        backToTopButton.style.display = "block";
    } else {
        backToTopButton.style.display = "none";
    }
}

function scrollToTop() {
    window.scrollTo({
        top: 0,
        behavior: 'smooth'
    });
}

window.onscroll = function() {
    toggleBackToTopButton();
};

backToTopButton.addEventListener('click', scrollToTop);

function toggleWishlist(productName, btnElement) {
    // Pega o array atual ou cria um novo
    let wishlist = JSON.parse(localStorage.getItem(blog + 'wishlist')) || [];
    const index = wishlist.indexOf(productName);

    if (index === -1) {
        wishlist.push(productName); // Adiciona
        btnElement.classList.add('active');
        // Muda o ícone para preenchido
        btnElement.innerHTML = '<i class="fas fa-heart"></i>'; 
        showNotification("Adicionado aos favoritos! ❤️", "success");
    } else {
        wishlist.splice(index, 1); // Remove
        btnElement.classList.remove('active');
        // Muda o ícone para vazio
        btnElement.innerHTML = '<i class="far fa-heart"></i>'; 
        showNotification("Removido dos favoritos.", "aviso");
        
        // Se estiver no modo "ver apenas favoritos", recarrega a lista
        if (showingFavoritesOnly) {
            displayProducts();
        }
    }
    // Salva no navegador
    localStorage.setItem(blog + 'wishlist', JSON.stringify(wishlist));
}

function toggleShowFavorites() {
    showingFavoritesOnly = !showingFavoritesOnly;
    const btn = document.getElementById('btnFilterFav');
    
    if (showingFavoritesOnly) {
        btn.classList.add('active');
        btn.innerHTML = '<i class="fas fa-heart"></i> Ver Todos';
        showNotification("Mostrando apenas seus favoritos.", "info");
    } else {
        btn.classList.remove('active');
        btn.innerHTML = '<i class="far fa-heart"></i> Meus Favoritos';
    }
    
    currentPage = 1;
    displayProducts();
}

/* --- Funções do Modal de Frete Grátis --- */

function showPromoModal() {
    const modal = document.getElementById('promoModal');
    // Só exibe se tiver um valor configurado e o modal existir
    if (modal && freteGratisValor > 0) {
        document.getElementById('promoValueDisplay').innerText = realBR(freteGratisValor);
        modal.style.display = 'flex';
    }
}

function closePromoModal() {
    const modal = document.getElementById('promoModal');
    if (modal) {
        modal.style.display = 'none';
        // Salva na sessão que o usuário já viu/fechou o anúncio
        sessionStorage.setItem('promoFreteVisto', 'true');
    }
}

// Fecha se clicar fora do conteúdo
window.addEventListener('click', function(event) {
    const modal = document.getElementById('promoModal');
    if (event.target == modal) {
        closePromoModal();
    }
});

function apagarDadosCliente() {
    // Pergunta de segurança
    exibirModalErro("Deseja remover seus dados salvos deste dispositivo?", false, false, 'confirmarExclusao', 'DADOS_CLIENTE');
}

function carregarDadosCliente() {
    const dadosSalvos = localStorage.getItem(blog + '_dadosCliente');
    const btnApagar = document.getElementById('btnApagarDados'); // Elemento do botão
    
    if (dadosSalvos) {
        try {
            const dados = JSON.parse(dadosSalvos);
            
            // ... (Mantenha todo o código de preenchimento dos campos aqui) ...
            if(document.getElementById('Nome')) document.getElementById('Nome').value = dados.nome || '';
            if(document.getElementById('Email')) document.getElementById('Email').value = dados.email || '';
            if(document.getElementById('WhatsApp')) document.getElementById('WhatsApp').value = dados.whatsapp || '';

            if (ativaentrega) {
            if (dados.deliveryOption) {
                const deliverySelect = document.getElementById('deliveryOption');
                if (deliverySelect) {
                    deliverySelect.value = dados.deliveryOption;
                    toggleAddressFields(); 
                }

                if (dados.deliveryOption === 'delivery') {
                    const inputCep = document.getElementById('CEP');
                    if(inputCep && dados.cep) {
                        inputCep.value = dados.cep;
                        const event = new Event('blur');
                        inputCep.dispatchEvent(event);
                    }
                }
                setTimeout(() => {
                if (document.getElementById('Endereço'))
                document.getElementById('Endereço').value = dados.endereco || '';
                }, 2000);

            }
            }

            // Ativa o switch
            const switchSalvar = document.getElementById('salvarDadosCheck');
            if (switchSalvar) switchSalvar.checked = true;

            // ✅ MOSTRA O BOTÃO DE APAGAR
            if (btnApagar) btnApagar.style.display = 'block';

            setTimeout(() => {
                updateCartDisplay();
                showNotification("Seus dados foram carregados!", "info");
            }, 500);

        } catch (e) {
            console.error("Erro ao carregar dados salvos", e);
        }
    } else {
        // ✅ SE NÃO TIVER DADOS, ESCONDE O BOTÃO
        if (btnApagar) btnApagar.style.display = 'none';
    }
}

function closeAdminModal() {
    document.getElementById('adminVerifyModal').style.display = 'none';
}

/* ======================================================= */
/* === SISTEMA DE VERIFICAÇÃO E IMPRESSÃO (V6 FINAL) === */
/* ======================================================= */

// Armazena o último pedido validado para impressão
let dadosPedidoValidado = null;

function openAdminVerifier() {
    document.getElementById('adminVerifyModal').style.display = 'block';
    document.getElementById('pedidoColado').value = '';
    document.getElementById('resultadoVerificacao').style.display = 'none';
    dadosPedidoValidado = null;
}

function closeAdminModal() {
    document.getElementById('adminVerifyModal').style.display = 'none';
}

/* =========================================================== */
/* === VERIFICADOR V18 - AUDITORIA DE 4 PONTOS (COM SUBTOTAL) === */
/* =========================================================== */

async function analisarPedidoColado() {
    const input = document.getElementById('pedidoColado');
    const divResult = document.getElementById('resultadoVerificacao');
    const btnVerificar = document.querySelector('#adminVerifyModal .analisarPedidoColado');
    
    if (!input.value.trim()) {
        alert("Cole o pedido primeiro.");
        return;
    }

    const textoOriginalBtn = btnVerificar.innerText;
    btnVerificar.innerText = "🧮 Auditando Subtotal...";
    btnVerificar.disabled = true;

    try {
        // --- 1. HELPERS MATEMÁTICOS ---
        const safeMath = (num) => Math.round((num + Number.EPSILON) * 100) / 100;

        const parseMoney = (str) => {
            if (!str) return 0;
            let clean = str.replace(/[^\d,.-]/g, '').replace(/\./g, '').replace(',', '.');
            return parseFloat(clean) || 0;
        };

        const normalize = (str) => str.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").trim();

        // --- 2. LEITURA DO TEXTO DO CLIENTE ---
        const texto = input.value.replace(/\*/g, '').replace(/\u00A0/g, ' ');
        const linhas = texto.split('\n');

        // Adicionamos 'subtotal' ao objeto do cliente
        let cliente = { total: 0, desconto: 0, frete: 0, subtotal: 0 };
        
        const matchCupom = texto.match(/\(Cupom:\s*([A-Z0-9-_]+)\)/i) || texto.match(/Cupom:\s*([A-Z0-9-_]+)/i);
        const codigoCupom = matchCupom ? matchCupom[1] : null;

        // Detecta intenção de entrega/retirada
        const isRetirada = /Opção de Entrega:[\s\S]*?Retirada/i.test(texto);

        linhas.forEach(linha => {
            const l = linha.trim();
            const matchValor = l.match(/R\$\s*([\d.,]+)/); 
            const valor = matchValor ? parseMoney(matchValor[1]) : 0;

            if (l.match(/^TOTAL:/i)) cliente.total = valor;
            else if (l.match(/^Subtotal:/i)) cliente.subtotal = valor; // Lê o subtotal do texto
            else if (l.match(/^Desconto:/i)) cliente.desconto = valor;
            else if (l.match(/^Taxa de Entrega:/i)) {
                cliente.frete = (l.toLowerCase().includes('grátis') || l.toLowerCase().includes('gratis')) ? 0 : valor;
            }
        });

        // --- 3. CÁLCULO DOS PRODUTOS (CRU) ---
        let somaItensRaw = 0; 
        let itensDetectados = [];
        const textoBusca = normalize(texto);

        products.forEach(prod => {
            const nomeSafe = normalize(prod.name).replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            const regex = new RegExp(`${nomeSafe}.*?\\(x(\\d+)\\)`, 'gi');
            const matches = [...textoBusca.matchAll(regex)];

            matches.forEach(m => {
                const qtd = parseInt(m[1]);
                const subtotalRaw = prod.price * qtd;
                somaItensRaw += subtotalRaw;
                
                itensDetectados.push({ 
                    name: prod.name, 
                    img: prod.imageUrls[0], 
                    qtd, 
                    unit: prod.price, 
                    total: subtotalRaw 
                });
            });
        });

        // --- 4. REGRAS DA LOJA ---
        let freteSistemaCalculado = 0;

        if (isRetirada) {
            freteSistemaCalculado = 0;
        } else {
            freteSistemaCalculado = taxadeenvio || 0;
            if (typeof freteGratisValor !== 'undefined' && freteGratisValor > 0 && somaItensRaw >= freteGratisValor) {
                freteSistemaCalculado = 0;
            }
        }

        let descontoSistemaCalculado = 0;
        let statusCupomHTML = '';

        if (codigoCupom) {
            try {
                const cupomData = await verifyCouponCode(codigoCupom);
                statusCupomHTML = `<span class="badge-cupom-valid">Cupom ${codigoCupom} Válido ✅</span>`;
                
                if (cupomData.tipo === 'percentual') {
                    descontoSistemaCalculado = somaItensRaw * (cupomData.valor / 100);
                } else if (cupomData.tipo === 'fixo') {
                    descontoSistemaCalculado = cupomData.valor;
                    if(descontoSistemaCalculado > somaItensRaw) descontoSistemaCalculado = somaItensRaw;
                } else if (cupomData.tipo === 'frete') {
                    freteSistemaCalculado = 0; 
                }
            } catch (e) {
                statusCupomHTML = `<span class="badge-cupom-invalid">Cupom Inválido ❌</span>`;
            }
        }

        // --- 5. FECHAMENTO E ARREDONDAMENTO ---
        const somaItensFinal = safeMath(somaItensRaw); // Este é o Subtotal do Sistema
        const sistemaFrete = safeMath(freteSistemaCalculado);
        const sistemaDesconto = safeMath(descontoSistemaCalculado);
        const sistemaTotal = safeMath(somaItensFinal + sistemaFrete - sistemaDesconto);

        // Normaliza cliente
        cliente.total = safeMath(cliente.total);
        cliente.desconto = safeMath(cliente.desconto);
        cliente.frete = safeMath(cliente.frete);
        cliente.subtotal = safeMath(cliente.subtotal);

        // --- 6. AUDITORIA (4 PONTOS) ---
        const check = (val1, val2) => Math.abs(val1 - val2) <= 0.12;

        const okSubtotal = check(somaItensFinal, cliente.subtotal); // Verifica a soma dos produtos
        const okFrete = check(sistemaFrete, cliente.frete);
        const okDesconto = check(sistemaDesconto, cliente.desconto);
        const okTotal = check(sistemaTotal, cliente.total);

        // Só aprova se os 4 pontos baterem
        const pedidoAprovado = okSubtotal && okFrete && okDesconto && okTotal;

        // Dados para Impressão
        const extrair = (r) => (texto.match(r) || [])[1]?.trim() || "N/A";
        const enderecoMatch = texto.match(/Endereço de Entrega:\s*\n([\s\S]*?)(?=\n-)/);
        
        dadosPedidoValidado = {
            id: extrair(/Pedido: #([A-Za-z0-9]+)/),
            nome: extrair(/Nome: (.*)/),
            telefone: extrair(/Telefone: (.*)/),
            email: extrair(/Email: (.*)/),
            data: extrair(/Data: (.*)/),
            pagamento: extrair(/Forma de Pagamento: (.*)/),
            endereco: enderecoMatch ? enderecoMatch[1].trim() : "Retirada",
            itens: itensDetectados.map(i => ({...i, unit: safeMath(i.unit), total: safeMath(i.total)})),
            somaItens: somaItensFinal,
            desconto: sistemaDesconto,
            frete: sistemaFrete,
            totalFinal: sistemaTotal
        };

        // --- 7. RENDERIZAÇÃO ---
        if (itensDetectados.length === 0) {
            divResult.innerHTML = `<div class="verify-card verify-error"><h3>❌ Erro de Leitura</h3><p>Nenhum produto identificado. Copie o texto completo.</p></div>`;
            divResult.style.display = 'block';
            return;
        }

        const rowClass = (ok) => ok ? 'audit-row-ok' : 'audit-row-error';
        const icon = (ok) => ok ? '✅' : '⚠️';
        
        const diffVal = safeMath(Math.abs(sistemaTotal - cliente.total));
        let htmlDiferenca = '';
        if (diffVal > 0) {
             const corDiff = pedidoAprovado ? '#f59e0b' : '#dc2626'; 
             const textoDiff = pedidoAprovado ? '(Aceitável)' : '(Erro)';
             htmlDiferenca = `<p style="color:${corDiff}; margin-top:5px; font-weight:bold;">Diferença: ${realBR(diffVal)} <span style="font-size:0.8em; font-weight:normal;">${textoDiff}</span></p>`;
        }

        let html = `
            <div class="verify-card ${pedidoAprovado ? 'verify-success' : 'verify-error'}">
                <h2 style="margin:0;">${pedidoAprovado ? '✅ APROVADO' : '❌ REJEITADO'}</h2>
                <p>${pedidoAprovado ? 'Auditoria completa: Aprovada.' : 'Inconsistência encontrada nos valores.'}</p>
                
                <div style="display:flex; justify-content:space-between; margin-top:15px; font-size:1.1em; font-weight:bold;">
                    <span>Cliente: ${realBR(cliente.total)}</span>
                    <span>Sistema: ${realBR(sistemaTotal)}</span>
                </div>
                ${htmlDiferenca}

                ${pedidoAprovado ? `
                <div class="verify-box verify-success" style="text-align:center; border:none; background:transparent; padding:0; margin-top:15px;">
                     <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <button onclick="imprimirPedidoValidado()" class="btn-status st-print" style="flex:1; justify-content:center;">
                            <i class="fas fa-print"></i> Imprimir
                        </button>
                    </div>
                    <p style="margin: 10px 0 5px; font-size: 0.8em; color: #fff; text-align: left; font-weight: bold;">RESPOSTAS RÁPIDAS:</p>
                    <div class="quick-actions-grid">
                        <button class="btn-status st-pago" onclick="copiarRespostaCliente()"><i class="fab fa-whatsapp"></i> Confirmar Pedido</button>
                        <button class="btn-status st-pago" onclick="copiarMensagemStatus('pago')"><i class="fas fa-check-circle"></i> Pago</button>
                        <button class="btn-status st-enviado" onclick="copiarMensagemStatus('enviado')"><i class="fas fa-motorcycle"></i> Saiu</button>
                        <button class="btn-status st-entregue" onclick="copiarMensagemStatus('entregue')"><i class="fas fa-box-open"></i> Entregue</button>
                        <button class="btn-status st-cancelado" onclick="copiarMensagemStatus('cancelado')"><i class="fas fa-ban"></i> Cancelar</button>
                        <button class="btn-status st-reembolso" onclick="copiarMensagemStatus('reembolso')"><i class="fas fa-undo"></i> Estorno</button>
                        <a href="https://www.blogger.com/blog/pages/${blog}" target="_blank"><button class="btn-status st-reembolso"><i class="fa-brands fa-blogger"></i>Confirma no Blog</button></a>
                    </div>
                </div>`
                 : 
                 `
                <div class="verify-box verify-success" style="text-align:center; border:none; background:transparent; padding:0; margin-top:15px;">
                    <p style="margin: 10px 0 5px; font-size: 0.8em; color: #ffff; text-align: left; font-weight: bold;">RESPOSTAS RÁPIDAS:</p>
                    <div class="quick-actions-grid">
                        <button class="btn-status st-cancelado" onclick="copiarMensagemStatus('cancelado')"><i class="fas fa-ban"></i> Cancelar</button>
                        <button class="btn-status st-reembolso" onclick="copiarMensagemStatus('reembolso')"><i class="fas fa-undo"></i> Estorno</button>
                    </div>
                </div>`}
            </div>

            <div class="verify-details">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h4 style="margin:0;">🔎 Auditoria de 4 Pontos</h4>
                    ${statusCupomHTML}
                </div>

                <table class="audit-table">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Cliente (Txt)</th>
                            <th>Sistema (Real)</th>
                            <th>OK?</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- NOVA LINHA: SUBTOTAL -->
                        <tr class="${rowClass(okSubtotal)}">
                            <td>Subtotal (Soma)</td>
                            <td>${realBR(cliente.subtotal)}</td>
                            <td>${realBR(somaItensFinal)}</td>
                            <td>${icon(okSubtotal)}</td>
                        </tr>
                        <tr class="${rowClass(okFrete)}">
                            <td>Taxa de Entrega</td>
                            <td>${realBR(cliente.frete)}</td>
                            <td>${realBR(sistemaFrete)}</td>
                            <td>${icon(okFrete)}</td>
                        </tr>
                        <tr class="${rowClass(okDesconto)}">
                            <td>Desconto</td>
                            <td>-${realBR(cliente.desconto)}</td>
                            <td>-${realBR(sistemaDesconto)}</td>
                            <td>${icon(okDesconto)}</td>
                        </tr>
                        <tr class="${rowClass(okTotal)} audit-row-total">
                            <td>TOTAL FINAL</td>
                            <td>${realBR(cliente.total)}</td>
                            <td>${realBR(sistemaTotal)}</td>
                            <td>${icon(okTotal)}</td>
                        </tr>
                    </tbody>
                </table>
                
                ${!pedidoAprovado ? `<div style="background:#fee2e2; color:#991b1b; padding:10px; margin-top:10px; border-radius:5px; font-size:0.9em;">⚠️ <strong>Alerta de Fraude/Erro:</strong> Verifique a linha vermelha. O cliente pode ter editado o Subtotal, o Frete ou o Total.</div>` : ''}
                
                <details style="margin-top:15px;">
                    <summary style="cursor:pointer; color:#3b82f6;">Ver produtos somados (${itensDetectados.length})</summary>
                    <div style="margin-top:10px; font-size:0.85em; color:#555; max-height:200px; overflow-y:auto;">
                        ${itensDetectados.map(i => `<div style="padding:4px 0; border-bottom:1px solid #eee;">${i.qtd}x ${i.name} <strong>(${realBR(safeMath(i.total))})</strong></div>`).join('')}
                    </div>
                </details>
            </div>
        `;

        divResult.innerHTML = html;
        divResult.style.display = 'block';

    } catch (error) {
        console.error(error);
        alert("Erro técnico ao processar.");
    } finally {
        btnVerificar.innerText = textoOriginalBtn;
        btnVerificar.disabled = false;
    }
}

function imprimirPedidoValidado() {
    if (!dadosPedidoValidado) return;
    const p = dadosPedidoValidado;
    const dataImpressao = new Date().toLocaleString('pt-BR');

    // Define a logo ou nome
    const headerLogo = logotipo 
        ? `<img src="${logotipo}" alt="Logo" style="max-height: 70px; max-width: 100%;">` 
        : `<h2 style="margin:0; color:#333;">${nomedaloja}</h2>`;

    // Gera linhas da tabela
    const itensHTML = p.itens.map((item, i) => `
        <tr style="border-bottom: 1px solid #eee;">
            <td style="padding: 8px; text-align: center; color: #666;">${item.qtd}x</td>
            <td style="padding: 8px;">
                <div style="font-weight: 600;">${item.name}</div>
                <div style="font-size: 0.85em; color: #666;">UN: ${realBR(item.unit)}</div>
            </td>
            <td style="padding: 8px; text-align: right; font-weight: bold;">${realBR(item.total)}</td>
        </tr>
    `).join('');

    const win = window.open('', '_blank');
    win.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
            <title>Pedido #${p.id}</title>
            <style>
                body { font-family: 'Courier New', Courier, monospace; padding: 20px; color: #000; max-width: 80mm; margin: 0 auto; }
                .container { width: 100%; }
                .text-center { text-align: center; }
                .text-right { text-align: right; }
                .bold { font-weight: bold; }
                .divider { border-top: 1px dashed #000; margin: 10px 0; }
                .header { margin-bottom: 15px; }
                table { width: 100%; border-collapse: collapse; font-size: 0.9em; }
                .total-box { margin-top: 10px; font-size: 1.1em; }
                
                @media print {
                    body { padding: 0; margin: 0; }
                    .no-print { display: none; }
                }
            </style>
        </head>
        <body>
            <div class="container">
                <div class="header text-center">
                    ${headerLogo}
                    <p style="margin: 5px 0; font-size: 0.8em;">Comprovante de Pedido</p>
                </div>

                <div class="divider"></div>
                
                <div style="font-size: 0.9em;">
                    <p><strong>Pedido:</strong> #${p.id}</p>
                    <p><strong>Data:</strong> ${p.data}</p>
                    <p><strong>Cliente:</strong> ${p.nome}</p>
                    <p><strong>Tel:</strong> ${p.telefone}</p>
                </div>

                <div class="divider"></div>
                
                <p class="bold" style="margin: 5px 0;">ENTREGA</p>
                <p style="font-size: 0.9em; margin-bottom: 10px;">${p.endereco.replace(/\n/g, '<br>')}</p>

                <div class="divider"></div>

                <table>
                    <thead>
                        <tr>
                            <th width="15%">Qtd</th>
                            <th width="60%" style="text-align: left;">Item</th>
                            <th width="25%" align="right">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${itensHTML}
                    </tbody>
                </table>

                <div class="divider"></div>

                <div class="total-box">
                    <div style="display:flex; justify-content:space-between; font-size: 0.9em;">
                        <span>Subtotal:</span>
                        <span>${realBR(p.somaItens)}</span>
                    </div>
                    ${p.desconto > 0 ? `
                    <div style="display:flex; justify-content:space-between; font-size: 0.9em;">
                        <span>Desconto:</span>
                        <span>-${realBR(p.desconto)}</span>
                    </div>` : ''}
                    <div style="display:flex; justify-content:space-between; font-size: 0.9em;">
                        <span>Frete:</span>
                        <span>${p.frete > 0 ? realBR(p.frete) : 'Grátis'}</span>
                    </div>
                    
                    <div class="divider"></div>
                    
                    <div style="display:flex; justify-content:space-between; font-weight: bold; font-size: 1.2em;">
                        <span>TOTAL:</span>
                        <span>${realBR(p.totalFinal)}</span>
                    </div>
                </div>
                
                <div class="divider"></div>
                
                <div class="text-center" style="font-size: 0.8em; margin-top: 20px;">
                    <p>Forma de Pagamento: <strong>${p.pagamento}</strong></p>
                    <p style="margin-top: 10px;">Obrigado pela preferência!</p>
                    <p>${dataImpressao}</p>
                </div>
            </div>
            <script>
                window.onload = function() { 
                    window.print(); 
                    // setTimeout(function(){ window.close(); }, 1000); // Opcional: fechar após imprimir
                }
            <\/script>
        </body>
        </html>
    `);
    win.document.close();
}

function copiarMensagemStatus(status) {
    if (!dadosPedidoValidado) return;
    const p = dadosPedidoValidado;
    let msg = "";

    const saudacao = `Olá *${p.nome}*! 👋\n` +
                     `Status atualizado do seu pedido *#${p.id}*:\n\n`;

    switch (status) {

        case 'pago':
            msg =
                `${saudacao}` +
                `✅ *Pagamento Confirmado!*\n` +
                `Tudo certo por aqui! Já iniciamos a separação dos seus itens e logo seu pedido seguirá para envio.\n\n` +
                `Qualquer novidade avisaremos por aqui. 😊`;
        break;

        case 'enviado':
            msg =
                `${saudacao}` +
                `🛵 *Pedido a Caminho!*\n` +
                `Nosso entregador já saiu com seu pedido.\n` +
                `📍 *Endereço de entrega:* _${p.endereco}_\n\n` +
                `Fique atento(a) ao telefone, pois ele poderá entrar em contato caso necessário.`;
        break;

        case 'entregue':
            msg =
                `${saudacao}` +
                `📦 *Pedido Entregue com Sucesso!*\n` +
                `Agradecemos muito pela preferência! 💛\n\n` +
                `Se precisar de algo mais, estamos sempre à disposição.`;
        break;

        case 'cancelado':
            msg =
                `${saudacao}` +
                `❌ *Pedido Cancelado*\n` +
                `Seu pedido foi cancelado conforme solicitado ou devido a alguma pendência.\n\n` +
                `Se tiver qualquer dúvida, fale com a gente! Estamos aqui para ajudar.`;
        break;

        case 'reembolso':
            msg =
                `${saudacao}` +
                `💸 *Reembolso Concluído*\n` +
                `O valor de *${realBR(p.totalFinal)}* foi estornado com sucesso.\n` +
                `Qualquer dúvida, só chamar!`;
        break;
    }

    navigator.clipboard.writeText(msg).then(() => {
        showNotification(`Mensagem de "${status.toUpperCase()}" copiada!`, 'success');
    });
}

function copiarRespostaCliente() {
    if (!dadosPedidoValidado) return;

    const p = dadosPedidoValidado;
    const isRetirada = p.endereco === "Retirada";

    let msg =
`Olá *${p.nome}*! 👋

Recebemos seu pedido *#${p.id}*.
A conferência foi realizada com sucesso! ✅

💵 *Total a pagar:* ${realBR(p.totalFinal)}

`;

    // ---------------------------
    //     MENSAGENS POR TIPO
    // ---------------------------
    if (isRetirada) {
        msg +=
`🏬 *Pedido para Retirada no Local*

Seu pedido foi confirmado e já estamos separando tudo para você.  
O pagamento será realizado *diretamente na loja*, no momento da retirada.

📍 *Endereço para retirada:*
_${EnderecoCompleto || "Retirada na loja"}_

Qualquer dúvida, só chamar!`;

    } else {
        msg +=
`🛵 *Pedido para Entrega*

Assim que o pagamento for confirmado, prepararemos o seu pedido e enviaremos para:

📍 *Endereço de entrega:*
_${p.endereco}_

Você receberá uma notificação quando sair para entrega! 🚚💨`;
    }

    // Copiar mensagem
    navigator.clipboard.writeText(msg)
        .then(() => alert("Mensagem copiada com sucesso!"))
        .catch(() => alert("Erro ao copiar a mensagem."));
}



// --- FUNÇÃO DE LOGOUT (SAIR) ---
function adminLogout() {
    // Remove a permissão da sessão
    sessionStorage.removeItem('isAdminLoggedIn');
    
    // Fecha o modal
    closeAdminModal();
    
    // Limpa os campos para segurança
    document.getElementById('pedidoColado').value = '';
    document.getElementById('resultadoVerificacao').style.display = 'none';
    document.getElementById('resultadoVerificacao').innerHTML = '';
    
    showNotification("Você saiu da área administrativa.", "info");
}
// Hash padrão (Senha: admin123) - Será substituído se tiver config no Blogger
let adminHash = "";

// Função nativa do navegador para gerar SHA-256 (Criptografia)
async function sha256(message) {
    const msgBuffer = new TextEncoder().encode(message);
    const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
}

// 1. Função chamada pelo botão no rodapé
function checkAdminAccess() {
    // Verifica se já está logado na sessão atual
    if (sessionStorage.getItem('isAdminLoggedIn') === 'true') {
        openAdminVerifier(); // Abre direto o verificador
    } else {
        document.getElementById('adminLoginModal').style.display = 'block'; // Abre login
    }
}

// 2. Função de Login
async function performAdminLogin() {
    const input = document.getElementById('adminPassInput');
    const btn = document.querySelector('#loginView button');
    const senhaDigitada = input.value;

    if (!senhaDigitada) return;

    // Feedback visual
    const originalText = btn.innerText;
    btn.innerText = "Verificando...";
    btn.disabled = true;

    try {
        // Gera o hash da senha digitada e compara com o salvo
        const hashDigitado = await sha256(senhaDigitada);

        if (hashDigitado === adminHash) {
            // SUCESSO
            sessionStorage.setItem('isAdminLoggedIn', 'true'); // Salva sessão
            closeLoginModal();
            input.value = ''; // Limpa campo
            openAdminVerifier(); // Abre a ferramenta
            showNotification("Login realizado com sucesso!", "success");
        } else {
            // ERRO
            showNotification("Senha incorreta.", "error");
            input.style.borderColor = "red";
            input.classList.add("shake"); // Adicione CSS de tremer se quiser
            setTimeout(() => input.style.borderColor = "#ddd", 2000);
        }
    } catch (error) {
        console.error(error);
        showNotification("Erro ao processar segurança.", "error");
    } finally {
        btn.innerText = originalText;
        btn.disabled = false;
    }
}

// 3. Ferramentas do Modal
function closeLoginModal() {
    document.getElementById('adminLoginModal').style.display = 'none';
}

function toggleGeneratorView() {
    const loginView = document.getElementById('loginView');
    const genView = document.getElementById('generatorView');
    if (loginView.style.display === 'none') {
        loginView.style.display = 'block';
        genView.style.display = 'none';
    } else {
        loginView.style.display = 'none';
        genView.style.display = 'block';
    }
}

// 4. Gerador de Hash (Para o dono criar novas senhas)
async function generateAdminHash() {
    const pass = document.getElementById('newPassInput').value;
    if (!pass) {
        alert("Digite uma senha para converter.");
        return;
    }
    const hash = await sha256(pass);
    const area = document.getElementById('hashResultArea');
    const display = document.getElementById('generatedHash');
    
    display.innerHTML = `<strong>Copie e cole no Blogger:</strong><br><br>admin = ${hash}`;
    area.style.display = 'block';
}

// --- GERADOR DE MANIFESTO PWA PERSONALIZADO ---
function atualizarManifestoPWA() {
    const linkEl = document.getElementById('dynamic-manifest');
    if (!linkEl) return;

    const currentUrl = window.location.href.split('?')[0];
    const nomeApp = nomedaloja;
    const iconeApp = logotipo; 

    const manifest = {
        "name": nomeApp,
        "short_name": nomeApp.substring(0, 12), 
        "start_url": currentUrl,
        "display": "standalone",
        "background_color": "#ffffff",
        "theme_color": "#ffa200e0",
        "orientation": "portrait",
        "icons": [
            {
                "src": iconeApp,
                "sizes": "192x192",
                "type": "image/png",
                "purpose": "any maskable"
            },
            {
                "src": iconeApp,
                "sizes": "512x512",
                "type": "image/png",
                "purpose": "any maskable"
            }
        ]
    };

    const stringManifest = JSON.stringify(manifest);
    const blob = new Blob([stringManifest], {type: 'application/json'});
    const manifestURL = URL.createObjectURL(blob);
    linkEl.setAttribute('href', manifestURL);
    document.querySelector('meta[name="apple-mobile-web-app-title"]').setAttribute("content", nomeApp);
}
 
document.addEventListener('DOMContentLoaded', inicio);
</script>

</body>

</html>