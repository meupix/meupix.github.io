<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:site_name" content="MeuPix/Loja">
	<meta property="article:author" content="@DaviMaTaeus">
    <meta property="og:description" content="Compre produtos exclusivos na nossa loja online! Carrinho fácil, checkout rápido e histórico de pedidos. Pague com Pix!">
    <meta property="og:image" content="pagamentos.files/imagens/metaTag.png">
    <meta property="og:locale" content="pt_BR">
    <meta property="og:type" content="website">
    <meta name="theme-color" content="#ffa200e0">

    <link rel="icon" href="pagamentos.files/imagens/favicon.png" type="image/png">
    <link href="pagamentos.files/imagens/favicon.png" rel="shortcut icon" type="image/png">
    <title>Meu Pix - Loja online</title>
    <!-- Fontes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
    /* Cores Globais */
    :root {
    --primary-color: #ff6b6b;
    --secondary-color: #4ecdc4;
    --text-color: #ffffff;
    --background-color: #f9f9f9;
    --light-gray: #ddd;
    --success-color: #2ecc71;
    --error-color: #e74c3c;
    --floating-cart-bg: linear-gradient(47deg, #ffa200e0, #ff5d00e0);
}

    /* Estilos Globais */
    body {
    background-image: url(pagamentos.files/imagens/capa-pix.png);
    font-family: 'Poppins', sans-serif;
    background-color: var(--background-color);
    color: var(--text-color);
    line-height: 1.6;
    margin: 0;
    padding: 0;
}


    /* Header Styles */
header {
    text-align: center;
    background: linear-gradient(227deg, #05a5826b, #2069586b);
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
}

    header img {
    max-width: 200px;
    height: auto;
    border-radius: 10px;
}

    header h1 {
    font-family: 'Poppins', sans-serif;
    color: white;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

    header p {
    font-size: 18px;
    color: #fff;
    font-weight: bold;
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
}

    /* Container Principal */
.container {
    margin-right: 30px;
    margin-left: 30px;
    margin-top: 20px;
    margin-bottom: 20px;
    padding: 20px;
    box-shadow: 0 0 15px #05a582a1;
    background: linear-gradient(120deg, #206958b8, #05a582a1);
    border-radius: 15px;
    display: flex;
}

    /* Layout Desativado */
.desativado {
    margin: 20px auto;
    padding: 20px;
    box-shadow: 0 0 15px #ff0000;
    background: #ad0000b2;
    border-radius: 15px;
    color: #fff;
    text-align: center;
}

    /* Seção de Produtos */
.products {
    flex: 2;
    padding-right: 20px;
    border-right: 1px solid var(--light-gray);
    width: 800px;
}

.products h2 {
    font-size: 2em;
    margin-bottom: 15px;
}

    /* Lista de Produtos */
#productList {
    display: flex;
    flex-wrap: wrap;
    justify-content: flex-start;
}

    /* Item de Produto */
.product {
    width: calc(50% - 20px);
    padding: 15px;
    margin-bottom: 20px;
    margin-right: 20px;
    text-align: center;
    position: relative;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    box-sizing: border-box;
    border-radius: 15px;
    box-shadow: 0 0 10px rgb(0 0 0 / 53%);
    background: linear-gradient(24deg, #ff00007c, #0004ff86);
}

.product:nth-child(2n) {
    margin-right: 0;
}

.product:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

.product img {
    max-width: 100%;
    height: auto;
    margin-bottom: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    transition: opacity 0.3s ease;
}

.product img:hover {
    opacity: 0.9;
}

.product h3 {
    font-size: 1.5em;
    margin-bottom: 8px;
    color: #ffffff;
    transition: color 0.3s ease;
}

.product:hover h3 {
    color: darken(#3498db, 10%);
}

.product p {
    font-size: 1.2em;
    margin-bottom: 12px;
    color: #ffffff;
}

    /* Badge de Desconto */
.discount-badge {
    position: absolute;
    top: 10px;
    left: 10px;
    background: linear-gradient(118deg, #ff0000, #cc0000);
    color: white;
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 0.9em;
    z-index: 1;
}

.discount-carrossel {
    position: absolute;
    top: 19px;
    margin-left: 20px;
    background: linear-gradient(118deg, #ff0000, #cc0000);
    color: white;
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 0.9em;
    z-index: 1;
}

    /* Barra Lateral */
aside {
    flex: 1;
    padding-left: 20px;
}

 
.tab-button {
    flex: 1; /* Distribui o espaço igualmente entre os botões */
    background: linear-gradient(120deg, #206958b8, #05a582a1);
    border: none;
    padding: 10px 0; /* Reduz o preenchimento vertical */
    cursor: pointer;
    border-radius: 10px 10px 0 0;
    font-size: 0.9em; /* Reduz o tamanho da fonte */
    font-weight: 500;
    color: #fff;
    transition: all 0.3s ease;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    position: relative;
    overflow: hidden;
    z-index: 2;
    text-align: center; /* Centraliza o texto */
    white-space: nowrap; /* Evita que o texto quebre a linha */
    overflow: hidden; /* Esconde o texto que ultrapassa as bordas */
    text-overflow: ellipsis; /* Adiciona "..." ao texto que ultrapassa */
    margin: 0 2px; /* Adiciona margem lateral para separação */
}

.tab-button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 50%;
    height: 100%;
    background: linear-gradient(to right, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.3));
    transform: skewX(-45deg);
    transition: left 0.4s ease;
    z-index: 1;
}

.tab-button:hover::before {
    left: 150%;
}

.tab-button:hover {
    background: linear-gradient(120deg, #05a582a1, #206958b8);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

.tab-button.active {
    box-shadow: 0 0 15px #ff6700;
    background: linear-gradient(231deg, #ffa200e0, #ff5d00e0);
    color: #fff;
    z-index: 3;
}

/* Estilo base para os botões */
button {
    padding: 12px 18px;

    border: none;
    border-radius: 8px;

    cursor: pointer;
    transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    outline: none;
}

/* Estilos para os botões primários */
.btnInicio {
    background-color: #3498db;
    /* Azul */
    color: #fff;
}

.btnInicio:hover {
    background-color: #2980b9;
    /* Azul mais escuro no hover */
    transform: translateY(-2px);
    /* Leve elevação no hover */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    /* Sombra mais intensa no hover */
}

.button-group {
    display: flex;
    justify-content: space-around;
    margin-bottom: 20px;
    margin-top: 20px;
}

.button-group-carousel {
    display: flex;
    margin-bottom: 9px;
    flex-direction: column;
    align-items: center;
}

/* Estilo base para os botões */
button {
  border: none;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s ease; /* Transição para todos os atributos */
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); /* Sombra mais pronunciada */
  outline: none;
  font-weight: 500; /* Peso da fonte um pouco mais forte */
  position: relative; /* Necessário para efeitos de brilho */
  overflow: hidden; /* Esconde o brilho que ultrapassa as bordas */
}

/* Efeito de brilho (Opcional, mas adiciona um toque premium) */
button::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 50%;
  height: 100%;
  margin-bottom: 10px;
  background: linear-gradient(to right, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.4));
  transform: skewX(-45deg);
  transition: left 0.4s ease;
  z-index: 1;
}

button:hover::before {
  left: 150%;
}

/* Estilos para os botões primários */
.btnInicio {
  background: linear-gradient(120deg, #3498db, #2980b9); /* Gradiente azul */
  color: #fff;
}

.btnInicio:hover {
  background: linear-gradient(120deg, #2980b9, #3498db); /* Inverte o gradiente no hover */
  transform: translateY(-3px); /* Elevação um pouco maior */
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3); /* Sombra mais intensa */
}

/* Estilos para os botões secundários */
.ButtonFinalizarCompra {
  background: linear-gradient(120deg, #2ecc71, #27ae60); /* Gradiente verde */
  color: #fff;
}

.ButtonFinalizarCompra:hover {
  background: linear-gradient(120deg, #27ae60, #2ecc71); /* Inverte o gradiente no hover */
  transform: translateY(-3px); /* Elevação um pouco maior */
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3); /* Sombra mais intensa */
}

/* Estilos para os botões de ação close-button*/
.ButtonEsvaziarCarrinho {
  background: linear-gradient(120deg, #e74c3c, #c0392b); /* Gradiente vermelho */
  color: #fff;
}

.ButtonEsvaziarCarrinho:hover {
  background: linear-gradient(120deg, #c0392b, #e74c3c); /* Inverte o gradiente no hover */
  transform: translateY(-3px); /* Elevação um pouco maior */
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3); /* Sombra mais intensa */
}

/* Estilos para os botões de texto */
.buy-now-button {
  background: linear-gradient(120deg, #2ecc71, #27ae60); /* Gradiente laranja */
  box-shadow: 0 0 15px #2ecc7052;
  color: #fff;
}
.add-to-cart-button {
  background: linear-gradient(120deg, #3498db, #2980b9); /* Gradiente laranja */
  box-shadow: 0 0 15px #3498db70;
  margin-bottom: 20px;
  color: #fff;
}

.add-to-cart-button:hover {
  background: linear-gradient(120deg, #d35400, #f39c12); /* Inverte o gradiente no hover */
  transform: translateY(-3px); /* Elevação um pouco maior */
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3); /* Sombra mais intensa */
}

.buy-now-button:hover {
  background: linear-gradient(120deg, #d35400, #f39c12); /* Inverte o gradiente no hover */
  transform: translateY(-3px); /* Elevação um pouco maior */
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3); /* Sombra mais intensa */
}

/* Estilos para os botões desabilitados */
button:disabled {
  background: #ddd; /* Cinza claro */
  color: #999;
  cursor: not-allowed; /* Altera o cursor para indicar que não é clicável */
  box-shadow: none; /* Remove a sombra */
  transform: none; /* Remove a elevação */
  opacity: 0.7; /* Diminui a opacidade para indicar que está desabilitado */
}

/* Estilos para o botão de fechar no modal */
.close-button {
    background: linear-gradient(120deg, #e74c3c, #c0392b); /* Gradiente vermelho */
    color: #fff;
}

.close-button:hover { 
  background: linear-gradient(120deg, #e74c3c, #c0392b); /* Gradiente vermelho */
  transform: translateY(-3px); /* Elevação um pouco maior */
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3); /* Sombra mais intensa */
}

/* Estilo adicional para os botões para dar um efeito 3D suave */
button {
  border: 1px solid rgba(0, 0, 0, 0.1);
  background-clip: padding-box; /* Evita que o gradiente se estenda sob a borda */
}

/* Sutil efeito de relevo no hover */
button:hover {
  border-color: rgba(0, 0, 0, 0.2);
}

.button-container {
  display: flex;
  flex-direction: column;
}

#orderHistoryList button {
  margin-top: 12px; 
  padding: 12px 20px; 
  border-radius: 10px; 
  font-size: 1em;
  font-weight: 500; 
  border: none; 
  background: linear-gradient(120deg, #7986cb, #3f51b5); 
  color: #fff; 
  cursor: pointer; 
  transition: all 0.3s ease; 
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2); 
  position: relative; 
  overflow: hidden; 
}

#orderHistoryList button::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 50%;
  height: 100%;
  background: linear-gradient(to right, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.3));
  transform: skewX(-45deg);
  transition: left 0.4s ease;
  z-index: 1;
}

#orderHistoryList button:hover::before {
  left: 150%;
}

#orderHistoryList button:hover {
  transform: translateY(-2px); 
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); 
  background: linear-gradient(120deg, #3f51b5, #7986cb); 
}


#orderHistoryList button {
    margin-top: 10px;
    padding: 10px 15px;
    border-radius: 8px;
    font-size: 1em;
}

.pagination-buttons {
    display: flex;
    margin-top: 20px;
    justify-content: space-evenly;
}

.tabs {
    display: flex;
    margin-bottom: 20px;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}


#cartList {
    list-style: none;
    padding: 0;
}

.cart-item {
    display: grid; /* Usamos Grid para controle total do layout */
    
    /* Layout para Desktop: [Imagem] [Informações] [Controles] */
    grid-template-columns: auto 1fr auto;
    align-items: center;
    gap: 1rem; /* Espaçamento entre os elementos */
    
    padding: 1.25rem 0.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    transition: background-color 0.3s ease;
}

.cart-item:last-of-type {
    border-bottom: none; /* Remove a borda do último item */
}

.cart-item:hover {
    background-color: rgba(255, 255, 255, 0.05); /* Efeito sutil de hover */
    border-radius: 8px;
}

/* --- Imagem do Produto --- */
.cart-item img {
    width: 65px;
    height: 65px;
    border-radius: 12px;
    object-fit: cover; /* Garante que a imagem preencha o espaço sem distorcer */
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
}

/* --- Informações do Produto (Nome, Opções, Preço) --- */


.cart-item-info .item-name {
    font-weight: 600;
    color: #ffffff;
    line-height: 1.3;
}

.cart-item-info .item-options {
    font-size: 0.85em;
    color: #adb5bd; /* Cor mais suave para informações secundárias */
    margin-top: 0.25rem;
}

.cart-item-info .item-price {
    font-weight: 700;
    color: var(--secondary-color, #4ecdc4);
    margin-top: 0.5rem;
}

/* --- Controles de Quantidade e Exclusão --- */
.cart-quantity-controls {
    display: flex;
    align-items: center;
    background-color: rgba(0, 0, 0, 0.2);
    border-radius: 20px;
    padding: 4px;
}

.cart-quantity-controls .quantity-btn {
    width: 32px;
    height: 32px;
    padding: 0;
    border: none;
    border-radius: 50%;
    font-size: 1.2rem;
    font-weight: 500;
    line-height: 1;
    cursor: pointer;
    transition: background-color 0.2s, transform 0.2s;
}

.cart-quantity-controls .quantity-btn.decrease {
    background-color: #e74c3c;
    color: white;
}
.cart-quantity-controls .quantity-btn.increase {
    background-color: #2ecc71;
    color: white;
}
.cart-quantity-controls .quantity-btn:hover {
    transform: scale(1.1);
}

.cart-quantity-controls .quantity-display {
    font-weight: 700;
    font-size: 1.1rem;
    padding: 0 1rem;
    color: white;
}

.cart-item .trash-btn {
    background: none;
    border: none;
    color: #ff6b6b;
    font-size: 1.25rem;
    cursor: pointer;
    padding: 0.5rem;
    margin-left: 0.5rem; /* Espaço entre os controles de qtd e a lixeira */
    transition: color 0.2s ease, transform 0.2s ease;
}

.cart-item .trash-btn:hover {
    color: #e74c3c;
    transform: scale(1.15) rotate(10deg);
}


/* ================================================== */
/* === RESPONSIVIDADE DO ITEM DO CARRINHO (CELULAR) = */
/* ================================================== */
@media (max-width: 768px) {
    .cart-item {
        /* Layout para Celular:
           [Imagem] [Informações]
           [   Controles      ]
        */
        grid-template-columns: auto 1fr; /* 2 colunas */
        grid-template-rows: auto auto;    /* 2 linhas */
        grid-template-areas:
            "image info"
            "controls controls"; /* Controles ocupam a largura toda */
        column-gap: 0.75rem;
        row-gap: 0.75rem;
        padding: 1rem 0;
    }

    .cart-item img {
        grid-area: image; /* Posiciona na área 'image' */
        width: 60px;
        height: 60px;
    }

    .cart-item-info {
        grid-area: info; /* Posiciona na área 'info' */
    }

    .cart-quantity-controls {
        grid-area: controls;
        display: grid;
        grid-template-columns: 1fr auto;
        width: 100%;
        background-color: transparent;
        padding: 0;
        border-radius: 0;
        justify-items: center;
    }

    .quantity-controls-wrapper {
        display: flex;
        align-items: center;
        justify-content: flex-start; /* Alinha à esquerda */
        background-color: rgba(0, 0, 0, 0.2);
        border-radius: 20px;
        padding: 4px;
    }

    .cart-item .trash-btn {
        justify-self: flex-end; /* Alinha a lixeira à direita */
        margin-left: 0;
    }
}

#cartTotal {
    font-weight: bold;
    color: #2ecc71;
}


.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 500;
}

.form-group input[type="text"],
.form-group input[type="Email"],
.form-group input[type="number"],
.form-group input[type="Nome"],
.form-group textarea,
.form-group select {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 1em;
    box-sizing: border-box;
}

.form-group textarea {
    resize: vertical;
    min-height: 100px;
}

#orderHistoryList button {
    margin-top: 10px;
    padding: 10px 15px;
    border-radius: 8px;
    font-size: 1em;
}

.custom-select {
    margin-bottom: 12px;
    width: 55%;
    padding: 12px;
    font-size: 1em;
    border: 2px solid #ddd;
    border-radius: 8px;
    background-color: #fff;
    color: #333;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20fill%3D%22%23343a40%22%20d%3D%22M7%2C10l5%2C5l5%2C-5H7z%22%2F%3E%3C%2Fsvg%3E');
    background-repeat: no-repeat;
    background-position: right 12px top 50%;
    background-size: 18px;
    padding-right: 35px;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

.custom-select:focus {
    border-color: #3498db;
    outline: none;
    box-shadow: 0 0 8px rgba(52, 152, 219, 0.5);
}

.custom-select option {
    font-size: 1em;
    color: #333;
    background-color: #fff;
}

#orderHistoryList {
    list-style: none;
    padding: 0;
}

.order-details p {
    margin-bottom: 8px;
}
.order-details h4 {
    margin-top: 15px;
    margin-bottom: 10px;
    color: #055d00;
}
.order-details ul {
    list-style: none;
    padding: 0;
}
.order-details li {
    padding: 8px 0;
    border-bottom: 1px dashed #ddd;
}
.order-details li:last-child {
    border-bottom: none;
}
.order-details img {
    vertical-align: middle;
    border-radius: 50%;
    object-fit: contain;
}

/* =========================================== */
/* === NOVOS ESTILOS PARA HISTÓRICO OCULTO === */
/* =========================================== */
.order-item {
    background-color: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    margin-bottom: 15px;
    overflow: hidden; /* Importante para a animação */
}
.order-header {
    background-color: rgba(0, 0, 0, 0.2);
    padding: 15px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: background-color 0.3s ease;
}
.order-header:hover {
    background-color: rgba(0, 0, 0, 0.3);
}
.order-header h3, .order-header .status-display {
    margin: 0;
    color: #fff;
}
.order-header h3 {
    font-size: 1.1em;
}
.order-header .status-display {
    font-weight: bold;
}
.order-header .toggle-icon {
    font-size: 1.2em;
    transition: transform 0.3s ease-in-out;
}
.order-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.5s ease-out, padding 0.5s ease-out;
    padding: 0 20px; /* Sem padding vertical quando fechado */
    color: #000;
    background: linear-gradient(163deg, #ffa200b3, #ff5d00a1);
    border-top: 1px solid rgba(0,0,0,0.1);
}
/* Estilos para quando o item está aberto */
.order-item.open .order-header {
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
}
.order-item.open .order-content {
    max-height: 2000px; /* Valor alto para acomodar qualquer conteúdo */
    padding-bottom: 20px;
}
.order-item.open .toggle-icon {
    transform: rotate(180deg);
}
.order-content p { color: #000000; }
.order-content h4 { color: #003808; }
.order-content ul li { color: #111; }
/* =========================================== */

.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    z-index: 1000; 
}

.modal-content {
    position: absolute; 
    top: 50%; 
    left: 50%; 
    padding: 20px;
    width: 80%;
    max-width: 600px;
    box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
    border-radius: 10px; 
}

@keyframes animatetop {
    from {
    top: -300px;
    opacity: 0
}

to {
    top: 50%;
    opacity: 1
}
}

#qrCode {
    text-align: center;
}


.modal.fullscreen .modal-content {
    width: 100%;
    max-width: none;
    height: 100%;
    border: none;
    border-radius: 0;
    box-shadow: none;
    top: 0;
    left: 0;
    transform: none;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 0; /* Remove o padding para tela cheia */
}

.modal.fullscreen .close-button {
    position: absolute;
    top: 20px;
    right: 20px;
    z-index: 1002; /* Garante que o botão fique visível em tela cheia */
}

.modal.fullscreen #qrCode {
    width: 100%; /* Garante que ocupe toda a largura do modal */
    height: 100%; /* Garante que ocupe toda a altura do modal */
    max-width: none; /* Remove restrições de largura */
    max-height: none; /* Remove restrições de altura */
}

.modal.fullscreen iframe {
    width: 100%; /* Garante que o iframe ocupe toda a largura */
    height: 100%; /* Garante que o iframe ocupe toda a altura */
    border: none;
}

    /* Notificações */
#notification-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    width: 300px;
}

.notification {
    background-color: #2ecc71;
    color: white;
    padding: 15px;
    margin-bottom: 10px;
    border-radius: 5px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    opacity: 0;
    transition: opacity 0.5s ease-in-out, transform 0.3s ease;
    transform: translateX(100%);
}
.notification.aguardando {
    background-color: #9e8600;
}
.notification.atualizado {
    background-color: #006eff;
}

.notification.success {
    background-color: #2ecc71;
}

.notification.error {
    background-color: #e74c3c;
}

.notification.show {
    opacity: 1;
    transform: translateX(0);
}

    /* Carrinho Flutuante */
#floating-cart {
    position: fixed;
    bottom: 20px;
    left: 20px;
    color: #fff;
    display: flex;
    align-items: center;
    padding: 17px;
    font-size: 1.5em;
    background: var(--floating-cart-bg);
    border: none;
    border-radius: 31px;
    cursor: pointer;
    box-shadow: 0 0 15px #000000ba;
    z-index: 100;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

#floating-cart:hover {
    background-color: darken(#3498db, 10%);
    transform: translateY(-2px);
    background: linear-gradient(47deg, #206958, #05a581, #206958);
}

#floating-cart .cart-icon {
    margin-right: 10px;
    font-size: 1.5em;
}

#floating-cart .cart-count {
    background-color: #e74c3c;
    color: white;
    border-radius: 50%;
    padding: 5px 15px;
    font-size: 0.8em;
    margin-left: 5px;
}

.mini-cart-button {
    display: none;
}




/* =================================== */
/*       ESTILOS DO NOVO RODAPÉ        */
/* =================================== */

/* Estilo principal do rodapé */
.rodape {
    background: linear-gradient(120deg, #206958b8, #05a582a1);
    box-shadow: 0 0 15px #05a582;
    color: #fff;
    padding: 40px 20px 20px 20px; /* Mais espaço interno */
    margin-top: 30px;
    border-radius: 15px;
    font-size: 0.9em;
}

/* Container que segura as colunas */
.footer-content {
    display: flex;
    flex-wrap: wrap; /* Permite que as colunas quebrem a linha em telas menores */
    justify-content: space-between;
    gap: 30px; /* Espaço entre as colunas */
    margin-bottom: 30px;
}

/* Estilo de cada coluna */
.footer-column {
    flex: 1; /* Faz as colunas dividirem o espaço */
    min-width: 250px; /* Largura mínima antes de quebrar a linha */
}

.footer-column h4 {
    font-size: 1.2em;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid #4ecdc4; /* Linha de destaque no título */
    color: #ffffff;
}

.footer-column p {
    margin-bottom: 10px;
    line-height: 1.6;
}

/* Lista de links úteis */
.footer-links {
    list-style: none;
    padding: 0;
}
.footer-links li {
    margin-bottom: 10px;
}
.footer-links a {
    color: #fff;
    text-decoration: none;
    transition: color 0.3s ease;
}
.footer-links a:hover {
    color: #4ecdc4;
    text-decoration: underline;
}

/* Ícones de redes sociais */
.social-icons a {
    color: #fff;
    font-size: 1.8em; /* Ícones maiores */
    margin-right: 20px;
    transition: transform 0.3s ease, color 0.3s ease;
    display: inline-block; /* Necessário para o transform */
}
.social-icons a:hover {
    color: #4ecdc4;
    transform: translateY(-3px); /* Efeito de elevação */
}

/* Ícone de pagamento */
.payment-icons .pix-icon {
    display: inline-block;
    background-color: #fff;
    border-radius: 4px;
    padding: 5px;
    margin-top: 10px;
}
.payment-icons .pix-icon img {
    width: 60px;
    height: auto;
    display: block;
}

/* Botão de horários e aviso */
.footer-column #openModalhorarios {
    margin-top: 15px;
    width: 100%; /* Ocupa a largura da coluna */
}
.footer-notice {
    font-size: 0.85em;
    font-style: italic;
    margin-top: 15px;
    opacity: 0.8;
}

/* Seção inferior do rodapé (copyright) */
.footer-bottom {
    text-align: center;
    padding-top: 20px;
    margin-top: 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.2); /* Linha divisória sutil */
}

/* Media Query para responsividade em celulares */
@media (max-width: 768px) {
    .footer-content {
        flex-direction: column; /* Empilha as colunas */
        text-align: center; /* Centraliza o texto */
    }
    .footer-column h4 {
        border-bottom: none; /* Remove a linha para um visual mais limpo no mobile */
    }
    .social-icons {
        margin-bottom: 20px;
    }
}

@media (max-width: 1280px) {
#featuredProductsCarousel {
    margin-right: 0 !important;
}

.container {
    margin-right: 10px !important;
    margin-left: 10px !important;
    margin-top: 20px !important;
    margin-bottom: 20px !important;
    flex-direction: column-reverse;
    padding: 10px;
    display: flex;
}

.products {
    border-right: none;
    padding-right: 0;
    margin-bottom: 20px;
    width: 100%;
}

    aside {
    padding-left: 0;
}

    header h1 {
    font-size: 2em;
}

    header p {
    font-size: 1em;
}

.products h2 {
    font-size: 1.8em;
}

#productList {
    flex-direction: column;
}

.product {
    width: 100%;
    margin-right: 0;
}
}

#featuredProductsCarousel {
    position: relative;
    overflow: hidden;
    margin-bottom: 20px;
    border-radius: 15px;
    text-align: center;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    box-sizing: border-box;
    box-shadow: 0 0 15px #ff6700;
    background: linear-gradient(231deg, #ffa200b3, #ff5d00a1);
}

.loja-fechada-mensagem {
    text-align: center;
    margin-bottom: 20px;
}

.not-alert {
    padding: 15px;
    border: 1px solid transparent;
    border-radius: 4px;
}

.not-alert-danger {
    color: #000000;
}

.not-alert p {
    margin: 0;
    font-size: 1em;
}

.not-alert table {
    width: 100%;
    margin-top: 10px;
    border-collapse: collapse;
}

.not-alert table thead th {
    background-color: #ffffff;
    color: #000000;
    padding: 8px;
    border: 1px solid #ebccd1;
}

.not-alert table tbody td {
    padding: 8px;
    border: 1px solid #ebccd1;
    text-align: left;
}

.not-alert table tbody tr:nth-child(even) {
    background-color: #f9f9f9;
}

.uk-margin-xsmall-right {
    margin-right: 5px;
}



.carousel-slide {
    display: flex;
    transition: transform 0.5s ease-in-out;
}

.carousel-item {
    min-width: 100%;
    box-sizing: border-box;
    text-align: center;
    align-content: space-around;
}

.carousel-item img {
    max-width: 80%;
    height: auto;
    margin-bottom: 10px;
    border-radius: 8px;
    margin-top: 20px;
}

.carousel-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 100%;
    display: flex;
    justify-content: space-between;
    padding: 0 10px;
    box-sizing: border-box;
}

.carousel-nav button {
    background: rgba(0, 0, 0, 0.5);
    color: #fff;
    border: none;
    padding: 8px 12px;
    cursor: pointer;
    border-radius: 5px;
    transition: background-color 0.3s ease;
}

.carousel-nav button:hover {
    background: rgba(0, 0, 0, 0.7);
}

.required:after {
    content: " *";
    color: red;
}

@media (max-width: 768px) {
.close-button {
    font-size: 24px;
    padding: 6px 10px;
}
}

.loja-aberta {
    color: #09ff00;
    font-size: 24px;
    font-weight: bold;
}

.loja-fechada {
    color: red;
    font-size: 24px;
    font-weight: bold;
}

.pago-success {
    color: #09ff00;
    font-size: 18px;
    font-weight: bold;
}
.aguardando-paga {
    color: #ffee00;
    font-size: 18px;
    font-weight: bold;
}

.cancelado-falha {
    color: red;
    font-size: 18px;
    font-weight: bold;
}

.whatswidget-widget-wrapper {
    font-family: "Helvetica Neue","Apple Color Emoji",Helvetica,Arial,sans-serif !important;
    font-size: 16px !important;
    position: fixed !important;
    bottom: 20px !important;
    right: 30px !important;
    z-index: 100;
}

.whatswidget-conversation {
    background-color: #e4dcd4 !important;
    background-image: url('data:image/png !important;base64,iVBORw0KGgoAAAANSUhEUgAAAGUAAABlCAYAAABUfC3PAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAhHpUWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYAAAiZdY5dDoQwCITfOcUeYQqUluOYrCbewOM7tW6MD/slwPAbZD32TT6DAojX1iMjQDw9daHomBhQFGVE+skdrVApxXfmYjpFZG/wZ9DxpiJ6bM1pXDHV1YJmV5M3BOOFfA5E/X3zp34jJ5txK0wLhZMZAAABd2lUWHRYTUw6Y29tLmFkb2JlLnhtcAABAFVURi04AFhNTDpjb20uYWRvYmUueG1wAEiJ7ZaxTsMwFEX3foVl5thJKEOsuB1aUBkKCJBaxjR5Taw2TpQYYvprDHwSv4DdVi2qyojEYE+27/U99vPy4qGuk3QFCi0gF5Ljr49PjETG8exq6k/rERRismngaXP3nG5WaZTh4aAXa6bLugSVIF2uZcs0x0lWLYCZud2mGG0tasXxfPqARlUDqE/6xPeutXgL8aCH4iZbssfxzT7CrDgulKoZpV3Xke6SVE1OgyiKqB/SMPSMw2vfpUq0J9sLG7HLGEObNqJWopLIrpNF9ao4xkZH+3DQ4pguW7K9LEmrklqFBsSnP+1KLH+xW+Vot4fZg9Cwno9FCbI1V+A48IMT9eWMapPYbZnkMBOZKs4JExB5oU6U+0aAqYHahWFqK0n3pTQ/Qw9fM9g+6K+HgziIgziIgziIg/wrSC8+NHcgTUfXmdbtG8Nkm7OA2X6LAAATK0lEQVR4nO1d25bjOI4MgKSy5/+/bR/3cf+hLJLAPoCgaFu2JaeU6dptnFNTPVlpWSJIXAIBiP7nv/9L8a98lPBv38C/ci/xt2/g/5qICGoVqAoUAAEAEQIzmBlE9PIaEQBUFaUUiAhU7VIhMEIIYP73MG0VEUHOpa+lCxEhhICUIkIILxUTRQSlVtRSoAoQAQqFFoGoIsX4r2I2iIjgcrlARMGB8fU1gYigqqhVUGpBzhmqipTS02vFWivmeQYTI8YA5gBVQc4ZJWcQgJgSeMOx+/8qtvAVtQpCDJhSujJVzAIiIJeCXApCiGB+vJ6xioCIME0JIYT2Y7tg6RcJQP+33xMzrcvfIAIBm+z0mSIi8HWMMQ7raMLMSCmZ4sT8DfB4PSNUV51QjBEiipzLsgi/JKoKVYWIQETb/SiICMy8yU6fen/tf0IIDy2K36vq8jyP7rlFXw8e6Beec1l8U4CIQFTa7RCIlpNRRaClYEoJMcbfU8xycF8IbVrTqABqLUh6HR3XWiG12oOe/LBdCarQHgGi7yo3UUQMZuqLTyIopaDUCmJGbGajnyy7QA9N3RocrTxfIhnu/VbsngR4ckJcYuCAWgrmeUZskZaIopQMEUVK8VQnX6ugVgsjq0hfPOaAEPlpfC/NjpdSUUtFYIYCkGa7pdoiKRTUwnx/xiMVw+0ecylgEYSmGP8Oj8BEbHvQi++PIYTuP0qpIJa+y7g9xFlmQUQwzxdUEcQQkG6iltu/b2Wx0xk5C6pUO2kAePA3AEFUuuJTjC/D0j3ieUhgRikFKnK1brVaNEtESCm+tGAxBAbxF2opzWQJiAkpphYin5OjdN+hauF4SggPdpD/rjaPquq70xY+xtSTNWrOlm9OmCqDMEaUz8PSvWILnlriqMil9MVXBYgJMUSE8HqTR8B2Fd2EcmfY3luRZl8Dh+4PgMUnjH+ulaJgDogxIISAaUrdnrsy/DrtYcBAM812osz0HWfGPBwmIpS2ud2bERNS2JbNAwP29RNKuBVueYZicY6OHdXaTm5THFOzxe0TpRYA2h803ChVVFFLBYAOGdnvcVNyvQoajpIOTd1ax/asW+RHAclx15sjrhBRxGYhO3ZUS0MYYo+4/KEMp1OgnQyHhkYppZpth0VzVQImLAtGbN/vDvlo+a6iY875UKfncm9+WkjY/81sre/irqxqpiWmiBBGn2C7X8TOFXNb4JXnr9UUm2JEBZliqnTTxi1i0w/FyONZCjEsqF4ngApwsDDXAowl5HVFgVo+wWSfVYuoPCiw0HbxJ6vfD/TfQwMFPcPzfEc0fwupGD/73ZNxex+H7xUvAzg845A1tR0KXPuv8e8QGCIW75dc7BT00DZ2HzD+WZMYAkQEfy4XQLXjUQtA6KdPnsIdj8RyjtpN5xJ6718rQ5dnix7btU5RSs4ZCsPPQlxC1Fdi4W28UpT/2ZPwhWA+pFbp/3/8fg8cXmFQa8/mfk9UwEQtpLdTHeM+DM6ulaGwnJDazw5VyujEU0qYprR7F4Zwb5ZG3zTKo9PivuORZTYlB6jaImzNxXzD1ZbLETOoVguBRa984BaptSKXgilNSMlUcbnMxyulVjGfcQCUMTr/6rhS04v5ptB9095v4sCQDn1sv59S6lXNRGPCPF8scHjDR1G7Fy+IHW6+HGf6LrbkgUJukIUleeiL76cml4yczWfEHRVSajXzWmpHoHfcXQ8W7G/0YGKvTohtQ+WcIc3UllJOyFP6jb2nlK6QXCBiKLVHbI5Ya0OT/QRZToLNpeuOmWFBpbdsom72xMq7QbmfZmLaDaYHZqQYkRvEZQo+I3kkQGUJQffKGLmlVidZXegGpFYR5HlGyQUqimlKmxUDGNSzRykxRtvZ8wwJEbUaavAOl8ErkhaiG0KejjZfFtUwsr5nX23Xm0n5mr5eRjNuhmiamgMuqHVbzcTvte/0jZ9JyaJDD4ktMHm/+mmKDlBloBXxDlUKM4ODQmfd5UCBJb/x3OZWIZ6IjmVg910hhJ7t51L6jt5yv9LAya15hi+iCENVdofrj655VYp/+0oPxBLEJYTdngMAtS2oHekBXhFBdi5Vy9hiiIgR3WQEZmgMmOcMCductyEJ0hHmrfdqG4FwFsH0lKsSM1wxW0W1wSjEVzB+bZl5rVZZjNGSj5wz5pakAkNWTeYnZMN3O9A5Euc+QQ5Xitt5AJsftp+qVnsYfy61QsXCXnP8liMQkeUZ9ZqJ2EvXm5RipYCeA32InIKTMjOqLPD4FrOgaLZ1/Jln8WR4lpsqZm6FpNrwq8Em9xrNaxlt+TtK6cU3YCB3fL9Gc55SquwyC21pVv/ltjykjvuvie4LxokAJu6BwtYSsWf3peSOXluIe0/G2yurShm5V3bjtDnku0rM6r7d5zmDi9fhnUbrztihF6xEPk8V9ux+RaD8nLk4SikFl3nupWyFJb3IltnH+L5iHiol59wKSkZs2BP2mRkiCLZFNeORv03mmBlhYGsaRmTQy+1GWcwdbaZFEZkfu90Qz8RNM4Be1xGxzSCiqFIRNyp3TVYdvcPTzhapYgWrrTdtu4/6rt7yOc873Cz4Z5gZU0pWW4c2rMqSuBGF9u4BwMzR3g2EHdiVVAvNY0O0uRXtrOwA6DejuYc+ZYHL33OCxAxuJnDrKUsxImdrGXAY3E2nK6xd3QDKm+SyNDI6h31BpZ0+YKs3IrLfVNGrT4hqD1i+I6tKuc2IA+/nfzERZMdJscWPPVGc53zlNB9FNYYWL70fcYo9JN8qZi6xmZ7bGZE1I88zKoeOSDDTOY6e2ZpeHGy7JbZtEV/EWuvmaIiZzH9ooxCZVRmoQHZCXMkejHSFhIi4E4NyHlgYytWv79MSXGkkD4eUFIoQToq+Op7DDCjuTMXWGydiiJRd0VBsDMe5Ib+llMYsdJIdNWhEG2ulgsn8zgjPbBH3Q1KlF622SggBX19fKNWIHSDCV5gO4Sk/9Ck9kXvz+u7szTnv80nMjGmawMESRFGBFK88GhRjXQXUggDrQNtTa3f6qqoipvdI38yMRNRP7jsV0DU5lfnkkY02mtGenegPLC0R9VYCL5laKLtQlNZkjf7q/DEvbgUO3+rrPCKDv5XT6WgeNYnqbqDNI68tNnoMJrRFQeqNRypX/+2csKkFEp/WaHv6SeHG3VWRU/omR/ShE/+GiI/YilnEjBQWpr7f39G7/Ag5XSnWs/FeJXKUkfp6a4K64zMkHiF4FY+aUq75Y58sqvpT5qtsBiddeW6C4H6gK8R5xctpMH7wcgrOaqM7W6SVw8939L0O7rXwdVL2NRncsCUdzJJTOv1PbAnt7c7/2xTh4vDSPB9MxlsTIiDEgFoq/lwuHS8CMDSfujNui0+t9aEt/lKnuK9Z/KYSPLQ+YnxKzhm5FMQYfkIphBStz8+agYwA4Zn5YqZwZfe50UK38pDfkR4MvKHYI8enjF0KMfyAUoCFYF0777a1RQz9Itwy+Z/a+R6ledi9R3wRjxyf4ozLWg8meD//Ulo91r9hhqwreUYp1YbbTNMuxYxjP44Yn7Jcx9pAfrSX6RMiIkehnbL0DrzicM+R41PGiPFDG8xeyzudVEtDU4aKVVQXoHPHdy/fvP4L38ALY4x/r1IsxG7U0fjaH6kqSq1Gi+0Th7ZBOLfCRCg4b3zKX6wUZ+YLKBucY+H2/dACV8g8zyAYu7LWuhlXuxVm6405a3zKX6sUz1s81wmykLVvM3rvyweWfkfR9znAHrScNT7ldKUc2UU7ipervXvMWzDmmjsHixt91nofFdPXV+stqYjhe2MYzxyfcqWU62hhfxPMrYwJlvdiHJkIevVvzhm1VCi0U1rHzir3HSEEXEqjwX59f3DbWeNTrpRy1E52slwptU8WoqaMaZoO+x43IxOADPSxITEEBDJGPYArM2U/012Vylf3sOc6W4iOq+ZrzHb34Exj24JjQgabhEbwK6szFr8rfj0FUEsFEyFMAYGuH895v2/HrAfIFqLjnVL8Q5d57vWQEKwf/lnHr8Jmosx5Rh3IDD5fJefcbua9hO2VhBDwRYQLZsu2c8Y0TVe/00eAQFo/5c/PnnSiY0oRCuqY17j575TipkdbxiqqkDyjlIUFeHvcnObjxayUkrFSBjzL297OFCJCDAE5l17Xv/1Op5jO84xpmjZ1fB0tr4iOd45+UYhNqvPopndTqSKp9pCvwxatgSfFtMo8N9R3/5SHvcJsTJeRu9g5xrBBOzGaKc3FwuSfnNa6heh4t00sfCTEFDqPammjzp0nBaAjv/NlBgiYUnriyKmPy3iHRLFVrPkIg2PX3tpNWJDpmGKHW76+vt+3uFW2EB3vzZdazB/4OsxzhJfbMBv3Od4xM02T1U0ePJihDk0VJzZNuX32KXhzzpDWNkFE0Fyag/X5LNa+103uyTX8LUTHVUc/subHi40Fq8s8tz5Ea3fbVNTZ2mL1pkiDU6wVG9aUqrL0Q4IgLH34Zy9TazUWZ0o/MkL+FdHx3ssN5JA18UlDc26Zc+BDc493xfojWw8km0+ppSJN6Y6SuuRRBUpGGPTZxp8wQv6t0MPqCYbOprh3UtH70yieiS+0BR8VBMY0pVUUwW14jHGYi2wn7BNkt1KW5ktFCnFfG5kuielaE1K3t+/WzIfClc8efmRSe04QQ29f+BRe2L1Smt1/FLr6NFSLGvaFkgrt8+mNQnSjlMZm3DtWY6El1X4C9uBsa1Sl35Q7pRAaU/7BaAznb1kSuf1BeudTq/6N0A3B/KxW7TnSP/987VMM0IZOR6tlfNAi75V7pTAB8qQjuo3NmDgtIe4G6bUOYpthf1WMsuOpqhYxiTz8/jUhspaIOMyZ/GR5RW26U0pgRtXaEdbbi0nPjNeZjg9vpBHWUkp9J6/dVBWB5v3BgJmgXR/5FdlCbbp6DGr8KzwYjeEDa/bOiF9uBC9fFtaBuQ/f7e+IU5v+/Ln0PG9N7vZWaCdgrYG0sxl3LlhpmFncEj57gLHrGz5fRmpTldoZoWtypxRrHzAIoLMZm+yd5qCKzoqk1vv+ygGb4hVHvhzgSBmJ6Hs+s4fatKqUwDZBuw7vK/Rb2GPpVWVAYl8PVO5vdmgwzyeKESVspOKW6UfvUJsetmwvdYnacSP0dzJsuPlG7a+lIA1zd5/efBvQeXRl8kj5CWrTQ6WEEHvNgdoojj6O/EUDkKrasM1+A69N0agU/oXC01b5CWrTwz56Nze1VpSceynYmoDW2+X85mzkko10jfF1Zt1HlUubH/nLrwh8Jj9BbXr4r0RtsihTf6eUAn1y3W10NhbC5mxFr9QG3bykkzYn6Pb2t7LxrU7cqU0xxY6ATG2M/IhyxNh+r5WgdeM8/KfDDRYGeUbOdgx9IEwptdcpxqqkansTRCOlvVLIPM+dof5bNXPAp7kakjAClGtyNrXp6Qr4aQEBZVh08/QVpdjggVKWofw2ASI+PSF+qkqtKE3ZaXqtxLXrOGj6rrmz10QZdO+lwFIVUaQ/xyM5i9r0clv6vC0CIZfcXwDGiA1+lx4aRjT4hKl39o7ii+hvnfYy7SuY/VZUtTeqemvbO0N9AHsnpJvm0HZxlTZFHEAI09PPn0Ft2mQrun8hYFbY1J/A/dj6q/RqrfhzMXT5tqFmrKP41B9/u8JemN59kDTmpYi9J3La2ZEFtCl3VfCf//wzNMgG/PlzsRetPddJX58jqU2bDbjTiYxUwcu4vhA7QlvqQnZ2XGfJbKgPuYkprCpui3jsT0RI0zQMT5A2b2v79TpCQUvPIYA+37iz6Ddc70hq02aluMmw92qFvgALedocZG0EPq+duBChdfsuRax3RUXAYRl0owBKXt4FuVXHnZYLtAKZ3agDr0TbpxIdSW3aFeqISI/FFzhk8QPvNuHsFaM26QIBtfI00/5OAaf7lBYBElF7PyTtenPQkdSmzUrxNmvwEkMQ/XwZ1UP1ec4o5dLeGFTBIfSR63skhICvaTL0tr2s03hsafMGO5ratEkpyxACvRrcfEQvxl7xHCElbaaBwJE3wzmPrgcspQkDZcMmUPQMatPuTI2w2OHfEm9Aiuovd/7e5rjl9+6RM6hN+5XSaZa/i039xildkzOoTXHvGEEMi3E2g/7T5SxqE/t7C18K3fsSHSKgv0k6oXAPZebRtWDUppEQ8l2Jc0Nnn8EJRHQ3PMAnqeZcProodSs+FKG2iO3RYFBto5WeWYGzqE1sOcfrF9B0Gz4UdLR1cP0tYq2Dc39z0Xy52NuKVjC6xXc+F0+gj+xv4e0FXvTsuSsF6+1hnyoLKmGTtlXtZQK3daHf9pGsGxUCoM+Qr7V1DrfXNf0tp8UQuPY209bu5xiXy28rBADYW+Ve3UwP2xptaKRe/i0+xTqdDSK6/LlAxd5zzB90/6qK6DyvLTvEWuwKSmkz4tvrvz9hd20VbyF3vxFC+Cjin5UBWn/8M3GsRtHajBuUICrg8LvMk2WCg/Zi17PE8tPaHkZx6xOf9Sr25KhaxayPsQVdzQX+LXF4fJ5zhzpSirvfDvEJcplnKyeHgP8FbJ3FbCth4+oAAAAASUVORK5CYII=') !important;
    background-repeat: repeat !important;
    box-shadow: rgba(0, 0, 0, 0.16) 0px 5px 40px !important;
    width: 250px !important;
    height: 300px !important;
    border-radius: 10px !important;
    transition-duration: 0.5s !important;
    margin-bottom: 80px !important
}

.whatswidget-conversation-header {
    background-color: #31d831c2 !important;
    padding: 10px !important;
    padding-left: 25px !important;
    box-shadow: 0px 1px #00000029 !important;
    font-weight: 600 !important;
    border-top-left-radius: 10px !important;
    border-top-right-radius: 10px !important
}

.whatswidget-conversation-message {
    line-height: 1.2em !important;
    background-color: rgba(0, 0, 0, 0.274) !important;
    padding: 10px !important;
    margin: 10px !important;
    margin-left: 15px !important;
    border-radius: 5px !important
}

.whatswidget-conversation-message-outer {
    background-color: #31d831c2  !important;
    padding: 10px !important;
    margin: 10px !important;
    margin-left: 0px !important;
    border-radius: 5px !important;
    box-shadow: rgba(0, 0, 0, 0.342) 0px 2.5px 10px !important;
    cursor: pointer !important;
    animation: nudge 2s linear infinite !important;
    margin-bottom: 70px !important
}

.whatswidget-text-header-outer {
    font-weight: bold !important;
    font-size: 90% !important
}

.whatswidget-text-message-outer {
    font-size: 90% !important
}

.whatswidget-conversation-cta {
    border-radius: 25px !important;
    width: 175px !important;
    font-size: 110% !important;
    padding: 10px !important;
    margin: 0 auto !important;
    text-align: center !important;
    background-color: #23b123 !important;
    color: white !important;
    font-weight: bold !important;
    box-shadow: rgba(0, 0, 0, 0.16) 0px 2.5px 10px !important;
    transition: 1s !important;
    position: absolute !important;
    top: 62% !important;
    left: 10% !important
}

.whatswidget-conversation-cta:hover {
    transform: scale(1.1) !important;
    filter: brightness(1.3) !important
}

.whatswidget-cta {
    text-decoration: none !important;
    color: white !important
}

.whatswidget-cta-desktop {
    display: none !important
}

.whatswidget-cta-mobile {
    display: inherit !important
}

    @media (min-width: 48em) {
.whatswidget-cta-desktop {
    display:inherit !important
}

.whatswidget-cta-mobile {
    display: none !important
}
}

.whatswidget-button-wrapper {
    position: fixed !important;
    bottom: 32px !important;
    right: 22px !important
}

.whatswidget-button {
    position: relative !important;
    right: 0px !important;
    background-color: #31d831 !important;
    border-radius: 100% !important;
    width: 60px !important;
    height: 60px !important;
    box-shadow: 2px 1px #0d630d63 !important;
    transition: 1s !important
}

.whatswidget-icon {
    width: 42px !important;
    height: 42px !important;
    position: absolute !important;
    bottom: 10px !important;
    left: 10px !important;
}

.whatswidget-button:hover {
    filter: brightness(115%) !important;
    transform: rotate(15deg) scale(1.15) !important;
    cursor: pointer !important
}

    @keyframes nudge {
    20%,100% {
    transform: translate(0,0)
}

    0% {
    transform: translate(0,5px);
    transform: rotate(2deg)
}

    10% {
    transform: translate(0,-5px);
    transform: rotate(-2deg)
}
}	

.backgroundred {
    background: linear-gradient(118deg, #ff0000, #cc0000);
    color: white;
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 0.9em;
}
.backgroundverde {
    background: linear-gradient(120deg, #206958, #05a582);
    color: white;
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 0.9em;
}
#modalErro {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            z-index: 101;
        }
        #modalErro .conteudo {
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            width: 300px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        #modalErro .botaoAjuda {
            background-color: #007BFF;
            color: white;
        }
        #modalErro.botaoFechar {
            background-color: #ff0000;
            color: white;
        }
        #modalErro.trocaid .conteudo {
            background: linear-gradient(153deg, #d8131388, #1900ff85);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        /* Estilos para os tipos de mensagem */
        #modalErro.success .conteudo {
            background: linear-gradient(153deg, #096d1a, #08ad08);
            color: white;
        }
        #modalErro.aviso .conteudo {
            background: linear-gradient(153deg, #6d5e09, #7e7101);
            color: white;
        }
        #modalErro.error .conteudo {
            background: linear-gradient(153deg, #f44336, #880303);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #modalErro button {
            margin-top: 10px;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        /* =========================================== */
/*    NOVO CSS PARA TABELA DE HORÁRIOS         */
/* =========================================== */

.schedule-table-container {
    width: 100%;
    max-width: 500px; /* Um pouco mais estreito para melhor leitura */
    margin: 25px auto;
    overflow-x: auto;
}

.schedule-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 1em;
    border-radius: 12px; /* Bordas mais arredondadas */
    overflow: hidden; /* Garante que o border-radius funcione */
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    color: var(--text-color);
}

.schedule-table thead tr {
    /* Gradiente laranja da sua identidade visual */
    background: linear-gradient(135deg, #ffa200e0, #ff5d00e0);
    color: #ffffff;
    text-align: left;
    font-weight: bold;
}

     .schedule-table th,
        .schedule-table td {
            padding: 6px 0px;
            text-align: center;
            border-bottom: 1px solid #ddd;
        }

.schedule-table tbody tr {
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    background-color: rgba(0, 0, 0, 0.15);
}

.schedule-table tbody tr:nth-of-type(even) {
    background-color: rgba(0, 0, 0, 0.25); /* Efeito de zebra sutil */
}

.schedule-table tbody tr:last-of-type {
    border-bottom: 2px solid #ff5d00; /* Linha final mais forte */
}

/* Estilo para o texto "Fechado" */
.schedule-table td span {
    background: linear-gradient(120deg, #e74c3c, #c0392b);
    color: white;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 0.9em;
    font-weight: 500;
}

/* Ajustes para telas menores */
@media (max-width: 600px) {
    .schedule-table {
        font-size: 0.9em;
    }
    .schedule-table th,
    .schedule-table td {
        padding: 10px 12px;
    }
}
 
   /* Estilos para o modal */
.horariosModal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

.modal-contenthorarios {
            display: flex;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    justify-content: center;
    align-items: center;
        }

tbody {
    display: table-row-group;
    vertical-align: middle;
    unicode-bidi: isolate;
    background: linear-gradient(153deg, #206958, #05a582);
}

/* Adicione este CSS perto dos outros estilos de .tab-button */

.tab-button.tab-disabled {
    background: #555; /* Cor cinza escura */
    color: #999;
    cursor: not-allowed; /* Ícone de "proibido" */
    box-shadow: none;
    transform: none;
}

.tab-button.tab-disabled::before {
    display: none; /* Remove o efeito de brilho */
}

.tab-button.tab-disabled:hover {
    background: #555; /* Impede mudança de cor no hover */
    transform: none;
    box-shadow: none;
}

.close {
    position: absolute;
    top: -22px;
    right: 24px;
    cursor: pointer;
    display: block;
    font-size: 5em;
}

.status {
    font-family: helvetica;
    text-align: center;
    color: #ffffff;
    display: block;
    font-size: 1.57em;
    font-weight: bold;
}
        /* Estilos para o botão de compartilhar */
#shareButton {
    background: linear-gradient(120deg, #851616cc, #1e05a5db);
    color: white;
    padding: 10px 15px;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease;
}

#openModalhorarios {
    background: linear-gradient(120deg, #851616cc, #1e05a5db);
    color: white;
    padding: 10px 15px;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease;
}
#openModalhorarios {
    background-color: #2980b9; /* Azul mais escuro no hover */
    transform: translateY(-2px); /* Levemente elevado no hover */
    box-shadow: 0 4px 8px rgba(0,0,0,0.3); /* Sombra mais intensa no hover */
}

#shareButton:hover {
    background-color: #2980b9; /* Azul mais escuro no hover */
    transform: translateY(-2px); /* Levemente elevado no hover */
    box-shadow: 0 4px 8px rgba(0,0,0,0.3); /* Sombra mais intensa no hover */
}
#sairdaloja {
    background: linear-gradient(60deg, #851616cc, #1e05a5db);
    color: white;
    padding: 10px 15px;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease;
}

#sairdaloja:hover {
    background-color: #2980b9; /* Azul mais escuro no hover */
    transform: translateY(-2px); /* Levemente elevado no hover */
    box-shadow: 0 4px 8px rgba(0,0,0,0.3); /* Sombra mais intensa no hover */
}

.image-slider-container { position: relative; overflow: hidden; width: 100%; }

.image-slider { display: flex; transition: transform 0.35s ease; width: 100%; }

.image-slider .slider-image { flex: 0 0 100%; width: 100%; height: auto; display: block; object-fit: cover; }

.slider-button { 
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 2;
    background: linear-gradient(141deg, #ff0000b8, #4800ffba);
    color: #fff;
    border: none;
    padding: 8px 12px;
    cursor: pointer;
    border-radius: 5px;
    transition: background-color 0.3s ease;
    box-shadow: 2px 1px 2px #000000e8;
}

.slider-button.prev { left: 8px; }

.slider-button.next { right: 8px; }

.fullscreen-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0,0,0,0.9);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
}

.fullscreen-image {
    max-width: 90%;
    max-height: 90%;
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0,0,0,0.7);
    cursor: zoom-out;
}

.close-btn {
    position: absolute;
    top: 20px;
    right: 30px;
    font-size: 40px;
    color: white;
    cursor: pointer;
    user-select: none;
}
.aviso-taxa {
    background-color: #fffbe6; /* Amarelo claro */
    border-left: 5px solid #f59e0b; /* Borda amarela/laranja */
    padding: 12px;
    margin-top: 15px;
    border-radius: 4px;
    font-size: 0.9em;
    color: #854d0e; /* Cor do texto mais escura */
    font-weight: 500;
}
/* Estilos para Filtros de Categoria */
#categoryFilters {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-evenly;
    gap: 10px;
    margin-bottom: 25px;
}

.category-button {
    background: linear-gradient(120deg, #206958b8, #05a582a1);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.3s ease;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

.category-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
}

.category-button.active {
    background: linear-gradient(231deg, #ffa200e0, #ff5d00e0);
    box-shadow: 0 0 15px #ff6700;
    font-weight: bold;
}
/* Adicione no seu CSS */
.skeleton {
    background-color: #3a3a3a;
    border-radius: 15px;
    margin-bottom: 20px;
    position: relative;
    overflow: hidden;
    height: 400px; /* Altura similar a um card de produto */
}

.skeleton::before {
    content: '';
    position: absolute;
    top: 0;
    left: -150%;
    height: 100%;
    width: 150%;
    background: linear-gradient(to right, transparent 0%, #555 50%, transparent 100%);
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0% {
        left: -150%;
    }
    100% {
        left: 150%;
    }
}
/* Adicione no final do seu CSS */
.search-container {
    position: relative; /* Essencial para posicionar o botão dentro dele */
}

/* Adiciona um espaço à direita no campo de texto para o botão não ficar em cima */
#searchInput {
    padding-right: 35px !important; 
}

.clear-search-btn {
    position: absolute;
    top: 50%;
    right: 10px; /* Distância da borda direita */
    transform: translateY(-50%); /* Alinha verticalmente no centro */
    
    background: none;
    border: none;
    cursor: pointer;
    
    font-size: 1.5em; /* Tamanho do "X" */
    color: #ff6600;
    
    display: none; /* Escondido por padrão */
}

/* Classe que vamos adicionar com JS para mostrar o botão */
.clear-search-btn.show {
    display: block;
}

/* =================================== */
/*    ESTILOS DO BOTÃO VOLTAR AO TOPO    */
/* =================================== */

#backToTopBtn {
    position: fixed;
    bottom: 102px;
    right: 25px;
    z-index: 99;
    background: var(--floating-cart-bg, linear-gradient(47deg, #ffa200e0, #ff5d00e0));
    color: white;
    border: none;
    outline: none;
    cursor: pointer;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    font-size: 20px;
    transition: background-color 0.3s, transform 0.2s;
    background-color: #e4dcd4 !important;
    background-repeat: repeat !important;
    box-shadow: rgba(0, 0, 0, 0.16) 0px 5px 40px !important;
}

#backToTopBtn:hover {
    /* Escurece um pouco ao passar o mouse */
    background: linear-gradient(47deg, #e69200, #e05300);
    transform: translateY(-3px); /* Efeito de elevação */
}
.modal-product-description {
    margin-top: 15px;
    margin-bottom: 20px;
    line-height: 1.7;
    white-space: pre-wrap; /* Respeita as quebras de linha e espaços */
}

/* =================================================================== */
/* ============== VERSÃO CORRIGIDA DO MODAL DE DESCRIÇÃO ============= */
/* =================================================================== */

/* --- Estilo Base (Desktop) --- */

.description-modal {
    display: none; /* Inicia escondido */
    position: fixed;
    z-index: 1002;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(10, 25, 47, 0.85);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    
    /* Animação suave na entrada/saída */
    opacity: 0;
    transition: opacity 0.3s ease;
    visibility: hidden;
}

.description-modal.is-visible {
    display: flex; /* Usamos Flex para centralizar o conteúdo */
    align-items: center;
    justify-content: center;
    opacity: 1;
    visibility: visible;
}

.description-modal-content {
    background: linear-gradient(120deg, #206958b8, #05a582a1);
    color: #e5e7eb;
    padding: 2.5rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
    width: 90%;
    max-width: 750px;
    border-radius: 16px;
    position: relative;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    
    /* Animação de entrada */
    transform: scale(0.95);
    transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
}

.description-modal.is-visible .description-modal-content {
    transform: scale(1);
}

.description-modal-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.1);
    color: #ff9900;
    border: none;
    border-radius: 50%;
    font-size: 1.5rem;
    line-height: 40px;
    text-align: center;
    cursor: pointer;
    transition: background-color 0.2s ease, transform 0.2s ease;
}

.description-modal-close:hover {
    background-color: rgba(255, 255, 255, 0.2);
    transform: rotate(90deg);
}

#descriptionModalTitle {
    font-size: 20px;
    font-weight: 600;
    color: #ffffff;
    margin: 0 0 1.5rem 0;
    padding-bottom: 1rem;
    border-bottom: 1px solid #4ecdc4;
}

#descriptionModalText {
    font-size: 1.1rem;
    line-height: 1.8;
    white-space: pre-wrap;
    color: #ffffff;
    max-height: 60vh; /* Altura máxima no desktop para evitar modais gigantes */
    overflow-y: auto; /* Adiciona scroll se o texto for muito longo */
}


/* --- Estilos de TELA CHEIA (Celular) --- */

@media (max-width: 768px) {
    .description-modal {
        backdrop-filter: none;
        -webkit-backdrop-filter: none;
    }

    .description-modal-content {
        /* Regras FORÇADAS para garantir a tela cheia */
        width: 100vw !important;
        height: 100vh !important;
        max-width: none !important;
        max-height: none !important;
        margin: 0 !important;
        border-radius: 0 !important;
        box-shadow: none !important;
        
        /* Layout flex para organizar título e texto */
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        padding: 0; /* Remove padding geral */
        transform: none !important; /* Desativa animação de escala */
    }

    #descriptionModalTitle {
        font-size: 1.5rem;
        padding: 4rem 1.5rem 1rem 1.5rem; /* Padding com espaço para o botão de fechar */
        margin: 0;
        flex-shrink: 0; /* Impede que o título encolha */
    }

    #descriptionModalText {
        padding: 0 1.5rem 1.5rem 1.5rem;
        overflow-y: auto;
        flex-grow: 1; /* Faz o texto ocupar todo o espaço restante */
        max-height: none; /* Remove a restrição de altura do desktop */
    }
    
    .description-modal-close {
        /* Posição fixa para ficar visível mesmo com scroll */
        position: fixed;
        top: 1rem;
        right: 1rem;
        z-index: 1003; /* Acima de todo o resto */
    }
}
.btn-details {
    background: linear-gradient(120deg, #9b59b6, #8e44ad);
    box-shadow: 0 0 15px #3498db70;
    margin-bottom: 20px;
    color: #fff;
}
.btn-details:hover {
    background: linear-gradient(120deg, #d35400, #f39c12);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
}
.featured-title {
    text-align: center;
    font-size: 2.2em;
    margin-bottom: 20px;
    color: #fff;
    text-shadow: 2px 2px 5px rgba(0,0,0,0.3);
}
/* Adicione este CSS na sua tag <style> */
.payment-options-container {
    display: flex;
    gap: 15px;
    margin-top: 10px;
}
.payment-option {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 15px;
    border: 2px solid var(--light-gray);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    background-color: rgba(255, 255, 255, 0.1);
}
.payment-option:hover {
    background-color: rgba(255, 255, 255, 0.2);
    border-color: var(--secondary-color);
}
.payment-option input[type="radio"] {
    display: none; /* Esconde o radio button padrão */
}
.payment-option input[type="radio"]:checked + i + span,
.payment-option input[type="radio"]:checked ~ i {
    color: var(--secondary-color); /* Apenas para visualização */
}
.payment-option input[type="radio"]:checked ~ label,
.payment-option input[type="radio"]:checked + label {
     border-color: var(--success-color);
     box-shadow: 0 0 10px var(--success-color);
}

/* Estilo para quando a opção está selecionada */
input[type="radio"]:checked + .payment-option {
    border-color: var(--success-color);
    box-shadow: 0 0 10px var(--success-color);
    background-color: rgba(46, 204, 113, 0.1);
}
.payment-option i {
    margin-right: 8px;
    font-size: 1.2em;
}
#featuredProductsCarousel {
    position: relative;
    overflow: hidden;
    margin-bottom: 20px;
    border-radius: 15px;
    text-align: center;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    box-sizing: border-box;
    box-shadow: 0 0 15px #ff6700;
    background: linear-gradient(231deg, #ffa200b3, #ff5d00a1);
    
    /* Adiciona uma altura mínima para que o skeleton seja visível */
    min-height: 450px; 
}

/* NOVO: Estilos para o estado de carregamento do carrossel */
#featuredProductsCarousel.loading {
    /* Mantém o fundo, mas podemos adicionar a animação */
    position: relative;
}

#featuredProductsCarousel.loading::before {
    content: '';
    position: absolute;
    top: 0;
    left: -150%;
    height: 100%;
    width: 150%;
    z-index: 1; /* Fica acima do fundo, mas abaixo do conteúdo */
    
    /* Mesmo efeito de brilho dos outros skeletons */
    background: linear-gradient(to right, transparent 0%, rgba(255, 255, 255, 0.2) 50%, transparent 100%);
    animation: pulse 1.8s infinite;
}

/* Esconde os botões de navegação enquanto carrega */
#featuredProductsCarousel.loading .carousel-nav {
    display: none;
}

    </style>
</head>

<body>
    <header style="position: relative;">
    <div id="minhalogo"></div>
    <h1 id="NomeDaLoja">Carregando...</h1>
    <p id="descricao">Carregando...</p>
    <div id="statusLoja"></div>

    <div style="display: flex;flex-direction: row-reverse;justify-content: space-between;">
        <button id="sairdaloja"><span>Troca id da loja</span></button>
        <button id="shareButton"><span>🔗Compartilhar</span></button>
    </div>

    </header>

    <div class="tela-ativada">
    <div class="container">
    <div class="products" id="products">
    <h2 class="featured-title">✨ Produtos em destaque  ✨</h2>


    <div id="featuredProductsCarousel">
        <div class="carousel-slide"></div>
        <div class="carousel-nav">
        <button id="prevBtn"><i class="fas fa-chevron-left"></i></button>
        <button id="nextBtn"><i class="fas fa-chevron-right"></i></button>
        </div>
    </div>

    <div class="form-group search-container">
    <input type="text" id="searchInput" placeholder="🔎 Pesquisar por nome do produto...">
    <div id="clearSearchBtn" class="clear-search-btn">&times;</div>
    </div>

    <div id="categoryFilters"></div>
    
    <h2 class="featured-title">Nossos Produtos</h2>
    <div id="productList">
        <p id="loadingMessage">Carregando produtos...</p>
    </div>

    <p id="errorMessage" class="hidden" style="color: rgb(255, 255, 255);"></p>
    <div class="pagination-buttons">
        <button id="btnAnterior" onclick="previousPage()" disabled><i class="fas fa-chevron-left"></i></button>
        <button id="btnInicio" onclick="goToPage(1)" disabled>Início</button>
        <button id="btnProximo" onclick="nextPage()" disabled><i class="fas fa-chevron-right"></i></button>
    </div>
    </div>

    <aside id="cartSection">
    <div class="tabs">
        <button class="tab-button active" data-tab="cart">Meu Carrinho</button>
        <button class="tab-button" data-tab="checkout">Checkout</button>
        <button class="tab-button" data-tab="orderHistory">Históricos</button>
    </div>

    <div id="cart" class="tab-content active">
        <h2>Seu Carrinho</h2>
        <ul id="cartList"></ul>
        <p>Total: <span id="cartTotal">R$ 0,00</span></p>
        <div class="button-group">
        <button class="ButtonFinalizarCompra" onclick="showTab('checkout')" id="proceedToCheckoutButton" disabled>Finalizar Compra</button>
        <button class="ButtonEsvaziarCarrinho" id="clearCartButton" onclick="clearCart()" disabled>Esvaziar Carrinho</button>
        </div>
    </div>

    <div id="checkout" class="tab-content">
        <h2>Detalhes da Entrega</h2>
        <form id="checkoutForm">
        <div class="form-group">
        <label for="Nome" class="required">Nome Completo</label>
        <input type="Nome" id="Nome" name="Nome" placeholder="Nome Completo" required>
        </div>

        <div class="form-group">
        <label for="Email" class="required">Email</label>
        <input type="email" id="Email" name="Email" placeholder="seu@email.com" required>
        </div>

        <div class="form-group">
        <label for="WhatsApp" class="required">WhatsApp</label>
        <input type="text" id="WhatsApp" name="WhatsApp" placeholder="(00) 90000-0000" required maxlength="15">
        </div>

        <div class="form-group">
        <label for="deliveryOption" class="required">Opção de Entrega</label>
        <select id="deliveryOption" name="deliveryOption" class="custom-select" required
        onchange="toggleAddressFields()">
        <option value="">Retirar no Local</option>
        <option value="delivery">Entrega em Domicílio</option>
        </select>
        <div id="avisoTaxaEntrega" class="aviso-taxa" style="display: none;"></div>
        </div>

        <div id="addressFields" style="display:none;">
        <div class="form-group">
        <label for="CEP" class="required">CEP</label>
        <input type="text" id="CEP" name="CEP" placeholder="00000-000" maxlength="9">
        </div>

        <div class="form-group">
        <label for="Endereço" class="required">Endereço</label>
        <input type="text" id="Endereço" name="Endereço" placeholder="Endereço Completo">
        </div>

        <div class="form-group">
        <label for="Cidade" class="required">Cidade</label>
        <input type="text" id="Cidade" name="Cidade" placeholder="Cidade" disabled>
        </div>

        <div class="form-group">
        <label for="Bairro" class="required">Bairro</label>
        <input type="text" id="Bairro" name="Bairro" placeholder="Bairro" disabled>
        </div>
        </div>

        <div class="form-group">
        <label for="additionalInfo">Informações Adicionais (opcional)</label>
        <textarea id="additionalInfo" name="additionalInfo"
        placeholder="Informações Adicionais (opcional)"></textarea>
        </div>

        <div id="carrinhocheckout">
        <h3>Resumo do Pedido</h3>
        <ul id="cartListCheckout"></ul>
        <hr>
        <!-- MODIFIQUE A SEÇÃO DO TOTAL PARA ISTO -->
        <p class="resumo-linha">Subtotal: <span id="TotalcartCheckout">R$ 0,00</span></p>
        <p id="linhaDesconto" class="resumo-linha" style="display: none;">Desconto: <span id="valorDescontoCheckout"> - R$ 0,00</span></p>
        <p id="linhaTaxaEnvio" class="resumo-linha" style="display: none;"><span id="taxaEnvioCheckout"> R$ 0,00</span></p>
        <h3 class="resumo-linha total-final">Total Final: <span id="totalFinalCheckout">R$ 0,00</span></h3>
        <!-- FIM DA MODIFICAÇÃO -->
        </div>

        <div id="cupomcheckout" class="form-group">
        <label for="cupomInput">Cupom de Desconto</label>
        <div style="display: flex; gap: 10px;">
        <input type="text" id="cupomInput" placeholder="Digite seu cupom">
        <button type="button" class="btnInicio" id="aplicarCupomBtn">Aplicar</button>
        </div>
        <p id="cupomStatus" style="margin-top: 5px; font-weight: bold;"></p>
        </div>

         
        <div class="form-group">
        <label class="required">Forma de Pagamento</label>
        <div class="payment-options-container">
        <label class="payment-option">
            <input type="radio" name="paymentMethod" value="pix" onchange="updatePaymentMethodUI()" checked>
            <i class="fas fa-qrcode"></i> Pix
        </label>
        <label class="payment-option">
            <input type="radio" name="paymentMethod" value="dinheiro" onchange="updatePaymentMethodUI()">
            <i class="fas fa-money-bill-wave"></i> Dinheiro
        </label>
        </div>
        </div>

        <!-- 2. MODIFIQUE o botão de finalização -->
        <div class="button-group">
    <!-- Mude o ID e o onclick deste botão -->
        <button class="ButtonFinalizarCompra" type="button" onclick="finalizarPedido()" id="finalizarPedidoBtn">Gerar QR Code Pix</button>
        </div>


    
        </form>
    </div>

    <div id="orderHistory" class="tab-content">
        <h2>Histórico de Pedidos</h2>
        <ul id="orderHistoryList"></ul>
        <!-- NOVO: Container para a paginação do histórico -->
        <div id="orderHistoryPagination" class="pagination-buttons"></div>
        <div class="button-group" style="display: none;">
            <button class="ButtonEsvaziarCarrinho" id="clearHistoryButton" onclick="clearOrderHistory()">Apagar Histórico</button>
        </div>
    </div>
    </aside>
    </div>
    </div>

    <div id="myModal" class="modal">
    <div class="modal-content">
    <button class="close-button" onclick="closeModal()">Fechar</button>
    <div id="qrCode"></div>
    </div>
    </div>

    <div id="horariosModal" class="horariosModal">
        <div class="modal-contenthorarios">
            <span class="close" onclick="closeModalhorarios()">×</span>
            <div id="horariosContent"></div>
        </div>
    </div>

<footer class="rodape">
    <div class="footer-content">
        <!-- Coluna 1: Contato e Endereço -->
        <div class="footer-column">
            <h4>Localização</h4>
            <div id="endereco-info">
                <p><strong>📍 Endereço:</strong></p>
                <p id="Endereço1"></p>
                <p id="Endereço2"></p>
                <p id="meucep"></p>
            </div>
        </div>

        <!-- Coluna 2: Links Úteis -->
        <div class="footer-column">
            <h4>Links Úteis</h4>
            <ul class="footer-links">
                <li><a id="politicaPrivacidadeLink" href="#" target="_blank">Política de Privacidade</a></li>
                <li><a id="termosUsoLink" href="#" target="_blank">Termos de Uso</a></li>
            </ul>
            <h4 style="margin-top: 20px;">Siga-nos</h4>
            <div id="redesSociaisDiv" class="social-icons">
                <!-- O JS vai esconder os que não tiverem link -->
                <a id="instagramLink" href="#" target="_blank" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                <a id="facebookLink" href="#" target="_blank" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                <a id="twitterLink" href="#" target="_blank" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                <a id="emailLink" href="#" target="_blank" aria-label="envelope"><i class="fa-solid fa-envelope"></i></a>
            </div>
        </div>

        <!-- Coluna 3: Informações -->
        <div class="footer-column">
            <h4>Pagamento e Horários</h4>
            <div>
                <strong>Formas de Pagamento:</strong>
                <div class="payment-icons">
                    <div class="pix-icon"><img src="pagamentos.files/imagens/pix-icon.png" alt="Pix"></div>
                </div>
            </div>
            <button id="openModalhorarios" onclick="openModalhorarios()"><span>Horário de funcionamento</span></button>
            <p id="avisonorodape" class="footer-notice">⚠️ Todas as vendas são feitas sob encomenda e conforme disponibilidade ⚠️</p>
        </div>
    </div>

    <!-- Seção Inferior do Rodapé -->
    <div class="footer-bottom">
        <p id="rodapedaloja">Todos os direitos reservados.</p>
    </div>
</footer>

    <div id="notification-container"></div>

    <div id="floating-cart" onclick="showTab('cart')">
    <i class="fas fa-shopping-cart cart-icon"></i>
    <span class="cart-count" id="floatingCartCount">0</span>
    </div>

    <div id="whatswidget-pre-wrapper" class="">
        <div id="whatswidget-widget-wrapper" class="whatswidget-widget-wrapper">
        <div id="whatswidget-conversation" class="whatswidget-conversation" style="display: none; opacity: 0;">
        <div class="whatswidget-conversation-header" style="all:revert;">
            <div id="whatswidget-conversation-title" class="whatswidget-conversation-title" style="all:revert;"><span id="nome1"></span></div>
        </div>
        <div id="whatswidget-conversation-message" class="whatswidget-conversation-message " style="all:revert;">Qualquer dúvida estou a disposição.</div>
        <div class="whatswidget-conversation-cta" style="all:revert; cursor: pointer;">
            <a style="all:revert;" id="whatswidget-phone-desktop" onclick="AbrirWhatsapp();" class="whatswidget-cta whatswidget-cta-desktop">Enviar mensagem</a>
            <a id="whatswidget-phone-mobile" onclick="AbrirWhatsapp();" class="whatswidget-cta whatswidget-cta-mobile" style="all:revert;">Enviar mensagem</a>
        </div>
        </div>
        
        <div class="whatswidget-button-wrapper" style="all:revert;">
        <div class="whatswidget-button" id="whatswidget-button" style="all:revert;">
            <div style="margin:0 auto;width:38.5px;all:revert;">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="rgba(255,255,255,1)"><path d="M7.25361 18.4944L7.97834 18.917C9.18909 19.623 10.5651 20 12.001 20C16.4193 20 20.001 16.4183 20.001 12C20.001 7.58172 16.4193 4 12.001 4C7.5827 4 4.00098 7.58172 4.00098 12C4.00098 13.4363 4.37821 14.8128 5.08466 16.0238L5.50704 16.7478L4.85355 19.1494L7.25361 18.4944ZM2.00516 22L3.35712 17.0315C2.49494 15.5536 2.00098 13.8345 2.00098 12C2.00098 6.47715 6.47813 2 12.001 2C17.5238 2 22.001 6.47715 22.001 12C22.001 17.5228 17.5238 22 12.001 22C10.1671 22 8.44851 21.5064 6.97086 20.6447L2.00516 22ZM8.39232 7.30833C8.5262 7.29892 8.66053 7.29748 8.79459 7.30402C8.84875 7.30758 8.90265 7.31384 8.95659 7.32007C9.11585 7.33846 9.29098 7.43545 9.34986 7.56894C9.64818 8.24536 9.93764 8.92565 10.2182 9.60963C10.2801 9.76062 10.2428 9.95633 10.125 10.1457C10.0652 10.2428 9.97128 10.379 9.86248 10.5183C9.74939 10.663 9.50599 10.9291 9.50599 10.9291C9.50599 10.9291 9.40738 11.0473 9.44455 11.1944C9.45903 11.25 9.50521 11.331 9.54708 11.3991C9.57027 11.4368 9.5918 11.4705 9.60577 11.4938C9.86169 11.9211 10.2057 12.3543 10.6259 12.7616C10.7463 12.8783 10.8631 12.9974 10.9887 13.108C11.457 13.5209 11.9868 13.8583 12.559 14.1082L12.5641 14.1105C12.6486 14.1469 12.692 14.1668 12.8157 14.2193C12.8781 14.2457 12.9419 14.2685 13.0074 14.2858C13.0311 14.292 13.0554 14.2955 13.0798 14.2972C13.2415 14.3069 13.335 14.2032 13.3749 14.1555C14.0984 13.279 14.1646 13.2218 14.1696 13.2222V13.2238C14.2647 13.1236 14.4142 13.0888 14.5476 13.097C14.6085 13.1007 14.6691 13.1124 14.7245 13.1377C15.2563 13.3803 16.1258 13.7587 16.1258 13.7587L16.7073 14.0201C16.8047 14.0671 16.8936 14.1778 16.8979 14.2854C16.9005 14.3523 16.9077 14.4603 16.8838 14.6579C16.8525 14.9166 16.7738 15.2281 16.6956 15.3913C16.6406 15.5058 16.5694 15.6074 16.4866 15.6934C16.3743 15.81 16.2909 15.8808 16.1559 15.9814C16.0737 16.0426 16.0311 16.0714 16.0311 16.0714C15.8922 16.159 15.8139 16.2028 15.6484 16.2909C15.391 16.428 15.1066 16.5068 14.8153 16.5218C14.6296 16.5313 14.4444 16.5447 14.2589 16.5347C14.2507 16.5342 13.6907 16.4482 13.6907 16.4482C12.2688 16.0742 10.9538 15.3736 9.85034 14.402C9.62473 14.2034 9.4155 13.9885 9.20194 13.7759C8.31288 12.8908 7.63982 11.9364 7.23169 11.0336C7.03043 10.5884 6.90299 10.1116 6.90098 9.62098C6.89729 9.01405 7.09599 8.4232 7.46569 7.94186C7.53857 7.84697 7.60774 7.74855 7.72709 7.63586C7.85348 7.51651 7.93392 7.45244 8.02057 7.40811C8.13607 7.34902 8.26293 7.31742 8.39232 7.30833Z"></path></svg> 
            </div>
        </div>
        </div>
        </div>
    </div>

        <!-- NOVO: Modal apenas para a Descrição do Produto -->
    <div id="descriptionModal" class="description-modal">
        <div class="description-modal-content">
        <dav class="description-modal-close" onclick="closeDescriptionModal()">&times;</dav>
        <h3 id="descriptionModalTitle"></h3>
        <div id="descriptionModalText" class="modal-product-description"></div>
        </div>
    </div>

    <button id="backToTopBtn" title="Voltar ao topo"><i class="fas fa-arrow-up"></i></button>

<script>
const Params = new URLSearchParams(window.location.search);
    let blog; // Declarar 'blog' aqui, sem inicializar

    // Função para obter e validar o ID da loja
    function obterIdLoja() {
        let blog = Params.get('id'); // Tenta obter o ID da URL
        
        const newUrl = window.location.pathname;
        window.history.replaceState({}, document.title, newUrl);

        if (blog) {
            const lojaLogada = localStorage.getItem('lojalogada');

            if (lojaLogada && lojaLogada !== blog) {
                localStorage.setItem('lojalogada', blog);
            } else if (!lojaLogada) {
                localStorage.setItem('lojalogada', blog);
            }
        } else {
            blog = localStorage.getItem('lojalogada'); // Tenta obter o ID do localStorage
        }
        return blog;
    }

    // Obtém e valida o ID da loja
    blog = obterIdLoja();

  let cart = JSON.parse(localStorage.getItem(blog + 'cart')) || [];
  let orderHistory = JSON.parse(localStorage.getItem(blog)) || [];
    let products = [];

    let carouselProducts = [];
    let MeuPix = '';
    let whatsapp = '';
    let horariosFuncionamento = '';
    let Endereço1 = '';
    let Endereço2 = '';
    let unidadefederativa = '';
    let cidade = '';
    let bairro = '';
    let emailEndereco = '';
    let instagramUsuario = '';
    let facebookPagina = '';
    let twitterUsuario = '';
    let politicaPrivacidadeURL = '';
    let termosUsoURL = '';
    let isOpen = false;
    let currentPage = 1;
    const productsPerPage = 10;
    let currentCategory = 'all';
    let nomedaloja = '';
    let descricao = '';
    let logotipo = '';
    let taxadeenvio = 0;
    let contatoHTML = '';
    var hashCupomParaVerificar = '';
    let cupomAplicado = null;
    // --- NOVAS VARIÁVEIS DE ESTADO PARA PAGINAÇÃO DO HISTÓRICO ---
    let orderHistoryCurrentPage = 1;
    const ordersPerPage = 10;


function updatePaymentMethodUI() {
    const metodoSelecionado = document.querySelector('input[name="paymentMethod"]:checked').value;
    const btnFinalizar = document.getElementById('finalizarPedidoBtn');

    if (metodoSelecionado === 'pix') {
        btnFinalizar.innerHTML = '<i class="fas fa-qrcode"></i> Gerar QR Code Pix';
        // Troca a classe para estilizar o botão (opcional)
        btnFinalizar.classList.remove('btnInicio');
        btnFinalizar.classList.add('ButtonFinalizarCompra');
    } else {
        btnFinalizar.innerHTML = '<i class="fas fa-hand-holding-usd"></i> Finalizar Pedido em Dinheiro';
        // Troca a classe para estilizar o botão (opcional)
        btnFinalizar.classList.remove('ButtonFinalizarCompra');
        btnFinalizar.classList.add('btnInicio');
    }
}


    document.addEventListener('DOMContentLoaded', function () {
    const carouselContainer = document.getElementById('featuredProductsCarousel');
    if (carouselContainer) {
        carouselContainer.classList.add('loading');
    }
        const productListElement = document.getElementById('productList');
    // Limpa a lista e mostra os skeletons
    productListElement.innerHTML = `
        <div class="product skeleton"></div>
        <div class="product skeleton"></div>
        <div class="product skeleton"></div>
        <div class="product skeleton"></div>
    `;

        if (!blog) {
            exibirModalErro("Digitar o id da loja", true, false, 'trocaid');
            return;
        }

    // Função que processa pagamentos sequencialmente
    async function processarPagamentos() {
        // Obtém o histórico uma vez
        const history = JSON.parse(localStorage.getItem(blog)) || [];
        const indicesAguardandoPagamento = history
            .map((order, index) => (order.Entregue === "" || order.Enviado === "" || order.StatusPedido === "Aguardando Pagamento") ? index : -1)
            .filter(index => index !== -1); // Filtra apenas os índices válidos

        for (let i = 0; i < indicesAguardandoPagamento.length; i++) {
            const index = indicesAguardandoPagamento[i];
            await verificarPagamento(index); 
        }
    }

    processarPagamentos(); // Inicia o processo de pagamento

    // Adiciona comportamento ao clique nas abas
    const tabButtons = document.querySelectorAll('.tab-button');
    tabButtons.forEach(button => {
        button.addEventListener('click', function () {
            const tabId = this.dataset.tab;
            showTab(tabId);
        });
    });

    verificarStatusDaLoja();
    updateCartDisplay();
    updateOrderHistoryDisplay();
    updateMiniCartCount();
    updateFloatingCartCount();
    updateFloatingCartAccessibilityLabel(); // Inicializa a label ARIA
    updatePaymentMethodUI();

    const trocaid = document.getElementById('sairdaloja');
        trocaid.addEventListener('click', function() {
        exibirModalErro("Digitar o id da loja", true, true, 'trocaid');
    });

});

function exibirModalErro(mensagem, comb, x, tipo = 'error') {
    // Verifica se já existe um modal e remove antes de criar outro
    let modalExistente = document.getElementById('modalErro');
    if (modalExistente) {
        modalExistente.remove();
    }

    // Criação do modal
    let modal2 = document.createElement('div');
    modal2.id = 'modalErro';

    // Criação do conteúdo do modal
    let conteudo = document.createElement('div');
    conteudo.className = "conteudo";
    formGroupHTML = '';
    if (comb) {
    // Cria o form-group com input e botão
    formGroupHTML = `
        <div class="form-group">
            <input type="text" id="addid" name="ADDid" placeholder="ID Da Loja">
        </div>
        <button class="ButtonFinalizarCompra" onclick="irParaLoja()">Ir para Loja</button>
    `;
    }

    // Adiciona os elementos ao conteúdo
    conteudo.innerHTML = `
        <h3>${tipo === 'error' ? '✖️ Erro' : '' || tipo === 'success' ? '✔️ Sucesso' : '' || tipo === 'trocaid' ? '🏪' : '' || tipo === 'aviso' ? '⚠️' : ''} </h3>
        <p>${mensagem}</p>
        ${formGroupHTML ? `${formGroupHTML}` : ``}
    `;

    // Adiciona o botão "Como criar um ID?" se `comb` for verdadeiro
    if (comb) {
        let botaoAjuda = document.createElement('a');
        botaoAjuda.href = "https://chat-meupix.blogspot.com/p/cria-sua-loja-virtual-com-meupix.html";
        botaoAjuda.target = "_blank";

        let botao = document.createElement('button');
        botao.className = "botaoAjuda";
        botao.innerText = "Como criar um ID?";
        botaoAjuda.appendChild(botao);
        conteudo.appendChild(botaoAjuda);
    }

    // Adiciona o botão "Fechar" se `x` for verdadeiro
    if (x) {
        let botaoFechar = document.createElement('button');
        botaoFechar.className = "botaoFechar";
        botaoFechar.innerText = "Fechar";
        botaoFechar.onclick = function () {
            modal2.remove();
        };

        conteudo.appendChild(botaoFechar);
    }

    // Adiciona a classe do tipo ao modal
    modal2.classList.add(tipo);
    modal2.appendChild(conteudo);
    document.body.appendChild(modal2);
}

function irParaLoja() {
        const idLoja = document.getElementById('addid').value;
        if (idLoja) {
            // Remove o 'id=' existente da URL
            let url = window.location.href.replace(/[?&]id=[^&#]+/i, '');
            // Adiciona o novo ID como parâmetro
            if (url.indexOf('?') > -1) {
                url += '&id=' + idLoja;
            } else {
                url += '?id=' + idLoja;
            }
            window.location.href = url;
        } else {
            showNotification("Por favor, insira o ID de loja.", 'error');
        }
    }

function verificarStatusDaLoja() {
    // 🔹 Remove qualquer script anterior antes de criar um novo
    const oldScript = document.getElementById('statusLojaScript');
    if (oldScript) oldScript.remove();

    // 🔹 Cria o novo script de forma controlada
    const script = document.createElement('script');
    script.id = 'statusLojaScript';
    script.src = `https://www.blogger.com/feeds/${blog}/pages/default?start-index=1&max-results=500&alt=json-in-script&callback=processarStatusDaLoja`;

    script.onerror = function () {
        exibirModalErro("ID do blog inválido.", true, false, 'error');
        script.remove(); // 🔹 remove em caso de erro
    };

    document.body.appendChild(script);
}

// 🔹 Callback principal
function processarStatusDaLoja(data) {
    try {
        let fechada = false;
        let manutencao = false;
        let ativahorario = false;
        let ativacupom = false;

        if (data && data.feed && data.feed.entry && data.feed.entry.length > 0) {
            nomedaloja = data.feed.title.$t;
            descricao = data.feed.subtitle.$t;

            document.querySelector('title').textContent = "Meu Pix - " + nomedaloja;
            document.getElementById('descricao').textContent = descricao;
            document.getElementById('NomeDaLoja').textContent = nomedaloja;
            document.getElementById('rodapedaloja').textContent = '© 2025 ' + nomedaloja + ' - Todos os direitos reservados.';

            const shareButton = document.getElementById('shareButton');
            shareButton.addEventListener('click', function () {
                const baseUrl = window.location.search;
                const shareUrl = `${baseUrl}?id=${blog}`;

                if (navigator.share) {
                    navigator.share({
                        title: nomedaloja,
                        text: descricao,
                        url: shareUrl
                    }).then(() => {
                        showNotification("Link de compartilhamento Gerado!", 'success');
                    }).catch(() => {
                        showNotification("Erro ao compartilhar: ", 'error');
                    });
                } else {
                    showNotification("Erro ao compartilhar: ", 'error');
                }
            });

            data.feed.entry.forEach(entry => {
                if (entry.content && entry.content.$t) {
                    const lines = entry.content.$t.split('\n');
                        lines.forEach(line => {
        line = line.replace(/<[^>]*>/g, '').trim();
    if (line.startsWith('fechada')) {
        fechada = line.includes('ativado');
    } else if (line.startsWith('manutenção')) {
        manutencao = line.includes('ativado');
    } else if (line.startsWith('ativacupom')) {
        ativacupom = line.includes('ativado');
    }  else if (line.startsWith('ativahorário')) {
        ativahorario = line.includes('ativado');
    } else if (line.startsWith('pix')) {
        Pix = line.split('pix =')[1].trim();
        MeuPix = Pix.replace(/&amp;/g, "&");
    } if (line.startsWith('whatsapp')) {
       whatsapp = line.split('=')[1].trim();
    } else if (line.startsWith('nome')) {
        nome = line.split('=')[1].trim();
        document.getElementById('nome1').textContent = nome;
    } else if (line.startsWith('horários')) {
        horariosFuncionamento = line.split('horários =')[1].trim();
    } else if (line.startsWith('logo')) {
        logotipo = line.split('logo =')[1].trim();
        var imagemContainer = document.getElementById('minhalogo');
        var imagemElemento = document.createElement('img');
        imagemElemento.setAttribute('src', logotipo);
        imagemElemento.setAttribute('width', '200');
        imagemElemento.setAttribute('height', '200');
        imagemContainer.appendChild(imagemElemento);
    } else if (line.startsWith('Endereço1')) {
        Endereço1 = line.split('Endereço1 =')[1].trim();
        const Endereço1id = document.getElementById("Endereço1");
        Endereço1id.innerHTML = `
         ${Endereço1 ? `<p>🏠 ${Endereço1}</p>` : `🏠 Carregando...`}
        `;
    } else if (line.startsWith('Endereço2')) {
        Endereço2 = line.split('Endereço2 =')[1].trim();
        const Endereço2id = document.getElementById("Endereço2");
        Endereço2id.innerHTML = `
         ${Endereço2 ? `<p>🏙️ ${Endereço2}</p>` : `🏙️ Carregando...`}
         `;
    } else if (line.startsWith('meucep')) {
        meucep = line.split('meucep =')[1].trim();
        const meucepid = document.getElementById("meucep");
        meucepid.innerHTML = `
        ${meucep ? `<p>📮 CEP: ${meucep}</p>` : `📮 CEP: Carregando...`}
        `;
    } else if (line.startsWith('unidadefederativa')) {
        unidadefederativa = line.split('unidadefederativa =')[1].trim();
    } else if (line.startsWith('cidade')) {
        cidade = line.split('cidade =')[1].trim();
    } else if (line.startsWith('bairro')) {
        bairro = line.split('bairro =')[1].trim();
    } else if (line.startsWith('emailEndereco')) {
        emailEndereco = line.split('emailEndereco =')[1].trim();
    } else if (line.startsWith('instagramUsuario')) {
        instagramUsuario = line.split('instagramUsuario =')[1].trim();
    } else if (line.startsWith('facebookPagina')) {
        facebookPagina = line.split('facebookPagina =')[1].trim();
    } else if (line.startsWith('twitterUsuario')) {
        twitterUsuario = line.split('twitterUsuario =')[1].trim();
    } else if (line.startsWith('facebookPagina')) {
        facebookPagina = line.split('facebookPagina =')[1].trim();
    } else if (line.startsWith('politicaPrivacidadeURL')) {
        politicaPrivacidadeURL = line.split('politicaPrivacidadeURL =')[1].trim();
    } else if (line.startsWith('termosUsoURL')) {
        termosUsoURL = line.split('termosUsoURL =')[1].trim();
    } else if (line.startsWith('taxadeenvio ')) {
    const valorTaxa = line.split('taxadeenvio =')[1].trim();
    taxadeenvio = parseFloat(valorTaxa.replace('R$', '').replace(',', '.').trim());
    } else if (line.startsWith('avisonorodape')) {
        avisonorodape = line.split('avisonorodape =')[1].trim();
        document.getElementById('avisonorodape').textContent = avisonorodape;
    }
                });
                }
            });

        atualizarInterface(fechada, manutencao, ativahorario);
        const emailLink = document.getElementById("emailLink");
        const instagramLink = document.getElementById("instagramLink");
        const facebookLink = document.getElementById("facebookLink");
        const twitterLink = document.getElementById("twitterLink");
        const politicaPrivacidadeLink = document.getElementById("politicaPrivacidadeLink");
        const termosUsoLink = document.getElementById("termosUsoLink");

        const sigaNosParagrafo = document.getElementById("sigaNosParagrafo");
        const redesSociaisDiv = document.getElementById("redesSociaisDiv");
        const instagramSeparator = document.getElementById("instagramSeparator");
        const facebookSeparator = document.getElementById("facebookSeparator");
        const twitterSeparator = document.getElementById("twitterSeparator");
        const privacidadeTermosParagrafo = document.getElementById("privacidadeTermosParagrafo");
        const privacidadeTermosSeparator = document.getElementById("privacidadeTermosSeparator");

        let contatoAdicionado = false;
        let redesSociaisAdicionadas = false;
        let privacidadeTermosAdicionados = false;

        // Função para verificar se uma string é vazia ou contém apenas espaços em branco
        function isEmpty(str) {
        return (!str || str.trim().length === 0);
    }

        const cupomForm = document.getElementById('cupomcheckout');
        if (!ativacupom && cupomForm) {
            cupomForm.style.display = 'none';
        } else if (ativacupom && cupomForm) {
            cupomForm.style.display = 'block';
        }

        // Função para remover o elemento e seu separador
        function removerRedeSocial(linkElement, separatorElement) {
        if (linkElement) {
        linkElement.parentNode.removeChild(linkElement);
    }
        if (separatorElement) {
        if (separatorElement.parentNode) { //verifica se o elemento pai existe
        separatorElement.parentNode.removeChild(separatorElement);
    }
    }
    }

        // Atualiza o link do Instagram, se o usuário for válido
        if (!isEmpty(instagramUsuario)) {
        instagramLink.href = `https://instagram.com/${instagramUsuario}`;
        redesSociaisAdicionadas = true;
    } else {
        removerRedeSocial(instagramLink, instagramSeparator);
    }

        // Atualiza o link do Facebook, se a página for válida
        if (!isEmpty(facebookPagina)) {
        facebookLink.href = `https://facebook.com/${facebookPagina}`;
        redesSociaisAdicionadas = true;
    } else {
        removerRedeSocial(facebookLink, facebookSeparator);
    }

        // Atualiza o link do Twitter, se o usuário for válido
        if (!isEmpty(twitterUsuario)) {
        twitterLink.href = `https://x.com/${twitterUsuario}`;
        redesSociaisAdicionadas = true;
    } else {
        removerRedeSocial(twitterLink, twitterSeparator);
    }

      // Atualiza o link do Facebook, se a página for válida
        if (!isEmpty(emailEndereco)) {
        emailLink.href = `mailto:${emailEndereco}`;
        redesSociaisAdicionadas = true;
    } else {
        removerRedeSocial(emailLink, facebookSeparator);
    }

        //Remove o siga-nos caso nenhuma rede social seja adicionada
        if (!redesSociaisAdicionadas) {
        removerRedeSocial(sigaNosParagrafo, null);
        removerRedeSocial(redesSociaisDiv, null);
    }

        // Remove o parágrafo de termos de privacidade se não houver links
        if (!isEmpty(politicaPrivacidadeURL)) {
        politicaPrivacidadeLink.href = politicaPrivacidadeURL;
        privacidadeTermosAdicionados = true;
    } else {
        removerRedeSocial(politicaPrivacidadeLink, null);
    }

        if (!isEmpty(termosUsoURL)) {
        termosUsoLink.href = termosUsoURL;
        privacidadeTermosAdicionados = true;
    } else {
        removerRedeSocial(termosUsoLink, null);
    }

        if (isEmpty(termosUsoURL) || isEmpty(politicaPrivacidadeURL)) {
        if (privacidadeTermosSeparator) {
        if (privacidadeTermosSeparator.parentNode) {
        privacidadeTermosSeparator.parentNode.removeChild(
            privacidadeTermosSeparator) //Remove a separação
    }

    }
    }

        if (!privacidadeTermosAdicionados) {
        if (privacidadeTermosParagrafo) {
        removerRedeSocial(privacidadeTermosParagrafo, null);
    }
    }
        }

        fetchProducts();
    } finally {
        // 🔹 Remove o script sempre, mesmo se der erro
        const script = document.getElementById('statusLojaScript');
        if (script) script.remove();
    }
}


function atualizarInterface(fechada, manutencao, ativahorario) {
    const telaAtivada = document.querySelector('.products');
    const cartTabButton = document.querySelector('.tab-button[data-tab="cart"]');
    const checkoutTabButton = document.querySelector('.tab-button[data-tab="checkout"]');
    const minecart = document.getElementById('floating-cart');

    function desativarInterface() {
    if (minecart) minecart.style.display = 'none';
    if (cartTabButton) {
        cartTabButton.classList.add('disabled-tab');
        cartTabButton.disabled = true;
        cartTabButton.style.display = 'none';
        document.getElementById('cart').style.display = 'none';
    }
    if (checkoutTabButton) {
        checkoutTabButton.classList.add('disabled-tab');
        checkoutTabButton.disabled = true;
        checkoutTabButton.style.display = 'none';
    }
    const featuredProductsCarousel = document.getElementById('featuredProductsCarousel');
    if (featuredProductsCarousel) featuredProductsCarousel.style.display = 'none';
    }

    if (fechada) {
    desativarInterface();
    desativarAbasCarrinho();
    clearCart();
    const LojaAberta = document.getElementById('statusLoja');
    LojaAberta.innerHTML = '<h1 class="loja-fechada">Loja fechada!</h1>';
    telaAtivada.innerHTML = `
    <div class="desativado">
    <h1>⚠️</h1>
    <p>A loja está temporariamente fechada. Por favor, volte mais tarde!</p>
    </div>
    `;
    } else if (manutencao) {
    desativarInterface();
    clearCart();
    const LojaAberta = document.getElementById('statusLoja');
    LojaAberta.innerHTML = '<h1 class="loja-fechada">Loja em Manutenção!</h1>';
    telaAtivada.innerHTML = `
    <div class="desativado">
    <h1>⚠️</h1>
    <p>Estamos trabalhando para melhorar sua experiência de compra. Por favor, volte mais tarde!</p>
    </div>
    `;
    } else if (ativahorario) {
    if (horariosFuncionamento) {
        getStoreStatus();
    }
    } else {
    isOpen = true;
    const LojaAberta = document.getElementById('statusLoja');
    LojaAberta.innerHTML = '<p class="loja-aberta">Loja aberta, Boas compras!</p>';
  ativarAbasCarrinho();
    // Loja aberta
    if (document.querySelector('.desativado')) {
        telaAtivada.innerHTML = ''; // Limpa a mensagem "Loja fechada"
    }
    if (minecart) minecart.style.display = 'flex'; 
    //Reativa o carrinho caso a loja volte a estar disponível
    if (cartTabButton) {
        cartTabButton.classList.remove('disabled-tab');
        cartTabButton.disabled = false;
        cartTabButton.style.display = 'block';
        document.getElementById('cart').style.display = 'block';
    }
    if (checkoutTabButton) {
        checkoutTabButton.classList.remove('disabled-tab');
        checkoutTabButton.disabled = false;
        checkoutTabButton.style.display = 'block';
    }
    const featuredProductsCarousel = document.getElementById('featuredProductsCarousel');
    if (featuredProductsCarousel) featuredProductsCarousel.style.display = 'block';
    }
}

function fetchProducts() {
    if (!isOpen) return;

    const errorMessage = document.getElementById('errorMessage');
    errorMessage.classList.add('hidden');

    // Remove qualquer script anterior (se existir)
    const oldScript = document.getElementById('scriptProdutos');
    if (oldScript) oldScript.remove();

    // Cria o script novo
    const script = document.createElement('script');
    script.id = 'scriptProdutos';
    script.src = 'https://www.blogger.com/feeds/' + blog + '/posts/default?start-index=1&max-results=500&alt=json-in-script&callback=processarProdutos';

    script.onerror = function () {
        errorMessage.textContent = 'A loja foi desativada ou o ID é inválido. Verifique novamente mais tarde.';
        errorMessage.classList.remove('hidden');

        // Esconde abas relacionadas
        const cartTabButton = document.querySelector('.tab-button[data-tab="cart"]');
        const checkoutTabButton = document.querySelector('.tab-button[data-tab="checkout"]');
        if (cartTabButton) cartTabButton.style.display = 'none';
        if (checkoutTabButton) checkoutTabButton.style.display = 'none';

        // Remove o script com erro
        script.remove();
    };

    document.body.appendChild(script);
}

// Callback
function processarProdutos(data) {
    const loadingMessage = document.getElementById('loadingMessage');

    try {
        products = [];
        carouselProducts = [];

        data.feed.entry.forEach(entry => {
            const product = parseProductFromEntry(entry);
            products.push(product);
            if (product.isCarousel) carouselProducts.push(product);
        });

        if (carouselProducts.length > 0) {
            initializeCarousel();
        } else {
            const carouselContainer = document.getElementById('featuredProductsCarousel');
            if (carouselContainer) {
                carouselContainer.style.display = 'none';
                carouselContainer.classList.remove('loading');
            }
        }

        displayCategoryFilters();
        displayProducts();
    } catch (error) {
        console.error("Erro ao processar produtos:", error);
    } finally {
        // Remove o script após processar (limpeza final)
        const script = document.getElementById('scriptProdutos');
        if (script) script.remove();
    }
}


function verificarDisponibilidadeProdutos() {
    // Retorna uma Promise para que possamos usar async/await
    return new Promise((resolve, reject) => {
        // Define uma função de callback global temporária
        window.verificarProdutosCallback = (data) => {
            const latestProducts = data.feed.entry.map(parseProductFromEntry);

            // --- INÍCIO DA MODIFICAÇÃO ---
            // 1. Atualiza as listas de produtos globais com os dados mais recentes.
            products = latestProducts;
            carouselProducts = latestProducts.filter(p => p.isCarousel);

            // 2. Redesenha a vitrine de produtos e o carrossel na tela.
            displayProducts();
            if (carouselProducts.length > 0) {
                initializeCarousel();
            }
            // --- FIM DA MODIFICAÇÃO ---


            let cartWasModified = false;
            const errorMessages = [];
            const updatedCart = [];

            cart.forEach(itemInCart => {
                const latestProduct = latestProducts.find(p => p.name === itemInCart.name);

                // Verificação 1: O produto ainda existe?
                if (!latestProduct || !latestProduct.available) {
                    cartWasModified = true;
                    errorMessages.push(`- O produto "${itemInCart.name}" não está mais disponível e foi removido.`);
                    return; // Pula para o próximo item do carrinho
                }

                // Verificação 2: A quantidade é válida?
                if (itemInCart.quantity > latestProduct.quantity) {
                    cartWasModified = true;
                    errorMessages.push(`- O estoque de "${itemInCart.name}" foi atualizado. Quantidade ajustada para ${latestProduct.quantity}.`);
                    itemInCart.quantity = latestProduct.quantity;
                }

                // Verificação 3: O preço mudou?
                if (itemInCart.price.toFixed(2) !== latestProduct.price.toFixed(2)) {
                    cartWasModified = true;
                    errorMessages.push(`- O preço de "${itemInCart.name}" mudou para ${realBR(latestProduct.price)}.`);
                    itemInCart.price = latestProduct.price;
                }

                updatedCart.push(itemInCart); // Adiciona o item (possivelmente modificado) ao novo carrinho
            });

            // Se o carrinho foi modificado, atualiza tudo e informa o usuário
            if (cartWasModified) {
                cart = updatedCart; // Substitui o carrinho antigo pelo atualizado
                localStorage.setItem(blog + 'cart', JSON.stringify(cart));
                updateCartDisplay();
                updateFloatingCartCount();
                
                const finalMessage = "Seu carrinho foi atualizado devido a mudanças no estoque ou preços:\n\n" + errorMessages.join('\n') + "\n\nPor favor, verifique antes de continuar.";
                exibirModalErro(finalMessage.replace(/\n/g, '<br>'), false, true, 'aviso');

                resolve(false); // Indica que a verificação falhou
            } else {
                resolve(true); // Indica que está tudo OK
            }

            // Limpeza: remove a função de callback e o script
            document.body.removeChild(document.getElementById('productVerificationScript'));
            delete window.verificarProdutosCallback;
        };

        // Cria e adiciona o script para a chamada JSONP
        const script = document.createElement('script');
        script.id = 'productVerificationScript';
        script.src = 'https://www.blogger.com/feeds/' + blog + '/posts/default?start-index=1&max-results=500&alt=json-in-script&callback=verificarProdutosCallback';
        script.onerror = () => {
            showNotification("Não foi possível verificar os produtos. Tente novamente.", 'error');
            reject(new Error("Falha ao carregar script de verificação."));
            document.body.removeChild(script);
            delete window.verificarProdutosCallback;
        };
        document.body.appendChild(script);
    });
}

function parseProductFromEntry(entry) {
    const entryTitle = entry.title.$t;
    const content = entry.content.$t;

    // Limpa a descrição removendo tags de imagem e outras HTML, mas mantendo quebras de linha
    const description = content
        .replace(/<img[^>]*>/g, "")           // Remove todas as tags <img>
        .replace(/<br\s*\/?>/ig, "\n")        // Converte <br> para quebras de linha
        .replace(/<[^>]*>?/gm, '')            // Remove o restante das tags HTML
        .replace(/&nbsp;/g, '')              // <-- CORREÇÃO ADICIONADA AQUI
        .trim();                              // Remove espaços em branco no início e no fim

    let imageUrls = [];
    const imgRegex = /<img.*?src="(.*?)"/g;
    let imgMatch;

    while ((imgMatch = imgRegex.exec(content)) !== null) {
        imageUrls.push(imgMatch[1]);
    }

    let price = 0;
    let originalPrice = 0;
    let discount = 0;
    let sizes = [];
    let sabor = [];
    let quantity = 0;
    let isCarousel = false;
    let categories = [];

    if (entry.category && Array.isArray(entry.category)) {
        isCarousel = entry.category.some(cat => cat.term.toLowerCase() === 'carousel');
        entry.category.forEach(cat => {
            const term = cat.term;
            if (term.startsWith('R$')) {
                price = parseFloat(term.replace('R$ ', '').replace(',', '.'));
            } else if (term.toLowerCase().startsWith('tamanho/')) {
                sizes = term.substring('tamanho/'.length).split('/');
            } else if (term.toLowerCase().startsWith('sabor/')) {
                sabor = term.substring('sabor/'.length).split('/');
            } else if (term.toLowerCase().startsWith('quantidade/')) {
                quantity = parseInt(term.substring('quantidade/'.length));
            } else if (term.toLowerCase().startsWith('desconto/')) {
                discount = parseInt(term.substring('desconto/'.length));
            } else if (term.toLowerCase().startsWith('categorias/')) {
                categories = term.substring('categorias/'.length).split('/').filter(c => c.trim() !== '');
            }
        });
    }

    const discountedPrice = price * (1 - (discount / 100));

    return {
        name: entryTitle,
        description: description, // <-- NOVA PROPRIEDADE ADICIONADA
        price: discountedPrice,
        originalPrice: price,
        imageUrls: imageUrls,
        sizes: sizes,
        sabor: sabor,
        quantity: quantity,
        discount: discount,
        available: quantity > 0,
        categories: categories,
        isCarousel: isCarousel
    };
}

// Função para criar e exibir os botões de filtro de categoria
function displayCategoryFilters() {
    const filtersContainer = document.getElementById('categoryFilters');
    if (!filtersContainer) return;

    // Extrai todas as categorias únicas de todos os produtos
    const allCategories = new Set();
    products.forEach(p => {
        if (p.categories && p.categories.length > 0) {
            p.categories.forEach(cat => allCategories.add(cat));
        }
    });

    // Limpa filtros antigos e cria o botão "Todos"
    filtersContainer.innerHTML = '';
    const allButton = document.createElement('button');
    allButton.textContent = 'Todos';
    allButton.classList.add('category-button', 'active'); // 'Todos' é ativo por padrão
    allButton.onclick = () => filterByCategory('all');
    filtersContainer.appendChild(allButton);

    // Cria um botão para cada categoria encontrada
    allCategories.forEach(category => {
        const button = document.createElement('button');
        button.textContent = category;
        button.classList.add('category-button');
        button.onclick = () => filterByCategory(category);
        filtersContainer.appendChild(button);
    });
}

// Função para lidar com o clique em um botão de categoria
function filterByCategory(category) {
    currentCategory = category; // Atualiza a categoria global
    currentPage = 1; // Volta para a primeira página ao filtrar

    // Atualiza qual botão está com a classe 'active'
    document.querySelectorAll('#categoryFilters .category-button').forEach(button => {
        if (button.textContent === category || (category === 'all' && button.textContent === 'Todos')) {
            button.classList.add('active');
        } else {
            button.classList.remove('active');
        }
    });

    displayProducts(); // Re-renderiza a lista de produtos com o filtro aplicado
}

function displayProducts() {
    const productListElement = document.getElementById('productList');
    const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
    productListElement.innerHTML = '';

    const filteredProducts = products.filter(product => {
        if (!product.available) return false;
        const matchesCategory = currentCategory === 'all' || (product.categories && product.categories.includes(currentCategory));
        const matchesSearch = product.name.toLowerCase().includes(searchTerm);
        return matchesCategory && matchesSearch;
    });

    if (filteredProducts.length === 0) {
        productListElement.innerHTML = '<p style="text-align: center; width: 100%;">Nenhum produto encontrado com esses filtros.</p>';
        updatePaginationButtons(0);
        return;
    }

    const startIndex = (currentPage - 1) * productsPerPage;
    const endIndex = startIndex + productsPerPage;
    const currentProducts = filteredProducts.slice(startIndex, endIndex);

    currentProducts.forEach(product => {
        const productDiv = document.createElement('article');
        productDiv.classList.add('product');

        // --- Image Slider ---
        const imageSliderContainer = document.createElement('div');
        imageSliderContainer.classList.add('image-slider-container');
        const imageSlider = document.createElement('div');
        imageSlider.classList.add('image-slider');
        imageSlider.dataset.currentSlide = 0;

        product.imageUrls.forEach(imageUrl => {
            const img = document.createElement('img');
            img.src = imageUrl;
            img.alt = product.name;
            img.loading = 'lazy';
            img.classList.add('slider-image');
            img.addEventListener('click', () => openFullscreenImage(imageUrl));
            imageSlider.appendChild(img);
        });

        if (product.imageUrls.length > 1) {
            const prevButton = document.createElement('button');
            prevButton.classList.add('slider-button', 'prev');
            prevButton.innerHTML = '<i class="fas fa-chevron-left"></i>';
            prevButton.addEventListener('click', () => prevSlide(imageSlider));
            const nextButton = document.createElement('button');
            nextButton.classList.add('slider-button', 'next');
            nextButton.innerHTML = '<i class="fas fa-chevron-right"></i>';
            nextButton.addEventListener('click', () => nextSlide(imageSlider));
            imageSliderContainer.appendChild(prevButton);
            imageSliderContainer.appendChild(nextButton);
        }
        imageSliderContainer.appendChild(imageSlider);
        productDiv.appendChild(imageSliderContainer);

        const sizesHTML = (product.sizes?.length > 0) ? `
            <label for="sizeSelect_${sanitizeId(product.name)}">Tamanho:</label>
            <select id="sizeSelect_${sanitizeId(product.name)}" class="custom-select">
                ${product.sizes.map(size => `<option value="${size}">${size}</option>`).join('')}
            </select>` : '';

        const saborHTML = (product.sabor?.length > 0) ? `
            <label for="saborSelect_${sanitizeId(product.name)}">Sabor:</label>
            <select id="saborSelect_${sanitizeId(product.name)}" class="custom-select">
                ${product.sabor.map(s => `<option value="${s}">${s}</option>`).join('')}
            </select>` : '';

        const quantityHTML = `
            <label for="quantitySelect_${sanitizeId(product.name)}">Quantidade:</label>
            <select id="quantitySelect_${sanitizeId(product.name)}" class="custom-select">
                ${Array.from({ length: product.quantity }, (_, i) => i + 1).map(qty => `<option value="${qty}">${qty}</option>`).join('')}
            </select>`;

        const discountBadgeHTML = product.discount > 0 ? `<div class="discount-badge">-${product.discount}%</div>` : '';

        // ATENÇÃO: A descrição foi REMOVIDA daqui para não quebrar o layout.
        const infoHTML = `
            ${discountBadgeHTML}
            <h3>${product.name}</h3>
            <p>${
                product.discount > 0
                    ? `De <strike class="backgroundred">R$ ${product.originalPrice.toFixed(2)}</strike> Por <span class="backgroundverde">${realBR(product.price.toFixed(2))}</span>`
                    : `<span class="backgroundverde">${realBR(product.price.toFixed(2))}</span>`
            }</p>
            <div class="button-group-carousel">
                ${sizesHTML}
                ${saborHTML}
                ${quantityHTML}
            </div>
        `;

        productDiv.insertAdjacentHTML('beforeend', infoHTML);

        const productDivs = document.createElement('div');
        productDivs.classList.add('button-group-carousel');

        if (product.description && product.description.trim().length > 0) {
            const detailsButton = document.createElement('button');
            detailsButton.className = 'btn-details'; // Usando uma nova classe para estilizar
            detailsButton.textContent = 'Veja todos os detalhes';
            detailsButton.onclick = () => showDescriptionModal(product.name);
            productDivs.appendChild(detailsButton);
        }
        
        productDivs.appendChild(CriaBotaoAdicionarAoCarrinho(product));
        productDivs.appendChild(CriaBotaoComprarAgora(product));
        
        productDiv.appendChild(productDivs);

        productListElement.appendChild(productDiv);

        const spacer = document.createElement('div');
        spacer.style.marginBottom = '20px';
        productListElement.appendChild(spacer);
    });

    updatePaginationButtons(filteredProducts.length);
}

function showDescriptionModal(productName) {
    const product = products.find(p => p.name === productName);
    if (!product) return;

    const modal = document.getElementById('descriptionModal');
    const modalTitle = document.getElementById('descriptionModalTitle');
    const modalText = document.getElementById('descriptionModalText');

    modalTitle.textContent = product.name;
    modalText.innerHTML = product.description.replace(/\n/g, '<br>'); 

    modal.classList.add('is-visible');
}

function closeDescriptionModal() {
    const modal = document.getElementById('descriptionModal');

    modal.classList.remove('is-visible');
}

// Atualize sua função window.onclick para fechar este novo modal também
window.onclick = function(event) {
    const productModal = document.getElementById('productDetailModal'); // Se você ainda tiver o modal antigo
    const horariosModal = document.getElementById("horariosModal");
    const descriptionModal = document.getElementById("descriptionModal"); // Novo modal
    
    if (event.target == productModal) {
        closeProductDetails();
    }
    if (event.target == horariosModal) {
        closeModalhorarios();
    }
    // Adiciona a verificação para o novo modal
    if (event.target == descriptionModal) {
        closeDescriptionModal();
    }
}

// --- Slider Functions (com checagem e dataset por slider) ---
function nextSlide(slider) {
    const images = slider.querySelectorAll('.slider-image');
    if (images.length === 0) return;
    let currentSlide = parseInt(slider.dataset.currentSlide, 10) || 0;
    currentSlide = (currentSlide + 1) % images.length;
    slider.dataset.currentSlide = currentSlide;
    slider.style.transform = `translateX(-${currentSlide * 100}%)`;
}

function prevSlide(slider) {
    const images = slider.querySelectorAll('.slider-image');
    if (images.length === 0) return;
    let currentSlide = parseInt(slider.dataset.currentSlide, 10) || 0;
    currentSlide = (currentSlide - 1 + images.length) % images.length;
    slider.dataset.currentSlide = currentSlide;
    slider.style.transform = `translateX(-${currentSlide * 100}%)`;
}

// --- utilitário para ids seguros (substitui espaços e chars inválidos) ---
function sanitizeId(name) {
    return String(name).replace(/\s+/g, '_').replace(/[^A-Za-z0-9_\-]/g, '');
}
    // Função para criar o botão "Adicionar ao Carrinho"
    function CriaBotaoAdicionarAoCarrinho(product) {
    const button = document.createElement('button');
    button.classList.add('add-to-cart-button');
    button.textContent = 'Adicionar ao Carrinho';
    button.onclick = () => AdicionaraoCarrinho(product); // Chama a função Adicionar ao Carrinho
    return button;
}

function openFullscreenImage(imageUrl) {
    // Cria o overlay
    const overlay = document.createElement('div');
    overlay.classList.add('fullscreen-overlay');

    // Cria a imagem em fullscreen
    const fullscreenImg = document.createElement('img');
    fullscreenImg.src = imageUrl;
    fullscreenImg.classList.add('fullscreen-image');

    // Botão fechar
    const closeBtn = document.createElement('span');
    closeBtn.classList.add('close-btn');
    closeBtn.innerHTML = '&times;';
    closeBtn.addEventListener('click', () => overlay.remove());

    // Fecha clicando fora da imagem também
    overlay.addEventListener('click', e => {
        if (e.target === overlay) overlay.remove();
    });

    overlay.appendChild(fullscreenImg);
    overlay.appendChild(closeBtn);
    document.body.appendChild(overlay);
}

function AdicionaraoCarrinho(product) {
    // Obtém as opções selecionadas dos selects
    const selectedQuantity = document.getElementById(`quantitySelect_${sanitizeId(product.name)}`) ? document.getElementById(`quantitySelect_${sanitizeId(product.name)}`).value : 1;
    const selectedSize = document.getElementById(`sizeSelect_${sanitizeId(product.name)}`) ? document.getElementById(`sizeSelect_${sanitizeId(product.name)}`).value : '';
    const selectedSabor = document.getElementById(`saborSelect_${sanitizeId(product.name)}`) ? document.getElementById(`saborSelect_${sanitizeId(product.name)}`).value : '';

    ComprarProdutos(product, selectedQuantity, selectedSize, selectedSabor, false);
}
    // Função para criar o botão "Comprar Agora"
function CriaBotaoComprarAgora(product) {
    const button = document.createElement('button');
    button.classList.add('buy-now-button');
    button.textContent = 'Comprar Agora';
    button.onclick = () => ComprarAgora(product); // Chama a função buyNow
    return button;
}

function ComprarAgora(product) {
    // Obtém as opções selecionadas dos selects
    const selectedQuantity = document.getElementById(`quantitySelect_${sanitizeId(product.name)}`) ? document.getElementById(`quantitySelect_${sanitizeId(product.name)}`).value : 1;
    const selectedSize = document.getElementById(`sizeSelect_${sanitizeId(product.name)}`) ? document.getElementById(`sizeSelect_${sanitizeId(product.name)}`).value : '';
    const selectedSabor = document.getElementById(`saborSelect_${sanitizeId(product.name)}`) ? document.getElementById(`saborSelect_${sanitizeId(product.name)}`).value : '';

    // Chama a função auxiliar, indicando para redirecionar para o checkout
    ComprarProdutos(product, selectedQuantity, selectedSize, selectedSabor, true);
}

// Função auxiliar para padronizar a adição/atualização do carrinho
function ComprarProdutos(product, selectedQuantity, selectedSize, selectedSabor, redirectToCheckout = false) {
    if (!product) {
        showNotification("Produto não encontrado.", 'error');
        return;
    }

    // Validações
    if (product.sizes && product.sizes.length > 0 && selectedSize === "") {
        showNotification("Por favor, selecione um tamanho.", 'error');
        return;
    }

    if (product.sabor && product.sabor.length > 0 && selectedSabor === "") {
        showNotification("Por favor, selecione um Sabor.", 'error');
        return;
    }

    if (!selectedQuantity || parseInt(selectedQuantity) <= 0) {
        showNotification("Por favor, selecione uma quantidade válida.", 'error');
        return;
    }

    selectedQuantity = parseInt(selectedQuantity);

    // Encontra o índice de um item *com as mesmas características*
    const existingItemIndex = cart.findIndex(item =>
        item.name === product.name &&
        item.selectedSize === selectedSize &&
        item.selectedsabor === selectedSabor
    );

    if (existingItemIndex > -1) {
        // O produto já existe no carrinho com as mesmas opções de tamanho e sabor
        const existingItem = cart[existingItemIndex];

        if (existingItem.quantity === selectedQuantity) {
            showNotification("Produto já adicionado no carrinho com a mesma quantidade!", 'error');
        } else {
            existingItem.quantity = selectedQuantity;
            showNotification("Quantidade do produto atualizada no carrinho!", 'atualizado');
        }

    } else {
        // O produto não existe no carrinho com essas opções, então adicione-o
        cart.push({
            name: product.name,
            price: product.price,
            quantity: selectedQuantity,
            imageUrl: product.imageUrls[0],
            selectedSize: selectedSize,
            selectedsabor: selectedSabor
        });
        showNotification("Item adicionado ao carrinho!", 'success');
    }

    localStorage.setItem(blog + 'cart', JSON.stringify(cart));
    updateCartDisplay();
    updateMiniCartCount();
    updateFloatingCartCount();
    updateFloatingCartAccessibilityLabel();

    if (redirectToCheckout) {
        showTab('checkout');
    }
}

    function removeFromCart(index) {
    cart.splice(index, 1);
    localStorage.setItem(blog + 'cart', JSON.stringify(cart));
    updateCartDisplay();
    updateMiniCartCount();
    updateFloatingCartCount();
    updateFloatingCartAccessibilityLabel();
    showNotification("Item removido do carrinho!", 'success');
}

function updateCartDisplay() {
    // --- 1. Seleciona todos os elementos do DOM que serão manipulados ---
    // Abas principais
    const cartList = document.getElementById('cartList');
    const cartTotalElement = document.getElementById('cartTotal');
    const cartListCheckout = document.getElementById('cartListCheckout');
    
    // Resumo do Pedido no Checkout
    const subtotalCheckoutEl = document.getElementById('TotalcartCheckout');
    const linhaDescontoEl = document.getElementById('linhaDesconto');
    const valorDescontoEl = document.getElementById('valorDescontoCheckout');
    const linhaTaxaEnvioEl = document.getElementById('linhaTaxaEnvio');
    const taxaEnvioEl = document.getElementById('taxaEnvioCheckout');
    const totalFinalEl = document.getElementById('totalFinalCheckout');
    const carrinhoCheckoutDiv = document.getElementById('carrinhocheckout');

    // Botões de Ação
    const proceedToCheckoutButton = document.getElementById('proceedToCheckoutButton');
    const clearCartButton = document.getElementById('clearCartButton');
    const finalizarPedidoBtn = document.getElementById('finalizarPedidoBtn');

    // --- 2. Limpa as listas para evitar itens duplicados na tela ---
    cartList.innerHTML = '';
    cartListCheckout.innerHTML = '';
    
    // --- 3. Calcula o subtotal iterando sobre os itens do carrinho ---
    let subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

    // --- 4. Renderiza cada item do carrinho na tela ---
    cart.forEach((item, index) => {
        const itemTotal = item.price * item.quantity;
        const optionsString = [item.selectedSize, item.selectedsabor].filter(Boolean).join(' / ');

        // HTML para a aba "Meu Carrinho" (com controles completos)
        const li = document.createElement('li');
        li.classList.add('cart-item');
        li.innerHTML = `
            <img src="${item.imageUrl}" alt="${item.name}">
            <div class="cart-item-info">
                <span class="item-name">${item.name}</span>
                ${optionsString ? `<span class="item-options">${optionsString}</span>` : ''}
                <strong class="item-price">${realBR(itemTotal)}</strong>
            </div>
            <div class="cart-quantity-controls">
                <div class="quantity-controls-wrapper">
                    <button class="quantity-btn decrease" onclick="decreaseCartItemQuantity(${index})">-</button>
                    <span class="quantity-display">${item.quantity}</span>
                    <button class="quantity-btn increase" onclick="increaseCartItemQuantity(${index})">+</button>
                </div>
                <dav class="trash-btn" onclick="removeFromCart(${index})" title="Remover item">
                    <i class="fas fa-trash-alt"></i>
                </dav>
            </div>
        `;
        cartList.appendChild(li);

        // HTML para a aba "Checkout" (resumo simples)
        const liCheckout = document.createElement('li');
        liCheckout.classList.add('cart-item'); // Reutiliza o estilo se quiser
        liCheckout.innerHTML = `
            <img src="${item.imageUrl}" alt="${item.name}" width="50" height="50">
            <span>${item.name} ${optionsString ? `(${optionsString})` : ''} (x${item.quantity})</span>
            <strong>${realBR(itemTotal)}</strong>
        `;
        cartListCheckout.appendChild(liCheckout);
    });

    // --- 5. Lógica de Cálculo de Descontos e Taxas ---
    let desconto = 0;
    
    // Calcula o desconto do cupom, se houver um válido aplicado
    
if (cupomAplicado && subtotal > 0) {
    if (cupomAplicado.tipo === 'percentual') {
        desconto = subtotal * (cupomAplicado.valor / 100);
    } else if (cupomAplicado.tipo === 'fixo') {
        desconto = cupomAplicado.valor;
        // Garante que o desconto não seja maior que o subtotal
        if (desconto > subtotal) desconto = subtotal;
    }

    // Só mostra se o desconto for maior que 0
    if (desconto > 0) {
        linhaDescontoEl.style.display = 'block';
        valorDescontoEl.textContent = `- ${realBR(desconto)}`;
    } else {
        linhaDescontoEl.style.display = 'none';
    }

} else {
    linhaDescontoEl.style.display = 'none'; // Esconde a linha do desconto
}

    // Calcula a taxa de entrega
    const deliveryOption = document.getElementById('deliveryOption').value;
    let taxaDeEntregaAplicada = 0;

    if (deliveryOption === 'delivery' && taxadeenvio > 0) {
        if (cupomAplicado && cupomAplicado.tipo === 'frete') {
            taxaEnvioEl.innerHTML = `Taxa de Entrega: <span style="text-decoration: line-through; color: #e74c3c;"> ${realBR(taxadeenvio)}</span> <span style="color: var(--success-color);">Grátis!</span>`;
        } else {
            taxaDeEntregaAplicada = taxadeenvio;
            taxaEnvioEl.textContent = 'Taxa de Entrega: ' + realBR(taxadeenvio);
        }
        linhaTaxaEnvioEl.style.display = 'flex'; // Mostra a linha da taxa
    } else {
        linhaTaxaEnvioEl.style.display = 'none'; // Esconde a linha da taxa
    }

    // --- 6. Calcula o Total Final ---
    let totalFinal = subtotal - desconto + taxaDeEntregaAplicada;
    
    // Garante que o total nunca seja negativo
    if (totalFinal < 0) {
        totalFinal = 0;
    }

    // --- 7. Atualiza todos os valores na interface ---
    cartTotalElement.textContent = realBR(subtotal);
    subtotalCheckoutEl.textContent = realBR(subtotal);
    totalFinalEl.textContent = realBR(totalFinal);

    // --- 8. Gerencia o estado dos botões e da visibilidade do resumo ---
    const cartHasItems = cart.length > 0;
    
    // Habilita/desabilita botões
    proceedToCheckoutButton.disabled = !cartHasItems;
    clearCartButton.disabled = !cartHasItems;
    finalizarPedidoBtn.disabled = !cartHasItems;

    // Mostra ou esconde o resumo do pedido no checkout
    carrinhoCheckoutDiv.style.display = cartHasItems ? 'block' : 'none';

    // --- 9. Atualiza outros elementos da UI, como o carrinho flutuante ---
    updateMiniCartCount(); // Se você ainda tiver esse elemento
    updateFloatingCartCount();
    updateFloatingCartAccessibilityLabel();
}
function updateMiniCartCount() {
    const miniCartCount = document.getElementById('miniCartCount');
    if (miniCartCount) { // Check if the element exists
    let totalItems = 0;
    cart.forEach(item => {
        totalItems += item.quantity;
});
    miniCartCount.textContent = totalItems;
} else {}
}

function updateFloatingCartCount() {
    const floatingCartCount = document.getElementById('floatingCartCount');
    if (floatingCartCount) { // Check if the element exists
    let totalItems = 0;
    cart.forEach(item => {
        totalItems += item.quantity;
});
    floatingCartCount.textContent = totalItems;
} else {}

}

function updateFloatingCartAccessibilityLabel() {
    const floatingCart = document.getElementById('floating-cart');
    const cartCount = cart.reduce((sum, item) => sum + item.quantity,
    0); //Soma a quantidade total de itens
    floatingCart.setAttribute('aria-label',
    `Carrinho de Compras (itens: ${cartCount}). Clique para ver o carrinho.`);
}

async function generateHash(value) {
    const encoder = new TextEncoder();
    const data = encoder.encode(value);
    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map(byte => byte.toString(16).padStart(2, '0')).join('');
}

async function finalizarPedido() {
    // --- Validação dos campos do formulário (seu código existente) ---
    const deliveryOption = document.getElementById('deliveryOption').value;
    let requiredFields = ['Nome', 'Email', 'WhatsApp'];
    if (deliveryOption === 'delivery') {
        requiredFields = requiredFields.concat(['CEP', 'Endereço', 'Cidade', 'Bairro']);
    }
    const missingFields = requiredFields.filter(field => !document.getElementById(field).value);
    if (missingFields.length > 0) {
        showNotification(`Por favor, preencha os campos: ${missingFields.join(', ')}.`, 'error');
        return;
    }
    // ...outras validações que você tem...

    if (cart.length === 0) {
        showNotification("Carrinho de compras vazio!", 'error');
        return;
    }
    
    // Verificação de estoque antes de prosseguir
    try {
        const isCartValid = await verificarDisponibilidadeProdutos();
        if (!isCartValid) {
            return; 
        }
    } catch (error) {
        showNotification("Erro ao verificar o estoque. Tente novamente.", 'error');
        return;
    }
    
    try {
        const idPagamentos = generatePaymentId();
        const paymentHash = idPagamentos;
        
        // --- 1. Recalcula o subtotal (base para todos os outros cálculos) ---
        const metodoPagamento = document.querySelector('input[name="paymentMethod"]:checked').value;
        const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        let valorDesconto = 0;
        let cupomInfo = null; // Objeto para salvar no histórico

        if (cupomAplicado && subtotal > 0) {
            if (cupomAplicado.tipo === 'percentual') {
                valorDesconto = subtotal * (cupomAplicado.valor / 100);
            } else if (cupomAplicado.tipo === 'fixo') {
                valorDesconto = cupomAplicado.valor;
                if (valorDesconto > subtotal) valorDesconto = subtotal;
            }
            // Guarda a informação do cupom que foi usado
            cupomInfo = {
                codigoHash: cupomAplicado.hash, // Salva o hash para referência
                valor: cupomAplicado.valor,
                tipo: cupomAplicado.tipo,
                codigoOriginal: cupomAplicado.codigoOriginal
            };
        }

        // --- 3. Calcula a taxa de entrega ---
        let taxaAplicada = 0;
        if (deliveryOption === 'delivery' && taxadeenvio > 0) {
            // Se o cupom NÃO for de frete, aplica a taxa
            if (!cupomAplicado || cupomAplicado.tipo !== 'frete') {
                taxaAplicada = taxadeenvio;
            } else {
                 // Se for cupom de frete, guarda a informação
                 cupomInfo = {
                    codigoHash: cupomAplicado.hash,
                    valor: cupomAplicado.valor,
                    tipo: 'frete',
                    codigoOriginal: cupomAplicado.codigoOriginal
                 };
            }
        }

        // --- 4. Calcula o VALOR FINAL para o Pix e para o histórico ---
        let valorFinal = subtotal - valorDesconto + taxaAplicada;
        if (valorFinal < 0) valorFinal = 0;

        const valor = valorFinal.toFixed(2);
        const dataCompra = new Date().toLocaleDateString();

        const produtosnopix = JSON.stringify(cart.map(item => ({
            name: item.name,
            price: item.price,
            quantity: item.quantity,
            imageUrl: item.imageUrl,
            selectedSize: item.selectedSize || '',
            selectedsabor: item.selectedsabor || '',
        })));

        const nomeCliente = document.getElementById('Nome').value;
        const emailCliente = document.getElementById('Email').value;
        const telefoneCliente = document.getElementById('WhatsApp').value;
        const infoAdicional = document.getElementById('additionalInfo').value;

        // --- 2. Monta a string dos itens do pedido ---
        const itensPedidoString = cart.map(item => {
            const optionsString = [item.selectedSize, item.selectedsabor].filter(Boolean).join(' / ');
            const itemTotal = item.price * item.quantity;
            return `${item.name} ${optionsString ? `(${optionsString})` : ''} (x${item.quantity}) - ${realBR(itemTotal)}`;
        }).join('\n');

        // --- 3. Monta a string do endereço de entrega ou retirada ---
        const entregaString = deliveryOption === 'delivery'
            ? `*Endereço de Entrega:*\n${document.getElementById('Endereço').value}, ${document.getElementById('Bairro').value}, ${document.getElementById('Cidade').value} - CEP: ${document.getElementById('CEP').value}`
            : `*Opção de Entrega:*\nRetirada no Local`;

        // --- 4. Constrói a mensagem final usando um array e join() para mais legibilidade ---
        const messageParts = [
            `*✨ Novo Pedido Realizado! ✨*`,
            `*Pedido:* #${idPagamentos}`,
            `-----------------------------------`,
            `*Dados do Cliente:*`,
            `*Nome:* ${nomeCliente}`,
            `*Email:* ${emailCliente}`,
            `*Telefone:* ${telefoneCliente}`,
            infoAdicional ? `*Info Adicional:* ${infoAdicional}` : null,
            `-----------------------------------`,
            entregaString,
            `-----------------------------------`,
            `*Itens do Pedido:*`,
            itensPedidoString,
            `-----------------------------------`,
            `*Resumo Financeiro:*`,
            `*Forma de Pagamento:* ${metodoPagamento === 'pix' ? 'Pix' : 'Dinheiro'}`,
            `*Subtotal:* ${realBR(subtotal)}`
        ];

        // Adiciona a linha de desconto SOMENTE se ele for maior que zero
        if (valorDesconto > 0) {
            // AQUI ESTÁ A MUDANÇA
            const codigoCupom = cupomAplicado && cupomAplicado.codigoOriginal ? `(Cupom: ${cupomAplicado.codigoOriginal})` : '';
            messageParts.push(`*Desconto:* - ${realBR(valorDesconto)} ${codigoCupom}`);
        }
        
        // Adiciona a linha da taxa de entrega
        if (deliveryOption === 'delivery') {
            if (cupomAplicado && cupomAplicado.tipo === 'frete') {
                // E AQUI TAMBÉM
                const codigoCupom = cupomAplicado.codigoOriginal || '';
                messageParts.push(`*Taxa de Entrega:* Frete Grátis (Cupom: ${codigoCupom})`);
            } else if (taxaAplicada > 0) {
                messageParts.push(`*Taxa de Entrega:* ${realBR(taxaAplicada)}`);
            }
        }
        
        messageParts.push(`*TOTAL:* *${realBR(valor)}*`);
        messageParts.push(`*Data:* ${dataCompra}`);

        const whatsappMessage = messageParts.filter(part => part !== null).join('\n');

        const pedidowhatsapp = `https://wa.me/${whatsapp}?text=${encodeURIComponent(whatsappMessage)}`;

        const order = {
            id: idPagamentos,
            paymentHash: paymentHash,
            isPago: false,
            Pagamento: '',
            Enviado: '',
            StatusButton: true,
            StatusPedido: 'Aguardando Pagamento',
            Entregue: '',
            produtos: produtosnopix,
            pedidowhatsapp: pedidowhatsapp,
            items: cart.map(item => ({
                name: item.name,
                price: item.price,
                quantity: item.quantity,
                imageUrl: item.imageUrl,
                selectedSize: item.selectedSize || '',
                selectedsabor: item.selectedsabor || '',
            })),
            subtotal: subtotal.toFixed(2),
            desconto: valorDesconto.toFixed(2), 
            cupomUtilizado: cupomInfo,        
            deliveryFee: taxaAplicada.toFixed(2),
            total: valor, 
            metodoPagamento: metodoPagamento,
            pixUrl: '',
            timestamp: Date.now(),
            deliveryOption: deliveryOption,
            address: {
                name: document.getElementById('Nome').value,
                address: document.getElementById('Endereço').value,
                city: document.getElementById('Cidade').value,
                bairro: document.getElementById('Bairro').value,
                postcode: document.getElementById('CEP').value,
                email: document.getElementById('Email').value,
                phone: document.getElementById('WhatsApp').value,
                additionalInfo: document.getElementById('additionalInfo').value
            }
        };

        if (metodoPagamento === 'pix') {

            const paramschaves = `${MeuPix}&valor=${valor}&txid=${idPagamentos}&logo=${logotipo}&idadaloja=${blog}&iddopagamento=${idPagamentos}`;
            const dadospix = btoa(paramschaves);
            order.pixUrl = `index.html?codepix=${dadospix}`; 

            // Salva o pedido no histórico
            orderHistory.push(order);
            localStorage.setItem(blog, JSON.stringify(orderHistory));
            
            // Mostra o modal do QR Code
            document.getElementById('myModal').classList.add('fullscreen');
            document.getElementById('qrCode').innerHTML = `<iframe src='${order.pixUrl}' style="width:100%; height:100%; border:none;"></iframe>`;
            openModal();
            showNotification("QR Code Pix gerado!", 'success');

        } else { // (metodoPagamento === 'dinheiro')

            orderHistory.push(order);
            localStorage.setItem(blog, JSON.stringify(orderHistory));

             window.open(pedidowhatsapp, '_blank');
            // Mostra uma mensagem de confirmação para o cliente
            const mensagemConfirmacao = `Pedido #${order.id} registrado com sucesso! \n\nPor favor, tenha o valor de ${realBR(order.total)} pronto para o pagamento na entrega/retirada. \n\nNão esqueça de enviar o pedido no nosso WhatsApp.`;
            exibirModalErro(mensagemConfirmacao.replace(/\n/g, '<br>'), false, true, 'success');
        }
        
        cupomAplicado = null;
        document.getElementById('cupomInput').value = '';
        document.getElementById('cupomStatus').textContent = '';
        
        clearCart();
        updateOrderHistoryDisplay();
        showTab('orderHistory');
        
    } catch (error) {
        console.error("Erro ao finalizar pedido:", error);
        showNotification("Erro ao finalizar o pedido. Tente novamente.", 'error');
    }
}



function openModal() {
    document.getElementById('myModal').style.display = 'block';
}

function closeModal() {
    document.getElementById('myModal').style.display = 'none';
    document.getElementById('myModal').classList.remove('fullscreen'); // Remove a classe fullscreen ao fechar
    document.getElementById('qrCode').innerHTML = '';
}

function clearCart() {
    cart = [];
    localStorage.removeItem(blog + 'cart');
    cupomAplicado = null;
    document.getElementById('cupomInput').value = '';
    document.getElementById('cupomStatus').textContent = '';
    updateCartDisplay();
    updateMiniCartCount();
    updateFloatingCartCount();
    updateFloatingCartAccessibilityLabel();
    showNotification("Carrinho esvaziado!", 'success');
}

// ===========================================
// === NOVA FUNÇÃO PARA ABRIR/FECHAR PEDIDO ==
// ===========================================
function toggleOrderDetails(headerElement) {
    const orderItem = headerElement.closest('.order-item');
    if (orderItem) {
        orderItem.classList.toggle('open');
    }
}

// ===========================================
// === FUNÇÃO DO HISTÓRICO ATUALIZADA ========
// ===========================================
function updateOrderHistoryDisplay() {
    const orderHistoryList = document.getElementById('orderHistoryList');
    const clearHistoryButton = document.getElementById('clearHistoryButton');
    orderHistoryList.innerHTML = '';

    const history = JSON.parse(localStorage.getItem(blog)) || [];

    if (history.length === 0) {
        orderHistoryList.textContent = "Nenhum pedido no histórico.";
        clearHistoryButton.style.display = 'none';
        renderOrderHistoryPagination(0); // Limpa a paginação
        return;
    }
    
    clearHistoryButton.style.display = 'block';

    const reversedHistory = [...history].reverse();

    // Lógica de Paginação
    const startIndex = (orderHistoryCurrentPage - 1) * ordersPerPage;
    const endIndex = startIndex + ordersPerPage;
    const paginatedOrders = reversedHistory.slice(startIndex, endIndex);

    paginatedOrders.forEach((order) => {
        const li = document.createElement('li');
        li.classList.add('order-item');

        const metodoPagamentoTexto = (order.metodoPagamento === 'pix' ? 'Pix' : (order.metodoPagamento === 'dinheiro' ? 'Dinheiro' : 'N/A'));
        const addressData = order.address || {};
        const nomeCliente = addressData.name || "Cliente não informado";
        const emailCliente = addressData.email || "E-mail não informado";
        const telefoneCliente = addressData.phone || "Telefone não informado";
        const infoAdicional = addressData.additionalInfo || "Nenhuma";
        const enderecoCompleto = addressData.address ? `${addressData.address}, ${addressData.city || ''} - ${addressData.bairro || ''}, ${addressData.postcode || ''}` : 'Endereço não disponível';

        const itemsList = (order.items && order.items.length > 0) ? order.items.map(item => {
            const itemTotal = (item.price || 0) * (item.quantity || 1);
            return `<li><img src="${item.imageUrl}" alt="${item.name}" width="40" height="40" style="vertical-align: middle; border-radius: 5px; margin-right: 10px;"> ${item.name} (Qtd: ${item.quantity}) ${item.selectedSize ? `(Tamanho: ${item.selectedSize})` : ``} ${item.selectedsabor ? `(sabor: ${item.selectedsabor})` : ``} - <strong>${realBR(itemTotal)}</strong></li>`;
        }).join('') : "<li>Nenhum item encontrado.</li>";

        let resumoFinanceiroHTML = `<p><strong>Subtotal:</strong> ${realBR(order.subtotal)}</p>`;
        if (order.desconto && parseFloat(order.desconto) > 0) {
            resumoFinanceiroHTML += `<p style="color: green;"><strong>Desconto Aplicado:</strong> - ${realBR(order.desconto)}</p>`;
        }
        if (order.cupomUtilizado && order.cupomUtilizado.tipo === 'frete') {
            resumoFinanceiroHTML += `<p style="color: green;"><strong>Cupom de Frete Grátis Utilizado</strong></p>`;
        }
        if (order.deliveryFee && parseFloat(order.deliveryFee) > 0) {
            resumoFinanceiroHTML += `<p><strong>Taxa de Entrega:</strong> ${realBR(order.deliveryFee)}</p>`;
        }
        resumoFinanceiroHTML += `<h4 style="margin-top: 10px;">Total Final: ${realBR(order.total)}</h4>`;

        let enderecoHTML = '';
        let buttonRetirada = '';

        if (order.deliveryOption === 'delivery') {
            enderecoHTML = `<p><strong>Endereço de Entrega:</strong> ${enderecoCompleto}</p>`;
        } else {
                enderecoHTML = `<p><strong>Opção de Entrega:</strong> Retirada no Local</p>`;
                buttonRetirada = `<button onclick="goToAddress()"><i class="fa-solid fa-map-location-dot"></i> Ver Endereço de Retirada</button>`;
        }

        const originalIndex = history.findIndex(h => h.id === order.id);

        li.innerHTML = `
            <div class="order-header" onclick="toggleOrderDetails(this)">
                <div>
                    <h3>#${order.id}</h3>
                    <small>${new Date(order.timestamp).toLocaleString()}</small>
                </div>
                <div class="status-display">
                   ${order.StatusButton === false ? `<span class='cancelado-falha'>Cancelado</span>` : `${order.Entregue ? `<span class='pago-success'>${order.Entregue}</span>` : `${order.Enviado ? `<span class='pago-success'>${order.Enviado}</span>` : `${order.Pagamento ? `<span class='pago-success'>${order.Pagamento}</span>` : `<span class='aguardando-paga'>Aguardando Pagamentos</span>`}`}`}`}
                <i class="fas fa-chevron-down toggle-icon"></i>
                   </div>
            </div>
            <div class="order-content">
                <p><strong>Nome:</strong> ${nomeCliente}</p>
                <p><strong>Email:</strong> ${emailCliente}</p>
                <p><strong>Telefone:</strong> ${telefoneCliente}</p>
                ${enderecoHTML}
                <p><strong>Informações Adicionais:</strong> ${infoAdicional}</p>
                <hr>
                <h4>Itens Comprados:</h4>
                <ul style="list-style: none; padding-left: 0;">${itemsList}</ul>
                <hr>
                <h4>Resumo Financeiro:</h4>
                <p><strong>Forma de Pagamento:</strong> ${metodoPagamentoTexto}</p>
                ${resumoFinanceiroHTML}
                <div class="button-container">
                    ${ order.StatusButton === false ? 
                        `<button onclick="AbrirWhatsapp();"><i class="fa-brands fa-whatsapp"></i> Entrar em contato</button>
                         <button onclick="deleteOrderFromHistory(${originalIndex})">🗑️ Excluir do Histórico</button>` 
                        :
                        `${order.isPago ? `${buttonRetirada}` : ``}
                         ${metodoPagamentoTexto === 'Pix' && !order.isPago ? `<button onclick="showPixQrCode(${originalIndex})"><i class="fas fa-qrcode"></i> Ver QR Code Pix</button>` : ''}
                         ${!order.isPago ? `<button onclick="verificarPagamento(${originalIndex})"><i class="fa fa-check-to-slot"></i> Verificar Pagamento</button>` : ''}
                         ${!order.isPago ? `<button onclick="resendWhatsappMessage(${originalIndex})"><i class="fa-brands fa-whatsapp"></i> Reenviar Pedido no WhatsApp</button>` : ''}
                         ${order.isPago ? `<button onclick="printOrder(${originalIndex})">🖨️ Imprimir Pedido</button>` : ``}
                         <button onclick="deleteOrderFromHistory(${originalIndex})">🗑️ Excluir do Histórico</button>`
                    }
                </div>
            </div>
        `;
        orderHistoryList.appendChild(li);
    });

    renderOrderHistoryPagination(reversedHistory.length);
    
    // Limpa o formulário de checkout após o pedido ser adicionado ao histórico
    if (document.getElementById('Nome')) {
        document.getElementById('Nome').value = '';
        document.getElementById('Endereço').value = '';
        document.getElementById('Cidade').value = '';
        document.getElementById('Email').value = '';
        document.getElementById('WhatsApp').value = '';
        document.getElementById('CEP').value = '';
        document.getElementById('Bairro').value = '';
        document.getElementById('additionalInfo').value = '';
        document.getElementById('deliveryOption').value = '';
        toggleAddressFields();
    }
}

// =========================================================
// === NOVAS FUNÇÕES PARA CONTROLAR A PAGINAÇÃO ============
// =========================================================
function renderOrderHistoryPagination(totalOrders) {
    const paginationContainer = document.getElementById('orderHistoryPagination');
    paginationContainer.innerHTML = '';

    const totalPages = Math.ceil(totalOrders / ordersPerPage);

    if (totalPages <= 1) {
        return; // Não mostra a paginação se houver apenas uma página
    }

    // Botão Anterior
    const prevButton = document.createElement('button');
    prevButton.innerHTML = '<i class="fas fa-chevron-left"></i> Anterior';
    prevButton.disabled = orderHistoryCurrentPage === 1;
    prevButton.onclick = () => changeOrderHistoryPage(-1);
    paginationContainer.appendChild(prevButton);

    // Indicador de página
    const pageIndicator = document.createElement('span');
    pageIndicator.textContent = `Página ${orderHistoryCurrentPage} de ${totalPages}`;
    pageIndicator.style.margin = '0 15px';
    pageIndicator.style.fontWeight = 'bold';
    paginationContainer.appendChild(pageIndicator);
    
    // Botão Próximo
    const nextButton = document.createElement('button');
    nextButton.innerHTML = 'Próximo <i class="fas fa-chevron-right"></i>';
    nextButton.disabled = orderHistoryCurrentPage >= totalPages;
    nextButton.onclick = () => changeOrderHistoryPage(1);
    paginationContainer.appendChild(nextButton);
}

function changeOrderHistoryPage(direction) {
    orderHistoryCurrentPage += direction;
    updateOrderHistoryDisplay(); // Re-renderiza a lista e a paginação
    document.getElementById('orderHistory').scrollIntoView({ behavior: 'smooth' });
}


function deleteOrderFromHistory(index) {
    let history = JSON.parse(localStorage.getItem(blog)) || [];

    if (index >= 0 && index < history.length) {
        const removedOrder = history[index];

        history.splice(index, 1); 
        localStorage.setItem(blog, JSON.stringify(history));
        updateOrderHistoryDisplay();
        showNotification(`Pedido #${removedOrder.id} foi excluído com sucesso!`, 'error');
    } else {
        showNotification("Erro ao excluir o pedido. Tente novamente.", 'error');
    }
}

// Função para imprimir um pedido
function printOrder(index) {
    const history = JSON.parse(localStorage.getItem(blog)) || [];
    const order = history[index];

    if (!order) {
        showNotification("Erro: Pedido não encontrado para impressão.", "error");
        return;
    }

    // --- 1. Extrai e formata os dados do pedido de forma segura ---

    const addressData = order.address || {};
    const enderecoCompleto = addressData.address ? `${addressData.address}, ${addressData.bairro || ''}, ${addressData.city || ''} - CEP: ${addressData.postcode || ''}` : 'Não aplicável';
    const metodoPagamento = order.metodoPagamento === 'pix' ? 'Pix' : (order.metodoPagamento === 'dinheiro' ? 'Dinheiro na Entrega/Retirada' : 'Não informado');

    // Monta a lista de itens
    const itemsListHTML = (order.items && order.items.length > 0) ? order.items.map(item => {
        const itemTotal = (item.price || 0) * (item.quantity || 1);
        const optionsString = [item.selectedSize, item.selectedsabor].filter(Boolean).join(' / ');
        return `
            <tr class="item-row">
                <td><img src="${item.imageUrl}" alt="${item.name}" class="item-image"></td>
                <td>
                    ${item.name}
                    ${optionsString ? `<br><small>(${optionsString})</small>` : ''}
                </td>
                <td class="text-center">${item.quantity || 1}</td>
                <td class="text-right">${realBR(item.price || 0)}</td>
                <td class="text-right">${realBR(itemTotal)}</td>
            </tr>`;
    }).join('') : '<tr><td colspan="5">Nenhum item no pedido.</td></tr>';

    // Monta o resumo financeiro, incluindo descontos
    let resumoFinanceiroHTML = `
        <tr>
            <td colspan="4" class="text-right"><strong>Subtotal</strong></td>
            <td class="text-right">${realBR(order.subtotal || 0)}</td>
        </tr>
    `;

    if (order.desconto && parseFloat(order.desconto) > 0) {
        const codigoCupom = (order.cupomUtilizado && order.cupomUtilizado.codigoOriginal) ? ` (${order.cupomUtilizado.codigoOriginal})` : '';
        resumoFinanceiroHTML += `
            <tr class="desconto-row">
                <td colspan="4" class="text-right"><strong>Desconto${codigoCupom}</strong></td>
                <td class="text-right">- ${realBR(order.desconto)}</td>
            </tr>`;
    }

    if (order.deliveryFee && parseFloat(order.deliveryFee) > 0) {
        resumoFinanceiroHTML += `
            <tr>
                <td colspan="4" class="text-right"><strong>Taxa de Entrega</strong></td>
                <td class="text-right">${realBR(order.deliveryFee)}</td>
            </tr>`;
    } else if (order.cupomUtilizado && order.cupomUtilizado.tipo === 'frete') {
         const codigoCupom = (order.cupomUtilizado && order.cupomUtilizado.codigoOriginal) ? ` (${order.cupomUtilizado.codigoOriginal})` : '';
        resumoFinanceiroHTML += `
            <tr class="desconto-row">
                <td colspan="4" class="text-right"><strong>Taxa de Entrega${codigoCupom}</strong></td>
                <td class="text-right">Grátis</td>
            </tr>`;
    }
    
    resumoFinanceiroHTML += `
        <tr class="total-row">
            <td colspan="4" class="text-right"><strong>Total a Pagar</strong></td>
            <td class="text-right"><strong>${realBR(order.total || 0)}</strong></td>
        </tr>
    `;

    // --- 2. Abre uma nova janela e escreve o HTML otimizado para impressão ---

    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
        <html>
        <head>
            <title>Pedido #${order.id} - ${nomedaloja}</title>
            <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
            <style>
                body { font-family: 'Poppins', sans-serif; color: #333; margin: 20px; }
                .invoice-box { max-width: 800px; margin: auto; padding: 30px; border: 1px solid #eee; box-shadow: 0 0 10px rgba(0, 0, 0, .15); font-size: 16px; }
                .header { text-align: center; margin-bottom: 20px; }
                .header img { max-width: 150px; max-height: 150px; }
                .header h1 { margin: 10px 0 0; color: #333; }
                .section { margin-bottom: 20px; }
                .section h2 { font-size: 1.2em; border-bottom: 2px solid #eee; padding-bottom: 5px; margin-bottom: 10px; }
                .details-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
                .details-grid p { margin: 0; }
                table { width: 100%; line-height: inherit; text-align: left; border-collapse: collapse; }
                table th { background: #eee; font-weight: 700; padding: 8px; }
                table td { padding: 8px; border-bottom: 1px solid #eee; }
                .item-image { width: 34px; height: 34px; object-fit: cover; border-radius: 5px; vertical-align: middle; }
                .text-center { text-align: center; }
                .text-right { text-align: right; }
                .summary-table td { border: none; }
                .desconto-row { color: #27ae60; }
                .total-row { border-top: 2px solid #333; font-size: 1.2em; }
                .footer { text-align: center; margin-top: 30px; font-size: 0.9em; color: #777; }
                .descricao { font-family: helvetica; color: #333; display: block; margin-block-start: 1em; }
                @media print {
                    body { -webkit-print-color-adjust: exact; margin: 0; }
                    .invoice-box { box-shadow: none; border: none; padding: 0; }
                }
            </style>
        </head>
        <body>
            <div class="invoice-box">
                <div class="header">
                    ${logotipo ? `<img src="${logotipo}" alt="${nomedaloja}">` : ''}
                    <h1>${nomedaloja}</h1>
                <div class="descricao">
                ${descricao ? `<strong>${descricao}</strong>` : ``}
                </div>
                    <p>Pedido #${order.id}</p>
                </div>

                <div class="section">
                    <h2>Detalhes do Pedido</h2>
                    <div class="details-grid">
                        <p><strong>Data do Pedido:</strong> ${new Date(order.timestamp).toLocaleString('pt-BR')}</p>
                        <p><strong>Forma de Pagamento:</strong> ${metodoPagamento}</p>
                    </div>
                </div>

                <div class="section">
                    <h2>Informações do Cliente</h2>
                    <p><strong>Nome:</strong> ${addressData.name || 'N/A'}</p>
                    <p><strong>Email:</strong> ${addressData.email || 'N/A'}</p>
                    <p><strong>Telefone:</strong> ${addressData.phone || 'N/A'}</p>
                    <p><strong>${order.deliveryOption === 'delivery' ? 'Endereço de Entrega:' : 'Opção de Entrega:'}</strong> ${order.deliveryOption === 'delivery' ? enderecoCompleto : 'Retirada no Local'}</p>
                    ${addressData.additionalInfo ? `<p><strong>Observações:</strong> ${addressData.additionalInfo}</p>` : ''}
                </div>

                <div class="section">
                    <h2>Itens do Pedido</h2>
                    <table>
                        <thead>
                            <tr>
                                <th colspan="2">Produto</th>
                                <th class="text-center">Qtd.</th>
                                <th class="text-right">Preço Unit.</th>
                                <th class="text-right">Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsListHTML}
                        </tbody>
                    </table>
                </div>

                <div class="section">
                    <h2>Resumo Financeiro</h2>
                    <table class="summary-table">
                        <tbody>
                            ${resumoFinanceiroHTML}
                        </tbody>
                    </table>
                </div>

                <div class="footer">
                    Obrigado pela sua preferência!
                </div>
            </div>
        </body>
        </html>
    `);

    printWindow.document.close();
    // Um pequeno timeout garante que a página carregue antes de chamar a impressão
    setTimeout(() => {
        printWindow.print();
    }, 500);
}

async function verificarPagamento(index) {
    const history = JSON.parse(localStorage.getItem(blog)) || [];

    if (!blog) {
        showNotification("Blog não definido. Verifique as configurações.", 'error');
        return;
    }

    if (index >= 0 && index < history.length) {
        const order = history[index];
        const paymentHash = order.paymentHash;
        const iddopagamento = order.id;

        // 🔹 Antes de criar um novo script, remove qualquer antigo
        const oldScript = document.getElementById('verificacaoPagamentoScript');
        if (oldScript) oldScript.remove();

        // 🔹 Cria o novo script
        const script = document.createElement('script');
        script.id = 'verificacaoPagamentoScript';
        script.src = `https://www.blogger.com/feeds/${blog}/pages/default?alt=json-in-script&callback=processarVerificacaoPagamento`;

        script.onerror = () => {
            showNotification("Erro ao obter os dados de pagamento.", 'error');
            script.remove(); // remove o script em caso de erro
        };

        // 🔹 Define o callback
        window.processarVerificacaoPagamento = (data) => {
            try {
                if (data && data.feed && data.feed.entry) {
                    let paymentFound = false;

                    data.feed.entry.forEach(entry => {
                        if (entry.content && entry.content.$t) {
                            const lines = entry.content.$t.split('\n').map(line => line.replace(/<[^>]*>/g, '').trim());

                            for (const line of lines) {
                                const match = line.match(new RegExp(`${paymentHash}\\s+(\\w+)`));

                                if (match) {
                                    const status = match[1].trim();

                                    if (status === 'Cancelado') {
                                        history[index].StatusButton = false;
                                        history[index].StatusPedido = 'Cancelado';
                                        history[index].Enviado = ' ';
                                        history[index].Pagamento = ' ';
                                        history[index].Entregue = ' ';
                                        history[index].isPago = false;
                                        showNotification(`Pedido #${iddopagamento} foi Cancelado.`, 'error');
                                        paymentFound = true;

                                    } else if (order.Entregue === '' && status === 'Entregue') {
                                        history[index].Entregue = 'Entregue';
                                        history[index].Pagamento = 'Pago';
                                        history[index].StatusPedido = 'Pago';
                                        history[index].isPago = true;
                                        showNotification(`Pedido #${iddopagamento} Pago e foi entregue.`, 'atualizado');
                                        paymentFound = true;

                                    } else if (order.Enviado === '' && status === 'Enviado') {
                                        history[index].Enviado = 'Enviado';
                                        history[index].Pagamento = 'Pago';
                                        history[index].StatusPedido = 'Pago';
                                        history[index].isPago = true;
                                        showNotification(`Pedido #${iddopagamento} Pago e foi enviado.`, 'atualizado');
                                        paymentFound = true;

                                    } else if (order.StatusPedido === 'Aguardando Pagamento' && status === 'Pago') {
                                        history[index].isPago = true;
                                        history[index].Pagamento = 'Pago';
                                        history[index].StatusPedido = 'Pago';
                                        showNotification(`Pagamento #${iddopagamento} concluído com sucesso!`, 'success');
                                        paymentFound = true;
                                    }
                                }
                            }
                        }
                    });

                    if (!paymentFound && order.StatusPedido === "Aguardando Pagamento") {
                        showNotification(`Estamos aguardando a confirmação do seu pagamento #${iddopagamento}. Assim que recebermos a confirmação, você será notificado.`, 'aguardando');
                    }

                    localStorage.setItem(blog, JSON.stringify(history));
                    updateOrderHistoryDisplay();

                } else {
                    showNotification("Erro ao processar os dados da API.", 'error');
                }
            } finally {
                // 🔹 Sempre remove o script após o uso (mesmo em caso de erro)
                const s = document.getElementById('verificacaoPagamentoScript');
                if (s) s.remove();
            }
        };

        document.body.appendChild(script);

        // Pequeno delay para simular tempo de rede (opcional)
        await new Promise(resolve => setTimeout(resolve, 2000));
    }
}


function goToAddress() {
    const addressElement = document.querySelector('.rodape');

    if (addressElement) {
    addressElement.scrollIntoView({
        behavior: 'smooth'
    });
    } else {
    alert("Endereço para retirada não encontrado!");
    }
}

function showPixQrCode(index) {
    const order = orderHistory[index];
    document.getElementById('myModal').classList.add('fullscreen');
    document.getElementById('qrCode').innerHTML = `<iframe src='${order.pixUrl}' style="width:100%; height:100%; border:none;"></iframe>`;
    openModal();
}

function generatePaymentId() {
    const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let paymentId = 'Pagamento';
    for (let i = 0; i < 6; i++) {
    paymentId += characters.charAt(Math.floor(Math.random() * characters.length));
    }
    return paymentId;
}

function clearOrderHistory() {
    if (confirm("Tem certeza que deseja apagar o histórico de pedidos?")) {
    orderHistory = [];
    localStorage.removeItem(blog);
    updateOrderHistoryDisplay();
    showNotification("Histórico de pedidos apagado!", 'success');
    }
}

function showTab(tabId) {
    const tabContents = document.querySelectorAll('.tab-content');
    const tabButtons = document.querySelectorAll('.tab-button');

    tabContents.forEach(content => {
    content.classList.remove('active');
    content.style.display = 'none';
    });

    tabButtons.forEach(button => {
    button.classList.remove('active');
    });

    const tabContent = document.getElementById(tabId);
    if (tabContent) {
    tabContent.classList.add('active');
    tabContent.style.display = 'block';
    } else {}

    const tabButton = document.querySelector(`.tab-button[data-tab="${tabId}"]`);

    if (tabButton) {
    tabButton.classList.add('active');
    } else {}

    const proceedToCheckoutButton = document.getElementById('proceedToCheckoutButton');

    if (proceedToCheckoutButton) {
    if (tabId === 'checkout') {
        proceedToCheckoutButton.style.display = 'none';
    } else {
        proceedToCheckoutButton.style.display = 'inline-block';
    }
    }
    document.getElementById(tabId).scrollIntoView({
    behavior: 'smooth'
    });
}

function resendWhatsappMessage(index) {
    const history = JSON.parse(localStorage.getItem(blog)) || [];
    const order = history[index];
    
    if (!order) {
        showNotification("Pedido não encontrado no histórico.", 'error');
        return;
    }

    const codigoOriginal = (order.cupomUtilizado && order.cupomUtilizado.codigoOriginal) ? order.cupomUtilizado.codigoOriginal : '';

    const addressData = order.address || {};
    const nomeCliente = addressData.name || "N/A";
    const emailCliente = addressData.email || "N/A";
    const telefoneCliente = addressData.phone || "N/A";
    const infoAdicional = addressData.additionalInfo || "";
    const dataCompra = new Date(order.timestamp).toLocaleDateString('pt-BR');

    const itensPedidoString = (order.items && order.items.length > 0) ? order.items.map(item => {
        const optionsString = [item.selectedSize, item.selectedsabor].filter(Boolean).join(' / ');
        const itemTotal = (item.price || 0) * (item.quantity || 1);
        return `${item.name} ${optionsString ? `(${optionsString})` : ''} (x${item.quantity}) - ${realBR(itemTotal)}`;
    }).join('\n') : "Nenhum item no pedido.";

    // String da entrega.
    const entregaString = order.deliveryOption === 'delivery'
        ? `*Endereço de Entrega:*\n${addressData.address || ''}, ${addressData.bairro || ''}, ${addressData.city || ''} - CEP: ${addressData.postcode || ''}`
        : `*Opção de Entrega:*\nRetirada no Local`;

    // --- 3. Monta a mensagem final, parte por parte ---
    const messageParts = [
        `*⚠ REENVIO DE PEDIDO ⚠*`,
        `*Pedido:* #${order.id}`,
        `-----------------------------------`,
        `*Dados do Cliente:*`,
        `*Nome:* ${nomeCliente}`,
        `*Email:* ${emailCliente}`,
        `*Telefone:* ${telefoneCliente}`,
        infoAdicional ? `*Info Adicional:* ${infoAdicional}` : null,
        `-----------------------------------`,
        entregaString,
        `-----------------------------------`,
        `*Itens do Pedido:*`,
        itensPedidoString,
        `-----------------------------------`,
        `*Resumo Financeiro:*`,
        `*Subtotal:* ${realBR(order.subtotal || 0)}`
    ];
    
    if (order.desconto && parseFloat(order.desconto) > 0) {
        const cupomInfoString = codigoOriginal ? ` (Cupom: ${codigoOriginal})` : '';
        messageParts.push(`*Desconto:* - ${realBR(order.desconto)}${cupomInfoString}`);
    }
  
    if (order.deliveryOption === 'delivery') {
        if (order.cupomUtilizado && order.cupomUtilizado.tipo === 'frete') {
            const cupomInfoString = codigoOriginal ? ` (Cupom: ${codigoOriginal})` : '';
            messageParts.push(`*Taxa de Entrega:* Frete Grátis${cupomInfoString}`);
        } else if (order.deliveryFee && parseFloat(order.deliveryFee) > 0) {
            messageParts.push(`*Taxa de Entrega:* ${realBR(order.deliveryFee)}`);
        }
    }

    messageParts.push(`*TOTAL:* *${realBR(order.total || 0)}*`);
    messageParts.push(`*Data do Pedido Original:* ${dataCompra}`);
    
    const whatsappMessage = messageParts.filter(part => part !== null).join('\n');
    const encodedMessage = encodeURIComponent(whatsappMessage);
    const whatsappLink = `https://wa.me/${whatsapp}?text=${encodedMessage}`;

    window.open(whatsappLink, '_blank');
    showNotification(`Mensagem do pedido #${order.id} reenviada para o WhatsApp!`, 'success');
}

function previousPage() {
    if (currentPage > 1) {
    currentPage--;
    displayProducts();
    document.getElementById('productList').scrollIntoView({
        behavior: 'smooth'
    });
    }
}

function nextPage() {
    const totalPages = Math.ceil(products.length / productsPerPage);
    if (currentPage < totalPages) {
    currentPage++;
    document.getElementById('productList').scrollIntoView({
        behavior: 'smooth'
    });
    displayProducts();
    }
}

function goToPage(page) {
    currentPage = page;
    displayProducts();
    document.getElementById('productList').scrollIntoView({
    behavior: 'smooth'
    });
}

function updatePaginationButtons(totalFilteredProducts) { // Modifique aqui
    const btnInicio = document.getElementById('btnInicio');
    const btnAnterior = document.getElementById('btnAnterior');
    const btnProximo = document.getElementById('btnProximo');

    // Modifique aqui para usar o total de produtos filtrados
    const totalPages = Math.ceil(totalFilteredProducts / productsPerPage);

    btnInicio.disabled = currentPage === 1;
    btnAnterior.disabled = currentPage === 1;
    btnProximo.disabled = currentPage >= totalPages || totalPages === 0; // Use >= para segurança

    btnInicio.onclick = () => goToPage(1);
    btnAnterior.onclick = previousPage;
    btnProximo.onclick = nextPage;
}

function showNotification(message, type = 'success') {
    const notificationContainer = document.getElementById('notification-container');

    if (!notificationContainer) {
        console.error("Elemento 'notification-container' não encontrado!");
        return;
    }

    const notification = document.createElement('div');
    notification.classList.add('notification', type);
    notification.textContent = message;

    // Adiciona notificação ao container
    notificationContainer.appendChild(notification);

    // Exibe a notificação
    setTimeout(() => notification.classList.add('show'), 30);

    // Remove a notificação após o tempo determinado
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
            if (notificationContainer.contains(notification)) {
                notificationContainer.removeChild(notification);
            }
        }, 500);
    }, 4000);

    // Remove notificação ao clicar nela
    notification.onclick = () => {
        notification.classList.remove('show');
        setTimeout(() => {
            if (notificationContainer.contains(notification)) {
                notificationContainer.removeChild(notification);
            }
        }, 500);
    };
}

    // --- Carrossel ---
    function initializeCarousel() {
        const carouselSlide = document.querySelector('.carousel-slide');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const carouselContainer = document.getElementById('featuredProductsCarousel'); 

        // Verifica se os elementos do carrossel existem
        if (!carouselSlide || !prevBtn || !nextBtn) {
            console.warn('Carrossel não inicializado corretamente. Verifique os elementos.');
            return; // Aborta a inicialização se algum elemento estiver faltando
        }

        let slideIndex = 0;
        let autoSlideInterval; // Variável para armazenar o intervalo do slideshow automático

        // Função para exibir um slide específico
        function showSlide() {
            // Evita erros se não houver produtos no carrossel
            if (carouselProducts.length === 0) return;

            slideIndex++;
            // Volta para o primeiro slide se chegar ao final
            if (slideIndex >= carouselProducts.length) {
                slideIndex = 0;
            }
            // Aplica a transformação para exibir o slide correto
            carouselSlide.style.transform = `translateX(-${slideIndex * 100}%)`;
        }

        function startAutoSlide() {
            autoSlideInterval = setInterval(showSlide, 10000);
        }

        // Função para pausar o slideshow automático
        function pauseAutoSlide() {
            // Limpa o intervalo para pausar o slideshow
            clearInterval(autoSlideInterval);
        }

        // Event listener para avançar o slide ao clicar no botão "próximo"
        nextBtn.addEventListener('click', () => {
            pauseAutoSlide(); // Pausa o slideshow ao interagir
            showSlide();
            startAutoSlide(); // Reinicia o slideshow após a interação
        });

        // Event listener para retroceder o slide ao clicar no botão "anterior"
        prevBtn.addEventListener('click', () => {
            pauseAutoSlide(); // Pausa o slideshow ao interagir
            slideIndex--;
            // Volta para o último slide se estiver no primeiro
            if (slideIndex < 0) {
                slideIndex = carouselProducts.length - 1;
            }
            // Aplica a transformação para exibir o slide correto
            carouselSlide.style.transform = `translateX(-${slideIndex * 100}%)`;
            startAutoSlide(); // Reinicia o slideshow após a interação
        });


function loadCarouselProducts() {
    carouselSlide.innerHTML = '';
    let sizesHTML = '';
    let quantityHTML = '';
    let discountBadgeHTML = '';
    let saborHTML = '';

    carouselProducts.forEach(product => {
        if (!product.available) return;

        const carouselItem = document.createElement('div');
        carouselItem.classList.add('carousel-item');

        // --- Selects de tamanho ---
        let sizeSelectId = `carouselSizeSelect_${product.name}`;
        const sizesHTML = product.sizes && product.sizes.length > 0 ? `
            <label for="${sizeSelectId}">Tamanho:</label>
            <select id="${sizeSelectId}" class="custom-select">
                ${product.sizes.map(size => `<option value="${size}">${size}</option>`).join('')}
            </select>
        ` : '';

        // --- Selects de sabor ---
        let saborSelectId = `carouselsaborSelect_${product.name}`;
        const saborHTML = product.sabor && product.sabor.length > 0 ? `
            <label for="${saborSelectId}">Sabor:</label>
            <select id="${saborSelectId}" class="custom-select">
                ${product.sabor.map(s => `<option value="${s}">${s}</option>`).join('')}
            </select>
        ` : '';

        // --- Select de quantidade ---
        let quantitySelectId = `carouselQuantitySelect_${product.name}`;
        const quantityHTML = `
            <label for="${quantitySelectId}">Quantidade:</label>
            <select id="${quantitySelectId}" class="custom-select">
              ${Array.from({ length: product.quantity }, (_, i) => i + 1)
                .map(qty => `<option value="${qty}">${qty}</option>`).join('')}
            </select>
        `;

        // --- Desconto ---
        const discountBadgeHTML = product.discount > 0 ? `<div class="discount-carrossel">-${product.discount}%</div>` : '';
         let detailsButtonHTML = '';
        if (product.description && product.description.trim().length > 0) {
            // Usamos aspas simples dentro do onclick para passar o nome do produto como string
            detailsButtonHTML = `<button class="btn-details" onclick="showDescriptionModal('${product.name}')">Veja todos os detalhes</button>`;
        }


        // --- Estrutura do item ---
        carouselItem.innerHTML = `
            ${discountBadgeHTML}
            <img src="${product.imageUrls[0] || ''}" alt="${product.name}">
            <h3>${product.name}</h3>
            <p>${
                product.discount > 0
                ? `De <strike class="backgroundred">R$ ${product.originalPrice.toFixed(2)}</strike>
                   Por <span class="backgroundverde">${realBR(product.price.toFixed(2))}</span>`
                : `<span class="backgroundverde">${realBR(product.price.toFixed(2))}</span>`
            }</p>
            <div class="button-group-carousel">
                ${sizesHTML}
                ${saborHTML}
                ${quantityHTML}
                ${detailsButtonHTML}
                <button class="add-to-cart-button" onclick="carouseladdToCart(this, '${product.name}')">Adicionar ao Carrinho</button>
                <button class="buy-now-button" onclick="buyNowCarousel(this, '${product.name}')">Comprar Agora</button>
            </div>
        `;

        // --- Adiciona no carrossel ---
        carouselSlide.appendChild(carouselItem);

        // --- Evento de fullscreen na imagem ---
        const img = carouselItem.querySelector('img');
        if (img) {
            img.addEventListener('click', () => openFullscreenImage(product.imageUrls[0]));
        }
    });
    }
    loadCarouselProducts();
    startAutoSlide();
        if (carouselContainer) {
        carouselContainer.classList.remove('loading');
    }
}

function carouseladdToCart(button, productName) {
 const product = carouselProducts.find(p => p.name === productName);

    if (!product) {
        showNotification("Produto não encontrado.", 'error');
        return;
    }

    const sizeSelectId = `carouselSizeSelect_${product.name}`;
    const sizeSelectElement = document.getElementById(sizeSelectId);
    const selectedSize = sizeSelectElement ? sizeSelectElement.value : "";

    const saborSelectId = `carouselsaborSelect_${product.name}`;
    const saborSelectElement = document.getElementById(saborSelectId);
    const selectedSabor = saborSelectElement ? saborSelectElement.value : "";

    const quantitySelectId = `carouselQuantitySelect_${product.name}`;
    const quantitySelectElement = document.getElementById(quantitySelectId);
    const selectedQuantity = quantitySelectElement ? quantitySelectElement.value : 1;
    ComprarProdutos(product, selectedQuantity, selectedSize, selectedSabor, false);
}

function buyNowCarousel(button, productName) {
    const product = carouselProducts.find(p => p.name === productName);

    if (!product) {
        showNotification("Produto não encontrado.", 'error');
        return;
    }

    const sizeSelectId = `carouselSizeSelect_${product.name}`;
    const sizeSelectElement = document.getElementById(sizeSelectId);
    const selectedSize = sizeSelectElement ? sizeSelectElement.value : "";

    const saborSelectId = `carouselsaborSelect_${product.name}`;
    const saborSelectElement = document.getElementById(saborSelectId);
    const selectedSabor = saborSelectElement ? saborSelectElement.value : "";

    const quantitySelectId = `carouselQuantitySelect_${product.name}`;
    const quantitySelectElement = document.getElementById(quantitySelectId);
    const selectedQuantity = quantitySelectElement ? quantitySelectElement.value : 1;

    // Chama a função auxiliar, indicando para redirecionar para o checkout
    ComprarProdutos(product, selectedQuantity, selectedSize, selectedSabor, true);
}


async function aplicarCupom() {
    const codigoInput = document.getElementById('cupomInput').value.toUpperCase();
    const cupomStatusEl = document.getElementById('cupomStatus');
    const aplicarBtn = document.getElementById('aplicarCupomBtn');

    // Se o campo estiver vazio, reseta tudo
    if (!codigoInput) {
        cupomAplicado = null;
        cupomStatusEl.textContent = "";
        updateCartDisplay();
        return;
    }

    // Desabilita o botão e mostra feedback de carregamento
    aplicarBtn.disabled = true;
    aplicarBtn.textContent = 'Aguarde...';
    cupomStatusEl.textContent = 'Verificando cupom...';
    cupomStatusEl.style.color = '#ffa200e0'; // Laranja para "aguardando"

    // Gera o hash a partir da entrada do usuário
    hashCupomParaVerificar = await generateHash(codigoInput);
    window.codigoOriginalCupom = codigoInput;

    // Remove qualquer script de verificação de cupom anterior para evitar conflitos
    const scriptAntigo = document.getElementById('cupomVerifierScript');
    
    if (scriptAntigo) {
        scriptAntigo.remove();
    }

    // Cria o novo script para a chamada JSONP
    const script = document.createElement('script');
    script.id = 'cupomVerifierScript'; // ID para fácil remoção posterior
    script.src = 'https://www.blogger.com/feeds/' + blog + '/pages/default?alt=json-in-script&callback=processarVerificacaodecupom';
    
    // Define o que fazer em caso de erro de rede ou blog inválido
    script.onerror = () => {
        showNotification("Erro de rede ao verificar o cupom. Tente novamente.", 'error');
        cupomStatusEl.textContent = 'Erro na verificação.';
        cupomStatusEl.style.color = 'var(--error-color)';
        
        window.codigoOriginalCupom = null;
        aplicarBtn.disabled = false;
        aplicarBtn.textContent = 'Aplicar';
    };

    // Adiciona o script ao corpo do documento, o que dispara a requisição
    document.body.appendChild(script);

 window.processarVerificacaodecupom = (data) => {
    const cupomStatusEl = document.getElementById('cupomStatus');
    const aplicarBtn = document.getElementById('aplicarCupomBtn');
    let cupomEncontrado = false;
    let cupomValido = null;

    const regexCupom = /^[a-f0-9]{64}:(\d+(\.\d+)?):(percentual|fixo|frete)$/;

    if (data && data.feed && data.feed.entry) {
        for (const entry of data.feed.entry) {
            if (cupomEncontrado) break;

            if (entry.content && entry.content.$t) {
                const lines = entry.content.$t.split('\n').map(line => line.replace(/<[^>]*>/g, '').trim());

                for (const line of lines) {
                    if (regexCupom.test(line)) {
                        const [hash, valor, tipo] = line.split(':');

                        if (hash === hashCupomParaVerificar) {
                            cupomValido = {
                                hash: hash,
                                valor: parseFloat(valor),
                                tipo: tipo
                            };
                            cupomEncontrado = true;
                            break;
                        }
                    }
                }
            }
        }
    }

    if (cupomEncontrado) {
        cupomValido.codigoOriginal = window.codigoOriginalCupom;
        cupomAplicado = cupomValido; // Armazena o objeto do cupom válido
        
        let mensagemSucesso = ''; // Variável para a mensagem personalizada

        // Constrói a mensagem com base no tipo do cupom
        switch (cupomValido.tipo) {
            case 'percentual':
                mensagemSucesso = `Desconto de ${cupomValido.valor}% aplicado!`;
                break;
            case 'fixo':
                // Usamos a função realBR para formatar o valor como moeda
                mensagemSucesso = `Desconto de ${realBR(cupomValido.valor)} aplicado!`;
                break;
            case 'frete':
                mensagemSucesso = `Frete Grátis ativado!`;
                break;
            default:
                // Mensagem padrão caso algo inesperado aconteça
                mensagemSucesso = `Cupom aplicado com sucesso!`;
        }

        // Exibe a mensagem personalizada
        cupomStatusEl.textContent = mensagemSucesso;
        cupomStatusEl.style.color = 'var(--success-color)';
        showNotification(mensagemSucesso, 'success');

    } else {
        cupomAplicado = null;
        cupomStatusEl.textContent = 'Cupom inválido ou expirado.';
        cupomStatusEl.style.color = 'var(--error-color)';
        showNotification('Cupom inválido ou expirado!', 'error');
    }

    window.codigoOriginalCupom = null; 

    // Limpa a variável global e o script, e reabilita o botão
    hashCupomParaVerificar = '';
    const scriptElement = document.getElementById('cupomVerifierScript');
    if (scriptElement) {
        scriptElement.remove();
    }
    aplicarBtn.disabled = false;
    aplicarBtn.textContent = 'Aplicar';

    // Recalcula o total e atualiza toda a exibição do carrinho
    updateCartDisplay();
};
}

// Não se esqueça de ligar a função ao botão "Aplicar"
document.getElementById('aplicarCupomBtn').addEventListener('click', aplicarCupom);

// Função para validar CEP
async function isCepValido(cep) {
    let cepLimpo = cep.replace(/\D/g, '');
    if (cepLimpo.length !== 8) return false;

    try {
        let response = await fetch(`https://viacep.com.br/ws/${cepLimpo}/json/`);
        let data = await response.json();
        if (data.erro) return false;

        let isValid = true;

        // Converte as strings em listas
        let ufList = unidadefederativa ? unidadefederativa.split(/\s+/).map(u => u.toUpperCase()) : [];
        let cidadesList = cidade ? cidade.split(/\s+/).map(c => c.toLowerCase()) : [];
        let bairrosList = bairro ? bairro.split(/\s+/).map(b => b.toLowerCase()) : [];

        // Verificação UF
        if (ufList.length > 0 && !ufList.includes(data.uf.toUpperCase())) {
            isValid = false;
        }

        // Verificação Cidade
        if (cidadesList.length > 0 && !cidadesList.includes(data.localidade.toLowerCase())) {
            isValid = false;
        }

        // Verificação Bairro
        if (bairrosList.length > 0 && data.bairro && !bairrosList.includes(data.bairro.toLowerCase())) {
            isValid = false;
        }

        return isValid;

    } catch (error) {
        console.error("Erro ao buscar o CEP:", error);
        return false;
    }
}

function increaseCartItemQuantity(index) {
    const item = cart[index];
    if (!item) return;

    // Encontra o produto original para verificar o estoque máximo
    const productData = products.find(p => p.name === item.name);
    const maxQuantity = productData ? productData.quantity : item.quantity;

    if (item.quantity < maxQuantity) {
        item.quantity++;
        localStorage.setItem(blog + 'cart', JSON.stringify(cart));
        updateCartDisplay();
        updateFloatingCartCount();
    } else {
        showNotification(`Estoque máximo para "${item.name}" atingido.`, 'error');
    }
}

function decreaseCartItemQuantity(index) {
    const item = cart[index];
    if (!item) return;

    item.quantity--;

    if (item.quantity <= 0) {
        removeFromCart(index); // Remove se a quantidade for zero
    } else {
        localStorage.setItem(blog + 'cart', JSON.stringify(cart));
        updateCartDisplay();
        updateFloatingCartCount();
    }
}

const searchInput = document.getElementById('searchInput');
const clearSearchBtn = document.getElementById('clearSearchBtn');

searchInput.addEventListener('input', () => {
    currentPage = 1; 
    displayProducts();

    // Mostra ou esconde o botão "X"
    if (searchInput.value.length > 0) {
        clearSearchBtn.classList.add('show');
    } else {
        clearSearchBtn.classList.remove('show');
    }
});

clearSearchBtn.addEventListener('click', () => {
    searchInput.value = ''; 
    clearSearchBtn.classList.remove('show');
    
    currentPage = 1;
    displayProducts(); 
    searchInput.focus();
});

// Evento ao perder foco do campo CEP
document.getElementById("CEP").addEventListener("blur", async function () {
    let cep = this.value.replace(/\D/g, ''); // Remove caracteres não numéricos

    if (cep.length === 8) {
        try {
            let response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
            let data = await response.json();
            if (!data.erro) {
                let valid = true;
                let errorMessage = "Apenas CEPs ";
                let restrictions = [];

                // Listas
                let ufList = unidadefederativa ? unidadefederativa.split(/\s+/).map(u => u.toUpperCase()) : [];
                let cidadesList = cidade ? cidade.split(/\s+/).map(c => c.toLowerCase()) : [];
                let bairrosList = bairro ? bairro.split(/\s+/).map(b => b.toLowerCase()) : [];

                // UF
                if (ufList.length > 0 && !ufList.includes(data.uf.toUpperCase())) {
                    valid = false;
                    restrictions.push("da UF " + unidadefederativa);
                }

                // Cidade
                if (cidadesList.length > 0 && !cidadesList.includes(data.localidade.toLowerCase())) {
                    valid = false;
                    restrictions.push("da cidade " + cidade);
                }

                // Bairro
                if (bairrosList.length > 0 && data.bairro && !bairrosList.includes(data.bairro.toLowerCase())) {
                    valid = false;
                    restrictions.push("do bairro " + bairro);
                }

                if (valid) {
                    document.getElementById("Endereço").value = data.logradouro + ', casa:';
                    document.getElementById("Bairro").value = data.bairro;
                    document.getElementById("Cidade").value = data.localidade;
                } else {
                    errorMessage += restrictions.join(", ");
                    errorMessage += " são aceitos!";
                    showNotification(errorMessage, 'error');
                    this.value = "";
                    document.getElementById("Endereço").value = "";
                    document.getElementById("Bairro").value = "";
                    document.getElementById("Cidade").value = "";
                }

            } else {
                showNotification("CEP não encontrado!", 'error');
            }
        } catch (error) {
            console.error("Erro ao buscar o CEP:", error);
        }
    } else {
        showNotification("CEP inválido!", 'error');
    }
});

function toggleAddressFields() {
    const deliveryOption = document.getElementById('deliveryOption').value;
    const addressFields = document.getElementById('addressFields');
    const avisoTaxaEl = document.getElementById('avisoTaxaEntrega'); // Pega o elemento do aviso

    if (deliveryOption === 'delivery') {
        addressFields.style.display = 'block';
        document.getElementById('CEP').setAttribute('required', '');
        document.getElementById('Endereço').setAttribute('required', '');
        document.getElementById('Cidade').setAttribute('required', '');
        document.getElementById('Bairro').setAttribute('required', '');

        // --- LÓGICA DO AVISO ---
        if (taxadeenvio > 0) {
            // Mostra o aviso fixo
            avisoTaxaEl.textContent = `Atenção: Será aplicada uma taxa de entrega no valor de ${realBR(taxadeenvio)}.`;
            avisoTaxaEl.style.display = 'block';
            exibirModalErro("Atenção: Será aplicada uma taxa de entrega no valor de " + realBR(taxadeenvio) + ".", false, true, 'aviso');
        } else {
            // Se a taxa for 0 ou não definida, avisa que a entrega é grátis
            avisoTaxaEl.textContent = 'A entrega em domicílio é gratuita!';
            avisoTaxaEl.style.display = 'block';
            showNotification('A entrega é gratuita!', 'success');
        }
        // --- FIM DA LÓGICA DO AVISO ---

    } else {
        addressFields.style.display = 'none';
        avisoTaxaEl.style.display = 'none'; // Esconde o aviso se for retirada
        
        document.getElementById('CEP').removeAttribute('required');
        document.getElementById('Endereço').removeAttribute('required');
        document.getElementById('Cidade').removeAttribute('required');
        document.getElementById('Bairro').removeAttribute('required');

        document.getElementById('CEP').value = '';
        document.getElementById('Endereço').value = '';
        document.getElementById('Cidade').value = '';
        document.getElementById('Bairro').value = '';
    }
    
    updateCartDisplay(); // Mantém esta linha para recalcular o total
}

/**
 * Verifica o status da loja (aberta, fechada, em pausa) com base em múltiplos
 * períodos de funcionamento e exibe mensagens personalizadas.
 */
function getStoreStatus() {
    // Desativa qualquer verificação automática anterior para evitar loops
    if (window.intervalID2) {
        clearInterval(window.intervalID2);
    }

    const now = new Date();
    // Para testar um horário diferente, descomente a linha abaixo:
    // now.setHours(13, 30); // Ex: Testando às 13:30

    const dayOfWeek = now.getDay();
    const currentTimeInMinutes = now.getHours() * 60 + now.getMinutes();
    
    const diasSemana = ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'];
    const diaAtual = diasSemana[dayOfWeek];

    let status = {
        aberta: false,
        emPausa: false,
        proximaAbertura: -1,
        mensagem: `Hoje estamos fechados.`
    };

    // Função auxiliar para converter "HHhMM" em minutos
    const parseTime = (timeStr) => {
        const [hour, minute] = timeStr.split('h');
        return parseInt(hour) * 60 + parseInt(minute || 0);
    };

    // Encontra o horário para o dia atual
    const horariosDoDiaStr = horariosFuncionamento.split(';')
        .find(h => h.trim().startsWith(diaAtual));
    
    if (horariosDoDiaStr) {
        const tempoStr = horariosDoDiaStr.split(':')[1].trim();

        if (tempoStr.toUpperCase() !== 'FECHADO') {
            const periodos = tempoStr.split(','); // Divide em múltiplos períodos, ex: "08h-12h, 14h-18h"

            for (const periodo of periodos) {
                const [inicioStr, fimStr] = periodo.trim().split('-');
                const openingTime = parseTime(inicioStr);
                const closingTime = parseTime(fimStr);

                // Verifica se o horário atual está dentro de algum período de funcionamento
                if (currentTimeInMinutes >= openingTime && currentTimeInMinutes < closingTime) {
                    status.aberta = true;
                    break; // Se está aberto em um período, não precisa checar os outros
                }
                
                // Se ainda não estiver aberto, guarda o próximo horário de abertura
                if (currentTimeInMinutes < openingTime && status.proximaAbertura === -1) {
                    status.proximaAbertura = openingTime;
                }
            }

            // Se a loja não está aberta, mas teve períodos hoje, verifica se está em pausa
            if (!status.aberta && status.proximaAbertura !== -1) {
                status.emPausa = true;
                const proximaHora = Math.floor(status.proximaAbertura / 60).toString().padStart(2, '0');
                const proximoMinuto = (status.proximaAbertura % 60).toString().padStart(2, '0');
                status.mensagem = `Estamos em pausa! Reabriremos às ${proximaHora}h${proximoMinuto}.`;
            } else if (!status.aberta) {
                 status.mensagem = `Nosso horário de funcionamento hoje já encerrou.`;
            }
        }
    }

    // --- Atualiza a interface com base no status encontrado ---
  const lojaStatusEl = document.getElementById('statusLoja');
    const estavaAberto = isOpen; // Guarda o estado anterior da loja
    isOpen = status.aberta;

    if (isOpen) {
        lojaStatusEl.innerHTML = '<p class="loja-aberta">Loja aberta, Boas compras!</p>';

    } else {
        desativarInterface();
        desativarAbasCarrinho(); 

        lojaStatusEl.innerHTML = `<p class="loja-fechada">${status.emPausa ? 'Loja em Pausa!' : 'Loja Fechada!'}</p>`;
        
        const productsDiv = document.getElementById('products');
        productsDiv.innerHTML = `
            <div class="desativado">
                <h1>${status.emPausa ? '⏸️' : '🌙'}</h1>
                <p style="font-size: 1.2em;">${status.mensagem}</p>
                <br>
                <h4>Nosso Horário de Funcionamento:</h4>
                ${generateScheduleTable(horariosFuncionamento)}
            </div>
        `;
    }

    // Verifica o status novamente em 1 minuto
    window.intervalID2 = setInterval(getStoreStatus, 60000);
}

// Sua função `desativarInterface()` continua a mesma.
function desativarInterface() {
    const minecart = document.getElementById('floating-cart');
    // ... o resto da sua função ...
}

function generateScheduleTable(horarios) {
    const horariosArray = horarios.split(';');
    let tableHTML = `
    <div class="schedule-table-container">
        <table class="schedule-table">
            <thead>
                <tr>
                    <th>Dia da Semana</th>
                    <th>Horário de Funcionamento</th>
                </tr>
            </thead>
            <tbody>`;

    horariosArray.forEach(horario => {
        const [dia, tempo] = horario.split(':');
        const diaTrimmed = dia.trim();
        let tempoFormatado = tempo.trim();

        if (tempoFormatado.toUpperCase() === 'FECHADO') {
            tempoFormatado = '<span>Fechado</span>'; 
        } else {
            // Formata múltiplos períodos com uma quebra de linha para melhor visualização
            tempoFormatado = tempoFormatado.replace(/,\s*/g, '<br>');
        }
        
        tableHTML += `<tr><td>${diaTrimmed}</td><td>${tempoFormatado}</td></tr>`;
    });

    tableHTML += `
            </tbody>
        </table>
    </div>
    `;
    return tableHTML;
}

function desativarAbasCarrinho() {
    const abasParaBloquear = ['cart', 'checkout'];
    abasParaBloquear.forEach(tabId => {
        const tabButton = document.querySelector(`.tab-button[data-tab="${tabId}"]`);
        if (tabButton) {
            tabButton.classList.add('tab-disabled');
            tabButton.disabled = true; // Impede o clique
        }
    });

    // Garante que a aba de Histórico seja a ativa quando a loja fecha
    showTab('orderHistory');
}

function ativarAbasCarrinho() {
    const abasParaReativar = ['cart', 'checkout'];
    abasParaReativar.forEach(tabId => {
        const tabButton = document.querySelector(`.tab-button[data-tab="${tabId}"]`);
        if (tabButton) {
            tabButton.classList.remove('tab-disabled');
            tabButton.disabled = false; // Permite o clique novamente
        }
    });

    // Volta para a aba do Carrinho como padrão
    showTab('cart'); 
}

function openModalhorarios() {
    const modal = document.getElementById("horariosModal");
    const content = document.getElementById("horariosContent");
    content.innerHTML = `<p class="loja-fechada">Horário de funcionamento:</p> ${generateScheduleTable(horariosFuncionamento)}`;
    modal.style.display = "block";
}

function closeModalhorarios() {
    const modal = document.getElementById("horariosModal");
    modal.style.display = "none";
}

window.onclick = function (event) {
    const modal = document.getElementById("horariosModal");
    if (event.target == modal) {
    modal.style.display = "none";
    }
}

function realBR(valorNumerico) {
    const valor = parseFloat(valorNumerico);
    if (isNaN(valor)) {
        return "R$ 0,00";
    }
    return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
}

function realBR2(input) { //R$ 325.325.232,53
    valor = input.replace(/\D/g, '');
    valor = (parseFloat(valor) / 100).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    valor = valor.toLocaleString('pt-BR');
	return input.value = valor; 
}

function AbrirWhatsapp() {
    window.open("https://api.whatsapp.com/send?phone=" + encodeURIComponent(whatsapp), '_blank');
}

    // --- SELECIONA OS ELEMENTOS DO FORMULÁRIO ---
const inputCep = document.getElementById('CEP');
const inputEmail = document.getElementById('Email');
const inputWhatsApp = document.getElementById('WhatsApp');

    // --- FORMATADOR DE CEP ---
    if (inputCep) {
        inputCep.addEventListener('input', () => {
            let cep = inputCep.value.replace(/\D/g, '');
            cep = cep.substring(0, 8);
            cep = cep.replace(/(\d{5})(\d)/, '$1-$2');
            inputCep.value = cep;
        });
    }

    // --- VALIDADOR DE EMAIL ---
    if (inputEmail) {
        inputEmail.addEventListener('blur', () => {
            const email = inputEmail.value;

            const emailRegex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;

            if (emailRegex.test(email)) {
                inputEmail.style.borderColor = ''; 
            } else {
                if (email.length > 0) {
                   inputEmail.style.borderColor = 'red';
                } else {
                    inputEmail.style.borderColor = '';
                }
            }
        });
    }

    // --- FORMATADOR DE WHATSAPP ---
    if (inputWhatsApp) {
        inputWhatsApp.addEventListener('input', () => {
            let whatsapp = inputWhatsApp.value.replace(/\D/g, '');
            whatsapp = whatsapp.substring(0, 11);
            if (whatsapp.length > 10) {
                whatsapp = whatsapp.replace(/^(\d{2})(\d{5})(\d{4})$/, '($1) $2-$3');
            } else if (whatsapp.length > 11) {
                whatsapp = whatsapp.replace(/^(\d{2})(\d{4})(\d{0,4})$/, '($1) $2-$3');
            } else if (whatsapp.length > 2) {
                whatsapp = whatsapp.replace(/^(\d{2})(\d*)$/, '($1) $2');
            } else if (whatsapp.length > 0) {
                whatsapp = whatsapp.replace(/^(\d*)$/, '($1');
            }
            inputWhatsApp.value = whatsapp;
        });
    }


const button = document.getElementById("whatswidget-button");
    const conversation = document.getElementById("whatswidget-conversation");
    let chatOpen = false;

function openChat() {
    if (!chatOpen) {
    conversation.style.display = "block";
    conversation.style.opacity = "1";
    } else {
    conversation.style.opacity = "0";
    conversation.style.display = "none";
    }
    chatOpen = !chatOpen;
}
button.addEventListener("click", openChat);


const backToTopButton = document.getElementById("backToTopBtn");

function toggleBackToTopButton() {
    const backToTopButton = document.getElementById("backToTopBtn");
    if (!backToTopButton) return;

    // Mostra o botão após rolar 300px para baixo
    if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
        backToTopButton.style.display = "block";
    } else {
        backToTopButton.style.display = "none";
    }
}

function scrollToTop() {
    window.scrollTo({
        top: 0,
        behavior: 'smooth'
    });
}

window.onscroll = function() {
    toggleBackToTopButton();
};

backToTopButton.addEventListener('click', scrollToTop);
</script>

</body>

</html>